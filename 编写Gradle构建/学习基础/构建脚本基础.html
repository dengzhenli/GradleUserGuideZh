 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# 构建脚本基础

内容

* [项目与任务](#sec:projects_and_tasks)
* [你好，世界](#sec:hello_world)
* [构建脚本是代码](#sec:build_scripts_are_code)
* [任务依赖性](#sec:task_dependencies)
* [动态任务](#sec:dynamic_tasks)
* [处理现有任务](#sec:manipulating_existing_tasks)
* [Groovy DSL快捷方式符号](#sec:shortcut_notations)
* [额外任务属性](#sec:extra_task_properties)
* [使用Ant任务](#sec:using_ant_tasks_tutorial)
* [使用方法](#sec:using_methods)
* [默认任务](#sec:default_tasks)
* [通过DAG进行配置](#configure-by-dag)
* [构建脚本的外部依赖关系](#sec:build_script_external_dependencies)
* [进一步阅读](#further_reading)

本章向您介绍编写Gradle构建脚本的基础。要快速动手入门，请尝试以下[分步示例之一]()。

## [](#sec:projects_and_tasks)[项目与任务](#sec:projects_and_tasks)

Gradle中的所有内容都位于两个基本概念之上：_项目_和_任务_。

每个Gradle构建都由一个或多个_项目组成_。一个项目代表什么取决于您使用Gradle做的事情。例如，一个项目可能代表一个JAR库或一个Web应用程序。它可能表示从其他项目产生的JAR组装而成的发行版ZIP。项目不一定代表要构建的事物。它可能表示要完成的事情，例如将应用程序部署到暂存或生产环境。暂时不要担心这是否有点含糊。Gradle的按惯例构建支持为项目的定义添加了更具体的定义。

每个项目由一个或多个_任务组成_。任务代表构建执行的一些原子工作。这可能是编译某些类，创建JAR，生成Javadoc或将一些存档发布到存储库。

现在，我们将研究在一个项目中构建一些简单的任务。后面的章节将介绍处理多个项目，以及有关处理项目和任务的更多信息。

## [](#sec:hello_world)[你好，世界](#sec:hello_world)

您可以使用以下`gradle`命令运行Gradle构建。该`gradle`命令`build.gradle`在当前目录中查找名为的文件。\[[1](#_footnotedef_1 "查看脚注。")\]我们严格地将其称为构建配置脚本，尽管我们将在后面看到，但我们将此`build.gradle`文件称为_构建脚本_。构建脚本定义项目及其任务。

要尝试此操作，请创建以下名为的构建脚本`build.gradle`。

例子1.您的第一个构建脚本

`Groovy``Kotlin`

build.gradle

task hello \{ doLast \{ println 'Hello world\!' \} \}

 

1

task hello \{

2

 doLast \{

3

 println 'Hello world\!'

4

 \}

5

\}

在命令行外壳中，移至包含的目录并使用以下命令执行构建脚本`gradle \-q hello`：

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="title" style="color:rgb(85, 85, 85);font-size:1.25rem;"><font><font>怎么</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">-q</code><font><font>办？</font></font></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>本用户指南中的大多数示例都使用</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">-q</code><font><font>命令行选项运行。</font><font>这样可以取消Gradle的日志消息，从而仅显示任务的输出。</font><font>这样可以使本用户指南中的示例输出更加清晰。</font><font>如果不想，则不需要使用此选项。</font><font>有关</font><font>影响Gradle输出的命令行选项的更多详细信息，</font><font>请参见</font></font><a href="" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>日志记录</font></font></a><font><font>。</font></font></p></div></td></tr></tbody></table>

例子2.建立脚本的执行

输出**`gradle -q hello`**

\> gradle -q你好 你好，世界！

这里发生了什么？此构建脚本定义了一个名为的任务`hello`，并向其中添加了一个动作。当您运行时`gradle hello`，Gradle将执行`hello`任务，该任务又将执行您提供的操作。该动作只是一个包含一些要执行代码的块。

如果您认为这看起来类似于Ant的目标，那将是正确的。Gradle任务等效于Ant目标，但正如您将看到的那样，它们的功能要强大得多。我们使用了与Ant不同的术语，因为我们认为“_任务_”一词比“_目标_”一词更具表现力。不幸的是，这会引起与Ant的术语冲突，因为Ant会调用其命令，例如`javac`或`copy`任务。因此，当我们谈论任务时，我们_总是_指Gradle任务，它等同于Ant的目标。如果我们谈论Ant任务（Ant命令），我们明确地说_Ant任务_。

## [](#sec:build_scripts_are_code)[构建脚本是代码](#sec:build_scripts_are_code)

Gradle的构建脚本为您提供了Groovy和Kotlin的全部功能。作为一个开胃菜，看看这个：

例子3.在Gradle的任务中使用Groovy或Kotlin

`Groovy``Kotlin`

build.gradle

task upper \{ doLast \{ String someString = 'mY\_nAmE' println "Original: \$someString" println "Upper case: \$\{someString.toUpperCase\(\)\}" \} \}

 

1

task upper \{

2

 doLast \{

3

 String someString \= 'mY\_nAmE'

4

 println "Original: \$someString"

5

 println "Upper case: \$\{someString.toUpperCase\(\)\}"

6

 \}

7

\}

输出**`gradle -q upper`**

\> gradle -q上 原文：mY\_nAmE 大写：MY\_NAME

要么

例子4.在Gradle的任务中使用Groovy或Kotlin

`Groovy``Kotlin`

build.gradle

task count \{ doLast \{ 4.times \{ print "\$it " \} \} \}

 

1

task count \{

2

 doLast \{

3

 4.times \{ print "\$it " \}

4

 \}

5

\}

输出**`gradle -q count`**

\> gradle -q计数 0 1 2 3

## [](#sec:task_dependencies)[任务依赖性](#sec:task_dependencies)

您可能已经猜到了，您可以声明依赖于其他任务的任务。

例子5.依赖于其他任务的任务声明

`Groovy``Kotlin`

build.gradle

task hello \{ doLast \{ println 'Hello world\!' \} \} task intro \{ dependsOn hello doLast \{ println "I'm Gradle" \} \}

 

1

task hello \{

2

 doLast \{

3

 println 'Hello world\!'

4

 \}

5

\}

6

task intro \{

7

 dependsOn hello

8

 doLast \{

9

 println "I'm Gradle"

10

 \}

11

\}

输出**`gradle -q intro`**

\> gradle -q简介 你好，世界！ 我是摇篮

要添加依赖项，不需要存在相应的任务。

例子6.懒惰的dependOn-其他任务不存在（还）

`Groovy``Kotlin`

build.gradle

task taskX \{ dependsOn 'taskY' doLast \{ println 'taskX' \} \} task taskY \{ doLast \{ println 'taskY' \} \}

 

1

task taskX \{

2

 dependsOn 'taskY'

3

 doLast \{

4

 println 'taskX'

5

 \}

6

\}

7

task taskY \{

8

 doLast \{

9

 println 'taskY'

10

 \}

11

\}

输出**`gradle -q taskX`**

\> gradle -q taskX TaskY TaskX

`taskX`to的依赖关系`taskY`可以在`taskY`定义之前声明。对于多项目构建，这种自由非常重要。[将依赖项添加到任务]()中将详细讨论任务依赖[项]()。

请注意，在引用尚未定义的任务时，不能使用[快捷方式表示法](#sec:shortcut_notations)。

## [](#sec:dynamic_tasks)[动态任务](#sec:dynamic_tasks)

Groovy或Kotlin的功能可用于定义任务以外的其他功能。例如，您也可以使用它动态创建任务。

例子7.动态创建任务

`Groovy``Kotlin`

build.gradle

4.times \{ counter -> task "task\$counter" \{ doLast \{ println "I'm task number \$counter" \} \} \}

 

1

4.times \{ counter \->

2

 task "task\$counter" \{

3

 doLast \{

4

 println "I'm task number \$counter"

5

 \}

6

 \}

7

\}

输出**`gradle -q task1`**

\> gradle -q task1 我是任务编号1

## [](#sec:manipulating_existing_tasks)[处理现有任务](#sec:manipulating_existing_tasks)

创建任务后，即可通过_API_对其进行访问。例如，您可以使用它在运行时为任务动态添加依赖项。蚂蚁不允许这样的事情。

例子8.通过API访问任务-添加依赖

`Groovy``Kotlin`

build.gradle

4.times \{ counter -> task "task\$counter" \{ doLast \{ println "I'm task number \$counter" \} \} \} task0.dependsOn task2, task3

 

1

4.times \{ counter \->

2

 task "task\$counter" \{

3

 doLast \{

4

 println "I'm task number \$counter"

5

 \}

6

 \}

7

\}

8

task0.dependsOn task2, task3

输出**`gradle -q task0`**

\> gradle -q task0 我是任务2 我是任务3 我的任务编号为0

或者，您可以将行为添加到现有任务。

示例9.通过API访问任务-添加行为

`Groovy``Kotlin`

build.gradle

task hello \{ doLast \{ println 'Hello Earth' \} \} hello.doFirst \{ println 'Hello Venus' \} hello.configure \{ doLast \{ println 'Hello Mars' \} \} hello.configure \{ doLast \{ println 'Hello Jupiter' \} \}

 

1

task hello \{

2

 doLast \{

3

 println 'Hello Earth'

4

 \}

5

\}

6

hello.doFirst \{

7

 println 'Hello Venus'

8

\}

9

hello.configure \{

10

 doLast \{

11

 println 'Hello Mars'

12

 \}

13

\}

14

hello.configure \{

15

 doLast \{

16

 println 'Hello Jupiter'

17

 \}

18

\}

输出**`gradle -q hello`**

\> gradle -q你好 你好金星 你好地球 你好火星 你好木星

调用`doFirst`和`doLast`可以执行多次。他们将操作添加到任务操作列表的开始或结尾。执行任务时，将按顺序执行操作列表中的操作。

## [](#sec:shortcut_notations)[Groovy DSL快捷方式符号](#sec:shortcut_notations)

访问_现有_任务有一种方便的表示法。每个任务都可以作为构建脚本的属性来使用：

例子10.将任务作为构建脚本的属性进行访问

build.gradle

task hello \{ doLast \{ println 'Hello world\!' \} \} hello.doLast \{ println "Greetings from the \$hello.name task." \}

 

1

task hello \{

2

 doLast \{

3

 println 'Hello world\!'

4

 \}

5

\}

6

hello.doLast \{

7

 println "Greetings from the \$hello.name task."

8

\}

输出**`gradle -q hello`**

\> gradle -q你好 你好，世界！ 来自hello任务的问候。

这样可以实现非常可读的代码，尤其是在使用插件提供的任务（例如`compile`任务）时。

## [](#sec:extra_task_properties)[额外任务属性](#sec:extra_task_properties)

您可以将自己的属性添加到任务。要添加名为的属性`myProperty`，请设置`ext.myProperty`为初始值。从那时起，可以像预定义的任务属性一样读取和设置属性。

例子11.向任务添加额外的属性

`Groovy``Kotlin`

build.gradle

task myTask \{ ext.myProperty = "myValue" \} task printTaskProperties \{ doLast \{ println myTask.myProperty \} \}

 

1

task myTask \{

2

 ext.myProperty \= "myValue"

3

\}

4

5

task printTaskProperties \{

6

 doLast \{

7

 println myTask.myProperty

8

 \}

9

\}

输出**`gradle -q printTaskProperties`**

\> gradle -q printTaskProperties myValue

额外的属性不仅限于任务。您可以在[Extra属性中]()阅读有关它们的更多信息。

## [](#sec:using_ant_tasks_tutorial)[使用Ant任务](#sec:using_ant_tasks_tutorial)

蚂蚁任务是Gradle中的一等公民。仅仅依靠Groovy，Gradle就可以为Ant任务提供出色的集成。Groovy附带了出色的功能`AntBuilder`。与从`build.xml`文件中使用Ant任务相比，使用Gradle中的Ant任务既方便又强大。它也可以从Kotlin使用。从下面的示例中，您可以学习如何执行Ant任务以及如何访问Ant属性：

例子12.使用AntBuilder执行ant.loadfile目标

`Groovy``Kotlin`

build.gradle

task loadfile \{ doLast \{ def files = file\('./antLoadfileResources'\).listFiles\(\).sort\(\) files.each \{ File file -> if \(file.isFile\(\)\) \{ ant.loadfile\(srcFile: file, property: file.name\) println " \*\*\* \$file.name \*\*\*" println "\$\{ant.properties\[file.name\]\}" \} \} \} \}

 

1

task loadfile \{

2

 doLast \{

3

 def files \= file\('./antLoadfileResources'\).listFiles\(\).sort\(\)

4

 files.each \{ File file \->

5

 if \(file.isFile\(\)\) \{

6

 ant.loadfile\(srcFile: file, property: file.name\)

7

 println " \*\*\* \$file.name \*\*\*"

8

 println "\$\{ant.properties\[file.name\]\}"

9

 \}

10

 \}

11

 \}

12

\}

输出**`gradle -q loadfile`**

\> gradle -q加载文件 \*\*\*敏捷.manifesto.txt \*\*\* 个人与流程和工具之间的互动 通过全面的文档工作软件 客户合作而非合同谈判 响应计划变更 \*\*\* gradle.manifesto.txt \*\*\* 使不可能变为可能，使容易成为可能，并使容易变得优雅。 （由Moshe Feldenkrais启发）

您可以在构建脚本中使用Ant进行更多操作。您可以在[Ant中]()找到更多信息。

## [](#sec:using_methods)[使用方法](#sec:using_methods)

Gradle扩展了如何组织构建逻辑。上面示例中组织构建逻辑的第一级是提取方法。

例子13.使用方法组织构建逻辑

`Groovy``Kotlin`

build.gradle

task checksum \{ doLast \{ fileList\('./antLoadfileResources'\).each \{ File file -> ant.checksum\(file: file, property: "cs\_\$file.name"\) println "\$file.name Checksum: \$\{ant.properties\["cs\_\$file.name"\]\}" \} \} \} task loadfile \{ doLast \{ fileList\('./antLoadfileResources'\).each \{ File file -> ant.loadfile\(srcFile: file, property: file.name\) println "I'm fond of \$file.name" \} \} \} File\[\] fileList\(String dir\) \{ file\(dir\).listFiles\(\{file -> file.isFile\(\) \} as FileFilter\).sort\(\) \}

 

1

task checksum \{

2

 doLast \{

3

 fileList\('./antLoadfileResources'\).each \{ File file \->

4

 ant.checksum\(file: file, property: "cs\_\$file.name"\)

5

 println "\$file.name Checksum: \$\{ant.properties\["cs\_\$file.name"\]\}"

6

 \}

7

 \}

8

\}

9

10

task loadfile \{

11

 doLast \{

12

 fileList\('./antLoadfileResources'\).each \{ File file \->

13

 ant.loadfile\(srcFile: file, property: file.name\)

14

 println "I'm fond of \$file.name"

15

 \}

16

 \}

17

\}

18

19

File\[\] fileList\(String dir\) \{

20

 file\(dir\).listFiles\(\{file \-> file.isFile\(\) \} as FileFilter\).sort\(\)

21

\}

输出**`gradle -q loadfile`**

\> gradle -q加载文件 我喜欢agile.manifesto.txt 我喜欢gradle.manifesto.txt

稍后您将看到可以在多项目构建中的子项目之间共享这种方法。如果您的构建逻辑变得更加复杂，Gradle将为您提供其他非常方便的组织方式。我们为此花了整整一章。请参阅[组织Gradle项目]()。

## [](#sec:default_tasks)[默认任务](#sec:default_tasks)

如果未指定其他任务，则Gradle允许您定义一个或多个默认任务。

例子14.定义一个默认任务

`Groovy``Kotlin`

build.gradle

defaultTasks 'clean', 'run' task clean \{ doLast \{ println 'Default Cleaning\!' \} \} task run \{ doLast \{ println 'Default Running\!' \} \} task other \{ doLast \{ println "I'm not a default task\!" \} \}

 

1

defaultTasks 'clean', 'run'

2

3

task clean \{

4

 doLast \{

5

 println 'Default Cleaning\!'

6

 \}

7

\}

8

9

task run \{

10

 doLast \{

11

 println 'Default Running\!'

12

 \}

13

\}

14

15

task other \{

16

 doLast \{

17

 println "I'm not a default task\!"

18

 \}

19

\}

输出**`gradle -q`**

\> gradle -q 默认清洁！ 默认运行！

这等效于运行`gradle clean run`。在多项目构建中，每个子项目可以有其自己的特定默认任务。如果子项目未指定默认任务，则使用父项目的默认任务（如果已定义）。

## [](#configure-by-dag)[通过DAG进行配置](#configure-by-dag)

正如我们稍后将详细描述的（请参阅[Build Lifecycle]()），Gradle具有配置阶段和执行阶段。在配置阶段之后，Gradle知道应该执行的所有任务。Gradle为您提供了一个利用此信息的机会。一个用例是检查发布任务是否在要执行的任务中。以此为基础，您可以为某些变量分配不同的值。

在以下示例中，`distribution`和`release`任务的执行导致`version`变量的值不同。

例子15.取决于所选任务的不同构建结果

`Groovy``Kotlin`

build.gradle

task distribution \{ doLast \{ println "We build the zip with version=\$version" \} \} task release \{ dependsOn 'distribution' doLast \{ println 'We release now' \} \} gradle.taskGraph.whenReady \{ taskGraph -> if \(taskGraph.hasTask\(":release"\)\) \{ version = '1.0' \} else \{ version = '1.0-SNAPSHOT' \} \}

 

1

task distribution \{

2

 doLast \{

3

 println "We build the zip with version=\$version"

4

 \}

5

\}

6

7

task release \{

8

 dependsOn 'distribution'

9

 doLast \{

10

 println 'We release now'

11

 \}

12

\}

13

14

gradle.taskGraph.whenReady \{ taskGraph \->

15

 if \(taskGraph.hasTask\(":release"\)\) \{

16

 version \= '1.0'

17

 \} else \{

18

 version \= '1.0-SNAPSHOT'

19

 \}

20

\}

输出`gradle -q distribution`

\> gradle -q分布 我们使用version = 1.0-SNAPSHOT构建zip

输出`gradle -q release`

\> gradle -q发布 我们使用version = 1.0构建zip 我们现在发布

重要的是，这`whenReady`会影响执行释放任务_之前_的释放任务。即使释放任务不是_主要_任务（即，传递给`gradle`命令的任务），此方法也有效。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>此示例有效，因为该</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">version</code><font><font>值仅在执行时读取。</font><font>在实际构建中使用类似的构造时，必须确保在配置过程中不会急切读取该值。</font><font>否则，您的构建可能会对配置和执行之间的属性使用不同的值。</font></font></p></div></td></tr></tbody></table>

## [](#sec:build_script_external_dependencies)[构建脚本的外部依赖关系](#sec:build_script_external_dependencies)

如果构建脚本需要使用外部库，则可以将它们添加到构建脚本本身中的脚本的类路径中。您可以使用`buildscript()`方法执行此操作，并传入一个声明构建脚本类路径的块。

例子16.声明构建脚本的外部依赖

`Groovy``Kotlin`

build.gradle

buildscript \{ repositories \{ mavenCentral\(\) \} dependencies \{ classpath group: 'commons-codec', name: 'commons-codec', version: '1.2' \} \}

 

1

buildscript \{

2

 repositories \{

3

 mavenCentral\(\)

4

 \}

5

 dependencies \{

6

 classpath group: 'commons-codec', name: 'commons-codec', version: '1.2'

7

 \}

8

\}

传递给该`buildscript()`方法的块将配置[ScriptHandler]()实例。您可以通过向`classpath`配置添加依赖项来声明构建脚本类路径。这与您声明Java编译类路径的方式相同。您可以使用除项目依赖项以外的任何[依赖项类型]()。

声明了构建脚本类路径后，就可以像在该类路径上的任何其他类一样使用构建脚本中的类。以下示例将添加到前面的示例中，并使用构建脚本类路径中的类。

例子17.具有外部依赖关系的构建脚本

`Groovy``Kotlin`

build.gradle

import org.apache.commons.codec.binary.Base64 buildscript \{ repositories \{ mavenCentral\(\) \} dependencies \{ classpath group: 'commons-codec', name: 'commons-codec', version: '1.2' \} \} task encode \{ doLast \{ def byte\[\] encodedString = new Base64\(\).encode\('hello world\\n'.getBytes\(\)\) println new String\(encodedString\) \} \}

 

1

import org.apache.commons.codec.binary.Base64

2

3

buildscript \{

4

 repositories \{

5

 mavenCentral\(\)

6

 \}

7

 dependencies \{

8

 classpath group: 'commons-codec', name: 'commons-codec', version: '1.2'

9

 \}

10

\}

11

12

task encode \{

13

 doLast \{

14

 def byte\[\] encodedString \= new Base64\(\).encode\('hello world\\n'.getBytes\(\)\)

15

 println new String\(encodedString\)

16

 \}

17

\}

输出**`gradle -q encode`**

\> gradle -q编码 aGVsbG8gd29ybGQK

对于多项目构建，使用项目`buildscript()`方法声明的依赖项可用于其所有子项目的构建脚本。

构建脚本依赖项可能是Gradle插件。请参阅[使用Gradle插件]()以获取有关Gradle插件的更多信息。

每个项目都会自动具有[BuildEnvironmentReportTask]()`buildEnvironment`类型的任务，可以调用该任务来报告构建脚本依赖关系的解决方案。

## [](#further_reading)[进一步阅读](#further_reading)

本章仅介绍了可能的内容。以下是一些可能有趣的主题：

* [编写可维护的构建脚本]()
* [整理您的Gradle项目]()
* [编写自定义任务]()

* * *

[1](#_footnoteref_1)。有命令行开关可以更改此行为。请参阅[命令行界面]()）

[2](#_footnoteref_2)。有命令行开关可以更改此行为。请参阅[命令行界面]()）