<!doctype html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode">
<title>无标题</title>
    
<style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body {  padding-left: 48px;  padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}@-webkit-keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}@keyframes blink {  0% {}  50% { background-color: transparent; }  100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print {  .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style></head>

<body class="wiz-editor-body" data-wiz-document-type="common" spellcheck="false"><div><div id="header" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><h1 style="font-size:2rem;color:rgba(0, 0, 0, 0.85);"><font><font>在项目之间共享输出</font></font></h1><div id="toc" class="toc" style="background: rgb(247, 247, 248);"><div id="toctitle"><font><font>内容</font></font></div><ul class="sectlevel1"><li><a href="#sec:simple-sharing-artifacts-between-projects" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>项目之间工件的简单共享</font></font></a></li><li><a href="#sec:variant-aware-sharing" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>项目之间工件的变体感知共享</font></font></a></li><li><a href="#targeting-different-platforms" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>针对不同的平台</font></font></a></li></ul></div></div><div id="preamble" style="color:rgb(2, 48, 58);font-family:Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif"><div class="sectionbody"><div class="paragraph"><p style="font-size:1.0625rem;"><font><font>在多项目构建中，一个常见的模式是一个项目消耗另一个项目的工件。</font><font>通常，Java生态系统中最简单的消耗形式是，当</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">A</code><font><font>依赖时</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">B</code><font><font>，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">A</code><font><font>将依赖于</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">jar</code><font><font>项目产生的东西</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">B</code><font><font>。</font><font>如本章前面所述，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">A</code><font><font>根据的</font></font><em style="font-style:italic;"><font><font>变体进行</font></font></em><span>&nbsp;</span><font><font>建模</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">B</code><font><font>，其中根据的需要选择变体</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">A</code><font><font>。</font><font>为了进行编译，我们需要</font><font>变体</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">B</code><font><font>提供的的</font><font>API依赖项</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">apiElements</code><font><font>。</font><font>对于运行时，我们需要</font><font>变体</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">B</code><font><font>提供的的</font><font>运行时依赖项</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">runtimeElements</code><font><font>。</font></font></p></div><div class="paragraph"><p><font><font>但是，如果您需要</font><font>与主要工件</font></font><em style="font-style:italic;"><font><font>不同的</font></font></em><font><font>工件怎么办？</font><font>例如，Gradle为依赖于</font><font>另一个项目</font><font>的</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>测试装置</font></font></a><font><font>提供了内置支持</font><font>，但是有时您根本不需要依赖的工件就不会作为变体出现。</font></font></p></div><div class="paragraph"><p><font><font>为了</font><font>在项目之间</font></font><em style="font-style:italic;"><font><font>安全共享</font></font></em><font><font>并允许最大性能（并行度），必须通过</font></font><em style="font-style:italic;"><font><font>传出配置</font></font></em><font><font>公开此类工件</font><font>。</font></font></p></div><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock warning wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="title" style="color:rgb(85, 85, 85);font-size:1.25rem;"><font><font>不要直接引用其他项目任务</font></font></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>声明跨项目依赖关系的常见反模式是：</font></font></p></div></td></tr></tbody></table></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029357_5441" class="wiz-code-container"><textarea style="display:none;">dependencies {
   // this is unsafe!
   implementation project(":other").tasks.someOtherJar
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029357_5441"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 104px; min-width: 422.2px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">dependencies</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">   <span class="cm-comment">// this is unsafe!</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">   <span class="cm-variable">implementation</span> <span class="cm-variable">project</span>(<span class="cm-string">":other"</span>).<span class="cm-property">tasks</span>.<span class="cm-property">someOtherJar</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="height: 134px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div id="preamble"><div class="sectionbody"><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock warning wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>此发布模型</font></font><em style="font-style:italic;"><font><font>不安全，</font></font></em><font><font>并且可能导致不可复制且难以并行化内部版本。</font><font>本节说明如何</font><font>通过使用</font><em style="font-style:italic;"><font>变体</font></em><font>在项目之间定义“交换”</font><font>来</font></font><em style="font-style:italic;"><font><font>正确创建跨项目边界</font></font></em><font><font>。</font></font><em style="font-style:italic;"><font></font></em><font></font></p></div></td></tr></tbody></table></div></div><div class="paragraph"><p><font><font>有两个互补的选项可以在项目之间共享工件。</font><font>该</font></font><a href="#sec:simple-sharing-artifacts-between-projects" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>简化版</font></font></a><font><font>只适用，如果你需要共享的是一个简单的工件，不依赖于消费者。</font><font>简单的解决方案还限于未将此工件发布到存储库的情况。</font><font>这也意味着使用者不会发布对此工件的依赖关系。</font><font>如果使用者在不同的环境（例如，不同的目标平台）中解决不同的工件或需要该出版物，则需要使用</font></font><a href="#sec:variant-aware-sharing" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>高级版本</font></font></a><font><font>。</font></font></p></div></div></div><div class="sect1"><h2 id="sec:simple-sharing-artifacts-between-projects" style="font-size:1.5rem;"><a class="anchor" href="#sec:simple-sharing-artifacts-between-projects" style="color: rgb(29, 162, 189); text-decoration: none;"></a><a class="link" href="#sec:simple-sharing-artifacts-between-projects" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>项目之间工件的简单共享</font></font></a></h2><div class="sectionbody"><div class="paragraph"><p><font><font>首先，生产者需要声明将要</font></font><em style="font-style:italic;"><font><font>暴露</font></font></em><font><font>给消费者的配置。</font><font>如</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>配置章节</font></font></a><font><font>中所述</font><font>，这对应于</font></font><em style="font-style:italic;"><font><font>消耗性配置</font></font></em><font><font>。</font></font></p></div><div class="paragraph"><p><font><font>让我们想象一下，消费者需要</font><font>生产者提供的</font></font><em style="font-style:italic;"><font><font>检测类</font></font></em><font><font>，但是该工件</font></font><em style="font-style:italic;"><font><font>不是</font></font></em><font><font>主要</font><font>工件</font><font>。</font><font>生产者可以通过创建将“承载”此工件的配置来公开其检测的类：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子1.声明一个输出变体</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>生产者/ build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029339_9525" class="wiz-code-container"><textarea style="display:none;">configurations {
    instrumentedJars {
        canBeConsumed = true
        canBeResolved = false
        // If you want this configuration to share the same dependencies, otherwise omit this line
        extendsFrom implementation, runtimeOnly
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029339_9525"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="right: 0px; left: 0px; height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 200px; min-width: 761.325px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">configurations</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedJars</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeConsumed</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeResolved</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-comment">// If you want this configuration to share the same dependencies, otherwise omit this line</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">extendsFrom</span> <span class="cm-variable">implementation</span>, <span class="cm-variable">runtimeOnly</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 200px;"></div><div class="CodeMirror-gutters" style="height: 230px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>这种配置是</font></font><em style="font-style:italic;"><font><font>可消耗的</font></font></em><font><font>，这意味着它是给消费者的“交换”。</font><font>现在，我们要向该配置添加工件，消费者在使用它时会得到：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>示例2.将工件附加到传出配置</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>生产者/ build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029325_9167" class="wiz-code-container"><textarea style="display:none;">artifacts {
    instrumentedJars(instrumentedJar)
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029325_9167"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 80px; min-width: 291.763px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">artifacts</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedJars</span>(<span class="cm-variable">instrumentedJar</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 80px;"></div><div class="CodeMirror-gutters" style="height: 110px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>在这里，我们要附加的“工件”</font><font>实际上</font><font>是一个</font><font>生成Jar</font><font>的</font></font><em style="font-style:italic;"><font><font>任务</font></font></em><font><font>。</font><font>这样，Gradle可以自动跟踪此任务的依赖关系并根据需要构建它们。</font><font>这是可能的，因为</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">Jar</code><font><font>任务已扩展</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">AbstractArchiveTask</code><font><font>。</font><font>如果不是这种情况，则需要明确声明如何生成工件。</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子3.明确声明工件的任务依赖性</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>生产者/ build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029312_3583" class="wiz-code-container"><textarea style="display:none;">artifacts {
    instrumentedJars(someTask.outputFile) {
        builtBy(someTask)
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029312_3583"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 128px; min-width: 337.938px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">artifacts</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedJars</span>(<span class="cm-variable">someTask</span>.<span class="cm-property">outputFile</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">builtBy</span>(<span class="cm-variable">someTask</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 128px;"></div><div class="CodeMirror-gutters" style="height: 158px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>现在，</font></font><em style="font-style:italic;"><font><font>消费者</font></font></em><font><font>需要依赖于此配置才能获得正确的工件：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子4.一个显式的配置依赖</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029298_4240" class="wiz-code-container"><textarea style="display:none;">dependencies {
    instrumentedClasspath(project(path: ":producer", configuration: 'instrumentedJars'))
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029298_4240"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 80px; min-width: 684.288px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">dependencies</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedClasspath</span>(<span class="cm-variable">project</span>(<span class="cm-variable">path</span>: <span class="cm-string">":producer"</span>, <span class="cm-variable">configuration</span>: <span class="cm-string">'instrumentedJars'</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 80px;"></div><div class="CodeMirror-gutters" style="height: 110px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock warning wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>如果计划发布具有此依赖关系的组件，</font></font><em style="font-style:italic;"><font><font>则不建议</font></font></em><font><font>声明对显式目标配置的</font><font>依赖关系：这可能会导致元数据损坏。</font><font>如果需要在远程存储库上发布组件，请遵循可识别</font></font><a href="#sec:variant-aware-sharing" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>变体的交叉发布文档中的说明</font></font></a><font><font>。</font></font></p></div></td></tr></tbody></table></div></div><div class="paragraph"><p><font><font>在这种情况下，我们将依赖项添加到</font></font><em style="font-style:italic;"><font><font>InstrumentedClasspath</font></font></em><font><font>配置中，该配置是</font></font><em style="font-style:italic;"><font><font>消费者特定的配置</font></font></em><font><font>。</font><font>在Gradle术语中，这称为</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>可解析配置</font></font></a><font><font>，其定义方式如下：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子5.在使用者上声明一个可解析的配置</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029282_1893" class="wiz-code-container"><textarea style="display:none;">configurations {
    instrumentedClasspath {
        canBeConsumed = false
        canBeResolved = true
    } 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# 在项目之间共享输出

内容

* [项目之间工件的简单共享](#sec:simple-sharing-artifacts-between-projects)
* [项目之间工件的变体感知共享](#sec:variant-aware-sharing)
* [针对不同的平台](#targeting-different-platforms)

在多项目构建中，一个常见的模式是一个项目消耗另一个项目的工件。通常，Java生态系统中最简单的消耗形式是，当`A`依赖时`B`，`A`将依赖于`jar`项目产生的东西`B`。如本章前面所述，`A`根据的_变体进行_建模`B`，其中根据的需要选择变体`A`。为了进行编译，我们需要变体`B`提供的的API依赖项`apiElements`。对于运行时，我们需要变体`B`提供的的运行时依赖项`runtimeElements`。

但是，如果您需要与主要工件_不同的_工件怎么办？例如，Gradle为依赖于另一个项目的[测试装置]()提供了内置支持，但是有时您根本不需要依赖的工件就不会作为变体出现。

为了在项目之间_安全共享_并允许最大性能（并行度），必须通过_传出配置_公开此类工件。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="title" style="color:rgb(85, 85, 85);font-size:1.25rem;"><font><font>不要直接引用其他项目任务</font></font></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>声明跨项目依赖关系的常见反模式是：</font></font></p></div></td></tr></tbody></table>

dependencies \{ // this is unsafe\! implementation project\(":other"\).tasks.someOtherJar \}

 

1

dependencies \{

2

 // this is unsafe\!

3

 implementation project\(":other"\).tasks.someOtherJar

4

\}

<table style="background:none;width:912px;"><tbody><tr><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>此发布模型</font></font><em style="font-style:italic;"><font><font>不安全，</font></font></em><font><font>并且可能导致不可复制且难以并行化内部版本。</font><font>本节说明如何</font><font>通过使用</font><em style="font-style:italic;"><font>变体</font></em><font>在项目之间定义“交换”</font><font>来</font></font><em style="font-style:italic;"><font><font>正确创建跨项目边界</font></font></em><font><font>。</font></font><em style="font-style:italic;"><font></font></em><font></font></p></div></td></tr></tbody></table>

有两个互补的选项可以在项目之间共享工件。该[简化版](#sec:simple-sharing-artifacts-between-projects)只适用，如果你需要共享的是一个简单的工件，不依赖于消费者。简单的解决方案还限于未将此工件发布到存储库的情况。这也意味着使用者不会发布对此工件的依赖关系。如果使用者在不同的环境（例如，不同的目标平台）中解决不同的工件或需要该出版物，则需要使用[高级版本](#sec:variant-aware-sharing)。

## [](#sec:simple-sharing-artifacts-between-projects)[项目之间工件的简单共享](#sec:simple-sharing-artifacts-between-projects)

首先，生产者需要声明将要_暴露_给消费者的配置。如[配置章节]()中所述，这对应于_消耗性配置_。

让我们想象一下，消费者需要生产者提供的_检测类_，但是该工件_不是_主要工件。生产者可以通过创建将“承载”此工件的配置来公开其检测的类：

例子1.声明一个输出变体

`Groovy``Kotlin`

生产者/ build.gradle

configurations \{ instrumentedJars \{ canBeConsumed = true canBeResolved = false // If you want this configuration to share the same dependencies, otherwise omit this line extendsFrom implementation, runtimeOnly \} \}

 

1

configurations \{

2

 instrumentedJars \{

3

 canBeConsumed \= true

4

 canBeResolved \= false

5

 // If you want this configuration to share the same dependencies, otherwise omit this line

6

 extendsFrom implementation, runtimeOnly

7

 \}

8

\}

这种配置是_可消耗的_，这意味着它是给消费者的“交换”。现在，我们要向该配置添加工件，消费者在使用它时会得到：

示例2.将工件附加到传出配置

`Groovy``Kotlin`

生产者/ build.gradle

artifacts \{ instrumentedJars\(instrumentedJar\) \}

 

1

artifacts \{

2

 instrumentedJars\(instrumentedJar\)

3

\}

在这里，我们要附加的“工件”实际上是一个生成Jar的_任务_。这样，Gradle可以自动跟踪此任务的依赖关系并根据需要构建它们。这是可能的，因为`Jar`任务已扩展`AbstractArchiveTask`。如果不是这种情况，则需要明确声明如何生成工件。

例子3.明确声明工件的任务依赖性

`Groovy``Kotlin`

生产者/ build.gradle

artifacts \{ instrumentedJars\(someTask.outputFile\) \{ builtBy\(someTask\) \} \}

 

1

artifacts \{

2

 instrumentedJars\(someTask.outputFile\) \{

3

 builtBy\(someTask\)

4

 \}

5

\}

现在，_消费者_需要依赖于此配置才能获得正确的工件：

例子4.一个显式的配置依赖

`Groovy``Kotlin`

消费者/build.gradle

dependencies \{ instrumentedClasspath\(project\(path: ":producer", configuration: 'instrumentedJars'\)\) \}

 

1

dependencies \{

2

 instrumentedClasspath\(project\(path: ":producer", configuration: 'instrumentedJars'\)\)

3

\}

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>如果计划发布具有此依赖关系的组件，</font></font><em style="font-style:italic;"><font><font>则不建议</font></font></em><font><font>声明对显式目标配置的</font><font>依赖关系：这可能会导致元数据损坏。</font><font>如果需要在远程存储库上发布组件，请遵循可识别</font></font><a href="#sec:variant-aware-sharing" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>变体的交叉发布文档中的说明</font></font></a><font><font>。</font></font></p></div></td></tr></tbody></table>

在这种情况下，我们将依赖项添加到_InstrumentedClasspath_配置中，该配置是_消费者特定的配置_。在Gradle术语中，这称为[可解析配置]()，其定义方式如下：

例子5.在使用者上声明一个可解析的配置

`Groovy``Kotlin`

消费者/build.gradle

configurations \{ instrumentedClasspath \{ canBeConsumed = false canBeResolved = true \} \}

 

1

configurations \{

2

 instrumentedClasspath \{

3

 canBeConsumed \= false

4

 canBeResolved \= true

5

 \}

6

\}

## [](#sec:variant-aware-sharing)[项目之间工件的变体感知共享](#sec:variant-aware-sharing)

在[简单的共享解决方案中](#sec:simple-sharing-artifacts-between-projects)，我们在生产者端定义了一个配置，用作生产者和消费者之间的工件交换。但是，使用者必须明确指出它所依赖的配置，这是我们在_变体感知分辨率下_要避免的配置。实际上，我们还[解释]()了消费者有可能使用_属性_来表达需求，而生产者也应该使用_属性_来提供适当的输出变体。这样可以进行更明智的选择，因为使用单个依赖项声明，而无需任何明确的目标配置，使用者可以解决不同的问题。典型示例是使用单个依赖项声明`project(":myLib")`，我们可以根据架构选择`arm64`或`i386`版本`myLib`。

为此，我们将向消费者和生产者添加属性。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>重要的是要理解，一旦配置具有属性，它们便会参与</font></font><em style="font-style:italic;"><font><font>变体感知的解析</font></font></em><font><font>，这意味着它们在使用</font></font><em style="font-style:italic;"><font><font>任何</font></font></em><font><font>类似符号</font><font>时都将被视为候选</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project(":myLib")</code><font><font>。</font><font>换句话说，在生产者上设置的属性</font></font><em style="font-style:italic;"><font><font>必须与在同一项目中生产的其他变体一致</font></font></em><font><font>。</font><font>他们尤其不能为现有选择引入歧义。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>实际上，这意味着在您创建的配置上使用的属性集可能取决于所使用的</font></font><em style="font-style:italic;"><font><font>生态系统</font></font></em><font><font>（Java，C ++等），因为这些生态系统的相关插件通常使用不同的属性。</font></font></p></div></td></tr></tbody></table>

让我们增强前面的示例，它恰好是一个Java库项目。Java库向其使用者公开了几个变体，`apiElements`并且`runtimeElements`。现在，我们要添加第三个`instrumentedJars`。

因此，我们需要了解新变体的用途，以便在其上设置适当的属性。让我们看一下在`runtimeElements`配置中找到的属性：

gradle OutboundVariants --variant runtimeElements

属性 -org.gradle.category =库 -org.gradle.dependency.bundling =外部 -org.gradle.jvm.version = 11 -org.gradle.libraryelements = jar -org.gradle.usage = Java运行时

它告诉我们的是Java库插件产生具有5个属性的变体：

* `org.gradle.category`告诉我们这个变体代表一个_图书馆_
* `org.gradle.dependency.bundling`告诉我们，此变体的依赖项以jar形式找到（例如，它们没有在jar中重新包装）
* `org.gradle.jvm.version`告诉我们该库支持的最低Java版本是Java 11
* `org.gradle.libraryelements`告诉我们此变体包含在jar中找到的所有元素（类和资源）
* `org.gradle.usage`表示此变体是Java运行时，因此既适用于Java编译器，也适用于运行时

因此，如果我们希望在执行测试时使用我们的工具化类代替此变体，则需要将类似的属性附加到我们的变体中。实际上，我们关心的属性`org.gradle.libraryelements`可以解释_变量包含的内容_，因此我们可以通过以下方式设置变量：

例子6.声明变量属性

`Groovy``Kotlin`

生产者/ build.gradle

configurations \{ instrumentedJars \{ canBeConsumed = true canBeResolved = false attributes \{ attribute\(Category.CATEGORY\_ATTRIBUTE, objects.named\(Category, Category.LIBRARY\)\) attribute\(Usage.USAGE\_ATTRIBUTE, objects.named\(Usage, Usage.JAVA\_RUNTIME\)\) attribute\(Bundling.BUNDLING\_ATTRIBUTE, objects.named\(Bundling, Bundling.EXTERNAL\)\) attribute\(TargetJvmVersion.TARGET\_JVM\_VERSION\_ATTRIBUTE, JavaVersion.current\(\).majorVersion.toInteger\(\)\) attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE, objects.named\(LibraryElements, 'instrumented-jar'\)\) \} \} \}

 

1

configurations \{

2

 instrumentedJars \{

3

 canBeConsumed \= true

4

 canBeResolved \= false

5

 attributes \{

6

 attribute\(Category.CATEGORY\_ATTRIBUTE, objects.named\(Category, Category.LIBRARY\)\)

7

 attribute\(Usage.USAGE\_ATTRIBUTE, objects.named\(Usage, Usage.JAVA\_RUNTIME\)\)

8

 attribute\(Bundling.BUNDLING\_ATTRIBUTE, objects.named\(Bundling, Bundling.EXTERNAL\)\)

9

 attribute\(TargetJvmVersion.TARGET\_JVM\_VERSION\_ATTRIBUTE, JavaVersion.current\(\).majorVersion.toInteger\(\)\)

10

 attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE, objects.named\(LibraryElements, 'instrumented-jar'\)\)

11

 \}

12

 \}

13

\}

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>选择正确的属性进行设置是此过程中最难的事情，因为它们具有变体的语义。</font><font>因此，在添加</font></font><em style="font-style:italic;"><font><font>新属性</font></font></em><font><font>之前</font><font>，您应该始终询问自己是否没有一个可以承载所需语义的属性。</font><font>如果没有，则可以添加一个新属性。</font><font>添加新属性时，还必须小心，因为在选择过程中可能会产生歧义。</font><font>通常，添加属性意味着将其添加到</font></font><em style="font-style:italic;"><font><font>所有</font></font></em><font><font>现有变体中。</font></font></p></div></td></tr></tbody></table>

我们在这里所做的是，我们添加了一个_新的_变体，可以_在运行时_使用它，但它包含检测类而不是普通类。但是，现在这意味着对于运行时，使用者必须在两个变体之间进行选择：

* `runtimeElements`，由`java-library`插件提供的常规变体
* `instrumentedJars`，我们创建的变体

特别要说的是，我们要在测试运行时类路径上插入检测后的类。现在，我们可以在使用者上将我们的依赖项声明为常规项目依赖项：

例子7.声明项目依赖

`Groovy``Kotlin`

消费者/build.gradle

dependencies \{ testImplementation 'junit:junit:4.13' testImplementation project\(':producer'\) \}

 

1

dependencies \{

2

 testImplementation 'junit:junit:4.13'

3

 testImplementation project\(':producer'\)

4

\}

如果我们在这里停止，Gradle仍会选择该`runtimeElements`变体代替我们的`instrumentedJars`变体。这是因为`testRuntimeClasspath`配置要求配置哪个`libraryelements`属性是`jar`，并且我们的新`instrumented-jars`值_不兼容_。

因此，我们需要更改请求的属性，以便现在查找已检测的罐子：

例子8.改变消费者属性

`Groovy``Kotlin`

消费者/build.gradle

configurations \{ testRuntimeClasspath \{ attributes \{ attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE, objects.named\(LibraryElements, 'instrumented-jar'\)\) \} \} \}

 

1

configurations \{

2

 testRuntimeClasspath \{

3

 attributes \{

4

 attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE, objects.named\(LibraryElements, 'instrumented-jar'\)\)

5

 \}

6

 \}

7

\}

现在，我们告诉我们，每当要解析测试运行时类路径时，我们正在寻找的是_插装类_。但是，有一个问题：在我们的依赖项列表中，我们有JUnit，很明显，它_没有进行_检测。因此，如果我们在这里停下来，Gradle将会失败，并说明没有提供可检测类的JUnit变体。这是因为我们没有解释说，如果没有可用的检测版本，则使用常规jar是可以的。为此，我们需要编写一个_兼容性规则_：

例子9.兼容性规则

`Groovy``Kotlin`

消费者/build.gradle

class InstrumentedJarsRule implements AttributeCompatibilityRule\<LibraryElements> \{ \@Override void execute\(CompatibilityCheckDetails\<LibraryElements> details\) \{ if \(details.consumerValue.name == 'instrumented-jar' \&\& details.producerValue.name == 'jar'\) \{ details.compatible\(\) \} \} \}

 

1

class InstrumentedJarsRule implements AttributeCompatibilityRule\<LibraryElements\> \{

2

3

 \@Override

4

 void execute\(CompatibilityCheckDetails\<LibraryElements\> details\) \{

5

 if \(details.consumerValue.name \== 'instrumented-jar' \&\& details.producerValue.name \== 'jar'\) \{

6

 details.compatible\(\)

7

 \}

8

 \}

9

\}

我们需要在属性模式上声明：

例子10.利用兼容性规则

`Groovy``Kotlin`

消费者/build.gradle

dependencies \{ attributesSchema \{ attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE\) \{ compatibilityRules.add\(InstrumentedJarsRule\) \} \} \}

 

1

dependencies \{

2

 attributesSchema \{

3

 attribute\(LibraryElements.LIBRARY\_ELEMENTS\_ATTRIBUTE\) \{

4

 compatibilityRules.add\(InstrumentedJarsRule\)

5

 \}

6

 \}

7

\}

就是这样！现在我们有：

* 添加了一个变体，可以提供罐装工具
* 解释说此变体可以替代运行时
* 解释说，使用者_仅在测试运行时_需要此变体

因此，Gradle提供了一种强大的机制，可以根据偏好和兼容性选择正确的变体。[在文档的“了解变体的插件”部分中]()可以找到更多详细信息。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>通过像我们一样向现有属性添加值，或通过定义新属性，我们可以扩展模型。</font><font>这意味着</font></font><em style="font-style:italic;"><font><font>所有消费者</font></font></em><font><font>都必须了解此扩展模型。</font><font>对于本地使用者而言，这通常不是问题，因为所有项目都理解并共享相同的模式，但是如果您必须将此新变体发布到外部存储库，则意味着外部使用者必须为其构建添加相同的规则他们通过。</font><font>对于</font></font><em style="font-style:italic;"><font><font>生态系统插件</font></font></em><font><font>（例如Kotlin插件）而言，</font><font>这通常不是问题，</font><font>在任何情况下，如果不应用插件就无法消费，但是如果添加自定义值或属性，则是一个问题。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>因此，</font></font><strong><font><font>避免发布</font></font></strong><font><font>仅用于内部使用的</font><strong><font>自定义变体</font></strong><font>。</font></font></p></div></td></tr></tbody></table>

## [](#targeting-different-platforms)[针对不同的平台](#targeting-different-platforms)

库通常针对不同的平台。在Java生态系统中，我们经常会看到同一库的不同工件，但有不同的_分类器_。一个典型的例子是番石榴，其发布方式如下：

* `guava-jre`适用于JDK 8及更高版本
* `guava-android`对于JDK 7

这种方法的问题在于，没有与分类器相关的语义。特别是，依赖项解析引擎无法根据使用者需求自动确定要使用哪个版本。例如，这将是更好地表达你对番石榴的依赖，并让发动机之间选择`jre`，并`android`根据什么是兼容的。

Gradle为此提供了一种改进的模型，它没有分类器的弱点：属性。

特别是在Java生态系统中，Gradle提供了一个内置属性，库作者可以使用该属性来表达与Java生态系统的兼容性：`org.gradle.jvm.version`。此属性表示_使用者必须具备_的_最低版本才能正常工作_。

当您应用`java`或`java-library`插件时，Gradle会自动将此属性与外发变体相关联。这意味着，所有使用Gradle发布的库都会自动告知它们使用的目标平台。

默认情况下，将`org.gradle.jvm.version`设置为源集主编译任务的[`release`属性]()值（或作为对`targetCompatibility`值的后备）。

自动设置此属性后，默认情况下，Gradle_不会_允许您为不同的JVM构建项目。如果需要执行此操作，则需要[按照有关变体感知匹配](#sec:variant-aware-sharing)的[说明](#sec:variant-aware-sharing)创建其他变体。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><font><font>Gradle的未来版本将提供自动为不同Java平台构建的方法。</font></font></td></tr></tbody></table>
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029282_1893"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 152px; min-width: 230.175px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">configurations</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedClasspath</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeConsumed</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeResolved</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 152px;"></div><div class="CodeMirror-gutters" style="height: 182px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><h2 id="sec:variant-aware-sharing" style="font-size:1.5rem;"><a class="anchor" href="#sec:variant-aware-sharing" style="color: rgb(29, 162, 189); text-decoration: none;"></a><a class="link" href="#sec:variant-aware-sharing" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>项目之间工件的变体感知共享</font></font></a></h2><div class="sectionbody"><div class="paragraph"><p><font><font>在</font></font><a href="#sec:simple-sharing-artifacts-between-projects" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>简单的共享解决方案中</font></font></a><font><font>，我们在生产者端定义了一个配置，用作生产者和消费者之间的工件交换。</font><font>但是，使用者必须明确指出它所依赖的配置，这是我们在</font></font><em style="font-style:italic;"><font><font>变体感知分辨率下</font></font></em><font><font>要避免的配置</font><font>。</font><font>实际上，我们还</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>解释</font></font></a><font><font>了消费者有可能使用</font></font><em style="font-style:italic;"><font><font>属性</font></font></em><font><font>来表达需求</font><font>，而生产者也应该</font><font>使用</font><em style="font-style:italic;"><font>属性</font></em><font>来提供适当的输出变体。</font><font>这样可以进行更明智的选择，因为使用单个依赖项声明，而无需任何明确的目标配置，使用者可以解决不同的问题。</font><font>典型示例是使用单个依赖项声明</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project(":myLib")</code><font><font>，我们可以</font><font>根据架构</font><font>选择</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">arm64</code><font><font>或</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">i386</code><font><font>版本</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">myLib</code><font><font>。</font></font></p></div><div class="paragraph"><p><font><font>为此，我们将向消费者和生产者添加属性。</font></font></p></div><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock warning wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>重要的是要理解，一旦配置具有属性，它们便会参与</font></font><em style="font-style:italic;"><font><font>变体感知的解析</font></font></em><font><font>，这意味着它们在使用</font></font><em style="font-style:italic;"><font><font>任何</font></font></em><font><font>类似符号</font><font>时都将被视为候选</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project(":myLib")</code><font><font>。</font><font>换句话说，在生产者上设置的属性</font></font><em style="font-style:italic;"><font><font>必须与在同一项目中生产的其他变体一致</font></font></em><font><font>。</font><font>他们尤其不能为现有选择引入歧义。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>实际上，这意味着在您创建的配置上使用的属性集可能取决于所使用的</font></font><em style="font-style:italic;"><font><font>生态系统</font></font></em><font><font>（Java，C ++等），因为这些生态系统的相关插件通常使用不同的属性。</font></font></p></div></td></tr></tbody></table></div></div><div class="paragraph"><p><font><font>让我们增强前面的示例，它恰好是一个Java库项目。</font><font>Java库向其使用者公开了几个变体，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">apiElements</code><font><font>并且</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">runtimeElements</code><font><font>。</font><font>现在，我们要添加第三个</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">instrumentedJars</code><font><font>。</font></font></p></div><div class="paragraph"><p><font><font>因此，我们需要了解新变体的用途，以便在其上设置适当的属性。</font><font>让我们看一下在</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">runtimeElements</code><font><font>配置中</font><font>找到的属性</font><font>：</font></font></p></div><div class="listingblock"><div class="title"><font><font>gradle OutboundVariants --variant runtimeElements</font></font></div><div class="content"><pre style="font-family: Inconsolata, monospace; color: rgba(0, 0, 0, 0.9); background: rgb(247, 247, 248);"><font><font>属性</font></font><font></font><font><font>
    -org.gradle.category =库</font></font><font></font><font><font>
    -org.gradle.dependency.bundling =外部</font></font><font></font><font><font>
    -org.gradle.jvm.version = 11</font></font><font></font><font><font>
    -org.gradle.libraryelements = jar</font></font><font></font><font><font>
    -org.gradle.usage = Java运行时</font></font></pre></div></div><div class="paragraph"><p><font><font>它告诉我们的是Java库插件产生具有5个属性的变体：</font></font></p></div><div class="ulist"><ul><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.category</code><font><font>告诉我们这个变体代表一个</font></font><em style="font-style:italic;"><font><font>图书馆</font></font></em></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.dependency.bundling</code><font><font><span>&nbsp;</span>告诉我们，此变体的依赖项以jar形式找到（例如，它们没有在jar中重新包装）</font></font></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.jvm.version</code><font><font><span>&nbsp;</span>告诉我们该库支持的最低Java版本是Java 11</font></font></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.libraryelements</code><font><font><span>&nbsp;</span>告诉我们此变体包含在jar中找到的所有元素（类和资源）</font></font></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.usage</code><font><font><span>&nbsp;</span>表示此变体是Java运行时，因此既适用于Java编译器，也适用于运行时</font></font></span></li></ul></div><div class="paragraph"><p><font><font>因此，如果我们希望在执行测试时使用我们的工具化类代替此变体，则需要将类似的属性附加到我们的变体中。</font><font>实际上，我们关心的属性</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.libraryelements</code><font><font>可以解释</font></font><em style="font-style:italic;"><font><font>变量包含的内容</font></font></em><font><font>，因此我们可以通过以下方式设置变量：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子6.声明变量属性</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>生产者/ build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029256_1966" class="wiz-code-container"><textarea style="display:none;">configurations {
    instrumentedJars {
        canBeConsumed = true
        canBeResolved = false
        attributes {
            attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.LIBRARY))
            attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))
            attribute(Bundling.BUNDLING_ATTRIBUTE, objects.named(Bundling, Bundling.EXTERNAL))
            attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, JavaVersion.current().majorVersion.toInteger())
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, 'instrumented-jar'))
        }
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029256_1966"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="display: block; right: 0px; left: 0px; height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 938px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 320px; min-width: 907.475px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">configurations</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">instrumentedJars</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeConsumed</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">canBeResolved</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">attributes</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">Category</span>.<span class="cm-property">CATEGORY_ATTRIBUTE</span>, <span class="cm-variable">objects</span>.<span class="cm-property">named</span>(<span class="cm-variable">Category</span>, <span class="cm-variable">Category</span>.<span class="cm-property">LIBRARY</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">Usage</span>.<span class="cm-property">USAGE_ATTRIBUTE</span>, <span class="cm-variable">objects</span>.<span class="cm-property">named</span>(<span class="cm-variable">Usage</span>, <span class="cm-variable">Usage</span>.<span class="cm-property">JAVA_RUNTIME</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">Bundling</span>.<span class="cm-property">BUNDLING_ATTRIBUTE</span>, <span class="cm-variable">objects</span>.<span class="cm-property">named</span>(<span class="cm-variable">Bundling</span>, <span class="cm-variable">Bundling</span>.<span class="cm-property">EXTERNAL</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">TargetJvmVersion</span>.<span class="cm-property">TARGET_JVM_VERSION_ATTRIBUTE</span>, <span class="cm-variable">JavaVersion</span>.<span class="cm-property">current</span>().<span class="cm-property">majorVersion</span>.<span class="cm-property">toInteger</span>())</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">LibraryElements</span>.<span class="cm-property">LIBRARY_ELEMENTS_ATTRIBUTE</span>, <span class="cm-variable">objects</span>.<span class="cm-property">named</span>(<span class="cm-variable">LibraryElements</span>, <span class="cm-string">'instrumented-jar'</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 320px;"></div><div class="CodeMirror-gutters" style="height: 350px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock note wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>选择正确的属性进行设置是此过程中最难的事情，因为它们具有变体的语义。</font><font>因此，在添加</font></font><em style="font-style:italic;"><font><font>新属性</font></font></em><font><font>之前</font><font>，您应该始终询问自己是否没有一个可以承载所需语义的属性。</font><font>如果没有，则可以添加一个新属性。</font><font>添加新属性时，还必须小心，因为在选择过程中可能会产生歧义。</font><font>通常，添加属性意味着将其添加到</font></font><em style="font-style:italic;"><font><font>所有</font></font></em><font><font>现有变体中。</font></font></p></div></td></tr></tbody></table></div></div><div class="paragraph"><p><font><font>我们在这里所做的是，我们添加了一个</font></font><em style="font-style:italic;"><font><font>新的</font></font></em><font><font>变体，可以</font></font><em style="font-style:italic;"><font><font>在运行时</font></font></em><font><font>使用它</font><font>，但它包含检测类而不是普通类。</font><font>但是，现在这意味着对于运行时，使用者必须在两个变体之间进行选择：</font></font></p></div><div class="ulist"><ul><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">runtimeElements</code><font><font>，由</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">java-library</code><font><font>插件</font><font>提供的常规变体</font></font></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">instrumentedJars</code><font><font>，我们创建的变体</font></font></span></li></ul></div><div class="paragraph"><p><font><font>特别要说的是，我们要在测试运行时类路径上插入检测后的类。</font><font>现在，我们可以在使用者上将我们的依赖项声明为常规项目依赖项：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子7.声明项目依赖</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029242_917" class="wiz-code-container"><textarea style="display:none;">dependencies {
    testImplementation 'junit:junit:4.13'
    testImplementation project(':producer')
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029242_917"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 104px; min-width: 337.938px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">dependencies</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">testImplementation</span> <span class="cm-string">'junit:junit:4.13'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">testImplementation</span> <span class="cm-variable">project</span>(<span class="cm-string">':producer'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="height: 134px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>如果我们在这里停止，Gradle仍会选择该</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">runtimeElements</code><font><font>变体代替我们的</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">instrumentedJars</code><font><font>变体。</font><font>这是因为</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">testRuntimeClasspath</code><font><font>配置要求配置哪个</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">libraryelements</code><font><font>属性是</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">jar</code><font><font>，并且我们的新</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">instrumented-jars</code><font><font>值</font></font><em style="font-style:italic;"><font><font>不兼容</font></font></em><font><font>。</font></font></p></div><div class="paragraph"><p><font><font>因此，我们需要更改请求的属性，以便现在查找已检测的罐子：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子8.改变消费者属性</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029226_8050" class="wiz-code-container"><textarea style="display:none;">configurations {
    testRuntimeClasspath {
        attributes {
            attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE, objects.named(LibraryElements, 'instrumented-jar'))
        }
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029226_8050"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="display: block; right: 0px; left: 0px; height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 938px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 176px; min-width: 907.475px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">configurations</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">testRuntimeClasspath</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">attributes</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">attribute</span>(<span class="cm-variable">LibraryElements</span>.<span class="cm-property">LIBRARY_ELEMENTS_ATTRIBUTE</span>, <span class="cm-variable">objects</span>.<span class="cm-property">named</span>(<span class="cm-variable">LibraryElements</span>, <span class="cm-string">'instrumented-jar'</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="height: 206px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>现在，我们告诉我们，每当要解析测试运行时类路径时，我们正在寻找的是</font></font><em style="font-style:italic;"><font><font>插装类</font></font></em><font><font>。</font><font>但是，有一个问题：在我们的依赖项列表中，我们有JUnit，很明显，它</font></font><em style="font-style:italic;"><font><font>没有进行</font></font></em><font><font>检测。</font><font>因此，如果我们在这里停下来，Gradle将会失败，并说明没有提供可检测类的JUnit变体。</font><font>这是因为我们没有解释说，如果没有可用的检测版本，则使用常规jar是可以的。</font><font>为此，我们需要编写一个</font></font><em style="font-style:italic;"><font><font>兼容性规则</font></font></em><font><font>：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子9.兼容性规则</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029204_3471" class="wiz-code-container"><textarea style="display:none;">class InstrumentedJarsRule implements AttributeCompatibilityRule&lt;LibraryElements&gt; {

    @Override
    void execute(CompatibilityCheckDetails&lt;LibraryElements&gt; details) {
        if (details.consumerValue.name == 'instrumented-jar' &amp;&amp; details.producerValue.name == 'jar') {
            details.compatible()
        }
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029204_3471"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="display: block; right: 0px; left: 0px; height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 822px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 224px; min-width: 791.8px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">InstrumentedJarsRule</span> <span class="cm-keyword">implements</span> <span class="cm-variable">AttributeCompatibilityRule</span><span class="cm-operator">&lt;</span><span class="cm-variable">LibraryElements</span><span class="cm-operator">&gt;</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right:0.1px"></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-operator">@</span><span class="cm-variable">Override</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-keyword">void</span> <span class="cm-variable">execute</span>(<span class="cm-variable">CompatibilityCheckDetails</span><span class="cm-operator">&lt;</span><span class="cm-variable">LibraryElements</span><span class="cm-operator">&gt;</span> <span class="cm-variable">details</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> (<span class="cm-variable">details</span>.<span class="cm-property">consumerValue</span>.<span class="cm-property">name</span> <span class="cm-operator">==</span> <span class="cm-string">'instrumented-jar'</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">details</span>.<span class="cm-property">producerValue</span>.<span class="cm-property">name</span> <span class="cm-operator">==</span> <span class="cm-string">'jar'</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">details</span>.<span class="cm-property">compatible</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="height: 254px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>我们需要在属性模式上声明：</font></font></p></div><div class="exampleblock"><div class="title" style="font-style: italic;"><font><font>例子10.利用兼容性规则</font></font></div><div class="content"><div class="multi-language-selector"><code data-lang="groovy" class="language-option selected" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:20px center;background-repeat:no-repeat;background-size:20px 12px;&quot;);">Groovy</code><code data-lang="kotlin" class="language-option" style="font-family: Lato, Arial, sans-serif; font-size: 0.9375rem; color: rgba(0, 0, 0, 0.9); background-image: url(&quot;data:image/svg+xml;background-position:30px center;background-repeat:no-repeat;background-size:11px 11px;&quot;);">Kotlin</code></div><div class="exampleblock testable-sample multi-language-sample" data-lang="groovy"><div class="content"><div class="listingblock"><div class="title" style="font-family: Inconsolata, monospace; background-color: rgb(247, 247, 248); background-image: url(&quot;data:image/svg+xml;background-position:16px 80%;background-repeat:no-repeat;background-size:20px 12px;&quot;);"><font><font>消费者/build.gradle</font></font></div></div></div></div></div></div></div></div></div></div><div data-mode="JavaScript" data-theme="default" id="wiz_cm_1605947029170_5534" class="wiz-code-container"><textarea style="display:none;">dependencies {
    attributesSchema {
        attribute(LibraryElements.LIBRARY_ELEMENTS_ATTRIBUTE) {
            compatibilityRules.add(InstrumentedJarsRule)
        }
    }
}</textarea><wiz_code_mirror><div class="CodeMirror cm-s-default" data-id="wiz_cm_1605947029170_5534"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 20px; left: 34px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="padding:0px; width:1000px; height:1em;"></textarea></div><div class="wiz-hide wiz_CodeMirror-vscrollbar" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="wiz-hide wiz_CodeMirror-hscrollbar" style="height: 18px; pointer-events: none;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 30px; min-height: 176px; min-width: 491.8px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="wiz-hide wiz_CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 24px;">&nbsp;</div></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="wiz-hide wiz_CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;"><span class="cm-variable">dependencies</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    <span class="cm-variable">attributesSchema</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        <span class="cm-variable">attribute</span>(<span class="cm-variable">LibraryElements</span>.<span class="cm-property">LIBRARY_ELEMENTS_ATTRIBUTE</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">            <span class="cm-variable">compatibilityRules</span>.<span class="cm-property">add</span>(<span class="cm-variable">InstrumentedJarsRule</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">        }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">    }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class="CodeMirror-line"><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 13px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="height: 206px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></wiz_code_mirror></div><div><div id="content" style="color: rgb(2, 48, 58); font-family: Lato, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div class="sect1"><div class="sectionbody"><div class="paragraph"><p><font><font>就是这样！</font><font>现在我们有：</font></font></p></div><div class="ulist"><ul><li><span><font><font>添加了一个变体，可以提供罐装工具</font></font></span></li><li><span><font><font>解释说此变体可以替代运行时</font></font></span></li><li><span><font><font>解释说，使用者</font><em style="font-style:italic;"><font>仅在测试运行时</font></em><font>需要此变体</font></font><em style="font-style:italic;"><font></font></em></span></li></ul></div><div class="paragraph"><p><font><font>因此，Gradle提供了一种强大的机制，可以根据偏好和兼容性选择正确的变体。</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>在文档的“了解变体的插件”部分中</font></font></a><font><font>可以找到更多详细信息</font><font>。</font></font></p></div><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock warning wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-warning"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>通过像我们一样向现有属性添加值，或通过定义新属性，我们可以扩展模型。</font><font>这意味着</font></font><em style="font-style:italic;"><font><font>所有消费者</font></font></em><font><font>都必须了解此扩展模型。</font><font>对于本地使用者而言，这通常不是问题，因为所有项目都理解并共享相同的模式，但是如果您必须将此新变体发布到外部存储库，则意味着外部使用者必须为其构建添加相同的规则他们通过。</font><font>对于</font></font><em style="font-style:italic;"><font><font>生态系统插件</font></font></em><font><font>（例如Kotlin插件）而言，</font><font>这通常不是问题，</font><font>在任何情况下，如果不应用插件就无法消费，但是如果添加自定义值或属性，则是一个问题。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>因此，</font></font><strong><font><font>避免发布</font></font></strong><font><font>仅用于内部使用的</font><strong><font>自定义变体</font></strong><font>。</font></font></p></div></td></tr></tbody></table></div></div></div></div><div class="sect1"><h2 id="targeting-different-platforms" style="font-size:1.5rem;"><a class="anchor" href="#targeting-different-platforms" style="color: rgb(29, 162, 189); text-decoration: none;"></a><a class="link" href="#targeting-different-platforms" style="color:rgb(2, 48, 58);text-decoration:none;"><font><font>针对不同的平台</font></font></a></h2><div class="sectionbody"><div class="paragraph"><p><font><font>库通常针对不同的平台。</font><font>在Java生态系统中，我们经常会看到同一库的不同工件，但有不同的</font></font><em style="font-style:italic;"><font><font>分类器</font></font></em><font><font>。</font><font>一个典型的例子是番石榴，其发布方式如下：</font></font></p></div><div class="ulist"><ul><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">guava-jre</code><font><font><span>&nbsp;</span>适用于JDK 8及更高版本</font></font></span></li><li><span><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">guava-android</code><font><font><span>&nbsp;</span>对于JDK 7</font></font></span></li></ul></div><div class="paragraph"><p><font><font>这种方法的问题在于，没有与分类器相关的语义。</font><font>特别是，依赖项解析引擎无法根据使用者需求自动确定要使用哪个版本。</font><font>例如，这将是更好地表达你对番石榴的依赖，并让发动机之间选择</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">jre</code><font><font>，并</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">android</code><font><font>根据什么是兼容的。</font></font></p></div><div class="paragraph"><p><font><font>Gradle为此提供了一种改进的模型，它没有分类器的弱点：属性。</font></font></p></div><div class="paragraph"><p><font><font>特别是在Java生态系统中，Gradle提供了一个内置属性，库作者可以使用该属性来表达与Java生态系统的兼容性：</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.jvm.version</code><font><font>。</font><font>此属性表示</font></font><em style="font-style:italic;"><font><font>使用者必须具备</font></font></em><font><font>的</font><em style="font-style:italic;"><font>最低版本才能正常工作</font></em><font>。</font></font></p></div><div class="paragraph"><p><font><font>当您应用</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">java</code><font><font>或</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">java-library</code><font><font>插件时，Gradle会自动将此属性与外发变体相关联。</font><font>这意味着，所有使用Gradle发布的库都会自动告知它们使用的目标平台。</font></font></p></div><div class="paragraph"><p><font><font>默认情况下，将</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">org.gradle.jvm.version</code><font><font>设置为</font><font>源集主编译任务</font><font>的</font></font><a href style="color:rgb(29, 162, 189);text-decoration:none;"><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">release</code><font><font>属性</font></font></a><font><font>值</font><font>（或作为对</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">targetCompatibility</code><font><font>值的</font><font>后备</font><font>）。</font></font></p></div><div class="paragraph"><p><font><font>自动设置此属性后</font><font>，默认情况下</font><font>，Gradle</font></font><em style="font-style:italic;"><font><font>不会</font></font></em><font><font>允许您为不同的JVM构建项目。</font><font>如果需要执行此操作，则需要</font></font><a href="#sec:variant-aware-sharing" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>按照有关变体感知匹配</font></font></a><font><font>的</font><a href="#sec:variant-aware-sharing" style="color:rgb(29, 162, 189);text-decoration:none;"><font>说明</font></a><font>创建其他变体</font><font>。</font></font></p></div><div class="wiz-table-container" style="position: relative; padding: 0px;"><div class="admonitionblock note wiz-table-body"><table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><font><font>Gradle的未来版本将提供自动为不同Java平台构建的方法。</font></font></td></tr></tbody></table></div></div></div></div></div><br></div></body></html>