 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# Maven发布插件

内容

* [用法](#publishing_maven:usage)
* [任务](#publishing_maven:tasks)
* [刊物](#publishing_maven:publications)
* [储存库](#publishing_maven:repositories)
* [发布到Maven Local](#publishing_maven:install)
* [完整的例子](#publishing_maven:complete_example)
* [删除延迟的配置行为](#publishing_maven:deferred_configuration)

Maven发布插件提供了将构建工件发布到[Apache Maven](http://maven.apache.org/)存储库的功能。发布到Maven存储库的模块可由Maven，Gradle（请参阅[声明依赖项]()）和其他了解Maven存储库格式的工具使用。您可以在[发布概述中]()了解发布的基础知识。

## [](#publishing_maven:usage)[用法](#publishing_maven:usage)

要使用Maven Publish插件，请在构建脚本中包括以下内容：

示例1.应用Maven发布插件

`Groovy``Kotlin`

build.gradle

plugins \{ id 'maven-publish' \}

 

1

plugins \{

2

 id 'maven-publish'

3

\}

Maven Publish插件在项目上使用扩展名`publishing`，类型为[PublishingExtension]()。此扩展提供了一个命名出版物的容器和一个命名存储库的容器。Maven Publish插件可与[MavenPublication]()出版物和[MavenArtifactRepository]()存储库一起使用。

## [](#publishing_maven:tasks)[任务](#publishing_maven:tasks)

`generatePomFileFor_PubName_Publication`—[GenerateMavenPom]()

为名为_PubName_的发布创建一个POM文件，填充已知的元数据，例如项目名称，项目版本和依赖项。POM文件的默认位置是_build / publications / \$ pubName / pom-default.xml_。

`publish_PubName_PublicationTo_RepoName_Repository`—[PublishToMaven资源库]()

将_PubName_发布发布到名为_RepoName_的存储库。如果您具有没有明确名称的存储库定义，则_RepoName_将为“ Maven”。

`publish_PubName_PublicationToMavenLocal`—[PublishToMavenLocal]()

将_PubName_发布以及本地发布的POM文件和其他元数据复制到本地Maven缓存中（通常_为\$ USER\_HOME / .m2 / repository）_。

`publish`

_取决于_：所有任务`publish_PubName_PublicationTo_RepoName_Repository`

将所有定义的发布发布到所有定义的存储库的聚合任务。它_不_包括复制出版物本地Maven缓存。

`publishToMavenLocal`

_取决于_：所有任务`publish_PubName_PublicationToMavenLocal`

将所有已定义的发布（包括其元数据（POM文件等））复制到本地Maven缓存中。

## [](#publishing_maven:publications)[刊物](#publishing_maven:publications)

此插件提供[出版物]()类型的[MavenPublication]()。要了解如何定义和使用出版物，请参见[基本出版]()部分。

您可以在Maven发布中配置以下四项主要内容：

* 一个[组件]()—通过[MavenPublication.from（org.gradle.api.component.SoftwareComponent）]()。
* [自定义工件]()\-通过[MavenPublication.artifact（java.lang.Object）]()方法。有关自定义Maven工件的可用配置选项，请参见[MavenArtifact]()。
* 标准元数据一样`artifactId`，`groupId`和`version`。
* POM文件的其他内容-通过[MavenPublication.pom（org.gradle.api.Action）]()。

您可以在[完整的发布示例中](#publishing_maven:complete_example)看到所有这些内容。的API文档`MavenPublication`还有其他代码示例。

### [](#sec:identity_values_in_the_generated_pom)[生成的POM中的标识值](#sec:identity_values_in_the_generated_pom)

生成的POM文件的属性将包含从以下项目属性派生的标识值：

* `groupId`\-[Project.getGroup（）]()
* `artifactId`\-[Project.getName（）]()
* `version`\-[Project.getVersion（）]()

覆盖默认标识值非常简单：只需指定`groupId`，`artifactId`或者`version`在配置时属性[MavenPublication]()。

示例2.定制发布标识

`Groovy``Kotlin`

build.gradle

publishing \{ publications \{ maven\(MavenPublication\) \{ groupId = 'org.gradle.sample' artifactId = 'library' version = '1.1' from components.java \} \} \}

 

1

publishing \{

2

 publications \{

3

 maven\(MavenPublication\) \{

4

 groupId \= 'org.gradle.sample'

5

 artifactId \= 'library'

6

 version \= '1.1'

7

8

 from components.java

9

 \}

10

 \}

11

\}

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>某些存储库将无法处理所有受支持的字符。</font><font>例如，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">:</code><font><font>当发布到Windows上由文件系统支持的存储库时</font><font>，该</font><font>字符不能用作标识符。</font></font></p></div></td></tr></tbody></table>

Maven的限制`groupId`和`artifactId`有限字符集（`[A-Za-z0-9_\\-.]+`）和摇篮实施了这一约束。对于`version`（以及工件`extension`和`classifier`属性），Gradle将处理任何有效的Unicode字符。

被明令禁止，唯一的Unicode值`\`，`/`以及任何ISO控制字符。提供的值在发布早期就得到了验证。

### [](#sec:modifying_the_generated_pom)[自定义生成的POM](#sec:modifying_the_generated_pom)

可以在发布之前自定义生成的POM文件。例如，将库发布到Maven Central时，需要设置某些元数据。Maven发布插件为此提供了DSL。请参阅《 DSL参考》中的[MavenPom]()，以获取可用属性和方法的完整文档。下面的示例演示如何使用最常见的方法：

例子3.定制POM文件

`Groovy``Kotlin`

build.gradle

publishing \{ publications \{ mavenJava\(MavenPublication\) \{ pom \{ name = 'My Library' description = 'A concise description of my library' url = 'http://www.example.com/library' properties = \[ myProp: "value", "prop.with.dots": "anotherValue" \] licenses \{ license \{ name = 'The Apache License, Version 2.0' url = 'http://www.apache.org/licenses/LICENSE-2.0.txt' \} \} developers \{ developer \{ id = 'johnd' name = 'John Doe' email = 'john.doe\@example.com' \} \} scm \{ connection = 'scm:git:git://example.com/my-library.git' developerConnection = 'scm:git:ssh://example.com/my-library.git' url = 'http://example.com/my-library/' \} \} \} \} \}

 

1

publishing \{

2

 publications \{

3

 mavenJava\(MavenPublication\) \{

4

 pom \{

5

 name \= 'My Library'

6

 description \= 'A concise description of my library'

7

 url \= 'http://www.example.com/library'

8

 properties \= \[

9

 myProp: "value",

10

 "prop.with.dots": "anotherValue"

11

 \]

12

 licenses \{

13

 license \{

14

 name \= 'The Apache License, Version 2.0'

15

 url \= 'http://www.apache.org/licenses/LICENSE-2.0.txt'

16

 \}

17

 \}

18

 developers \{

19

 developer \{

20

 id \= 'johnd'

21

 name \= 'John Doe'

22

 email \= 'john.doe\@example.com'

23

 \}

24

 \}

25

 scm \{

26

 connection \= 'scm:git:git://example.com/my-library.git'

27

 developerConnection \= 'scm:git:ssh://example.com/my-library.git'

28

 url \= 'http://example.com/my-library/'

29

 \}

30

 \}

31

 \}

32

 \}

33

\}

### [](#publishing_maven:resolved_dependencies)[自定义依赖版本](#publishing_maven:resolved_dependencies)

支持两种策略来发布依赖项：

声明的版本（默认）

此策略使用`dependencies`块中的依赖项声明发布由构建脚本作者定义的版本。发布不会考虑任何其他类型的处理，例如通过[更改已解决版本的规则]()。

解决的版本

此策略可能会通过应用解决方案规则和自动冲突解决方案来发布在构建期间已解决的版本。这样做的好处是，已发布的版本对应于已测试发布的工件的版本。

解析版本的用例示例：

* 项目将动态版本用于依赖项，但更喜欢将给定版本的已解析版本公开给其使用者。
* 与[依赖项锁定]()结合使用，您要发布锁定的版本。
* 一个项目利用了Gradle的丰富版本约束，这些约束对Maven进行了有损转换。它不依赖转换，而是发布已解决的版本。

这是通过使用`versionMapping`DSL方法完成的，该方法允许配置[VersionMappingStrategy]()：

例子4.使用解决的版本

`Groovy``Kotlin`

build.gradle

publishing \{ publications \{ mavenJava\(MavenPublication\) \{ versionMapping \{ usage\('java-api'\) \{ fromResolutionOf\('runtimeClasspath'\) \} usage\('java-runtime'\) \{ fromResolutionResult\(\) \} \} \} \} \}

 

1

publishing \{

2

 publications \{

3

 mavenJava\(MavenPublication\) \{

4

 versionMapping \{

5

 usage\('java-api'\) \{

6

 fromResolutionOf\('runtimeClasspath'\)

7

 \}

8

 usage\('java-runtime'\) \{

9

 fromResolutionResult\(\)

10

 \}

11

 \}

12

 \}

13

 \}

14

\}

在上面的示例中，Gradle将使用在中`runtimeClasspath`声明的依赖项上解析的版本，这些依赖项`api`已映射到`compile`Maven的范围。Gradle还将使用在上`runtimeClasspath`声明的for依赖项上解析的版本，这些版本`implementation`映射到`runtime`Maven的范围。`fromResolutionResult()`指示Gradle应该使用变体`runtimeClasspath`的默认类路径，并且是的默认类路径`java-runtime`。

## [](#publishing_maven:repositories)[储存库](#publishing_maven:repositories)

该插件提供了[MavenArtifactRepository]()类型的[存储库]()。要了解如何定义和使用存储库进行发布，请参见“[基本发布]()”部分。

这是定义发布存储库的简单示例：

示例5.声明要发布到的存储库

`Groovy``Kotlin`

build.gradle

publishing \{ repositories \{ maven \{ // change to point to your repo, e.g. http://my.org/repo url = "\$buildDir/repo" \} \} \}

 

1

publishing \{

2

 repositories \{

3

 maven \{

4

 // change to point to your repo, e.g. http://my.org/repo

5

 url \= "\$buildDir/repo"

6

 \}

7

 \}

8

\}

您将要配置的两个主要内容是存储库：

* 网址（必填）
* 名称（可选）

您可以定义多个存储库，只要它们在构建脚本中具有唯一的名称即可。您也可以声明一个（只有一个）没有名称的存储库。该存储库将采用隐式名称“ Maven”。

您还可以配置连接到存储库所需的任何身份验证详细信息。有关更多详细信息，请参见[MavenArtifactRepository]()。

### [](#publishing_maven:snapshot_and_release_repositories)[快照和版本库](#publishing_maven:snapshot_and_release_repositories)

将快照和发行版发布到不同的Maven存储库是一种常见的做法。一种简单的方法是根据项目版本配置存储库URL。下面的示例对以“ SNAPSHOT”结尾的版本使用一个URL，对其余版本使用不同的URL：

例子6.根据项目版本配置存储库URL

`Groovy``Kotlin`

build.gradle

publishing \{ repositories \{ maven \{ def releasesRepoUrl = "\$buildDir/repos/releases" def snapshotsRepoUrl = "\$buildDir/repos/snapshots" url = version.endsWith\('SNAPSHOT'\) \? snapshotsRepoUrl : releasesRepoUrl \} \} \}

 

1

publishing \{

2

 repositories \{

3

 maven \{

4

 def releasesRepoUrl \= "\$buildDir/repos/releases"

5

 def snapshotsRepoUrl \= "\$buildDir/repos/snapshots"

6

 url \= version.endsWith\('SNAPSHOT'\) \? snapshotsRepoUrl : releasesRepoUrl

7

 \}

8

 \}

9

\}

同样，您可以使用[项目或系统属性]()来决定发布到哪个存储库。如果`release`设置了项目属性，例如在用户运行时，以下示例将使用发行版存储库`gradle \-Prelease publish`：

例子7.根据项目属性配置存储库URL

`Groovy``Kotlin`

build.gradle

publishing \{ repositories \{ maven \{ def releasesRepoUrl = "\$buildDir/repos/releases" def snapshotsRepoUrl = "\$buildDir/repos/snapshots" url = project.hasProperty\('release'\) \? releasesRepoUrl : snapshotsRepoUrl \} \} \}

 

1

publishing \{

2

 repositories \{

3

 maven \{

4

 def releasesRepoUrl \= "\$buildDir/repos/releases"

5

 def snapshotsRepoUrl \= "\$buildDir/repos/snapshots"

6

 url \= project.hasProperty\('release'\) \? releasesRepoUrl : snapshotsRepoUrl

7

 \}

8

 \}

9

\}

## [](#publishing_maven:install)[发布到Maven Local](#publishing_maven:install)

为了与本地Maven安装集成，有时将模块及其POM文件和其他元数据发布到Maven本地存储库（通常位于_\$ USER\_HOME / .m2 / repository中_）_很有_用。用Maven的话来说，这就是“安装”模块。

Maven的发布插件使得这很容易做到通过自动创建[PublishToMavenLocal]()每个任务[MavenPublication]()在`publishing.publications`容器中。任务名称遵循的模式。这些任务中的每一个都连接到聚合任务中。您不需要在您的部分中。`publish_PubName_PublicationToMavenLocal``publishToMavenLocal``mavenLocal()``publishing.repositories`

## [](#publishing_maven:complete_example)[完整的例子](#publishing_maven:complete_example)

以下示例演示如何签名和发布Java库，包括源，Javadoc和自定义的POM：

例子8.发布一个Java库

`Groovy``Kotlin`

build.gradle

plugins \{ id 'java-library' id 'maven-publish' id 'signing' \} group = 'com.example' version = '1.0' java \{ withJavadocJar\(\) withSourcesJar\(\) \} publishing \{ publications \{ mavenJava\(MavenPublication\) \{ artifactId = 'my-library' from components.java versionMapping \{ usage\('java-api'\) \{ fromResolutionOf\('runtimeClasspath'\) \} usage\('java-runtime'\) \{ fromResolutionResult\(\) \} \} pom \{ name = 'My Library' description = 'A concise description of my library' url = 'http://www.example.com/library' properties = \[ myProp: "value", "prop.with.dots": "anotherValue" \] licenses \{ license \{ name = 'The Apache License, Version 2.0' url = 'http://www.apache.org/licenses/LICENSE-2.0.txt' \} \} developers \{ developer \{ id = 'johnd' name = 'John Doe' email = 'john.doe\@example.com' \} \} scm \{ connection = 'scm:git:git://example.com/my-library.git' developerConnection = 'scm:git:ssh://example.com/my-library.git' url = 'http://example.com/my-library/' \} \} \} \} repositories \{ maven \{ // change URLs to point to your repos, e.g. http://my.org/repo def releasesRepoUrl = "\$buildDir/repos/releases" def snapshotsRepoUrl = "\$buildDir/repos/snapshots" url = version.endsWith\('SNAPSHOT'\) \? snapshotsRepoUrl : releasesRepoUrl \} \} \} signing \{ sign publishing.publications.mavenJava \} javadoc \{ if\(JavaVersion.current\(\).isJava9Compatible\(\)\) \{ options.addBooleanOption\('html5', true\) \} \}

 

1

plugins \{

2

 id 'java-library'

3

 id 'maven-publish'

4

 id 'signing'

5

\}

6

7

group \= 'com.example'

8

version \= '1.0'

9

10

java \{

11

 withJavadocJar\(\)

12

 withSourcesJar\(\)

13

\}

14

15

publishing \{

16

 publications \{

17

 mavenJava\(MavenPublication\) \{

18

 artifactId \= 'my-library'

19

 from components.java

20

 versionMapping \{

21

 usage\('java-api'\) \{

22

 fromResolutionOf\('runtimeClasspath'\)

23

 \}

24

 usage\('java-runtime'\) \{

25

 fromResolutionResult\(\)

26

 \}

27

 \}

28

 pom \{

29

 name \= 'My Library'

30

 description \= 'A concise description of my library'

31

 url \= 'http://www.example.com/library'

32

 properties \= \[

33

 myProp: "value",

34

 "prop.with.dots": "anotherValue"

35

 \]

36

 licenses \{

37

 license \{

38

 name \= 'The Apache License, Version 2.0'

39

 url \= 'http://www.apache.org/licenses/LICENSE-2.0.txt'

40

 \}

41

 \}

42

 developers \{

43

 developer \{

44

 id \= 'johnd'

45

 name \= 'John Doe'

46

 email \= 'john.doe\@example.com'

47

 \}

48

 \}

49

 scm \{

50

 connection \= 'scm:git:git://example.com/my-library.git'

51

 developerConnection \= 'scm:git:ssh://example.com/my-library.git'

52

 url \= 'http://example.com/my-library/'

53

 \}

54

 \}

55

 \}

56

 \}

57

 repositories \{

58

 maven \{

59

 // change URLs to point to your repos, e.g. http://my.org/repo

60

 def releasesRepoUrl \= "\$buildDir/repos/releases"

61

 def snapshotsRepoUrl \= "\$buildDir/repos/snapshots"

62

 url \= version.endsWith\('SNAPSHOT'\) \? snapshotsRepoUrl : releasesRepoUrl

63

 \}

64

 \}

65

\}

66

67

signing \{

68

 sign publishing.publications.mavenJava

69

\}

70

71

72

javadoc \{

73

 if\(JavaVersion.current\(\).isJava9Compatible\(\)\) \{

74

 options.addBooleanOption\('html5', true\)

75

 \}

76

\}

结果是将发布以下工件：

* POM：`my-library-1.0.pom`
* Java组件的主要JAR工件：`my-library-1.0.jar`
* 已明确配置的源JAR工件：`my-library-1.0-sources.jar`
* 已明确配置的Javadoc JAR工件：`my-library-1.0-javadoc.jar`

该[签名插件]()被用来生成每个工件的签名文件。此外，还将为所有工件和签名文件生成校验和文件。

## [](#publishing_maven:deferred_configuration)[删除延迟的配置行为](#publishing_maven:deferred_configuration)

在Gradle 5.0之前，`publishing {}`（默认情况下）对块进行隐式处理，就好像在评估项目后已执行了其中的所有逻辑一样。此行为引起了很多混乱，在Gradle 4.8中已弃用，因为它是唯一以这种方式运行的块。

您的发布块中或插件中可能有一些逻辑，具体取决于延迟的配置行为。例如，以下逻辑假定在设置artifactId时将评估子项目：

`Groovy``Kotlin`

build.gradle

subprojects \{ publishing \{ publications \{ mavenJava\(MavenPublication\) \{ from components.java artifactId = jar.archiveBaseName \} \} \} \}

 

1

subprojects \{

2

 publishing \{

3

 publications \{

4

 mavenJava\(MavenPublication\) \{

5

 from components.java

6

 artifactId \= jar.archiveBaseName

7

 \}

8

 \}

9

 \}

10

\}

现在必须将这种逻辑包装在一个`afterEvaluate {}`块中。

`Groovy``Kotlin`

build.gradle

subprojects \{ publishing \{ publications \{ mavenJava\(MavenPublication\) \{ from components.java afterEvaluate \{ artifactId = jar.archiveBaseName \} \} \} \} \}

 

1

subprojects \{

2

 publishing \{

3

 publications \{

4

 mavenJava\(MavenPublication\) \{

5

 from components.java

6

 afterEvaluate \{

7

 artifactId \= jar.archiveBaseName

8

 \}

9

 \}

10

 \}

11

 \}

12

\}