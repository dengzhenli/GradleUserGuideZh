 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# 常春藤发布插件

内容

* [用法](#publishing_ivy:usage)
* [任务](#publishing_ivy:tasks)
* [刊物](#publishing_ivy:publications)
* [储存库](#publishing_ivy:repositories)
* [完整的例子](#publishing_ivy:example)
* [从旧版Ivy出版物迁移](#sec:pub_ivy:legacy_migration)

Ivy Publish插件提供了以[Apache Ivy](http://ant.apache.org/ivy/)格式发布构建工件的功能，通常将其发布到存储库以供其他构建或项目使用。发布的内容是由构建创建的一个或多个工件，以及一个Ivy_模块描述符_（通常为`ivy.xml`），该描述_符_描述了工件及其相关性（如果有）。

Gradle（请参阅[声明依赖项]()）和其他了解Ivy格式的工具可以使用已发布的Ivy模块。您可以在[发布概述中]()了解发布的基础知识。

## [](#publishing_ivy:usage)[用法](#publishing_ivy:usage)

要使用Ivy Publish插件，请在构建脚本中包括以下内容：

例子1.应用Ivy Publish插件

`Groovy``Kotlin`

build.gradle

plugins \{ id 'ivy-publish' \}

 

1

plugins \{

2

 id 'ivy-publish'

3

\}

Ivy Publish插件在项目上使用扩展名`publishing`，类型为[PublishingExtension]()。此扩展提供了一个命名出版物的容器和一个命名存储库的容器。Ivy Publish插件可与[IvyPublication]()出版物和[IvyArtifactRepository]()仓库一起使用。

## [](#publishing_ivy:tasks)[任务](#publishing_ivy:tasks)

`generateDescriptorFileFor_PubName_Publication`—[GenerateIvyDescriptor]()

为名为_PubName_的发布创建一个Ivy描述符文件，填充已知的元数据，例如项目名称，项目版本和依赖项。描述符文件的默认位置是_build / publications / \$ pubName / ivy.xml_。

`publish_PubName_PublicationTo_RepoName_Repository`—[PublishToIvyRepository]()

将_PubName_发布发布到名为_RepoName_的存储库。如果您具有没有明确名称的存储库定义，则_RepoName_将为“ Ivy”。

`publish`

_取决于_：所有任务`publish_PubName_PublicationTo_RepoName_Repository`

将所有定义的发布发布到所有定义的存储库的聚合任务。

## [](#publishing_ivy:publications)[刊物](#publishing_ivy:publications)

此插件提供[出版物]()类型的[IvyPublication]()。要了解如何定义和使用出版物，请参见[基本出版]()部分。

您可以在Ivy发布中配置以下四项主要内容：

* 一个[组件]()—通过[IvyPublication.from（org.gradle.api.component.SoftwareComponent）]()。
* [自定义工件]()\-通过[IvyPublication.artifact（java.lang.Object）]()方法。有关自定义Ivy工件的可用配置选项，请参见[IvyArtifact]()。
* 标准元数据一样`module`，`organisation`和`revision`。
* 模块描述符的其他内容-通过[IvyPublication.descriptor（org.gradle.api.Action）]()。

您可以在[完整的发布示例中](#publishing_ivy:example)看到所有这些内容。的API文档`IvyPublication`还有其他代码示例。

### [](#sec:identity_values_for_the_published_project)[已发布项目的标识值](#sec:identity_values_for_the_published_project)

生成的Ivy模块描述符文件包含一个`<info>`标识模块的元素。默认标识值从以下派生：

* `organisation`\-[Project.getGroup（）]()
* `module`\-[Project.getName（）]()
* `revision`\-[Project.getVersion（）]()
* `status`\-[Project.getStatus（）]()
* `branch`\- （没有设置）

覆盖默认标识值非常简单：只需指定`organisation`，`module`或`revision`配置属性时[IvyPublication]()。`status`并`branch`可以通过`descriptor`属性设置\-请参见[IvyModuleDescriptorSpec]()。

该`descriptor`属性还可以用于添加其他自定义元素作为该`<info>`元素的子元素，如下所示：

例子2.定制发布标识

`Groovy``Kotlin`

build.gradle

publishing \{ publications \{ ivy\(IvyPublication\) \{ organisation = 'org.gradle.sample' module = 'project1-sample' revision = '1.1' descriptor.status = 'milestone' descriptor.branch = 'testing' descriptor.extraInfo 'http://my.namespace', 'myElement', 'Some value' from components.java \} \} \}

 

1

publishing \{

2

 publications \{

3

 ivy\(IvyPublication\) \{

4

 organisation \= 'org.gradle.sample'

5

 module \= 'project1-sample'

6

 revision \= '1.1'

7

 descriptor.status \= 'milestone'

8

 descriptor.branch \= 'testing'

9

 descriptor.extraInfo 'http://my.namespace', 'myElement', 'Some value'

10

11

 from components.java

12

 \}

13

 \}

14

\}

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>某些存储库无法处理所有受支持的字符。</font><font>例如，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">:</code><font><font>当发布到Windows上由文件系统支持的存储库时</font><font>，该</font><font>字符不能用作标识符。</font></font></p></div></td></tr></tbody></table>

摇篮将处理任何有效的Unicode字符`organisation`，`module`和`revision`（以及神器的`name`，`extension`和`classifier`）。被明令禁止的唯一值`\`，`/`以及任何ISO控制字符。提供的值在发布过程的早期就得到了验证。

### [](#sec:modifying_the_generated_module_descriptor)[自定义生成的模块描述符](#sec:modifying_the_generated_module_descriptor)

有时，从项目信息生成的模块描述符文件需要在发布之前进行调整。Ivy Publish Plugin为此提供了DSL。请参阅《 DSL参考》中的[IvyModuleDescriptorSpec]()，以获取可用属性和方法的完整文档。

下面的示例演示如何使用DSL最常见的方面：

例子3.定制模块描述符文件

`Groovy``Kotlin`

build.gradle

publications \{ ivyCustom\(IvyPublication\) \{ descriptor \{ license \{ name = 'The Apache License, Version 2.0' url = 'http://www.apache.org/licenses/LICENSE-2.0.txt' \} author \{ name = 'Jane Doe' url = 'http://example.com/users/jane' \} description \{ text = 'A concise description of my library' homepage = 'http://www.example.com/library' \} \} versionMapping \{ usage\('java-api'\) \{ fromResolutionOf\('runtimeClasspath'\) \} usage\('java-runtime'\) \{ fromResolutionResult\(\) \} \} \} \}

 

1

 publications \{

2

 ivyCustom\(IvyPublication\) \{

3

 descriptor \{

4

 license \{

5

 name \= 'The Apache License, Version 2.0'

6

 url \= 'http://www.apache.org/licenses/LICENSE-2.0.txt'

7

 \}

8

 author \{

9

 name \= 'Jane Doe'

10

 url \= 'http://example.com/users/jane'

11

 \}

12

 description \{

13

 text \= 'A concise description of my library'

14

 homepage \= 'http://www.example.com/library'

15

 \}

16

 \}

17

 versionMapping \{

18

 usage\('java-api'\) \{

19

 fromResolutionOf\('runtimeClasspath'\)

20

 \}

21

 usage\('java-runtime'\) \{

22

 fromResolutionResult\(\)

23

 \}

24

 \}

25

 \}

26

 \}

在此示例中，我们只是在生成的Ivy依赖项描述符中添加了一个'description'元素，但是该钩子允许您修改生成的描述符的任何方面。例如，您可以将依赖关系的版本范围替换为用于生成内部版本的实际版本。

您还可以通过[IvyModuleDescriptorSpec.withXml（org.gradle.api.Action）]()将任意XML添加到描述符文件中，但是不能使用它来修改模块标识符的任何部分（组织，模块，修订版）。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-caution"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><font><font>可以以不再是有效的Ivy模块描述符的方式修改描述符，因此在使用此功能时必须小心。</font></font></td></tr></tbody></table>

### [](#publishing_ivy:resolved_dependencies)[自定义依赖版本](#publishing_ivy:resolved_dependencies)

支持两种策略来发布依赖项：

声明的版本（默认）

此策略使用`dependencies`块中的依赖项声明发布由构建脚本作者定义的版本。发布不会考虑任何其他类型的处理，例如通过[更改已解决版本的规则]()。

解决的版本

此策略可能会通过应用解决方案规则和自动冲突解决方案来发布在构建期间已解决的版本。这样做的好处是，已发布的版本对应于已测试发布的工件的版本。

解析版本的用例示例：

* 项目将动态版本用于依赖项，但更喜欢将给定版本的已解析版本公开给其使用者。
* 与[依赖项锁定]()结合使用，您要发布锁定的版本。
* 一个项目利用了Gradle的丰富版本约束，这些约束对Ivy进行了有损转换。它不依赖转换，而是发布已解决的版本。

这是通过使用`versionMapping`DSL方法完成的，该方法允许配置[VersionMappingStrategy]()：

例子4.使用解决的版本

`Groovy``Kotlin`

build.gradle

publications \{ ivyCustom\(IvyPublication\) \{ versionMapping \{ usage\('java-api'\) \{ fromResolutionOf\('runtimeClasspath'\) \} usage\('java-runtime'\) \{ fromResolutionResult\(\) \} \} \} \}

 

1

 publications \{

2

 ivyCustom\(IvyPublication\) \{

3

 versionMapping \{

4

 usage\('java-api'\) \{

5

 fromResolutionOf\('runtimeClasspath'\)

6

 \}

7

 usage\('java-runtime'\) \{

8

 fromResolutionResult\(\)

9

 \}

10

 \}

11

 \}

12

 \}

在上面的示例中，Gradle将使用在中`runtimeClasspath`声明的依赖项上解析的版本，这些依赖项`api`已映射到`compile`Ivy的配置。Gradle还将使用在上`runtimeClasspath`声明的for依赖项上解析的版本，这些版本`implementation`映射到`runtime`Ivy的配置。`fromResolutionResult()`指示Gradle应该使用变体`runtimeClasspath`的默认类路径，并且是的默认类路径`java-runtime`。

## [](#publishing_ivy:repositories)[储存库](#publishing_ivy:repositories)

该插件提供了[IvyArtifactRepository]()类型的[存储库]()。要了解如何定义和使用存储库进行发布，请参见“[基本发布]()”部分。

这是定义发布存储库的简单示例：

示例5.声明要发布到的存储库

`Groovy``Kotlin`

build.gradle

publishing \{ repositories \{ ivy \{ // change to point to your repo, e.g. http://my.org/repo url = "\$buildDir/repo" \} \} \}

 

1

publishing \{

2

 repositories \{

3

 ivy \{

4

 // change to point to your repo, e.g. http://my.org/repo

5

 url \= "\$buildDir/repo"

6

 \}

7

 \}

8

\}

您将要配置的两个主要内容是存储库：

* 网址（必填）
* 名称（可选）

您可以定义多个存储库，只要它们在构建脚本中具有唯一的名称即可。您也可以声明一个（只有一个）没有名称的存储库。该存储库将采用隐式名称“ Ivy”。

您还可以配置连接到存储库所需的任何身份验证详细信息。有关更多详细信息，请参见[IvyArtifactRepository]()。

## [](#publishing_ivy:example)[完整的例子](#publishing_ivy:example)

下面的示例演示了使用多项目构建的发布。每个项目都发布一个Java组件，该Java组件配置为还构建和发布Javadoc和源代码工件。定制描述符文件以包括每个项目的项目描述。

例子6.发布一个Java模块

`Groovy``Kotlin`

settings.gradle

rootProject.name = 'ivy-publish-java' include 'project1', 'project2'

 

1

rootProject.name \= 'ivy-publish-java'

2

include 'project1', 'project2'

buildSrc / build.gradle

plugins \{ id 'groovy-gradle-plugin' \}

 

1

plugins \{

2

 id 'groovy-gradle-plugin'

3

\}

buildSrc / src / main / groovy / myproject.publishing-conventions.gradle

plugins \{ id 'java-library' id 'ivy-publish' \} version = '1.0' group = 'org.gradle.sample' repositories \{ mavenCentral\(\) \} java \{ withJavadocJar\(\) withSourcesJar\(\) \} publishing \{ repositories \{ ivy \{ // change to point to your repo, e.g. http://my.org/repo url = "\$\{rootProject.buildDir\}/repo" \} \} publications \{ ivy\(IvyPublication\) \{ from components.java descriptor.description \{ text = providers.provider\(\{ description \}\) \} \} \} \}

 

1

plugins \{

2

 id 'java-library'

3

 id 'ivy-publish'

4

\}

5

6

version \= '1.0'

7

group \= 'org.gradle.sample'

8

9

repositories \{

10

 mavenCentral\(\)

11

\}

12

13

java \{

14

 withJavadocJar\(\)

15

 withSourcesJar\(\)

16

\}

17

18

publishing \{

19

 repositories \{

20

 ivy \{

21

 // change to point to your repo, e.g. http://my.org/repo

22

 url \= "\$\{rootProject.buildDir\}/repo"

23

 \}

24

 \}

25

 publications \{

26

 ivy\(IvyPublication\) \{

27

 from components.java

28

 descriptor.description \{

29

 text \= providers.provider\(\{ description \}\)

30

 \}

31

 \}

32

 \}

33

\}

project1 / build.gradle

plugins \{ id 'myproject.publishing-conventions' \} description = 'The first project' dependencies \{ implementation 'junit:junit:4.13' implementation project\(':project2'\) \}

 

1

plugins \{

2

 id 'myproject.publishing-conventions'

3

\}

4

5

description \= 'The first project'

6

7

dependencies \{

8

 implementation 'junit:junit:4.13'

9

 implementation project\(':project2'\)

10

\}

project2 / build.gradle

plugins \{ id 'myproject.publishing-conventions' \} description = 'The second project' dependencies \{ implementation 'commons-collections:commons-collections:3.2.2' \}

 

1

plugins \{

2

 id 'myproject.publishing-conventions'

3

\}

4

5

description \= 'The second project'

6

7

dependencies \{

8

 implementation 'commons-collections:commons-collections:3.2.2'

9

\}

结果是将为每个项目发布以下工件：

* Gradle模块元数据文件：`project1-1.0.module`。
* 常春藤模块元数据文件：`ivy-1.0.xml`。
* Java组件的主要JAR工件：`project1-1.0.jar`。
* Javadoc和Java组件的源JAR工件（因为我们配置了`withJavadocJar()`和`withSourcesJar()`）：`project1-1.0-javadoc.jar`，`project1-1.0-source.jar`。

## [](#sec:pub_ivy:legacy_migration)[从旧版Ivy出版物迁移](#sec:pub_ivy:legacy_migration)

如果要迁移以前依赖于[旧版发布]()支持的项目，则会发现以下两种解决方案之间的差异。

### [](#configurations_marked_as_non_transitive)[标记为不可传递的配置](#configurations_marked_as_non_transitive)

当配置标记为时`transitive = false`，它不会映射到Ivy。

Gradle将发出警告，指出已发布此类配置。如果确实需要发布此建议，则是使用依赖级别`transitive = false`。

### [](#forced_dependencies_are_not_mapped)[强制依赖关系未映射](#forced_dependencies_are_not_mapped)

虽然Ivy支持[`force`依赖项](https://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html#_forcing_revision)的概念，但Gradle不会将其已弃用的`force`声明映射到它。

相反，建议将Gradle替换`force`为[`strictly`version]()，该[版本]()提供[更好的语义]()并受Gradle Module元数据格式支持。

请注意，如果您绝对需要发布强制，则仍然可以[修改产生的`ivy.xml`](#sec:modifying_the_generated_module_descriptor)。