 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# 配置缓存

内容

* [介绍](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro)
* [使用配置缓存](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage)
* [IDE支持](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide)
* [支持的插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins)
* [故障排除](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:troubleshooting)
* [领养步骤](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:adoption)
* [测试您的构建逻辑](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing)
* [要求](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements)
* [尚未实现](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented)

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>配置缓存是一个</font></font><a href="https://docs.gradle.org/nightly/userguide/feature_lifecycle.html#feature_lifecycle" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>孵化</font></font></a><font><font>功能，此处描述的详细信息可能会更改。</font></font></p></div></td></tr></tbody></table>

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro)[介绍](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro)

配置缓存是一项功能，可通过缓存[配置阶段](https://docs.gradle.org/nightly/userguide/build_lifecycle.html#build_lifecycle)的结果并将其重新用于后续构建，从而显着提高构建性能。使用配置缓存，Gradle可以在不影响构建配置的任何内容（例如构建脚本）发生变化的情况下完全跳过配置阶段。Gradle还对任务执行也进行了一些性能改进。

配置缓存在概念上与[构建缓存](https://docs.gradle.org/nightly/userguide/build_cache.html#build_cache)类似，但是缓存不同的信息。构建缓存负责缓存构建的输出和中间文件，例如任务输出或工件转换输出。配置缓存负责为特定任务集缓存构建配置。换句话说，配置缓存保存配置阶段的输出，而构建缓存保存执行阶段的输出。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-important"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>此功能目前处于</font></font><strong><em style="font-style:italic;"><font><font>高度试验阶段</font></font></em></strong><font><font>，默认情况下未启用。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>并非所有</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:core" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>核心Gradle插件</font></font></a><font><font>都受支持。</font><font>您的内部版本和所依赖的插件可能需要更改才能满足</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>要求</font></font></a><font><font>。</font><font>一些Gradle功能</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>尚未实现</font></font></a><font><font>。</font><font>尚未通过配置缓存改进在IDE中导入和同步Gradle构建。</font></font></p></div></td></tr></tbody></table>

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro:how_does_it_work)[它是如何工作的？](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro:how_does_it_work)

启用配置缓存后，如果您针对特定的任务集运行Gradle（例如通过运行）`gradlew check`，则Gradle会检查配置缓存条目是否可用于请求的任务集。如果可用，Gradle将使用该条目而不是运行配置阶段。缓存条目包含有关要运行的任务集的信息，以及它们的配置和相关性信息。

第一次运行特定任务集时，配置高速缓存中将没有这些任务的条目，因此Gradle将照常运行配置阶段：

1.  运行初始化脚本。
2.  应用所有请求的设置插件，运行构建的设置脚本。
3.  配置并构建`buildSrc`项目（如果存在）。
4.  应用任何请求的项目插件来运行构建的构建脚本。
5.  计算请求的任务的任务图，并运行所有延迟的配置操作。

在配置阶段之后，Gradle将任务图的状态写入配置缓存，并为以后的Gradle调用创建快照。然后执行阶段将正常运行。这意味着您第一次运行特定任务集时将看不到任何构建性能的提高。

当您随后使用相同的任务集（例如`gradlew check`再次运行）运行Gradle时，Gradle将直接从配置缓存中加载任务及其配置，并完全跳过配置阶段。在使用配置缓存条目之前，Gradle会检查该条目的“构建配置输入”（例如构建脚本）是否均未更改。如果构建配置输入已更改，则Gradle将不使用该条目，并将如上所述再次运行配置阶段，保存结果供以后重用。

构建配置输入包括：

* 初始化脚本，设置脚本，构建脚本。
* 在配置阶段使用的系统属性，Gradle属性和配置文件，可通过值提供者（例如属性，环境变量的提供者）进行访问...
* `buildSrc`构建配置输入和源文件。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro:performance_improvements)[性能提升](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:intro:performance_improvements)

除了跳过配置阶段之外，配置缓存还提供了其他一些性能改进：

* 默认情况下，所有任务并行运行。
* 依赖关系解析被缓存。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:in_action)[进行配置缓存](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:in_action)

![运行帮助](配置缓存_files/0.7093921508979073.png)

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage)[使用配置缓存](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage)

建议从最简单的任务调用入手。`help`在启用配置缓存的情况下运行是一个不错的第一步：

❯gradle-配置缓存帮助 由于没有配置缓存可用于任务而计算任务图：帮助 ... 在4秒钟内成功建立 1个可执行的任务：1个已执行 配置缓存条目已存储。

首次运行此命令，将执行配置阶段，计算任务图。

然后，再次运行相同的命令。这将重用缓存的配置：

❯gradle-配置缓存帮助 重用配置缓存。 ... 在500毫秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已重用。

祝贺您，如果编译成功，您现在可以尝试执行更多有用的任务。您应该针对您的开发循环。一个很好的例子是在进行增量更改后运行测试。

如果在缓存或重用配置时发现任何问题，则会生成HTML报告来帮助您诊断和解决问题。有关更多信息，请参见下面的“[故障排除”](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:troubleshooting)部分。

继续阅读以了解如何调整配置缓存，在出现问题时手动使状态无效，并使用IDE中的配置缓存。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:enable)[启用配置缓存](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:enable)

默认情况下，未启用配置缓存。可以从命令行启用它：

❯gradle-配置缓存

也可以在`gradle.properties`文件中永久启用它：

org.gradle.unsafe.configuration-cache=true

 

1

org.gradle.unsafe.configuration\-cache\=true

如果在`gradle.properties`文件中启用了此功能，则可以在命令行中禁用一次构建调用：

❯gradle --no-configuration-cache

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:ignore_problems)[忽略问题](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:ignore_problems)

默认情况下，如果遇到任何配置缓存问题，Gradle将使构建失败。在逐步改进插件或构建逻辑以支持配置缓存时，将问题暂时变为警告会很有用。

可以从命令行完成：

❯gradle --configuration-cache-problems =警告

或在`gradle.properties`文件中：

org.gradle.unsafe.configuration-cache-problems=warn

 

1

org.gradle.unsafe.configuration\-cache\-problems\=warn

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:max_problems)[允许最大数量的问题](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:max_problems)

当配置缓存问题变成警告时，如果`512`默认情况下发现问题，Gradle将使构建失败。

可以通过在命令行上指定允许的最大问题数来进行调整：

❯gradle -Dorg.gradle.unsafe.configuration-cache.max-problems = 5

或在`gradle.properties`文件中：

org.gradle.unsafe.configuration-cache.max-problems=5

 

1

org.gradle.unsafe.configuration\-cache.max\-problems\=5

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:invalidate)[使缓存无效](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:invalidate)

当配置阶段的输入发生更改时，配置缓存将自动失效。但是，某些输入尚未被跟踪，因此当未跟踪到配置阶段的输入发生更改时，您可能必须手动使配置缓存无效。如果您[忽略问题，](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:ignore_problems)可能会发生这种情况。有关更多信息，请参见下面的“[需求](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements)和[尚未实现”](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented)部分。

配置缓存状态存储在磁盘上`.gradle/configuration-cache`使用的Gradle构建的根目录中命名的目录中。如果您需要使缓存无效，只需删除该目录：

❯rm -rf .gradle /配置缓存

定期检查配置缓存条目（最多每24小时一次）是否仍在使用中。如果7天未使用它们，则将其删除。

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide)[IDE支持](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide)

如果您从`gradle.properties`文件启用并配置配置缓存，那么当您的IDE委托给Gradle时，将启用配置缓存。没什么可做的了。

`gradle.properties`通常在源代码管理中检查。如果您不想为整个团队启用配置缓存，那么也可以仅从IDE中启用配置缓存，如下所述。

请注意，从IDE同步内部版本不会从配置缓存中受益，只有正在运行的任务会受益。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide:intellij)[基于IntelliJ的IDE](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide:intellij)

在IntelliJ IDEA或Android Studio中，这可以通过两种方式来完成，无论是全局配置还是每次运行配置。

要在整个构建中启用它，请转到`Run > Edit configurations…`。这将打开IntelliJ IDEA或Android Studio对话框来配置运行/调试配置。选择`Templates > Gradle`并将必要的系统属性添加到该`VM options`字段。

例如，要启用配置缓存，将问题变成警告，请添加以下内容：

\-Dorg.gradle.unsafe.configuration-cache = true -Dorg.gradle.unsafe.configuration-cache-problems =警告

您也可以选择仅针对给定的运行配置启用它。在这种情况下，请保持`Templates > Gradle`配置不变，并根据需要编辑每个运行配置。

结合这两种方式，可以全局启用和禁用某些运行配置，或者相反。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>您可以使用</font></font><a href="https://github.com/JetBrains/gradle-idea-ext-plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>gradle-idea-ext-plugin</font></font></a><font><font>从构建中配置IntelliJ运行配置。</font><font>这是仅为IDE启用配置缓存的好方法。</font></font></p></div></td></tr></tbody></table>

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide:eclipse)[Eclipse IDE](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:ide:eclipse)

在Eclipse IDE中，您可以通过Buildship以两种方式启用和配置配置缓存，即全局配置或每次运行配置。

要全局启用它，请转到`Preferences > Gradle`。您可以将上述属性用作系统属性。例如，要启用配置缓存，将问题转变为警告，请添加以下JVM参数：

* `-Dorg.gradle.unsafe.configuration-cache=true`
* `-Dorg.gradle.unsafe.configuration-cache-problems=warn`

要为给定的运行配置启用它，请转到`Run configurations…`，找到要更改的配置，转到`Project Settings`，勾选`Override project settings`复选框并添加与相同的系统属性`JVM argument`。

结合这两种方式，可以全局启用和禁用某些运行配置，或者相反。

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins)[支持的插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins)

配置缓存是全新的，并引入了插件实现的新要求。结果，核心Gradle插件和社区插件都需要进行调整。本节提供有关[Gradle核心插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:core)和[社区插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:community)当前支持的信息。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:core)[Core Gradle插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:core)

并非所有的[Gradle核心插件都](https://docs.gradle.org/nightly/userguide/plugin_reference.html#plugin_reference)支持配置缓存。

<table class="tableblock frame-all grid-all stretch" style="background:white;"><colgroup><col><col><col></colgroup><tbody><tr><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>JVM语言和框架</font></font></p></th><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>母语</font></font></p></th><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>包装与配送</font></font></p></th></tr><tr style="background:rgb(248, 248, 247);"><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/java_plugin.html#java_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>爪哇</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/java_library_plugin.html#java_library_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Java库</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/java_platform_plugin.html#java_platform_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Java平台</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13460" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="yellow" style="color:rgb(191, 191, 0);"><font><font>⚠</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/groovy_plugin.html#groovy_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Groovy</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13461" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/scala_plugin.html#scala_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>斯卡拉</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13462" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="yellow" style="color:rgb(191, 191, 0);"><font><font>⚠</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/antlr_plugin.html#antlr_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>ANTLR</font></font></a></p></td></tr></tbody></table></div></div></td><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13484" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/cpp_application_plugin.html#cpp_application_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>C ++应用</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13485" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/cpp_library_plugin.html#cpp_library_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>C ++库</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13514" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/cpp_unit_test_plugin.html#cpp_unit_test_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>C ++单元测试</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13515" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/swift_application_plugin.html#swift_application_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>快速申请</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13487" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/swift_library_plugin.html#swift_library_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>斯威夫特图书馆</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13488" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/xctest_plugin.html#xctest_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>XC测试</font></font></a></p></td></tr></tbody></table></div></div></td><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/application_plugin.html#application_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>应用</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/war_plugin.html#war_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>战争</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/ear_plugin.html#ear_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>耳</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13468" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="yellow" style="color:rgb(191, 191, 0);"><font><font>⚠</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/publishing_maven.html#publishing_maven" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Maven发布</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13469" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/publishing_ivy.html#publishing_ivy" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>常春藤出版</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><span class="gray" style="color:rgb(96, 96, 96);"><font><font>🚫</font></font></span></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/maven_plugin.html#maven_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>旧版Maven插件</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/distribution_plugin.html#distribution_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>分配</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/java_library_distribution_plugin.html#java_library_distribution_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Java库发行</font></font></a></p></td></tr></tbody></table></div></div></td></tr><tr><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>&nbsp;代码分析</font></font></p></th><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>&nbsp;IDE整合</font></font></p></th><th class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);background:rgb(247, 248, 247);"><p class="tableblock"><font><font>效用</font></font></p></th></tr><tr style="background:rgb(248, 248, 247);"><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13475" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/checkstyle_plugin.html#checkstyle_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Checkstyle</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13476" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/pmd_plugin.html#pmd_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>PMD</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13477" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/jacoco_plugin.html#jacoco_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>JaCoCo</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13478" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/codenarc_plugin.html#codenarc_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>CodeNarc</font></font></a></p></td></tr></tbody></table></div></div></td><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13479" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/eclipse_plugin.html#eclipse_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>蚀</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13480" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/idea_plugin.html#idea_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>IntelliJ IDEA</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13482" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/visual_studio_plugin.html#visual_studio_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>视觉工作室</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13483" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/xcode_plugin.html#xcode_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Xcode</font></font></a></p></td></tr></tbody></table></div></div></td><td class="tableblock halign-left valign-top" style="color:rgba(0, 0, 0, 0.8);"><div class="content wiz-table-container" style="position: relative; padding: 0px;"><div class="hdlist wiz-table-body"><table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/base_plugin.html#base_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>基础</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13466" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="yellow" style="color:rgb(191, 191, 0);"><font><font>⚠</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/build_init_plugin.html#build_init_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>建立初始化</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13470" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/signing_plugin.html#signing_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>签收</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13455" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/java_gradle_plugin.html#java_gradle_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Java插件开发</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13472" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/custom_plugins.html#sec:precompiled_plugins" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Groovy DSL插件开发</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13472" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/kotlin_dsl.html#sec:kotlin-dsl_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>Kotlin DSL插件开发</font></font></a></p></td></tr><tr style="background:none;"><td class="hdlist1"><a href="https://github.com/gradle/gradle/issues/13473" style="color:rgb(29, 162, 189);text-decoration:none;"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></a></td><td class="hdlist2"><p style="color: rgb(2, 48, 58);"><a href="https://docs.gradle.org/nightly/userguide/project_report_plugin.html#project_report_plugin" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>项目报告插件</font></font></a></p></td></tr></tbody></table></div></div></td></tr></tbody></table>

<table style="background:none;"><tbody><tr style="background:none;"><td class="hdlist1" style="color:rgba(0, 0, 0, 0.8);"><span class="green" style="color:rgb(0, 96, 0);"><font><font>✓</font></font></span></td><td class="hdlist2" style="color:rgba(0, 0, 0, 0.8);"><p style="color: rgb(2, 48, 58);"><font><font>支持的插件</font></font></p></td></tr><tr style="background:none;"><td class="hdlist1" style="color:rgba(0, 0, 0, 0.8);"><span class="yellow" style="color:rgb(191, 191, 0);"><font><font>⚠</font></font></span></td><td class="hdlist2" style="color:rgba(0, 0, 0, 0.8);"><p style="color: rgb(2, 48, 58);"><font><font>部分受支持的插件</font></font></p></td></tr><tr style="background:none;"><td class="hdlist1" style="color:rgba(0, 0, 0, 0.8);"><span class="red" style="color:rgb(191, 0, 0);"><font><font>✖</font></font></span></td><td class="hdlist2" style="color:rgba(0, 0, 0, 0.8);"><p style="color: rgb(2, 48, 58);"><font><font>不支持的插件</font></font></p></td></tr><tr style="background:none;"><td class="hdlist1" style="color:rgba(0, 0, 0, 0.8);"><span class="gray" style="color:rgb(96, 96, 96);"><font><font>🚫</font></font></span></td><td class="hdlist2" style="color:rgba(0, 0, 0, 0.8);"><p style="color: rgb(2, 48, 58);"><font><font>不会解决</font></font></p></td></tr></tbody></table>

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:community)[社区插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:community)

请参阅问题[gradle / gradle＃13490](https://github.com/gradle/gradle/issues/13490)了解社区插件的状态。

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:troubleshooting)[故障排除](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:troubleshooting)

以下各节将介绍一些有关处理配置缓存问题的一般准则。这适用于您的构建逻辑和Gradle插件。

如果无法序列化运行任务所需的状态，则会生成检测到问题的HTML报告。Gradle故障输出包括指向该报告的可单击链接。此报告非常有用，可让您深入分析问题，了解导致问题的原因。

让我们看一个简单的示例构建脚本，其中包含几个问题：

`Groovy``Kotlin`

build.gradle

tasks.register\('someTask'\) \{ def destination = System.getProperty\('someDestination'\) inputs.dir\('source'\) outputs.dir\(destination\) doLast \{ project.copy \{ from 'source' into destination \} \} \}

 

1

tasks.register\('someTask'\) \{

2

 def destination \= System.getProperty\('someDestination'\) 

3

 inputs.dir\('source'\)

4

 outputs.dir\(destination\)

5

 doLast \{

6

 project.copy \{ 

7

 from 'source'

8

 into destination

9

 \}

10

 \}

11

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>在配置时读取未声明的系统属性</font></font></a></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="2" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution" style="color:rgb(29, 162, 189);text-decoration:none;"><font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">Project</code><font><font>在执行时</font><font>使用</font><font>对象</font></font></a></td></tr></tbody></table>

运行该任务失败，并在控制台中打印以下内容：

❯gradle --configuration-cache someTask -DsomeDestination = dest ... \* 什么地方出了错： 在此版本中发现配置缓存问题。
 发现存储配置缓存存在2个问题。 -构建文件“ build.gradle”：读取系统属性“ someDestination” 参见https://docs.gradle.org/0.0.0/userguide/configuration\_cache.html#config\_cache:requirements:undeclared\_sys\_prop\_read -生成文件“ build.gradle”：不支持在执行时调用“ Task.project”。 参见https://docs.gradle.org/0.0.0/userguide/configuration\_cache.html#config\_cache:requirements:use\_project\_during\_execution
 请参阅以下完整报告：file：/// home / user / gradle / samples / build / reports / configuration-cache / \<hash> /configuration-cache-report.html >读取系统属性“ someDestination” >不支持在执行时由任务'：someTask'调用'Task.project'。
 \*尝试： 使用--stacktrace选项运行以获取堆栈跟踪。使用--info或--debug选项运行，以获取更多日志输出。与--scan一起运行以获取完整的见解。
 \*在https://help.gradle.org上获得更多帮助
 0秒内失败 1个可执行的任务：1个已执行 配置缓存条目被丢弃，有2个问题。

由于发现了构建失败的问题，因此丢弃了配置缓存条目。

可以在链接的HTML报告中找到详细信息：

![问题报告](配置缓存_files/0.649863990560827.png)

该报告两次显示问题集。首先按问题消息分组，然后按任务分组。前者使您可以快速查看构建所面临的问题类别。后者使您可以快速查看哪些任务有问题。在这两种情况下，您都可以展开树以发现罪魁祸首在对象图中的位置。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>报告中显示的问题具有指向相应</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>要求的</font></font></a><font><font>链接</font><font>，您可以在其中找到有关如何解决问题的指南或</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>尚未实现</font></font></a><font><font>的相应</font><font>功能。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>在更改构建或插件以解决问题时，应考虑</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>使用TestKit测试构建逻辑</font></font></a><font><font>。</font></font></p></div></td></tr></tbody></table>

在此阶段，您可以决定[将问题变成警告，](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:ignore_problems)然后继续探索构建对配置缓存的反应，或者解决当前的问题。

让我们忽略报告的问题，然后再次运行相同的构建两次，以查看重用缓存的有问题的配置时会发生什么：

❯gradle --configuration-cache --configuration-cache-problems =警告someTask -DsomeDestination = dest 由于没有配置缓存可用于任务，因此计算任务图：someTask >任务：someTask
 发现存储配置缓存存在2个问题。 -构建文件“ build.gradle”：读取系统属性“ someDestination” 参见https://docs.gradle.org/0.0.0/userguide/configuration\_cache.html#config\_cache:requirements:undeclared\_sys\_prop\_read -生成文件“ build.gradle”：不支持在执行时调用“ Task.project”。 参见https://docs.gradle.org/0.0.0/userguide/configuration\_cache.html#config\_cache:requirements:use\_project\_during\_execution
 请参阅以下完整报告：file：/// home / user / gradle / samples / build / reports / configuration-cache / \<hash> /configuration-cache-report.html
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目存储有2个问题。 ❯gradle --configuration-cache --configuration-cache-problems =警告someTask -DsomeDestination = dest 重用配置缓存。 >任务：someTask
 发现1个问题在重用配置缓存。 -生成文件“ build.gradle”：不支持在执行时调用“ Task.project”。 参见https://docs.gradle.org/0.0.0/userguide/configuration\_cache.html#config\_cache:requirements:use\_project\_during\_execution
 请参阅以下完整报告：file：/// home / user / gradle / samples / build / reports / configuration-cache / \<hash> /configuration-cache-report.html
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已重用，出现了1个问题。

这两个版本成功报告了观察到的问题，进行了存储，然后重新使用了配置缓存。第一个问题在存储时在配置时发生，在第二次运行时未报告，重新使用了配置缓存。配置阶段被跳过。`Project`在存储和重用时都报告了在执行时使用的第二个问题。两个版本都执行了任务。

借助控制台问题摘要和HTML报告中提供的链接，我们可以解决问题。这是构建脚本的一些固定版本：

`Groovy``Kotlin`

build.gradle

abstract class MyCopyTask extends DefaultTask \{ \@InputDirectory abstract DirectoryProperty getSource\(\) \@OutputDirectory abstract DirectoryProperty getDestination\(\) \@Inject abstract FileSystemOperations getFs\(\) \@TaskAction void action\(\) \{ fs.copy \{ from source into destination \} \} \} tasks.register\('someTask', MyCopyTask\) \{ def projectDir = layout.projectDirectory source = projectDir.dir\('source'\) destination = projectDir.dir\( providers.systemProperty\('someDestination'\).forUseAtConfigurationTime\(\).get\(\) \) \}

 

1

abstract class MyCopyTask extends DefaultTask \{ 

2

3

 \@InputDirectory abstract DirectoryProperty getSource\(\) 

4

5

 \@OutputDirectory abstract DirectoryProperty getDestination\(\) 

6

7

 \@Inject abstract FileSystemOperations getFs\(\) 

8

9

 \@TaskAction

10

 void action\(\) \{

11

 fs.copy \{ 

12

 from source

13

 into destination

14

 \}

15

 \}

16

\}

17

18

tasks.register\('someTask', MyCopyTask\) \{

19

 def projectDir \= layout.projectDirectory

20

 source \= projectDir.dir\('source'\)

21

 destination \= projectDir.dir\(

22

 providers.systemProperty\('someDestination'\).forUseAtConfigurationTime\(\).get\(\) 

23

 \)

24

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>我们将临时任务变成了适当的任务类，</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="2" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>带有输入和输出声明，</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="3" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>并在</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FileSystemOperations</code><font><font>服务中</font><font>注入了的</font><font>受支持替代</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution" style="color:rgb(29, 162, 189);text-decoration:none;"><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project.copy {}</code></a><font><font>。</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="4" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>最后，我们将</font></font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>在配置时使用</font></font></a><font><font>的</font><a href="https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read" style="color:rgb(29, 162, 189);text-decoration:none;"><font>系统属性</font></a><font>声明</font><font>为构建配置输入，并将其连接到我们的任务输入。</font></font></td></tr></tbody></table>

现在，两次运行任务成功了，没有报告任何问题，并且在第二次运行时重新使用了配置缓存：

❯gradle --configuration-cache someTask -DsomeDestination = dest 由于没有配置缓存可用于任务，因此计算任务图：someTask >任务：someTask
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已存储。 ❯gradle --configuration-cache someTask -DsomeDestination = dest 重用配置缓存。 >任务：someTask
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已重用。

但是，如果我们更改系统属性的值怎么办？

❯gradle --configuration-cache someTask -DsomeDestination = another 由于系统属性“ someDestination”已更改，因此无法重用将任务图计算为配置缓存。 >任务：someTask
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已存储。

先前的配置缓存条目无法重复使用，必须重新计算并存储任务图。这是因为我们在配置时读取了系统属性，因此要求Gradle在该属性的值更改时再次运行配置阶段。修复就像直接连接系统属性一样简单，而无需在配置时读取它。

`Groovy``Kotlin`

build.gradle

tasks.register\('someTask', MyCopyTask\) \{ def projectDir = layout.projectDirectory source = projectDir.dir\('source'\) destination = projectDir.dir\(providers.systemProperty\('someDestination'\)\) \}

 

1

tasks.register\('someTask', MyCopyTask\) \{

2

 def projectDir \= layout.projectDirectory

3

 source \= projectDir.dir\('source'\)

4

 destination \= projectDir.dir\(providers.systemProperty\('someDestination'\)\) 

5

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>我们直接连接已声明的系统属性，而无需在配置时读取它。</font></font></td></tr></tbody></table>

有了这个简单的更改，我们可以在任意时间运行任务，更改系统属性值并重新使用配置缓存：

❯gradle --configuration-cache someTask -DsomeDestination = dest 由于没有配置缓存可用于任务，因此计算任务图：someTask >任务：someTask
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已存储。 ❯gradle --configuration-cache someTask -DsomeDestination = another 重用配置缓存。 >任务：someTask
 在0秒内成功建立 1个可执行的任务：1个已执行 配置缓存条目已重用。

现在，我们已通过此简单任务解决了问题。

继续阅读以了解如何为您的构建或插件采用配置缓存。

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:adoption)[领养步骤](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:adoption)

一个重要的先决条件是保持Gradle和插件版本为最新。以下内容探讨了成功采用的推荐步骤。它适用于构建和插件。在执行这些步骤时，请记住下面的[需求](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements)一章中解释的HTML报告和解决方案。

从...开始`:help`

始终从尝试使用最简单的任务进行构建或插件开始`:help`。这将执行构建或插件的最小配置阶段。

逐步确定有用的任务

不要`build`马上跑步。您还可以用来`--dry-run`首先发现更多的配置时间问题。

在进行构建时，请逐步针对您的开发反馈循环。例如，在对源代码进行一些更改之后运行测试。

使用插件时，请逐步确定已贡献或已配置的任务。

通过将问题变成警告来进行探索

不要在第一次构建失败时停止，而是[将问题变成警告，](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:ignore_problems)以发现您的构建和插件的行为。如果构建失败，请使用HTML报告来推断与失败有关的报告问题。继续运行更多有用的任务。

这将使您对构建和插件面临的问题的性质有一个很好的了解。请记住，将问题转变为警告时，如果出现问题，可能需要[手动使缓存无效](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:invalidate)。

后退一步一步地解决问题

当您对所要解决的问题了解得足够多时，请退后一步，开始迭代地解决最重要的问题。使用HTML报告和此文档可在此过程中为您提供帮助。

从_存储_配置缓存时报告的问题开始。修复后，您可以依靠有效的缓存配置阶段，并继续解决在_加载_配置缓存时报告的问题（如果有）。

报告遇到的问题

如果您遇到[Gradle功能](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented)或本文档未涵盖的[Gradle核心插件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:plugins:core)的问题，请在上报告问题[`gradle/gradle`](https://github.com/gradle/gradle/issues/new/choose)。

如果您遇到社区Gradle插件的问题，请查看[gradle / gradle＃13490](https://github.com/gradle/gradle/issues/13490)是否已列出该插件，并考虑将问题报告给插件的问题跟踪器。

报告此类问题的一种好方法是提供以下信息：

* 此文档的链接，
* 您尝试的插件版本，
* 插件的自定义配置（如果有的话），或者最好是复制者的版本，
* 对失败的描述，例如给定任务的问题
* 复制失败的副本，
* 自包含`configuration-cache-report.html`文件。

测试，测试，测试

考虑为构建逻辑添加测试。请参阅以下有关[测试](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing)配置缓存的[构建逻辑的](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing)部分。这将在迭代所需的更改时为您提供帮助，并防止将来发生退化。

向您的团队推广

一旦开发人员工作流程正常运行（例如，从IDE运行测试），就可以考虑为团队启用它。更改代码和运行测试时更快的周转时间是值得的。您可能首先要选择加入。

如果需要，将问题转换为警告，并在构建`gradle.properties`文件中设置允许的最大问题数。默认情况下，禁用配置缓存。让您的团队知道他们可以选择加入，例如，为支持的工作流程在其IDE运行配置上启用配置缓存。

稍后，当更多工作流在工作时，您可以进行翻转。默认情况下启用配置缓存，将CI配置为禁用它，并在需要时传达需要禁用其配置缓存的不受支持的工作流。

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing)[测试您的构建逻辑](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:testing)

Gradle TestKit（又名TestKit）是一个有助于测试Gradle插件和一般构建逻辑的库。有关如何使用TestKit的一般指导，请参见[专用章节](https://docs.gradle.org/nightly/userguide/test_kit.html#test_kit)。

要在测试中启用配置缓存，可以将`--configuration-cache`参数传递给[GradleRunner](https://docs.gradle.org/nightly/javadoc/org/gradle/testkit/runner/GradleRunner.html)或使用[启用配置缓存中](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:usage:enable)描述的其他方法之一。

您需要运行两次任务。一次启动配置缓存。一次重用配置缓存。

例子1.测试配置缓存

`Groovy``Kotlin`

src / test / groovy / org / example / BuildLogicFunctionalTest.groovy

def "my task can be loaded from the configuration cache"\(\) \{ given: buildFile \<\< """ plugins \{ id 'org.example.my-plugin' \} """ when: runner\(\) .withArguments\('--configuration-cache', 'myTask'\) .build\(\) and: def result = runner\(\) .withArguments\('--configuration-cache', 'myTask'\) .build\(\) then: result.output.contains\('Reusing configuration cache.'\) // ... more assertions on your task behavior \}

 

1

 def "my task can be loaded from the configuration cache"\(\) \{

2

 given:

3

 buildFile \<\< """

4

 plugins \{

5

 id 'org.example.my-plugin'

6

 \}

7

 """

8

9

 when:

10

 runner\(\)

11

 .withArguments\('--configuration-cache', 'myTask'\) 

12

 .build\(\)

13

14

 and:

15

 def result \= runner\(\)

16

 .withArguments\('--configuration-cache', 'myTask'\) 

17

 .build\(\)

18

19

 then:

20

 result.output.contains\('Reusing configuration cache.'\) 

21

 // ... more assertions on your task behavior

22

 \}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>首次运行会启动配置缓存。</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="2" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>第二次运行将重用配置缓存。</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="3" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>断言配置缓存已被重用。</font></font></td></tr></tbody></table>

如果发现配置缓存有问题，那么Gradle将使生成失败并报告问题，并且测试将失败。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-tip"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>Gradle插件的一种很好的测试策略是在启用配置缓存的情况下运行其整个测试套件。</font><font>这需要使用受支持的Gradle版本测试插件。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>如果插件已经支持一系列Gradle版本，则可能已经针对多个Gradle版本进行了测试。</font><font>在这种情况下，我们建议启用从支持它的Gradle版本开始的配置缓存。</font></font></p></div><div class="paragraph"><p style="font-size: 1rem;"><font><font>如果不能立即做到这一点，那么使用多次运行由插件贡献的所有任务的测试（例如断言</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">UP_TO_DATE</code><font><font>and</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FROM_CACHE</code><font><font>行为）也是一种不错的策略。</font></font></p></div></td></tr></tbody></table>

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements)[要求](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements)

为了将任务图的状态捕获到配置缓存中并在以后的构建中再次重新加载，Gradle将某些要求应用于任务和其他构建逻辑。这些要求中的每一个都被视为配置缓存“问题”，如果存在违规，则构建失败。

在大多数情况下，这些要求实际上掩盖了一些未声明的输入。换句话说，对于所有构建，使用配置高速缓存都可以选择更严格，更正确和更可靠。

以下各节描述了每个要求以及如何更改构建以解决问题。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:disallowed_types)[某些类型不能被任务引用](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:disallowed_types)

任务实例不能从其字段中引用许多类型。对于任务操作，例如`doFirst {}`或，也是如此`doLast {}`。

这些类型分为以下几类：

* 实时JVM状态类型
* 摇篮模型类型
* 依赖管理类型

在所有情况下，均不允许使用这些类型的原因是它们的状态无法通过配置缓存轻松存储或重新创建。

直播JVM状态类型（例如`ClassLoader`，`Thread`，`OutputStream`，`Socket`等...），只是不允许。这些类型几乎从不代表任务输入或输出。

摇篮模型类型（例如`Gradle`，`Settings`，`Project`，`SourceSet`，`Configuration`等...）通常用来进行一些任务的输入，应该是明确和精确声明来代替。

例如，如果引用a`Project`以便`project.version`在执行时获取，则应改为使用来直接将_项目版本_声明为任务的输入`Property<String>`。另一个示例是引用a`SourceSet`以便以后获取源文件，编译类路径或源集的输出。相反，您应该将它们声明为`FileCollection`输入，并仅引用它。

相同要求适用于具有某些细微差别的依赖项管理类型。

某些类型（例如）`Configuration`不能很好地完成任务输入参数，因为它们具有许多不相关的状态，最好将这些输入建模为更精确的参数。我们根本不打算使这些类型可序列化。例如，如果您引用a`Configuration`以后再获取已解析的文件，则应改为将a声明`FileCollection`为任务的输入。

引用依赖性解析结果也不允许（例如`ArtifactResolutionQuery`，`ResolvedArtifact`，`ArtifactResult`等...）。例如，如果引用某些`ResolvedArtifactResult`实例，则应声明一些实例`ArtifactCollection`作为任务的输入。经验法则是任务必须不引用已_解析的_结果，而应引用惰性规范，以便在执行时进行依赖关系解析。某些API已丢失，尚不能用作任务输入，例如，当前任务动作无法[推断](https://github.com/gradle/gradle/issues/12871)依赖关系_图_，请参阅[gradle / gradle＃12871](https://github.com/gradle/gradle/issues/12871)。

某些类型，例如`Publication`或`Dependency`不可序列化，但是可以。如果有必要，我们可以允许将它们直接用作任务输入。

这是一个有问题的任务类型引用的示例`SourceSet`：

`Groovy``Kotlin`

build.gradle

abstract class SomeTask extends DefaultTask \{ \@Input SourceSet sourceSet \@TaskAction void action\(\) \{ def classpathFiles = sourceSet.compileClasspath.files // ... \} \}

 

1

abstract class SomeTask extends DefaultTask \{

2

3

 \@Input SourceSet sourceSet 

4

5

 \@TaskAction

6

 void action\(\) \{

7

 def classpathFiles \= sourceSet.compileClasspath.files

8

 // ...

9

 \}

10

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>这将被报告为问题，因为</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">SourceSet</code><font><font>不允许</font><font>引用</font></font></td></tr></tbody></table>

下面是应如何做：

`Groovy``Kotlin`

build.gradle

abstract class SomeTask extends DefaultTask \{ \@InputFiles \@Classpath abstract ConfigurableFileCollection getClasspath\(\) \@TaskAction void action\(\) \{ def classpathFiles = classpath.files // ... \} \}

 

1

abstract class SomeTask extends DefaultTask \{

2

3

 \@InputFiles \@Classpath

4

 abstract ConfigurableFileCollection getClasspath\(\) 

5

6

 \@TaskAction

7

 void action\(\) \{

8

 def classpathFiles \= classpath.files

9

 // ...

10

 \}

11

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>不再报告任何问题，我们现在参考支持的类型<span>&nbsp;</span></font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FileCollection</code></td></tr></tbody></table>

同样，如果在脚本中声明的临时任务遇到相同的问题，如下所示：

`Groovy``Kotlin`

build.gradle

tasks.register\('someTask'\) \{ doLast \{ def classpathFiles = sourceSets.main.compileClasspath.files \} \}

 

1

tasks.register\('someTask'\) \{

2

 doLast \{

3

 def classpathFiles \= sourceSets.main.compileClasspath.files 

4

 \}

5

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>这将被报告为问题，因为</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">doLast {}</code><font><font>闭包正在捕获对</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">SourceSet</code></td></tr></tbody></table>

您仍然需要满足相同的要求，即不引用不允许的类型。上面的任务声明的固定方法如下：

`Groovy``Kotlin`

build.gradle

tasks.register\('someTask'\) \{ def classpath = sourceSets.main.compileClasspath doLast \{ def classpathFiles = classpath.files \} \}

 

1

tasks.register\('someTask'\) \{

2

 def classpath \= sourceSets.main.compileClasspath 

3

 doLast \{

4

 def classpathFiles \= classpath.files

5

 \}

6

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>不再报告任何问题，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">doLast {}</code><font><font>闭包现在仅捕获</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">classpath</code><font><font>受支持</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FileCollection</code><font><font>类型</font><font>的</font><font>闭包</font></font></td></tr></tbody></table>

请注意，有时会间接引用不允许的类型。例如，您可以让任务从允许的插件中引用某种类型的任务。该类型可以引用另一个允许的类型，而后者又引用一个不允许的类型。HTML报告中提供的对象图层次结构视图中的问题应可帮助您查明违规者。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution)[使用`Project`对象](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution)

任务`Project`在执行时不得使用任何对象。这包括`Task.getProject()`在任务运行时调用。

某些情况下可以采用与[不允许类型](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:disallowed_types)相同的方式进行修复。

通常情况下，类似的事情上都可用`Project`和`Task`。例如，如果您需要`Logger`在任务中执行操作，则应使用`Task.logger`而不是`Project.logger`。

否则，您可以使用[注入服务](https://docs.gradle.org/nightly/userguide/custom_gradle_types.html#service_injection)代替的方法`Project`。

这是`Project`在执行时使用对象的有问题的任务类型的示例：

`Groovy``Kotlin`

build.gradle

abstract class SomeTask extends DefaultTask \{ \@TaskAction void action\(\) \{ project.copy \{ from 'source' into 'destination' \} \} \}

 

1

abstract class SomeTask extends DefaultTask \{

2

 \@TaskAction

3

 void action\(\) \{

4

 project.copy \{ 

5

 from 'source'

6

 into 'destination'

7

 \}

8

 \}

9

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>这将被报告为问题，因为任务操作正在</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">Project</code><font><font>执行时</font><font>使用</font><font>对象</font></font></td></tr></tbody></table>

下面是应如何做：

`Groovy``Kotlin`

build.gradle

abstract class SomeTask extends DefaultTask \{ \@Inject abstract FileSystemOperations getFs\(\) \@TaskAction void action\(\) \{ fs.copy \{ from 'source' into 'destination' \} \} \}

 

1

abstract class SomeTask extends DefaultTask \{

2

3

 \@Inject abstract FileSystemOperations getFs\(\) 

4

5

 \@TaskAction

6

 void action\(\) \{

7

 fs.copy \{

8

 from 'source'

9

 into 'destination'

10

 \}

11

 \}

12

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>不再报告任何问题，</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FileSystemOperations</code><font><font>支持</font><font>注入</font><font>服务替代</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project.copy {}</code></td></tr></tbody></table>

同样，如果在脚本中声明的临时任务遇到相同的问题，如下所示：

`Groovy``Kotlin`

build.gradle

tasks.register\('someTask'\) \{ doLast \{ project.copy \{ from 'source' into 'destination' \} \} \}

 

1

tasks.register\('someTask'\) \{

2

 doLast \{

3

 project.copy \{ 

4

 from 'source'

5

 into 'destination'

6

 \}

7

 \}

8

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>这将被报告为问题，因为任务操作正在</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">Project</code><font><font>执行时</font><font>使用</font><font>对象</font></font></td></tr></tbody></table>

上面的任务声明的固定方法如下：

`Groovy``Kotlin`

build.gradle

interface Injected \{ \@Inject FileSystemOperations getFs\(\) \} tasks.register\('someTask'\) \{ def injected = project.objects.newInstance\(Injected\) doLast \{ injected.fs.copy \{ from 'source' into 'destination' \} \} \}

 

1

interface Injected \{

2

 \@Inject FileSystemOperations getFs\(\) 

3

\}

4

tasks.register\('someTask'\) \{

5

 def injected \= project.objects.newInstance\(Injected\) 

6

 doLast \{

7

 injected.fs.copy \{ 

8

 from 'source'

9

 into 'destination'

10

 \}

11

 \}

12

\}

<table style="background:none;"><tbody><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="1" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>服务不能直接在脚本中注入，我们需要一个额外的类型来传达注入点</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="2" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project.object</code><font><font>在任务动作之外</font><font>创建额外类型的实例</font></font></td></tr><tr style="background:none;"><td style="color:rgba(0, 0, 0, 0.8);"><i class="conum" data-value="3" style="background-color: rgba(0, 0, 0, 0.8); font-size: 0.75rem; font-family: Lato, Arial, sans-serif; color: rgb(255, 255, 255) !important;"></i></td><td style="color:rgba(0, 0, 0, 0.8);"><font><font>不再报告任何问题</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">injected</code><font><font>，提供该</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">FileSystemOperations</code><font><font>服务</font><font>的任务操作参考</font><font>作为替代的支持</font></font><code style="font-family:Inconsolata, monospace;font-size:0.9375rem;color:rgba(0, 0, 0, 0.9);background-color:rgb(247, 247, 248);">project.copy {}</code></td></tr></tbody></table>

正如您在上面看到的，修复脚本中声明的临时任务需要相当多的仪式。现在是考虑将任务声明提取为适当的任务类的好时机，如上所示。

下表显示了应使用哪些API或注入的服务替代每种`Project`方法。

| 代替： | 使用： |
| --- | --- |
| 
`project.rootDir`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.rootDir`用于计算实际参数的结果。





 |
| 

`project.projectDir`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.projectDir`用于计算实际参数的结果。





 |
| 

`project.buildDir`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.buildDir`用于计算实际参数的结果。





 |
| 

`project.name`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.name`用于计算实际参数的结果。





 |
| 

`project.description`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.description`用于计算实际参数的结果。





 |
| 

`project.group`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.group`用于计算实际参数的结果。





 |
| 

`project.version`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.version`用于计算实际参数的结果。





 |
| 

`project.properties`，`project.property(name)`，`project.hasProperty(name)`，`project.getProperty(name)`或者`project.findProperty(name)`





 | 

[Gradle属性的价值提供者](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_gradle_prop_read)





 |
| 

`project.logger`





 | 

[Task.logger](https://docs.gradle.org/nightly/javadoc/org/gradle/api/Task.html#getLogger--)





 |
| 

`project.provider {}`





 | 

[ProviderFactory.provider \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-java.util.concurrent.Callable-)





 |
| 

`project.file(path)`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.file(file)`用于计算实际参数的结果。





 |
| 

`project.uri(path)`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.uri(path)`用于计算实际参数的结果。否则，`File.toURI()`或可以使用其他一些JVM API。





 |
| 

`project.relativePath(path)`





 | 

[ProjectLayout.projectDirectory](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--)。[文件路径）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/Directory.html#file-java.lang.String-)





 |
| 

`project.files(paths)`





 | 

[ObjectFactory.fileCollection（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--)。[来自（路径）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/ConfigurableFileCollection.html#from-java.lang.Object%E2%80%A6%E2%80%8B-)





 |
| 

`project.fileTree(paths)`





 | 

[ObjectFactory.fileTree（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--)。[从（目录）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/ConfigurableFileTree.html#from-java.lang.Object-)





 |
| 

`project.zipTree(path)`





 | 

[ArchiveOperations.zipTree（路径）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/ArchiveOperations.html#zipTree-java.lang.Object-)





 |
| 

`project.tarTree(path)`





 | 

[ArchiveOperations.tarTree（路径）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/ArchiveOperations.html#tarTree-java.lang.Object-)





 |
| 

`project.resources`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.resource`用于计算实际参数的结果。





 |
| 

`project.copySpec {}`





 | 

任务输入或输出属性或脚本变量，用于捕获`project.copySpec {}`用于计算实际参数的结果。





 |
| 

`project.copy {}`





 | 

[FileSystemOperations.copy \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/FileSystemOperations.html#copy-org.gradle.api.Action-)





 |
| 

`project.sync {}`





 | 

[FileSystemOperations.sync \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/FileSystemOperations.html#sync-org.gradle.api.Action-)





 |
| 

`project.delete {}`





 | 

[FileSystemOperations.delete \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/api/file/FileSystemOperations.html#delete-org.gradle.api.Action-)





 |
| 

`project.mkdir(path)`





 | 

Kotlin，Groovy或Java API可用于您的构建逻辑。





 |
| 

`project.exec {}`





 | 

[ExecOperations.exec \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/process/ExecOperations.html#exec-org.gradle.api.Action-)





 |
| 

`project.javaexec {}`





 | 

[ExecOperations.javaexec \{\}](https://docs.gradle.org/nightly/javadoc/org/gradle/process/ExecOperations.html#javaexec-org.gradle.api.Action-)





 |
| 

`project.ant {}`





 | 

[任务代理](https://docs.gradle.org/nightly/javadoc/org/gradle/api/Task.html#getAnt--)





 |
| 

`project.createAntBuilder()`





 | 

[任务代理](https://docs.gradle.org/nightly/javadoc/org/gradle/api/Task.html#getAnt--)





 |

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:task_access)[从另一个实例访问任务实例](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:task_access)

任务不应直接访问另一个任务实例的状态。相反，应该使用[输入和输出关系](https://docs.gradle.org/nightly/userguide/lazy_configuration.html#working_with_task_dependencies_in_lazy_properties)来连接任务。

请注意，此要求使其不支持编写在执行时配置其他任务的任务。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:build_listeners)[使用构建监听器](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:build_listeners)

插件和构建脚本不得注册任何构建侦听器。也就是说，在配置时注册的侦听器会在执行时得到通知。例如a`BuildListener`或a`TaskExecutionListener`。

这些应该由[构建服务](https://docs.gradle.org/nightly/userguide/build_services.html#build_services)代替，如果需要，注册[服务可以](https://docs.gradle.org/nightly/userguide/build_services.html#build_services)注册以接收有关[任务执行的](https://docs.gradle.org/nightly/userguide/build_services.html#operation_listener)信息。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_gradle_prop_read)[未声明阅读Gradle属性](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_gradle_prop_read)

插件和构建脚本不应在配置时直接读取Gradle属性。而是必须使用值提供者API将这些Gradle属性声明为潜在的构建配置输入。

此问题是由类似于以下内容的生成逻辑引起的：

`Groovy``Kotlin`

build.gradle

def enabled = project.findProperty\('some-property'\) \!= null

 

1

def enabled \= project.findProperty\('some-property'\) \!= null

要解决此问题，请改为使用[provider.gradleProperty（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-java.lang.String-)阅读Gradle属性：

`Groovy``Kotlin`

build.gradle

def enabled = providers.gradleProperty\('some-property'\).forUseAtConfigurationTime\(\).present

 

1

def enabled \= providers.gradleProperty\('some-property'\).forUseAtConfigurationTime\(\).present

通常，应避免在配置时读取Gradle属性的值，以避免在Gradle属性值更改时使配置缓存条目无效。相反，您可以将[provider.gradleProperty（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-java.lang.String-)`Provider`返回的值连接到任务属性。[](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-java.lang.String-)

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read)[未经声明的读取系统属性](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read)

在配置时，插件和构建脚本不应直接使用Java API读取系统属性。相反，必须使用值提供者API将这些系统属性声明为潜在的构建配置输入。

此问题是由类似于以下内容的生成逻辑引起的：

`Groovy``Kotlin`

build.gradle

def enabled = System.getProperty\('some-property'\) \!= null

 

1

def enabled \= System.getProperty\('some-property'\) \!= null

要解决此问题，请改为使用[provider.systemProperty（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-java.lang.String-)读取系统属性：

`Groovy``Kotlin`

build.gradle

def enabled = providers.systemProperty\('some-property'\).forUseAtConfigurationTime\(\).present

 

1

def enabled \= providers.systemProperty\('some-property'\).forUseAtConfigurationTime\(\).present

通常，应避免在配置时读取系统属性的值，以避免在系统属性值更改时使配置缓存条目无效。相反，您可以将[provider.systemProperty（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-java.lang.String-)`Provider`返回的值连接到任务属性。[](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-java.lang.String-)

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_env_var_read)[未经声明的读取环境变量](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_env_var_read)

在配置时，插件和构建脚本不应直接使用Java API读取环境变量。而是使用值提供者API将环境变量声明为潜在的构建配置输入。

此问题是由类似于以下内容的生成逻辑引起的：

`Groovy``Kotlin`

build.gradle

def enabled = System.getenv\('SOME\_ENV\_VAR'\) \!= null

 

1

def enabled \= System.getenv\('SOME\_ENV\_VAR'\) \!= null

要解决此问题，请改用[providers.environmentVariable（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-java.lang.String-)读取环境变量：

`Groovy``Kotlin`

build.gradle

def enabled = providers.environmentVariable\('SOME\_ENV\_VAR'\).forUseAtConfigurationTime\(\).present

 

1

def enabled \= providers.environmentVariable\('SOME\_ENV\_VAR'\).forUseAtConfigurationTime\(\).present

通常，应避免在配置时读取环境变量的值，以避免在环境变量值更改时使配置缓存条目无效。相反，您可以将[provider.environmentVariable（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-java.lang.String-)`Provider`返回的值连接到任务属性。[](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-java.lang.String-)

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_file_read)[未声明读取文件](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:requirements:undeclared_file_read)

在配置时，插件和构建脚本不应使用Java，Groovy或Kotlin API直接读取文件。而是使用价值提供者API将文件声明为潜在的构建配置输入。

此问题是由类似于以下内容的生成逻辑引起的：

`Groovy``Kotlin`

build.gradle

def config = file\('some.conf'\).text

 

1

def config \= file\('some.conf'\).text

要解决此问题，请改为使用[provider.fileContents（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-org.gradle.api.file.RegularFile-)读取文件：

`Groovy``Kotlin`

build.gradle

def config = providers.fileContents\(layout.projectDirectory.file\('some.conf'\)\) .asText.forUseAtConfigurationTime\(\)

 

1

def config \= providers.fileContents\(layout.projectDirectory.file\('some.conf'\)\)

2

 .asText.forUseAtConfigurationTime\(\)

通常，应避免在配置时读取文件，以避免在文件内容更改时使配置缓存条目无效。相反，您可以将[provider.fileContents（）](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-org.gradle.api.file.RegularFile-)`Provider`返回的值连接到任务属性。[](https://docs.gradle.org/nightly/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-org.gradle.api.file.RegularFile-)

## [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented)[尚未实现](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented)

使用某些Gradle功能使用配置缓存的支持尚未实现。这些功能的支持将在以后的Gradle版本中添加。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:sharing)[共享配置缓存](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:sharing)

配置缓存当前仅存储在本地。热的或冷的本地Gradle守护程序都可以重用它。但是它不能在开发人员或CI计算机之间共享。

参见[gradle / gradle＃13510](https://github.com/gradle/gradle/issues/13510)。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_implemented:store_parallel_execution)[缓存未命中的并行任务执行](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_implemented:store_parallel_execution)

如果没有可用的配置缓存，并且需要计算工作图，则默认情况下不会并行执行任务。默认情况下，仅重用配置高速缓存的内部版本当前并行执行所有任务。

参见[gradle / gradle＃14624](https://github.com/gradle/gradle/issues/14624)。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:normalization)[自定义输入标准化](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:normalization)

使用配置缓存时，不会捕获自定义[输入归一化](https://docs.gradle.org/nightly/userguide/more_about_tasks.html#sec:configure_input_normalization)。如果您的构建具有用于输入规范化的配置，即`normalization { }`，它将被忽略，则不会报告任何问题。重复使用配置缓存的构建可能会看到构建缓存未命中，但将保持可靠。

参见[gradle / gradle＃13706](https://github.com/gradle/gradle/issues/13706)。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:source_dependencies)[源依赖](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:source_dependencies)

尚未实现对[源依赖性的](https://blog.gradle.org/introducing-source-dependencies)支持。启用配置缓存后，将不会报告任何问题，并且构建将失败。

参见[gradle / gradle＃13506](https://github.com/gradle/gradle/issues/13506)。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:testkit_build_with_java_agent)[将Java代理与使用TestKit运行的构建一起使用](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:testkit_build_with_java_agent)

使用[TestKit](https://docs.gradle.org/nightly/userguide/test_kit.html#test_kit)运行内部版本时，配置缓存可能会干扰应用于这些内部版本的Java代理（例如Jacoco代理）。

### [](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:java_serialization)[Java对象序列化](https://docs.gradle.org/nightly/userguide/configuration_cache.html#config_cache:not_yet_implemented:java_serialization)

Gradle允许将支持[Java对象序列化](https://docs.oracle.com/javase/8/docs/platform/serialization/spec/serialTOC.html)协议的[对象](https://docs.oracle.com/javase/8/docs/platform/serialization/spec/serialTOC.html)存储在配置缓存中。

当前，该实现仅限于可序列化的类，这些类可实现`java.io.Serializable`接口并定义以下方法组合之一：

* `writeObject`与`readObject`精确控制要存储的信息的方法相结合的方法；
* 一个`writeObject`没有对应的方法`readObject`;`writeObject`最终必须致电`ObjectOutputStream.defaultWriteObject`;
* 一个`readObject`没有对应的方法`writeObject`;`readObject`最终必须致电`ObjectInputStream.defaultReadObject`;
* 一种`writeReplace`允许类指定要编写的替换的方法；
* 一种`readResolve`允许类指定刚读取的对象的替换的方法；

**不**支持以下_Java对象序列化_功能：

* 实现`java.io.Externalizable`接口的可序列化类；此类的对象在序列化期间被配置高速缓存丢弃，并报告为问题；
* 该`serialPersistentFields`构件以显式声明哪些字段是可序列化;该成员（如果存在）将被忽略；配置缓存会考虑除`transient`字段之外的所有可序列化内容；
* `ObjectOutputStream`不支持以下方法，并且将抛出`UnsupportedOperationException`：  

  * `reset()`，`writeFields()`，`putFields()`，`writeChars(String)`，`writeBytes(String)`和`writeUnshared(Any?)`。
* `ObjectInputStream`不支持以下方法，并且将抛出`UnsupportedOperationException`：  

  * `readLine()`，`readFully(ByteArray)`，`readFully(ByteArray, Int, Int)`，`readUnshared()`，`readFields()`，`transferTo(OutputStream)`和`readAllBytes()`。
* 通过注册的验证将`ObjectInputStream.registerValidation`被忽略；
* 该`readObjectNoData`方法（如果存在）永远不会被调用；

参见[gradle / gradle＃13588](https://github.com/gradle/gradle/issues/13588)。  

来源： <https://docs.gradle.org/nightly/userguide/configuration_cache.html>