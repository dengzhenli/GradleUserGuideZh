 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style>

# 执行多项目构建

内容

* [确定项目结构](#sec:identifying_project_structure)
* [按名称执行任务](#sec:executing_tasks_by_name)
* [通过完全限定的名称执行任务](#sec:executing_tasks_by_fully_qualified_name)
* [多项目构建和测试](#sec:multiproject_build_and_test)

除非碰巧是一个庞大的整体应用程序，否则只有最小的项目具有单个构建文件和源树。消化和理解一个项目的过程通常要容易得多，该项目被分为多个较小的，相互依赖的模块。但是，“相互依赖”一词很重要，这就是为什么您通常希望通过单个构建将模块链接在一起的原因。

Gradle通过_多项目_构建来支持此方案。

有关创作_多项目_构建的详细信息，请参阅[用户手册]()的“[创作多项目构建”部分]()。

## [](#sec:identifying_project_structure)[确定项目结构](#sec:identifying_project_structure)

要确定项目结构，可以使用`gradle projects`命令。例如，让我们使用具有以下结构的多项目构建：

\> gradle -q项目
 -------------------------------------------------- ---------- 根项目 -------------------------------------------------- ----------
 根项目“ multiproject” + ---项目'：api' + ---项目'：services' | \+ ---专案'：services：shared' | \\ ---专案'：services：webservice' \\ ---专案'：shared'
 要查看项目任务列表，请运行gradle \<project-path>：tasks 例如，尝试运行gradle：api：tasks

从用户的角度来看，多项目构建仍然是您可以运行的任务的集合。不同之处在于您可能想控制要执行_哪个_项目的任务。以下各节将介绍在多项目构建中执行任务所需的两个选项。

## [](#sec:executing_tasks_by_name)[按名称执行任务](#sec:executing_tasks_by_name)

该命令`gradle test`将`test`在相对于当前工作目录具有该任务的任何子项目中执行该任务。如果从根项目目录运行命令，则将`test`在_api_，_shared_，_services：shared_和_services：webservice中运行_。如果从_services_项目目录运行命令，则仅在_services：shared_和_services：webservice中_执行任务。

Gradle行为的基本规则是：在具有该名称的层次结构中执行所有任务。仅在遍历的任何子项目中都_找不到_这样的任务时才抱怨。

Gradle从_当前目录_开始向下查找具有给定名称的任务的层次结构并执行它们。需要注意的一件事很重要。Gradle_始终_评估多项目构建中的_每个_项目并创建所有现有任务对象。然后，根据任务名称参数和当前目录，Gradle筛选应执行的任务。由于Gradle的[跨项目配置]()，必须在执行_任何_任务之前对_每个_项目进行评估。

使用Gradle包装器时，通过从子项目目录运行Gradle为特定子项目执行任务的效果不佳，因为如果您不在项目根目录中，则必须指定包装器脚本的路径。例如，如果要`build`为_webservice_子项目运行任务，并且您位于_webservice_子项目目录中，则必须运行`../../gradlew build`。下一节说明如何直接从项目的根目录中实现此目的。

## [](#sec:executing_tasks_by_fully_qualified_name)[通过完全限定的名称执行任务](#sec:executing_tasks_by_fully_qualified_name)

您可以使用任务的全限定名来执行特定子项目中的特定任务。例如：`gradle :services:webservice:build`将运行_webservice_子项目的`build`任务。任务的完全限定名称只是其项目路径加上任务名称。

项目路径具有以下模式：它以一个可选的冒号开头，该冒号表示根项目。根项目是路径中唯一未由其名称指定的项目。项目路径的其余部分是用冒号分隔的项目名称序列，其中下一个项目是上一个项目的子项目。运行时，您可以看到项目路径`gradle projects`，如“[识别项目结构”](#sec:identifying_project_structure)部分中所示。

这种方法适用于任何任务，因此，如果您想知道特定子项目中的`tasks`任务，只需使用该任务即可，例如`gradle :services:webservice:tasks`。

无论您使用哪种技术来执行任务，Gradle都会负责构建目标依赖的任何子项目。您不必自己担心项目间的依赖性。如果您对该配置方式感兴趣，可以[稍后在用户手册中]()阅读有关编写多项目构建的信息。

作为构建用户，这就是您真正需要了解的多项目构建的全部内容。现在，您可以确定某个构建是否为多项目构建，并可以发现其结构。最后，您可以在特定子项目中执行任务。

## [](#sec:multiproject_build_and_test)[多项目构建和测试](#sec:multiproject_build_and_test)

`build`Java插件的任务通常用于编译，测试和执行单个项目的代码样式检查（如果使用了CodeQuality插件）。在多项目构建中，您可能经常想在一系列项目中执行所有这些任务。该`buildNeeded`和`buildDependents`任务可以在这方面帮助。

在[此示例中]()，`:services:person-service`项目同时依赖`:api`和`:shared`项目。该`:api`项目还取决于该`:shared`项目。

假设您正在处理一个项目，即`:api`项目。自进行清理以来，您一直在进行更改，但尚未构建整个项目。您想要构建任何必要的支持jar，但仅对已更改的项目执行代码质量和单元测试。该`build`任务将执行此操作。

例子1.构建和测试单个项目

输出**`gradle :api:build`**

\> gradle：api：build >任务：shared：compileJava >任务：shared：processResources >任务：共享：类 >任务：shared：jar >任务：api：compileJava >任务：api：processResources >任务：api：classes >任务：api：jar >任务：api：assembly >任务：api：compileTestJava >任务：api：processTestResources >任务：api：testClasses >任务：api：test >任务：api：check >任务：api：build
 在0秒内成功建立 9个可执行任务：9个已执行

如果您刚从版本控制系统中获得了最新版本的源代码，其中包括`:api`依赖于其他项目的更改，则您可能不仅要构建您依赖的所有项目，还要对其进行测试。该`buildNeeded`任务还将根据testRuntime配置的项目依赖项测试所有项目。

例子2.依赖于项目的构建和测试

输出**`gradle :api:buildNeeded`**

\> gradle：api：build需要 >任务：shared：compileJava >任务：shared：processResources >任务：共享：类 >任务：shared：jar >任务：api：compileJava >任务：api：processResources >任务：api：classes >任务：api：jar >任务：api：assembly >任务：api：compileTestJava >任务：api：processTestResources >任务：api：testClasses >任务：api：test >任务：api：check >任务：api：build >任务：共享：组装 >任务：shared：compileTestJava >任务：shared：processTestResources >任务：shared：testClasses >任务：共享：测试 >任务：共享：检查 >任务：shared：build >任务：shared：buildNeeded >任务：api：buildNeeded
 在0秒内成功建立 12个可执行任务：已执行12个

您可能还需要重构`:api`其他项目中使用的项目的某些部分。如果进行这些类型的更改，仅测试`:api`项目是不够的，还需要测试依赖于该`:api`项目的所有项目。该`buildDependents`任务还将测试在指定项目上具有项目依赖项（在testRuntime配置中）的所有项目。

例子3.建立和测试依赖项目

输出**`gradle :api:buildDependents`**

\> gradle：api：buildDependents >任务：shared：compileJava >任务：shared：processResources >任务：共享：类 >任务：shared：jar >任务：api：compileJava >任务：api：processResources >任务：api：classes >任务：api：jar >任务：api：assembly >任务：api：compileTestJava >任务：api：processTestResources >任务：api：testClasses >任务：api：test >任务：api：check >任务：api：build >任务：services：person-service：compileJava >任务：services：person-service：processResources >任务：服务：人员服务：类 >任务：服务：个人服务：罐子 >任务：服务：个人服务：组装 >任务：服务：个人服务：compileTestJava >任务：服务：人员服务：processTestResources >任务：服务：个人服务：测试类 >任务：服务：个人服务：测试 >任务：服务：个人服务：检查 >任务：services：person-service：build >任务：services：person-service：buildDependents >任务：api：buildDependents
 在0秒内成功建立 17个可执行任务：17个已执行

最后，您可能要构建和测试所有项目中的所有内容。您在根项目文件夹中运行的任何任务都将使相同的命名任务在所有子项上运行。因此，您可以运行`gradle build`以构建和测试所有项目。