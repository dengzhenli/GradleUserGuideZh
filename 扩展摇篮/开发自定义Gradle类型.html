 无标题 <style id="wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;position:relative;padding: 20px 16px;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8px 0 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-editor-body a {word-wrap: break-word;text-decoration-skip-ink: none;}.wiz-editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-editor-body li.wiz-list-align-style {list-style-position: inside; margin-left: -1em;}.wiz-editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:100%;height:auto !important;margin:2px 0;padding: 2px;vertical-align:bottom;}.wiz-editor-body table {border-collapse:collapse;border:1px solid #a7afbc;}.wiz-editor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:collapse;border:1px solid #a7afbc;min-height:28px;word-break:break-word;box-sizing: border-box;}.wiz-editor-body td > div:first-child {margin-top:0;}.wiz-editor-body td > div:last-child {margin-bottom:0;}.wiz-editor-body img.wiz-svg-image {box-shadow:1px 1px 4px #E8E8E8;}.wiz-editor-body .wiz-image-container {margin:0;max-width: 100%;display: inline-flex;flex-direction: column;}.wiz-editor-body .wiz-image-container .wiz-image-title {display:inline-block;text-align: center;color: #a7afbc;line-height: 18px;font-size: 12px;min-height: 18px;width: 100%;white-space: normal;}.wiz-hide {display:none !important;}.wiz-editor-body.wiz-editor-outline {padding-right:0; padding-left:0;}.wiz-editor-body.wiz-editor-outline .outline-container {margin:0; padding:0; line-height:1.5;}.wiz-editor-body.wiz-editor-outline .outline-container div {margin:0;}.wiz-editor-body.wiz-editor-outline .node {margin:0; padding: 0;}.wiz-editor-body.wiz-editor-outline .outline-container > .node {margin-right:24px; margin-left:30px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .children {display:none;}.wiz-editor-body.wiz-editor-outline .node .row {position:relative; padding-left:26px;}.wiz-editor-body.wiz-editor-outline .node .operator-container {width:36px;position:absolute; top:4px; left:-18px;}.wiz-editor-body.wiz-editor-outline .node .operator-bar {position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center;}.wiz-editor-body.wiz-editor-outline .node .switch {width:18px; height:18px;display:flex;flex-direction: column;align-items: center;overflow: hidden;}.wiz-editor-body.wiz-editor-outline .node .switch i {font-size:20px;position:relative;left:-1px;top:-1px;}.wiz-editor-body.wiz-editor-outline .node .switch.active {cursor:pointer;color:transparent; transition:transform 200ms ease 0s;}.wiz-editor-body.wiz-editor-outline .node.collapsed .switch.active {transform:rotateZ(-90deg);}.wiz-editor-body.wiz-editor-outline .node .row:hover .switch.active {color:#505F79}.wiz-editor-body.wiz-editor-outline .node .dot {display:flex; align-items:center; justify-content:center; border-radius:100%; width:18px; height:18px;}.wiz-editor-body.wiz-editor-outline .node.collapsed .dot {background-color:rgba(80, 95, 121, .15);}.wiz-editor-body.wiz-editor-outline .node .dot-icon {background-color:#505F79; border-radius:100%; width:6px; height:6px;}.wiz-editor-body.wiz-editor-outline .node .child {margin-left:8px; border-left:1px solid #E6E9ED; padding-left:17px;}.wiz-editor-body.wiz-editor-outline .node .content {flex:1;outline:none; padding:4px 0;}.wiz-editor-body.wiz-editor-outline .node div.content {font-size:1rem;}.wiz-editor-body.wiz-editor-outline .node.complete > .row .content {text-decoration:line-through;color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .notes {outline:none; font-size:.8rem; color:#A7AFBC;}.wiz-editor-body.wiz-editor-outline .node .image {outline:none; padding-top:4px; padding-bottom:4px;}.wiz-editor-body.wiz-editor-outline .outline-container h1,.wiz-editor-body.wiz-editor-outline .outline-container h2,.wiz-editor-body.wiz-editor-outline .outline-container h3,.wiz-editor-body.wiz-editor-outline .outline-container h4,.wiz-editor-body.wiz-editor-outline .outline-container h5,.wiz-editor-body.wiz-editor-outline .outline-container h6 {margin:0;}body, .wiz-editor-body { padding-left: 48px; padding-right: 48px;}</style><style id="wiz_code_style">.wiz-editor-body .wiz-code-container{position: relative; padding:8px 0; margin: 5px 0;text-indent:0; text-align:left;}.CodeMirror {font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; color: black; font-size: 10.5pt; font-size: 0.875rem}.wiz-editor-body .wiz-code-container .CodeMirror div {margin-top: 0; margin-bottom: 0;}.CodeMirror-lines {padding: 4px 0;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {padding: 0 4px;}.CodeMirror pre.CodeMirror-line {min-height: 24px;}.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {background-color: white;}.CodeMirror-gutters {border-right: 1px solid #ddd; background-color: #f7f7f7; white-space: nowrap;}.CodeMirror-linenumbers {}.CodeMirror-linenumber {padding: 0 3px 0 5px; min-width: 20px; text-align: right; color: #999; white-space: nowrap;}.CodeMirror-guttermarker {color: black;}.CodeMirror-guttermarker-subtle {color: #999;}.CodeMirror-cursor {border-left: 1px solid black; border-right: none; width: 0;}.CodeMirror div.CodeMirror-secondarycursor {border-left: 1px solid silver;}.cm-fat-cursor .CodeMirror-cursor {width: auto; border: 0 !important; background: #7e7;}.cm-fat-cursor div.CodeMirror-cursors {z-index: 1;}.cm-fat-cursor-mark {background-color: rgba(20, 255, 20, 0.5);-webkit-animation: blink 1.06s steps(1) infinite;-moz-animation: blink 1.06s steps(1) infinite;animation: blink 1.06s steps(1) infinite;}.cm-animate-fat-cursor {width: auto; border: 0; -webkit-animation: blink 1.06s steps(1) infinite; -moz-animation: blink 1.06s steps(1) infinite; animation: blink 1.06s steps(1) infinite; background-color: #7e7;}@-moz-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@-webkit-keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}@keyframes blink { 0% {} 50% { background-color: transparent; } 100% {}}.CodeMirror-overwrite .CodeMirror-cursor {}.cm-tab { display: inline-block; text-decoration: inherit; }.CodeMirror-rulers {position: absolute; left: 0; right: 0; top: -50px; bottom: -20px; overflow: hidden;}.CodeMirror-ruler {border-left: 1px solid #ccc; top: 0; bottom: 0; position: absolute;}.cm-s-default .cm-header {color: blue;}.cm-s-default .cm-quote {color: #090;}.cm-negative {color: #d44;}.cm-positive {color: #292;}.cm-header, .cm-strong {font-weight: bold;}.cm-em {font-style: italic;}.cm-link {text-decoration: underline;}.cm-strikethrough {text-decoration: line-through;}.cm-s-default .cm-keyword {color: #708;}.cm-s-default .cm-atom {color: #219;}.cm-s-default .cm-number {color: #164;}.cm-s-default .cm-def {color: #00f;}.cm-s-default .cm-variable,.cm-s-default .cm-punctuation,.cm-s-default .cm-property,.cm-s-default .cm-operator {}.cm-s-default .cm-variable-2 {color: #05a;}.cm-s-default .cm-variable-3 {color: #085;}.cm-s-default .cm-comment {color: #a50;}.cm-s-default .cm-string {color: #a11;}.cm-s-default .cm-string-2 {color: #f50;}.cm-s-default .cm-meta {color: #555;}.cm-s-default .cm-qualifier {color: #555;}.cm-s-default .cm-builtin {color: #30a;}.cm-s-default .cm-bracket {color: #997;}.cm-s-default .cm-tag {color: #170;}.cm-s-default .cm-attribute {color: #00c;}.cm-s-default .cm-hr {color: #999;}.cm-s-default .cm-link {color: #00c;}.cm-s-default .cm-error {color: #f00;}.cm-invalidchar {color: #f00;}.CodeMirror-composing { border-bottom: 2px solid; }div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }.CodeMirror-activeline-background {background: #e8f2ff;}.CodeMirror {position: relative; background: #f5f5f5;}.CodeMirror-scroll {overflow: hidden !important; margin-bottom: 0; margin-right: -30px; padding: 16px 30px 16px 0; outline: none; position: relative;}.CodeMirror-sizer {position: relative; border-right: 30px solid transparent;}.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {position: absolute; z-index: 6; display: none;}.CodeMirror-vscrollbar {right: 0; top: 0; overflow-x: hidden; overflow-y: scroll;}.CodeMirror-hscrollbar {bottom: 0; left: 0 !important; overflow-y: hidden; overflow-x: scroll;pointer-events: auto !important;outline: none;}.CodeMirror-scrollbar-filler {right: 0; bottom: 0;}.CodeMirror-gutter-filler {left: 0; bottom: 0;}.CodeMirror-gutters {position: absolute; left: 0; top: 0; min-height: 100%; z-index: 3;}.CodeMirror-gutter {white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -30px;}.CodeMirror-gutter-wrapper {position: absolute; z-index: 4; background: none !important; border: none !important;}.CodeMirror-gutter-background {position: absolute; top: 0; bottom: 0; z-index: 4;}.CodeMirror-gutter-elt {position: absolute; cursor: default; z-index: 4;}.CodeMirror-gutter-wrapper ::selection { background-color: transparent }.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }.CodeMirror-lines {cursor: text; min-height: 1px;}.CodeMirror pre.CodeMirror-line,.CodeMirror pre.CodeMirror-line-like {-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0; border-width: 0; background: transparent; font-family: inherit; font-size: inherit; margin: 0; white-space: pre; word-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; -webkit-font-variant-ligatures: contextual; font-variant-ligatures: contextual;}.CodeMirror-wrap pre.CodeMirror-line,.CodeMirror-wrap pre.CodeMirror-line-like {word-wrap: break-word; white-space: pre-wrap; word-break: normal;}.CodeMirror-linebackground {position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;}.CodeMirror-linewidget {position: relative; z-index: 2; padding: 0.1px;}.CodeMirror-widget {}.CodeMirror-rtl pre { direction: rtl; }.CodeMirror-code {outline: none;}.CodeMirror-scroll,.CodeMirror-sizer,.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber {-moz-box-sizing: content-box; box-sizing: content-box;}.CodeMirror-measure {position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;}.CodeMirror-cursor {position: absolute; pointer-events: none;}.CodeMirror-measure pre { position: static; }div.CodeMirror-cursors {visibility: hidden; position: relative; z-index: 3;}div.CodeMirror-dragcursors {visibility: visible;}.CodeMirror-focused div.CodeMirror-cursors {visibility: visible;}.CodeMirror-selected { background: #d9d9d9; }.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }.CodeMirror-crosshair { cursor: crosshair; }.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }.cm-searching {background: #ffa; background: rgba(255, 255, 0, .4);}.cm-force-border { padding-right: .1px; }@media print { .CodeMirror div.CodeMirror-cursors {visibility: hidden;}}.cm-tab-wrap-hack:after { content: ""; }span.CodeMirror-selectedtext { background: none; }.CodeMirror-activeline-background, .CodeMirror-selected {transition: visibility 0ms 100ms;}.CodeMirror-blur .CodeMirror-activeline-background, .CodeMirror-blur .CodeMirror-selected {visibility:hidden;}.CodeMirror-blur .CodeMirror-matchingbracket {color:inherit !important;outline:none !important;text-decoration:none !important;}.CodeMirror-sizer {min-height:auto !important;}</style>

# 开发自定义Gradle类型

内容

* [使用bean属性进行配置](#configuration_using_bean_properties)
* [DSL支持和可扩展性](#dsl_support_and_extensibility)
* [服务注入](#service_injection)
* [创建嵌套对象](#nested_objects)
* [集合类型](#collection_types)

您可以为Gradle开发几种不同类型的“附加组件”，例如[插件]()，[任务]()，[项目扩展]()或[工件转换]()，它们全部实现为类和可以在JVM上运行的其他类型。本章讨论了这些类型共有的一些功能和概念。您可以使用这些功能来帮助实现自定义Gradle类型，并为用户提供一致的DSL。

本章适用于以下类型：

* 插件类型。
* 任务类型。
* 伪影转换参数类型。
* Worker API工作操作参数类型。
* 使用创建的扩展对象`ExtensionContainer.create()`，例如由插件注册的项目扩展。
* 使用创建的对象`ObjectFactory.newInstance()`。
* 为托管嵌套属性创建的对象。
* 的元素`NamedDomainObjectContainer`。

## [](#configuration_using_bean_properties)[使用bean属性进行配置](#configuration_using_bean_properties)

您实现的自定义Gradle类型通常具有一些配置，您希望这些配置可用于构建脚本和其他插件。例如，下载任务可以具有指定要从中下载的URL和将结果写入的文件系统位置的配置。此配置表示为Java bean属性。

Kotlin和Groovy为声明Java bean属性提供了便利，这使它们成为实现Gradle类型的良好语言选择。在下面的示例中演示了这些便利。

Gradle还为使用bean属性实现类型提供了一些便利。

### [](#managed_properties)[托管属性](#managed_properties)

Gradle可以提供抽象属性的实现。这称为_托管属性_，因为Gradle_负责管理属性_的状态。属性可以是_可变的_，这意味着它既具有getter方法又具有setter方法，或者是_只读的_，意味着它仅具有getter方法。

<table style="background:none;width:912px;"><tbody><tr><td class="icon" style="color:rgba(0, 0, 0, 0.8);width:80px;"><i class="fa icon-note"></i></td><td class="content" style="font-size:1.0625rem;color:rgba(0, 0, 0, 0.6);"><div class="paragraph"><p style="font-size: 1rem;"><font><font>托管属性当前是一个</font></font><a href="" style="color:rgb(29, 162, 189);text-decoration:none;"><font><font>孵化</font></font></a><font><font>功能。</font></font></p></div></td></tr></tbody></table>

#### [](#mutable_managed_properties)[可变的托管属性](#mutable_managed_properties)

要声明可变的托管属性，请为该类型的属性添加一个抽象的getter方法和一个抽象的setter方法。

这是带有`uri`属性的任务类型的示例：

例子1.可变的托管属性

下载.java

import org.gradle.api.DefaultTask; import org.gradle.api.tasks.Input; import org.gradle.api.tasks.TaskAction; import java.net.URI; public abstract class Download extends DefaultTask \{ // Use an abstract getter and setter method \@Input abstract URI getUri\(\); abstract void setUri\(URI uri\); \@TaskAction void run\(\) \{ // Use the \`uri\` property System.out.println\("Downloading " + getUri\(\)\); \} \}

 

1

import org.gradle.api.DefaultTask;

2

import org.gradle.api.tasks.Input;

3

import org.gradle.api.tasks.TaskAction;

4

5

import java.net.URI;

6

7

public abstract class Download extends DefaultTask \{

8

 // Use an abstract getter and setter method

9

 \@Input

10

 abstract URI getUri\(\);

11

 abstract void setUri\(URI uri\);

12

13

 \@TaskAction

14

 void run\(\) \{

15

 // Use the \`uri\` property

16

 System.out.println\("Downloading " + getUri\(\)\);

17

 \}

18

\}

请注意，要使某个属性被视为可变的托管属性，该属性的_所有_getter方法和setter方法都必须具有`abstract`并且具有`public`或`protected`可见性。

#### [](#read_only_managed_properties)[只读托管属性](#read_only_managed_properties)

要声明只读托管属性，请为该类型添加一个抽象的getter方法。该属性不应具有任何setter方法。Gradle将提供getter的实现，并为该属性创建一个值。

这是与Gradle可配置的[惰性属性]()或容器类型之一一起使用的有用模式。

这是带有`uri`属性的任务类型的示例：

例子2.只读托管属性

下载.java

import org.gradle.api.DefaultTask; import org.gradle.api.provider.Property; import org.gradle.api.tasks.Input; import org.gradle.api.tasks.TaskAction; import java.net.URI; public abstract class Download extends DefaultTask \{ // Use an abstract getter method \@Input abstract Property\<URI> getUri\(\); \@TaskAction void run\(\) \{ // Use the \`uri\` property System.out.println\("Downloading " + getUri\(\).get\(\)\); \} \}

 

1

import org.gradle.api.DefaultTask;

2

import org.gradle.api.provider.Property;

3

import org.gradle.api.tasks.Input;

4

import org.gradle.api.tasks.TaskAction;

5

6

import java.net.URI;

7

8

public abstract class Download extends DefaultTask \{

9

 // Use an abstract getter method

10

 \@Input

11

 abstract Property\<URI\> getUri\(\);

12

13

 \@TaskAction

14

 void run\(\) \{

15

 // Use the \`uri\` property

16

 System.out.println\("Downloading " + getUri\(\).get\(\)\);

17

 \}

18

\}

请注意，对于一个被视为只读托管属性的属性，该属性的_所有_getter方法都必须是`abstract`并且具有`public`或`protected`可见性。该属性不得具有任何setter方法。此外，属性类型必须具有以下之一：

* `Property<T>`
* `RegularFileProperty`
* `DirectoryProperty`
* `ListProperty<T>`
* `SetProperty<T>`
* `MapProperty<K, V>`
* `ConfigurableFileCollection`
* `ConfigurableFileTree`
* `DomainObjectSet<T>`
* `NamedDomainObjectContainer<T>`

Gradle以与[ObjectFactory]()相同的方式为只读托管属性创建值。

#### [](#read_only_managed_nested_properties)[只读托管嵌套属性](#read_only_managed_nested_properties)

要声明只读的托管嵌套属性，请将该属性的抽象getter方法添加到以注释的类型。该属性不应具有任何setter方法。Gradle提供了getter方法的实现，还为该属性创建了一个值。嵌套类型也被视为自定义类型，并且可以使用本章中讨论的功能。`@[Nested]()`

当定制类型的嵌套复杂类型具有相同的生命周期时，此模式很有用。如果生命周期不同，请考虑`Property<NestedType>`改用。

这是带有`resource`属性的任务类型的示例。该`Resource`类型也是自定义Gradle类型，并定义了一些托管属性：

例子3.只读托管嵌套属性

下载.java

public abstract class Download extends DefaultTask \{ // Use an abstract getter method annotated with \@Nested \@Nested abstract Resource getResource\(\); \@TaskAction void run\(\) \{ // Use the \`resource\` property System.out.println\("Downloading https://" + getResource\(\).getHostName\(\).get\(\) + "/" + getResource\(\).getPath\(\).get\(\)\); \} \} public interface Resource \{ \@Input Property\<String> getHostName\(\); \@Input Property\<String> getPath\(\); \}

 

1

public abstract class Download extends DefaultTask \{

2

 // Use an abstract getter method annotated with \@Nested

3

 \@Nested

4

 abstract Resource getResource\(\);

5

6

 \@TaskAction

7

 void run\(\) \{

8

 // Use the \`resource\` property

9

 System.out.println\("Downloading https://" + getResource\(\).getHostName\(\).get\(\) + "/" + getResource\(\).getPath\(\).get\(\)\);

10

 \}

11

\}

12

13

public interface Resource \{

14

 \@Input

15

 Property\<String\> getHostName\(\);

16

 \@Input

17

 Property\<String\> getPath\(\);

18

\}

请注意，要使某个属性被视为只读的托管嵌套属性，则该属性的_所有_getter方法都必须是`abstract`且具有`public`或`protected`可见性。该属性不得具有任何setter方法。此外，必须使用注释属性获取器。`@[Nested]()`

### [](#managed_types)[托管类型](#managed_types)

甲_托管类型_是一个抽象类或接口没有字段和其属性的所有被管理。也就是说，这是一种其状态完全由Gradle管理的类型。

## [](#dsl_support_and_extensibility)[DSL支持和可扩展性](#dsl_support_and_extensibility)

当Gradle创建自定义类型的实例时，它会将该实例_装饰_为混入DSL和可扩展性支持。

每个装饰实例都实现[ExtensionAware]()，因此可以将扩展对象附加到它。

请注意，由于向后兼容性问题，当前未装饰使用[Project.container（）]()创建的插件和容器的元素。

## [](#service_injection)[服务注入](#service_injection)

Gradle提供了许多可用于自定义Gradle类型的有用服务。例如，任务可以使用[WorkerExecutor]()服务来并行运行工作，如[worker API]()部分所示。通过_服务注入_提供_服务_。

### [](#services_for_injection)[可用服务](#services_for_injection)

以下服务可用于注射：

* [ObjectFactory-]()允许创建模型对象。有关更多详细信息，请参见[创建嵌套对象](#nested_objects)。
* [ProjectLayout-]()提供对关键项目位置的访问。有关更多详细信息，请参见[延迟配置]()。该服务在Worker API操作中不可用。
* [ProviderFactory-]()创建`Provider`实例。有关更多详细信息，请参见[延迟配置]()。
* [WorkerExecutor-]()允许任务并行运行工作。有关更多详细信息，请参见[worker API]()。
* [FileSystemOperations-]()允许任务在文件系统上运行操作，例如删除文件，复制文件或同步目录。
* [ArchiveOperations-]()允许任务对存档文件（例如ZIP或TAR文件）运行操作。
* [ExecOperations-]()允许任务运行外部进程，并带有对运行外部`java`程序的专门支持。
* [ToolingModelBuilderRegistry-]()允许插件注册Gradle工具API模型。

出了上述情况，`ProjectLayout`并`WorkerExecutor`服务仅适用于注射项目插件。

### [](#constructor_injection)[构造器注入](#constructor_injection)

对象可以通过两种方式接收其所需的服务。第一种选择是将服务添加为类构造函数的参数。构造函数必须带有`javax.inject.Inject`注释。Gradle使用每个构造函数参数的声明类型来确定对象所需的服务。构造函数参数及其名称的顺序并不重要，可以随便更改。

这是一个示例，显示了`ObjectFactory`通过其构造函数接收一个任务的任务类型：

例子4.构造函数服务注入

下载.java

import org.gradle.api.DefaultTask; import org.gradle.api.file.DirectoryProperty; import org.gradle.api.model.ObjectFactory; import org.gradle.api.tasks.OutputDirectory; import org.gradle.api.tasks.TaskAction; import javax.inject.Inject; public class Download extends DefaultTask \{ private final DirectoryProperty outputDirectory; // Inject an ObjectFactory into the constructor \@Inject public Download\(ObjectFactory objectFactory\) \{ // Use the factory outputDirectory = objectFactory.directoryProperty\(\); \} \@OutputDirectory public DirectoryProperty getOutputDirectory\(\) \{ return outputDirectory; \} \@TaskAction void run\(\) \{ // ... \} \}

 

1

import org.gradle.api.DefaultTask;

2

import org.gradle.api.file.DirectoryProperty;

3

import org.gradle.api.model.ObjectFactory;

4

import org.gradle.api.tasks.OutputDirectory;

5

import org.gradle.api.tasks.TaskAction;

6

7

import javax.inject.Inject;

8

9

public class Download extends DefaultTask \{

10

 private final DirectoryProperty outputDirectory;

11

12

 // Inject an ObjectFactory into the constructor

13

 \@Inject

14

 public Download\(ObjectFactory objectFactory\) \{

15

 // Use the factory

16

 outputDirectory \= objectFactory.directoryProperty\(\);

17

 \}

18

19

 \@OutputDirectory

20

 public DirectoryProperty getOutputDirectory\(\) \{

21

 return outputDirectory;

22

 \}

23

24

 \@TaskAction

25

 void run\(\) \{

26

 // ...

27

 \}

28

\}

### [](#property_injection)[资产注入](#property_injection)

或者，可以通过`javax.inject.Inject`在类中添加带有注释的属性获取方法来注入服务。例如，当由于向后兼容性约束而无法更改类的构造函数时，此功能很有用。这种模式还允许Gradle将服务的创建推迟到调用getter方法之前，而不是在创建实例时进行。这可以帮助提高性能。Gradle使用getter方法的声明的返回类型来确定要提供的服务。该属性的名称并不重要，并且可以是您喜欢的任何名称。

属性获取器方法必须为`public`或`protected`。该方法可以是，`abstract`或者在不可能的情况下可以具有虚拟方法主体。方法主体将被丢弃。

这是一个示例，显示了一个通过属性getter方法接收两项服务的任务类型：

例子5.物业服务注入

下载.java

import javax.inject.Inject; import org.gradle.api.model.ObjectFactory; import org.gradle.api.DefaultTask; import org.gradle.api.tasks.TaskAction; import org.gradle.workers.WorkerExecutor; public abstract class Download extends DefaultTask \{ // Use an abstract getter method \@Inject protected abstract ObjectFactory getObjectFactory\(\); // Alternatively, use a getter method with a dummy implementation \@Inject protected WorkerExecutor getWorkerExecutor\(\) \{ // Method body is ignored throw new UnsupportedOperationException\(\); \} \@TaskAction void run\(\) \{ WorkerExecutor workerExecutor = getWorkerExecutor\(\); ObjectFactory objectFactory = getObjectFactory\(\); // Use the executor and factory ... \} \}

 

1

import javax.inject.Inject;

2

import org.gradle.api.model.ObjectFactory;

3

import org.gradle.api.DefaultTask;

4

import org.gradle.api.tasks.TaskAction;

5

import org.gradle.workers.WorkerExecutor;

6

7

public abstract class Download extends DefaultTask \{

8

 // Use an abstract getter method

9

 \@Inject

10

 protected abstract ObjectFactory getObjectFactory\(\);

11

12

 // Alternatively, use a getter method with a dummy implementation

13

 \@Inject

14

 protected WorkerExecutor getWorkerExecutor\(\) \{

15

 // Method body is ignored

16

 throw new UnsupportedOperationException\(\);

17

 \}

18

19

 \@TaskAction

20

 void run\(\) \{

21

 WorkerExecutor workerExecutor \= getWorkerExecutor\(\);

22

 ObjectFactory objectFactory \= getObjectFactory\(\);

23

 // Use the executor and factory ...

24

 \}

25

\}

## [](#nested_objects)[创建嵌套对象](#nested_objects)

自定义Gradle类型可以使用[ObjectFactory]()服务创建Gradle类型的实例以用于其属性值。这些实例可以利用本章讨论的功能，使您可以创建“嵌套”对象和嵌套DSL。

您还可以让Gradle使用[托管的嵌套属性](#read_only_managed_nested_properties)为您创建嵌套对象。

在以下示例中，项目扩展`ObjectFactory`通过其构造函数接收实例。构造函数使用它来创建嵌套`Resource`对象（也是自定义Gradle类型），并使该对象可通过`resource`属性使用。

例子6.嵌套对象的创建

DownloadExtension.java

import org.gradle.api.model.ObjectFactory; import javax.inject.Inject; public class DownloadExtension \{ // A nested instance private final Resource resource; \@Inject public DownloadExtension\(ObjectFactory objectFactory\) \{ // Use an injected ObjectFactory to create a Resource object resource = objectFactory.newInstance\(Resource.class\); \} public Resource getResource\(\) \{ return resource; \} \} public class Resource \{ private URI uri; public URI getUri\(\) \{ return uri; \} public void setUri\(URI uri\) \{ this.uri = uri; \} \}

 

1

import org.gradle.api.model.ObjectFactory;

2

3

import javax.inject.Inject;

4

5

public class DownloadExtension \{

6

 // A nested instance

7

 private final Resource resource;

8

9

 \@Inject

10

 public DownloadExtension\(ObjectFactory objectFactory\) \{

11

 // Use an injected ObjectFactory to create a Resource object

12

 resource \= objectFactory.newInstance\(Resource.class\);

13

 \}

14

15

 public Resource getResource\(\) \{

16

 return resource;

17

 \}

18

\}

19

20

public class Resource \{

21

 private URI uri;

22

23

 public URI getUri\(\) \{

24

 return uri;

25

 \}

26

 public void setUri\(URI uri\) \{

27

 this.uri \= uri;

28

 \}

29

\}

## [](#collection_types)[集合类型](#collection_types)

Gradle提供了用于维护对象集合的类型，旨在与Gradle DSL配合使用并提供有用的功能，例如延迟配置。

### [](#nameddomainobjectcontainer)[命名域对象容器](#nameddomainobjectcontainer)

甲[NamedDomainObjectContainer]()管理一组对象，其中每个元素具有与之相关联的名称。该容器负责创建和配置元素，并提供一个DSL，构建脚本可用于定义和配置元素。它旨在容纳本身可配置的对象，例如一组自定义Gradle对象。

Gradle`NamedDomainObjectContainer`在整个API中广泛使用类型。例如，`project.tasks`用于管理项目任务的对象是`NamedDomainObjectContainer<Task>`。

您可以使用[ObjectFactory]()服务创建容器实例，该服务提供[ObjectFactory.domainObjectContainer（）]()方法。使用[Project.container（）]()方法也可以使用此方法，但是在自定义Gradle类型中，通常最好使用注入的`ObjectFactory`服务而不是传递`Project`实例。

您还可以使用如上所述的[只读托管属性](#read_only_managed_properties)创建容器实例。

为了对任何`domainObjectContainer()`方法使用类型，它必须公开一个名为“ name”的属性作为对象的唯一且恒定的名称。该`domainObjectContainer(Class)`方法的变体通过调用带有字符串参数的类的构造函数来创建新实例，该字符串参数是对象的所需名称。通过这种方式创建的对象被视为自定义Gradle类型，因此可以利用本章中讨论的功能，例如服务注入或托管属性。

有关`domainObjectContainer()`允许自定义实例化策略的方法变体，请参见上面的链接。

例子7.管理对象集合

DownloadExtension.java

import org.gradle.api.NamedDomainObjectContainer; import org.gradle.api.model.ObjectFactory; import javax.inject.Inject; public class DownloadExtension \{ // A container of \`Resource\` objects private final NamedDomainObjectContainer\<Resource> resources; \@Inject public DownloadExtension\(ObjectFactory objectFactory\) \{ // Use an injected ObjectFactory to create a container resources = objectFactory.domainObjectContainer\(Resource.class\); \} public NamedDomainObjectContainer\<Resource> getResources\(\) \{ return resources; \} \} public class Resource \{ private final String name; private URI uri; private String userName; // Type must have a public constructor that takes the element name as a parameter public Resource\(String name\) \{ this.name = name; \} // Type must have a 'name' property, which should be read-only public String getName\(\) \{ return name; \} public URI getUri\(\) \{ return uri; \} public void setUri\(URI uri\) \{ this.uri = uri; \} public String getUserName\(\) \{ return userName; \} public void setUserName\(String userName\) \{ this.userName = userName; \} \}

 

1

import org.gradle.api.NamedDomainObjectContainer;

2

import org.gradle.api.model.ObjectFactory;

3

4

import javax.inject.Inject;

5

6

public class DownloadExtension \{

7

 // A container of \`Resource\` objects

8

 private final NamedDomainObjectContainer\<Resource\> resources;

9

10

 \@Inject

11

 public DownloadExtension\(ObjectFactory objectFactory\) \{

12

 // Use an injected ObjectFactory to create a container

13

 resources \= objectFactory.domainObjectContainer\(Resource.class\);

14

 \}

15

16

 public NamedDomainObjectContainer\<Resource\> getResources\(\) \{

17

 return resources;

18

 \}

19

\}

20

21

public class Resource \{

22

 private final String name;

23

 private URI uri;

24

 private String userName;

25

26

 // Type must have a public constructor that takes the element name as a parameter

27

 public Resource\(String name\) \{

28

 this.name \= name;

29

 \}

30

31

 // Type must have a 'name' property, which should be read-only

32

 public String getName\(\) \{

33

 return name;

34

 \}

35

36

 public URI getUri\(\) \{

37

 return uri;

38

 \}

39

 public void setUri\(URI uri\) \{

40

 this.uri \= uri;

41

 \}

42

43

 public String getUserName\(\) \{

44

 return userName;

45

 \}

46

 public void setUserName\(String userName\) \{

47

 this.userName \= userName;

48

 \}

49

\}

对于每个容器属性，Gradle会自动向Groovy和Kotlin DSL添加一个块，您可以使用该块来配置容器的内容：

例子8.配置块

`Kotlin``Groovy`

build.gradle

plugins \{ id\("org.gradle.sample.download"\) \} download \{ // Can use a block to configure the container contents resources \{ gradle \{ uri = uri\('https://gradle.org'\) \} \} \}

 

1

plugins \{

2

 id\("org.gradle.sample.download"\)

3

\}

4

5

download \{

6

 // Can use a block to configure the container contents

7

 resources \{

8

 gradle \{

9

 uri \= uri\('https://gradle.org'\)

10

 \}

11

 \}

12

\}

### [](#extensiblepolymorphicdomainobjectcontainer)[ExtensiblePolymorphicDomainObjectContainer](#extensiblepolymorphicdomainobjectcontainer)

一个[ExtensiblePolymorphicDomainObjectContainer]()是`NamedDomainObjectContainer`，它允许你定义实例化策略，不同类型的对象。

您可以使用[ObjectFactory.polymorphicDomainObjectContainer（）]()方法创建实例。

### [](#nameddomainobjectset)[命名域对象集](#nameddomainobjectset)

甲[NamedDomainObjectSet]()持有一组可配置的对象，其中每个元素具有与之相关联的名称。这类似于`NamedDomainObjectContainer`，但是`NamedDomainObjectSet`不管理集合中的对象。它们需要手动创建和添加。

您可以使用[ObjectFactory.namedDomainObjectSet（）]()方法创建实例。

### [](#nameddomainobjectlist)[NamedDomainObjectList](#nameddomainobjectlist)

一个[NamedDomainObjectList]()持有配置的对象，其中每个元素具有与它关联的名称的列表。这类似于`NamedDomainObjectContainer`，但是`NamedDomainObjectList`不管理集合中的对象。它们需要手动创建和添加。

您可以使用[ObjectFactory.namedDomainObjectList（）]()方法创建一个实例。

### [](#domainobjectset)[DomainObjectSet](#domainobjectset)

一个[DomainObjectSet]()只是拥有一组可配置的对象。与相比`NamedDomainObjectContainer`，a`DomainObjectSet`不管理集合中的对象。它们需要手动创建和添加。

您可以使用[ObjectFactory.domainObjectSet（）]()方法创建实例。