

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [来自蚂蚁](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#customizing-execution)
    * [配置构建环境](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [配置Gradle守护程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#optimizing-build-performance)
    * [构建绩效指南](https://guides.gradle.org/performance/)
    * [启用和配置构建缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [使用配置缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#learning-the-basics)
    * [介绍构建脚本的基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [处理任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [了解有关构建脚本的更多信息](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [Using Gradle Plugins](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [Understanding the Build Lifecycle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [Working with Logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [Avoiding Traps](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#authoring-multi-project-builds)
    * [Creating a Basic Multi-Project Build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#advanced-techniques)
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [Using Ant from Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [构建C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [测试C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [建立Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [测试Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### 使用依赖项

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [声明版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [控制翻译](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#controlling-transitive-dependencies)
    * [Upgrading Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [Downgrading and Excluding](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [Aligning Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [Customizing Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [Preventing accidental upgrades](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [图书馆的生产和消费形式](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [在多仓库环境中工作](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [出版图书馆](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [术语](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### 扩展摇篮

  * [插件开发教程](https://gradle.org/guides/?q=Plugin%20Development)
  * [编写Gradle任务类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [编写Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [编写自定义Gradle类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [延迟配置任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [使用避免任务配置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### 参考

  * [核心插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [命令行界面](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle和第三方工具](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [摇篮包装](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle管理的目录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# 构建C ++项目

version 6.7.1

内容

  * [介绍](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_introduction)
  * [引入构建变体](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:introducing_build_variants-cpp)
  * [声明您的源文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_source_sets)
  * [管理你的依赖](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_dependency_management_overview)
  * [编译和链接代码](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_compile_link)
  * [包装出版](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_packaging)
  * [清理构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cleaning_cpp_build)
  * [构建C ++库](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_libraries)
  * [构建C ++应用程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_applications)

Gradle使用约定优于配置的方法来构建本机项目。如果您来自另一个本机构建系统，那么这些概念起初可能并不熟悉，但是它们的目的是简化构建脚本的编写。

我们将在本章中详细介绍C ++项目，但是大多数主题也将适用于其他受支持的本地语言。如果您没有使用Gradle构建本机项目的丰富经验，请查看C
++教程，以获取有关如何构建各种类型的基本C ++项目以及一些常见用例的逐步说明。

本章[介绍](https://blog.gradle.org/introducing-the-new-cpp-plugins)的C
++插件[于2018年引入](https://blog.gradle.org/introducing-the-new-cpp-
plugins)，我们建议用户在您可能会找到参考[的旧版Native插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/native_software.html)上使用这些插件。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_introduction)[介绍](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_introduction)

C ++项目的最简单构建脚本将应用C ++应用程序插件或C ++库插件，并可以选择设置项目版本：

示例1.应用C ++插件

`Groovy``Kotlin`

build.gradle

    
    
    plugins {
        id 'cpp-application' // or 'cpp-library'
    }
    
    version = '1.2.1'

build.gradle.kts

    
    
    plugins {
        `cpp-application` // or `cpp-library`
    }
    
    version = "1.2.1"

通过应用这两个C ++插件，您可以获得许多功能：

  * `compileDebugCpp`以及分别`compileReleaseCpp`编译 _src / main / cpp_ 下的C ++源文件以得到众所周知的调试和发行版本的任务。

  * `linkDebug`以及`linkRelease`将已编译的C ++对象文件链接到应用程序的可执行文件或共享库的库的任务，这些库具有调试和发行版本类型的共享链接。

  * `createDebug`以及`createRelease`将已编译的C ++对象文件组装到静态库中的任务，这些库具有针对调试和发布构建类型的静态链接。

对于任何不平凡的C ++项目，你可能有一些文件相关的和额外的配置具体到 _你的_ 项目。

C
++插件还将上述任务集成到标准[生命周期任务中](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/base_plugin.html#sec:base_tasks)。产生开发二进制文件的任务附加到`assemble`。默认情况下，开发二进制文件是调试变量。

本章的其余部分介绍了在构建库和应用程序时根据需要自定义构建的不同方法。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:introducing_build_variants-
cpp)[引入构建变体](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:introducing_build_variants-
cpp)

本机项目通常可以产生几种不同的二进制文件，例如调试或发布二进制文件，或针对特定平台和处理器体系结构的二进制文件。Gradle通过 _维度_ 和 _变体_
的概念来进行管理。

维度只是一个类别，每个类别都与其余类别正交。例如，“构建类型”维是包括调试和发布的类别。“架构”维度涵盖了x86-64和PowerPC之类的处理器架构。

变体是这些维度的值的组合，每个维度恰好由一个值组成。您可能具有“调试x86-64”或“发行版PowerPC”变体。

Gradle内置支持多个维度以及每个维度中的多个值。您可以在本[机插件参考章节中](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html#native_languages)找到它们的列表。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_source_sets)[声明您的源文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_source_sets)

Gradle的C
++支持使用`ConfigurableFileCollection`直接来自[应用程序](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.language.cpp.CppApplication.html)或[库](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.language.cpp.CppLibrary.html)脚本块的代码来配置要编译的源集。

库区分私有（实现细节）和公共（导出到用户）头。

对于仅在某些目标计算机上编译源的情况，您还可以为每个二进制版本配置源。

![cpp资料集汇编](./构建C ++项目_files/cpp-sourcesets-compilation.png)

图1.源代码和C ++编译

在每个测试套件脚本块上配置测试源。请参阅[测试C
++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)一章。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_dependency_management_overview)[管理你的依赖](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_dependency_management_overview)

绝大多数项目都依赖于其他项目，因此管理项目的依存关系是构建任何项目的重要组成部分。依赖性管理是一个大话题，因此我们在这里仅关注C
++项目的基础知识。如果您想深入了解细节，请查看[依赖管理简介](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)。

Gradle提供了对使用Gradle [
[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnotedef_1
"查看脚注。") ]发布的Maven存储库中的预构建二进制文件的支持。

我们将介绍如何在多构建项目中的项目之间添加依赖项。

为C ++项目指定依赖项需要两条信息：

  * 识别依赖项的信息（项目路径，Maven GAV）

  * 它需要什么，例如编译，链接，运行时或以上所有。

此信息`dependencies {}`在C
++`application`或`library`脚本块的块中指定。例如，要告诉Gradle您的项目需要库`common`来编译和链接您的生产代码，可以使用以下片段：

例子2.声明依赖

`Groovy``Kotlin`

build.gradle

    
    
    application {
        dependencies {
            implementation project(':common')
        }
    }

build.gradle.kts

    
    
    application {
        dependencies {
            implementation(project(":common"))
        }
    }

三个元素的Gradle术语如下：

  * _配置_ （例如：`implementation`）-命名的依赖项集合，针对特定目标（例如，编译或链接模块）分组在一起

  * _项目引用_ （例如：`project(':common')`）-指定路径引用的项目

您可以[在此处](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)找到更全面的依赖项管理术语表。

就配置而言，主要感兴趣的是：

  * `implementation` -用于编译，链接和运行时

  * `cppCompile _Variant_` -对于编译生产代码所必需的依赖关系，但不应该包含在链接或运行时过程中

  * `nativeLink _Variant_` -对于链接代码所必需的依赖关系，但不应该包含在编译或运行时过程中

  * `nativeRuntime _Variant_` -对于运行组件所需的依赖关系，但不应该包含在编译或链接过程中

您可以在本[机插件参考章节中](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html#native_languages)了解有关它们的更多信息以及它们之间的关系。

请注意，[C
++库插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_library_plugin.html)`api`为编译和链接模块以及依赖于该模块的任何模块所需的依赖项创建了一个附加配置。

我们仅在此处进行了介绍，因此，一旦您熟悉使用Gradle构建C
++项目的基础知识，我们建议您阅读[专用的依赖管理章节](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)。

需要进一步阅读的一些常见方案包括：

  * 定义与[Maven兼容](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html#sec:maven_repo)的自定义存储库

  * 使用[变化的版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html#sub:declaring_dependency_with_changing_version)（例如SNAPSHOT）和[动态的](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html#sub:declaring_dependency_with_dynamic_version)（范围）声明依赖项

  * 将同级[项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html#sub:project_dependencies)声明[为依赖项](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html#sub:project_dependencies)

  * [控制传递依赖及其版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)

  * 通过[组合构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html#composite_builds)测试对第三方依赖关系的修复（这是发布到[Maven Local](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html#sub:maven_local)和从[Maven Local](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html#sub:maven_local)消费的更好的替代方法）

您会发现Gradle具有丰富的API用于处理依赖关系-一种需要花费时间才能掌握的API，但对于常见情况而言，它很容易使用。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_compile_link)[编译和链接代码](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_compile_link)

如果遵循以下约定，则编译两个代码都非常容易：

  1. 将您的源代码放在 _src / main / cpp_ 目录下

  2. 在`implementation`配置中声明您的编译依赖性（请参阅上一节）

  3. 运行`assemble`任务

我们建议您尽可能遵循这些约定，但是不必这样做。

有几个自定义选项，您将在下面看到。

__ |
所有[CppCompile](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.language.cpp.tasks.CppCompile.html)任务都是增量的并且可缓存。  
---|---  
  
###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_supported_tool_chain)[支持的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_supported_tool_chain)

Gradle提供了使用不同工具链执行相同构建的功能。当您构建本机二进制文件时，Gradle会尝试找到您的计算机上安装的可以构建二进制文件的工具链。Gradle选择可以为目标操作系统和体系结构构建的第一个工具链。将来，Gradle在选择工具链时将考虑源和ABI兼容性。

Gradle对主要操作系统上的三个主要工具链具有普遍支持：Clang [
[2](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnotedef_2
"查看脚注。") ]，GCC [
[3](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnotedef_3
"查看脚注。") ]和Visual C ++ [
[4](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnotedef_4
"查看脚注。") ]（仅Windows）。据报道，使用Macports和Homebrew安装的GCC和Clang可以正常工作，但是尚未对此进行持续测试。

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#windows)[视窗](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#windows)

要在Windows上构建，请安装兼容版本的Visual Studio。C ++插件将发现Visual
Studio安装并选择最新版本。无需弄乱环境变量或批处理脚本。在Cygwin Shell或Windows命令行中，此功能正常运行。

或者，您可以在GCC中安装Cygwin或MinGW。目前不支持Clang。

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#macos)[苹果系统](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#macos)

要在macOS上构建，您应该安装Xcode。C ++插件将使用系统PATH发现Xcode的安装。

C ++插件还可以与Macports或Homebrew [
[5](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnotedef_5
"查看脚注。") ]一起安装的GCC和Clang一起使用。要使用Macports或Homebrew之一，您需要将Macports /
Homebrew添加到系统PATH。

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#linux)[的Linux](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#linux)

要在Linux上构建，请安装兼容版本的GCC或Clang。C ++插件将使用系统PATH发现GCC或Clang。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:custom_cpp_source_set_paths)[自定义文件和目录位置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:custom_cpp_source_set_paths)

假设您有一个旧版库项目，该项目将 _src_ 目录用于生产代码和专用标头，并 _包含_
用于导出标头的目录。传统的目录结构不起作用，因此您需要告诉Gradle在哪里可以找到源文件和头文件。您可以通过`application`或`library`脚本块执行此操作。

每个组件脚本块以及每个二进制文件都定义了其源代码所在的位置。您可以使用以下语法覆盖约定值：

例子3.设置C ++源集

`Groovy``Kotlin`

build.gradle

    
    
    library {
        source.from file('src')
        privateHeaders.from file('src')
        publicHeaders.from file('include')
    }

build.gradle.kts

    
    
    library {
        source.from(file("src"))
        privateHeaders.from(file("src"))
        publicHeaders.from(file("include"))
    }

现在Gradle将只在 _src中_ 直接搜索源和私有头，在 _include中_ 搜索公共头。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:custom_cpp_compile_link)[更改编译器和链接器选项](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:custom_cpp_compile_link)

大多数的编译器和连接选项是通过相应的任务访问，如，和。这些任务分别为[CppCompile](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.language.cpp.tasks.CppCompile.html)，[LinkSharedLibrary](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.nativeplatform.tasks.LinkSharedLibrary.html)和[CreateStaticLibrary](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.nativeplatform.tasks.CreateStaticLibrary.html)类型。阅读任务参考以获取最新，最全面的选项列表。`compile
_Variant_ Cpp``link _Variant_``create
_Variant_`[](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.language.cpp.tasks.CppCompile.html)[](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.nativeplatform.tasks.LinkSharedLibrary.html)[](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.nativeplatform.tasks.CreateStaticLibrary.html)

例如，如果要更改由编译器为所有变体生成的警告级别，则可以使用以下配置：

示例4.为所有变体设置C ++编译器选项

`Groovy``Kotlin`

build.gradle

    
    
    tasks.withType(CppCompile).configureEach {
        // Define a preprocessor macro for every binary
        macros.put("NDEBUG", null)
    
        // Define a compiler options
        compilerArgs.add '-W3'
    
        // Define toolchain-specific compiler options
        compilerArgs.addAll toolChain.map { toolChain ->
            if (toolChain in [ Gcc, Clang ]) {
                return ['-O2', '-fno-access-control']
            } else if (toolChain in VisualCpp) {
                return ['/Zi']
            }
            return []
        }
    }

build.gradle.kts

    
    
    tasks.withType(CppCompile::class.java).configureEach {
        // Define a preprocessor macro for every binary
        macros.put("NDEBUG", null)
    
        // Define a compiler options
        compilerArgs.add("-W3")
    
        // Define toolchain-specific compiler options
        compilerArgs.addAll(toolChain.map { toolChain ->
            when (toolChain) {
                is Gcc, is Clang -> listOf("-O2", "-fno-access-control")
                is VisualCpp -> listOf("/Zi")
                else -> listOf()
            }
        })
    }

也可以通过`BinaryCollection`on`application`或`library`script块找到特定变体的实例：

例子5.为每个变量设置C ++编译器选项

`Groovy``Kotlin`

build.gradle

    
    
    application {
        binaries.configureEach(CppStaticLibrary) {
            // Define a preprocessor macro for every binary
            compileTask.get().macros.put("NDEBUG", null)
    
            // Define a compiler options
            compileTask.get().compilerArgs.add '-W3'
    
            // Define toolchain-specific compiler options
            if (toolChain in [ Gcc, Clang ]) {
                compileTask.get().compilerArgs.addAll(['-O2', '-fno-access-control'])
            } else if (toolChain in VisualCpp) {
                compileTask.get().compilerArgs.add('/Zi')
            }
        }
    }

build.gradle.kts

    
    
    application {
        binaries.configureEach(CppStaticLibrary::class.java) {
            // Define a preprocessor macro for every binary
            compileTask.get().macros.put("NDEBUG", null)
    
            // Define a compiler options
            compileTask.get().compilerArgs.add("-W3")
    
            // Define toolchain-specific compiler options
            when (toolChain) {
                is Gcc, is Clang -> compileTask.get().compilerArgs.addAll(listOf("-O2", "-fno-access-control"))
                is VisualCpp -> compileTask.get().compilerArgs.add("/Zi")
            }
        }
    }

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:select_cpp_target_machines)[选择目标机器](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:select_cpp_target_machines)

默认情况下，Gradle将尝试为主机操作系统和体系结构创建C
++二进制变体。通过`TargetMachine`在`application`或`library`脚本块上指定的设置，可以覆盖此设置：

例子6.设置目标机器

`Groovy``Kotlin`

build.gradle

    
    
    application {
        targetMachines = [
            machines.linux.x86_64,
            machines.windows.x86, machines.windows.x86_64,
            machines.macOS.x86_64
        ]
    }

build.gradle.kts

    
    
    application {
        targetMachines.set(listOf(machines.windows.x86, machines.windows.x86_64, machines.macOS.x86_64, machines.linux.x86_64))
    }

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_packaging)[包装出版](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cpp_packaging)

在本地环境中，打包和发布C ++项目的方式差异很大。Gradle带有默认值，但是可以实现自定义打包而没有任何问题。

  * 可执行文件直接发布到Maven存储库。

  * 共享库和静态库文件以及公共标头的zip文件直接发布到Maven存储库。

  * 对于应用程序，Gradle还支持在已知位置安装和运行具有所有共享库依赖项的可执行文件。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cleaning_cpp_build)[清理构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:cleaning_cpp_build)

C
++应用程序和库插件`clean`通过使用[基本插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/base_plugin.html)将任务添加到项目中。此任务只是删除`$buildDir`目录中的所有内容，因此为什么要始终将构建生成的文件放在其中。该任务是Delete的一个实例，您可以通过设置其`dir`属性来更改其删除的目录。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_libraries)[构建C
++库](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_libraries)

库项目的独特之处在于它们被其他C
++项目使用（或“消耗”）。这意味着与二进制文件和标头一起发布的依赖元数据（以Gradle模块元数据的形式）至关重要。特别是，库的使用者应能够区分两种不同类型的依赖关系：仅依赖于编译库的依赖关系和也依赖于编译使用者的依赖关系。

Gradle通过[C
++库插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_library_plugin.html)管理此区别，该[插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_library_plugin.html)除了本章介绍的
_实现_ 之外，还引入了 _api_ 配置。如果依赖项的类型显示为静态库的未解析符号或在公共头文件中，则该依赖项通过库的公共API公开，因此应将其添加到
_api_ 配置中。否则，依赖项是内部实现细节，应将其添加到 _Implementation中_ 。 __ __ __

如果不确定API和实现依赖项之间的区别，请参阅[C
++库插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_library_plugin.html#sec:cpp_library_api_vs_implementation)一章的详细说明。另外，您可以在相应的[样本中](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/sample_building_cpp_libraries.html)看到构建C
++库的基本，实际[示例](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/sample_building_cpp_libraries.html)。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_applications)[构建C
++应用程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#sec:building_cpp_applications)

有关更多详细信息，请参见“ [C
++应用程序插件”](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_application_plugin.html)一章，但这是您所获得内容的快速摘要：

  * `install` 创建一个目录，其中包含运行该目录所需的一切

  * Shell和Windows Batch脚本启动应用程序

您可以在相应的[示例中](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/sample_building_cpp_applications.html)看到构建C
++应用程序的基本[示例](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/sample_building_cpp_applications.html)。

* * *

[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnoteref_1)。不幸的是，Conan和Nuget存储库尚不支持作为核心功能

[2](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnoteref_2)。在Mac
OS上随Xcode一起安装

[3](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnoteref_3)。通过Cygwin和MinGW在Windows上安装了32位和64位体系结构

[4](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnoteref_4)。与Visual
Studio 2010一起安装到2019

[5](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html#_footnoteref_5)。GCC和Clang的Macports和Homebrew安装不受官方支持

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./构建C ++项目_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

