# é…ç½®ç¼“å­˜


å†…å®¹

  * [ä»‹ç»](#config_cache:intro)
  * [ä½¿ç”¨é…ç½®ç¼“å­˜](#config_cache:usage)
  * [IDEæ”¯æŒ](#config_cache:ide)
  * [æ”¯æŒçš„æ’ä»¶](#config_cache:plugins)
  * [æ•…éšœæ’é™¤](#config_cache:troubleshooting)
  * [é¢†å…»æ­¥éª¤](#config_cache:adoption)
  * [æµ‹è¯•æ‚¨çš„æ„å»ºé€»è¾‘](#config_cache:testing)
  * [è¦æ±‚](#config_cache:requirements)
  * [å°šæœªå®ç°](#config_cache:not_yet_implemented)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é…ç½®ç¼“å­˜æ˜¯ä¸€ä¸ª[å­µåŒ–](https://docs.gradle.org/6.7.1/userguide/feature_lifecycle.html#feature_lifecycle)åŠŸèƒ½ï¼Œæ­¤å¤„æè¿°çš„è¯¦ç»†ä¿¡æ¯å¯èƒ½ä¼šæ›´æ”¹ã€‚  
  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
## [](#config_cache:intro)[ä»‹ç»](#config_cache:intro)

é…ç½®ç¼“å­˜æ˜¯ä¸€é¡¹åŠŸèƒ½ï¼Œå¯é€šè¿‡ç¼“å­˜[é…ç½®é˜¶æ®µ](https://docs.gradle.org/6.7.1/userguide/build_lifecycle.html#build_lifecycle)çš„ç»“æœå¹¶å°†å…¶é‡æ–°ç”¨äºä»¥åçš„æ„å»ºï¼Œä»è€Œæ˜¾ç€æé«˜æ„å»ºæ€§èƒ½ã€‚ä½¿ç”¨é…ç½®ç¼“å­˜ï¼ŒGradleå¯ä»¥åœ¨æ²¡æœ‰å½±å“æ„å»ºé…ç½®çš„ä»»ä½•å†…å®¹ï¼ˆä¾‹å¦‚æ„å»ºè„šæœ¬ï¼‰å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹å®Œå…¨è·³è¿‡é…ç½®é˜¶æ®µã€‚Gradleè¿˜å¯¹ä»»åŠ¡æ‰§è¡Œåº”ç”¨äº†ä¸€äº›æ€§èƒ½æ”¹è¿›ã€‚

é…ç½®ç¼“å­˜åœ¨æ¦‚å¿µä¸Šä¸[æ„å»ºç¼“å­˜](https://docs.gradle.org/6.7.1/userguide/build_cache.html#build_cache)ç±»ä¼¼ï¼Œä½†æ˜¯ç¼“å­˜ä¸åŒçš„ä¿¡æ¯ã€‚æ„å»ºç¼“å­˜è´Ÿè´£ç¼“å­˜æ„å»ºçš„è¾“å‡ºå’Œä¸­é—´æ–‡ä»¶ï¼Œä¾‹å¦‚ä»»åŠ¡è¾“å‡ºæˆ–å·¥ä»¶è½¬æ¢è¾“å‡ºã€‚é…ç½®ç¼“å­˜è´Ÿè´£ä¸ºç‰¹å®šä»»åŠ¡é›†ç¼“å­˜æ„å»ºé…ç½®ã€‚æ¢å¥è¯è¯´ï¼Œé…ç½®ç¼“å­˜ç¼“å­˜é…ç½®é˜¶æ®µçš„è¾“å‡ºï¼Œè€Œæ„å»ºç¼“å­˜ç¼“å­˜æ‰§è¡Œé˜¶æ®µçš„è¾“å‡ºã€‚

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ­¤åŠŸèƒ½ç›®å‰å¤„äº ** _é«˜åº¦è¯•éªŒé˜¶æ®µ_** ï¼Œé»˜è®¤æƒ…å†µä¸‹æœªå¯ç”¨ã€‚

å¹¶éæ‰€æœ‰[æ ¸å¿ƒGradleæ’ä»¶](#config_cache:plugins:core)éƒ½å—æ”¯æŒã€‚æ‚¨çš„å†…éƒ¨ç‰ˆæœ¬å’Œæ‰€ä¾èµ–çš„æ’ä»¶å¯èƒ½éœ€è¦æ›´æ”¹æ‰èƒ½æ»¡è¶³[è¦æ±‚](#config_cache:requirements)ã€‚ä¸€äº›GradleåŠŸèƒ½[å°šæœªå®ç°](#config_cache:not_yet_implemented)ã€‚å°šæœªé€šè¿‡é…ç½®ç¼“å­˜æ”¹è¿›åœ¨IDEä¸­å¯¼å…¥å’ŒåŒæ­¥Gradleæ„å»ºã€‚  
  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
### [](#config_cache:intro:how_does_it_work)[å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ](#config_cache:intro:how_does_it_work)

å¯ç”¨é…ç½®ç¼“å­˜åï¼Œå¦‚æœæ‚¨é’ˆå¯¹ç‰¹å®šçš„ä»»åŠ¡é›†è¿è¡ŒGradleï¼ˆä¾‹å¦‚é€šè¿‡è¿è¡Œï¼‰`gradlew
check`ï¼Œåˆ™Gradleä¼šæ£€æŸ¥é…ç½®ç¼“å­˜æ¡ç›®æ˜¯å¦å¯ç”¨äºè¯·æ±‚çš„ä»»åŠ¡é›†ã€‚å¦‚æœå¯ç”¨ï¼ŒGradleå°†ä½¿ç”¨è¯¥æ¡ç›®è€Œä¸æ˜¯è¿è¡Œé…ç½®é˜¶æ®µã€‚ç¼“å­˜æ¡ç›®åŒ…å«æœ‰å…³è¦è¿è¡Œçš„ä»»åŠ¡é›†çš„ä¿¡æ¯ï¼Œä»¥åŠå®ƒä»¬çš„é…ç½®å’Œç›¸å…³æ€§ä¿¡æ¯ã€‚

é¦–æ¬¡è¿è¡Œç‰¹å®šä»»åŠ¡é›†æ—¶ï¼Œé…ç½®é«˜é€Ÿç¼“å­˜ä¸­å°†æ²¡æœ‰è¿™äº›ä»»åŠ¡çš„æ¡ç›®ï¼Œå› æ­¤Gradleå°†ç…§å¸¸è¿è¡Œé…ç½®é˜¶æ®µï¼š

  1. è¿è¡Œåˆå§‹åŒ–è„šæœ¬ã€‚

  2. åº”ç”¨æ‰€æœ‰è¯·æ±‚çš„è®¾ç½®æ’ä»¶ï¼Œè¿è¡Œæ„å»ºçš„è®¾ç½®è„šæœ¬ã€‚

  3. é…ç½®å¹¶æ„å»º`buildSrc`é¡¹ç›®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

  4. åº”ç”¨ä»»ä½•è¯·æ±‚çš„é¡¹ç›®æ’ä»¶ï¼Œè¿è¡Œæ„å»ºçš„æ„å»ºè„šæœ¬ã€‚

  5. è®¡ç®—è¯·æ±‚çš„ä»»åŠ¡çš„ä»»åŠ¡å›¾ï¼Œå¹¶è¿è¡Œæ‰€æœ‰å»¶è¿Ÿçš„é…ç½®æ“ä½œã€‚

åœ¨é…ç½®é˜¶æ®µä¹‹åï¼ŒGradleå°†ä»»åŠ¡å›¾çš„çŠ¶æ€å†™å…¥é…ç½®ç¼“å­˜ï¼Œå¹¶ä¸ºä»¥åçš„Gradleè°ƒç”¨åˆ›å»ºå¿«ç…§ã€‚ç„¶åæ‰§è¡Œé˜¶æ®µå°†æ­£å¸¸è¿è¡Œã€‚è¿™æ„å‘³ç€æ‚¨ç¬¬ä¸€æ¬¡è¿è¡Œç‰¹å®šä»»åŠ¡é›†æ—¶å°†çœ‹ä¸åˆ°ä»»ä½•æ„å»ºæ€§èƒ½çš„æé«˜ã€‚

å½“æ‚¨éšåä½¿ç”¨ç›¸åŒçš„ä»»åŠ¡é›†ï¼ˆä¾‹å¦‚`gradlew
check`å†æ¬¡è¿è¡Œï¼‰è¿è¡ŒGradleæ—¶ï¼ŒGradleå°†ç›´æ¥ä»é…ç½®ç¼“å­˜ä¸­åŠ è½½ä»»åŠ¡åŠå…¶é…ç½®ï¼Œå¹¶å®Œå…¨è·³è¿‡é…ç½®é˜¶æ®µã€‚åœ¨ä½¿ç”¨é…ç½®ç¼“å­˜æ¡ç›®ä¹‹å‰ï¼ŒGradleä¼šæ£€æŸ¥è¯¥æ¡ç›®çš„â€œæ„å»ºé…ç½®è¾“å…¥â€ï¼ˆä¾‹å¦‚æ„å»ºè„šæœ¬ï¼‰æ˜¯å¦éƒ½æœªæ›´æ”¹ã€‚å¦‚æœæ„å»ºé…ç½®è¾“å…¥å·²æ›´æ”¹ï¼Œåˆ™Gradleå°†ä¸ä½¿ç”¨è¯¥æ¡ç›®ï¼Œå¹¶å°†å¦‚ä¸Šæ‰€è¿°å†æ¬¡è¿è¡Œé…ç½®é˜¶æ®µï¼Œä¿å­˜ç»“æœä¾›ä»¥åé‡ç”¨ã€‚

æ„å»ºé…ç½®è¾“å…¥åŒ…æ‹¬ï¼š

  * åˆå§‹åŒ–è„šæœ¬ï¼Œè®¾ç½®è„šæœ¬ï¼Œæ„å»ºè„šæœ¬ã€‚

  * åœ¨é…ç½®é˜¶æ®µä½¿ç”¨çš„ç³»ç»Ÿå±æ€§ï¼ŒGradleå±æ€§å’Œé…ç½®æ–‡ä»¶ï¼Œå¯é€šè¿‡å€¼æä¾›è€…ï¼ˆä¾‹å¦‚å±æ€§ï¼Œç¯å¢ƒå˜é‡çš„æä¾›è€…ï¼‰è¿›è¡Œè®¿é—®...

  * `buildSrc` æ„å»ºé…ç½®è¾“å…¥å’Œæºæ–‡ä»¶ã€‚

### [](#config_cache:intro:performance_improvements)[æ€§èƒ½æå‡](#config_cache:intro:performance_improvements)

é™¤äº†è·³è¿‡é…ç½®é˜¶æ®µä¹‹å¤–ï¼Œé…ç½®ç¼“å­˜è¿˜æä¾›äº†å…¶ä»–ä¸€äº›æ€§èƒ½æ”¹è¿›ï¼š

  * é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä»»åŠ¡å¹¶è¡Œè¿è¡Œã€‚

  * ä¾èµ–å…³ç³»è§£æè¢«ç¼“å­˜ã€‚

### [](#config_cache:in_action)[è¿›è¡Œé…ç½®ç¼“å­˜](#config_cache:in_action)

![è¿è¡Œå¸®åŠ©](img/running-help.gif)

## [](#config_cache:usage)[ä½¿ç”¨é…ç½®ç¼“å­˜](#config_cache:usage)

å»ºè®®ä»æœ€ç®€å•çš„ä»»åŠ¡è°ƒç”¨å…¥æ‰‹ã€‚`help`åœ¨å¯ç”¨é…ç½®ç¼“å­˜çš„æƒ…å†µä¸‹è¿è¡Œæ˜¯ä¸€ä¸ªä¸é”™çš„ç¬¬ä¸€æ­¥ï¼š

    
    
    â¯ gradle --configuration-cache help
    Calculating task graph as no configuration cache is available for tasks: help
    ...
    BUILD SUCCESSFUL in 4s
    1 actionable task: 1 executed
    Configuration cache entry stored.

é¦–æ¬¡è¿è¡Œæ­¤å‘½ä»¤ï¼Œå°†æ‰§è¡Œé…ç½®é˜¶æ®µï¼Œè®¡ç®—ä»»åŠ¡å›¾ã€‚

ç„¶åï¼Œå†æ¬¡è¿è¡Œç›¸åŒçš„å‘½ä»¤ã€‚è¿™å°†é‡ç”¨ç¼“å­˜çš„é…ç½®ï¼š

    
    
    â¯ gradle --configuration-cache help
    Reusing configuration cache.
    ...
    BUILD SUCCESSFUL in 500ms
    1 actionable task: 1 executed
    Configuration cache entry reused.

ç¥è´ºæ‚¨ï¼Œå¦‚æœç¼–è¯‘æˆåŠŸï¼Œæ‚¨ç°åœ¨å¯ä»¥å°è¯•æ‰§è¡Œæ›´å¤šæœ‰ç”¨çš„ä»»åŠ¡ã€‚æ‚¨åº”è¯¥é’ˆå¯¹æ‚¨çš„å¼€å‘å¾ªç¯ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯åœ¨è¿›è¡Œå¢é‡æ›´æ”¹åè¿è¡Œæµ‹è¯•ã€‚

å¦‚æœåœ¨ç¼“å­˜æˆ–é‡ç”¨é…ç½®æ—¶å‘ç°ä»»ä½•é—®é¢˜ï¼Œåˆ™ä¼šç”ŸæˆHTMLæŠ¥å‘Šæ¥å¸®åŠ©æ‚¨è¯Šæ–­å’Œè§£å†³é—®é¢˜ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä¸‹é¢çš„â€œ[æ•…éšœæ’é™¤â€](#config_cache:troubleshooting)éƒ¨åˆ†ã€‚

ç»§ç»­é˜…è¯»ä»¥äº†è§£å¦‚ä½•è°ƒæ•´é…ç½®ç¼“å­˜ï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶æ‰‹åŠ¨ä½¿çŠ¶æ€æ— æ•ˆï¼Œå¹¶ä½¿ç”¨IDEä¸­çš„é…ç½®ç¼“å­˜ã€‚

### [](#config_cache:usage:enable)[å¯ç”¨é…ç½®ç¼“å­˜](#config_cache:usage:enable)

é»˜è®¤æƒ…å†µä¸‹ï¼Œæœªå¯ç”¨é…ç½®ç¼“å­˜ã€‚å¯ä»¥ä»å‘½ä»¤è¡Œå¯ç”¨å®ƒï¼š

    
    
    â¯ gradle --configuration-cache

ä¹Ÿå¯ä»¥åœ¨`gradle.properties`æ–‡ä»¶ä¸­æ°¸ä¹…å¯ç”¨å®ƒï¼š

    
    
    org.gradle.unsafe.configuration-cache=true

å¦‚æœåœ¨`gradle.properties`æ–‡ä»¶ä¸­å¯ç”¨äº†æ­¤åŠŸèƒ½ï¼Œåˆ™å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç¦ç”¨ä¸€æ¬¡æ„å»ºè°ƒç”¨ï¼š

    
    
    â¯gradle --no-configuration-cache

### [](#config_cache:usage:ignore_problems)[å¿½ç•¥é—®é¢˜](#config_cache:usage:ignore_problems)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœé‡åˆ°ä»»ä½•é…ç½®ç¼“å­˜é—®é¢˜ï¼ŒGradleå°†ä½¿æ„å»ºå¤±è´¥ã€‚åœ¨é€æ­¥æ”¹è¿›æ’ä»¶æˆ–æ„å»ºé€»è¾‘ä»¥æ”¯æŒé…ç½®ç¼“å­˜æ—¶ï¼Œå°†é—®é¢˜æš‚æ—¶å˜ä¸ºè­¦å‘Šä¼šå¾ˆæœ‰ç”¨ã€‚

å¯ä»¥ä»å‘½ä»¤è¡Œå®Œæˆï¼š

    
    
    â¯gradle --configuration-cache-problems =warn

æˆ–åœ¨`gradle.properties`æ–‡ä»¶ä¸­ï¼š

    
    
    org.gradle.unsafe.configuration-cache-problems=warn

### [](#config_cache:usage:max_problems)[å…è®¸æœ€å¤§æ•°é‡çš„é—®é¢˜](#config_cache:usage:max_problems)

å½“é…ç½®ç¼“å­˜é—®é¢˜å˜æˆè­¦å‘Šæ—¶ï¼Œå¦‚æœ`512`é»˜è®¤æƒ…å†µä¸‹å‘ç°é—®é¢˜ï¼ŒGradleå°†ä½¿æ„å»ºå¤±è´¥ã€‚

å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šå…è®¸çš„æœ€å¤§é—®é¢˜æ•°æ¥è¿›è¡Œè°ƒæ•´ï¼š

    
    
    â¯gradle -Dorg.gradle.unsafe.configuration-cache.max-problems = 5

æˆ–åœ¨`gradle.properties`æ–‡ä»¶ä¸­ï¼š

    
    
    org.gradle.unsafe.configuration-cache.max-problems=5

### [](#config_cache:usage:invalidate)[ä½¿ç¼“å­˜æ— æ•ˆ](#config_cache:usage:invalidate)

å½“é…ç½®é˜¶æ®µçš„è¾“å…¥å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œé…ç½®ç¼“å­˜å°†è‡ªåŠ¨å¤±æ•ˆã€‚ä½†æ˜¯ï¼ŒæŸäº›è¾“å…¥å°šæœªè¢«è·Ÿè¸ªï¼Œå› æ­¤å½“æœªè·Ÿè¸ªåˆ°é…ç½®é˜¶æ®µçš„è¾“å…¥å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œæ‚¨å¯èƒ½å¿…é¡»æ‰‹åŠ¨ä½¿é…ç½®ç¼“å­˜æ— æ•ˆã€‚å¦‚æœæ‚¨[å¿½ç•¥é—®é¢˜ï¼Œ](#config_cache:usage:ignore_problems)å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä¸‹é¢çš„â€œ[éœ€æ±‚](#config_cache:requirements)å’Œ[å°šæœªå®ç°â€](#config_cache:not_yet_implemented)éƒ¨åˆ†ã€‚

é…ç½®ç¼“å­˜çŠ¶æ€å­˜å‚¨åœ¨ç£ç›˜ä¸Š`.gradle/configuration-
cache`ä½¿ç”¨çš„Gradleæ„å»ºçš„æ ¹ç›®å½•ä¸­å‘½åçš„ç›®å½•ä¸­ã€‚å¦‚æœæ‚¨éœ€è¦ä½¿ç¼“å­˜æ— æ•ˆï¼Œåªéœ€åˆ é™¤è¯¥ç›®å½•ï¼š

    
    
    â¯rm -rf .gradle/configuration-cache

å®šæœŸï¼ˆæœ€å¤šæ¯24å°æ—¶ï¼‰æ£€æŸ¥é…ç½®ç¼“å­˜é¡¹æ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ã€‚å¦‚æœ7å¤©æœªä½¿ç”¨å®ƒä»¬ï¼Œåˆ™å°†å…¶åˆ é™¤ã€‚

## [](#config_cache:ide)[IDEæ”¯æŒ](#config_cache:ide)

å¦‚æœæ‚¨ä»`gradle.properties`æ–‡ä»¶å¯ç”¨å¹¶é…ç½®é…ç½®ç¼“å­˜ï¼Œé‚£ä¹ˆå½“æ‚¨çš„IDEå§”æ‰˜ç»™Gradleæ—¶ï¼Œå°†å¯ç”¨é…ç½®ç¼“å­˜ã€‚æ²¡ä»€ä¹ˆå¯åšçš„äº†ã€‚

`gradle.properties`é€šå¸¸åœ¨æºä»£ç ç®¡ç†ä¸­æ£€æŸ¥ã€‚å¦‚æœæ‚¨ä¸æƒ³ä¸ºæ•´ä¸ªå›¢é˜Ÿå¯ç”¨é…ç½®ç¼“å­˜ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä»…ä»IDEä¸­å¯ç”¨é…ç½®ç¼“å­˜ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚

è¯·æ³¨æ„ï¼Œä»IDEåŒæ­¥å†…éƒ¨ç‰ˆæœ¬ä¸ä¼šä»é…ç½®ç¼“å­˜ä¸­å—ç›Šï¼Œåªæœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ä¼šå—ç›Šã€‚

### [](#config_cache:ide:intellij)[åŸºäºIntelliJçš„IDE](#config_cache:ide:intellij)

åœ¨IntelliJ IDEAæˆ–Android Studioä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®Œæˆï¼Œæ— è®ºæ˜¯å…¨å±€é…ç½®è¿˜æ˜¯æ¯æ¬¡è¿è¡Œé…ç½®ã€‚

è¦åœ¨æ•´ä¸ªæ„å»ºä¸­å¯ç”¨å®ƒï¼Œè¯·è½¬åˆ°`Run > Edit configurationsâ€¦â€‹`ã€‚è¿™å°†æ‰“å¼€IntelliJ IDEAæˆ–Android
Studioå¯¹è¯æ¡†æ¥é…ç½®è¿è¡Œ/è°ƒè¯•é…ç½®ã€‚é€‰æ‹©`Templates > Gradle`å¹¶å°†å¿…è¦çš„ç³»ç»Ÿå±æ€§æ·»åŠ åˆ°è¯¥`VM options`å­—æ®µã€‚

ä¾‹å¦‚ï¼Œè¦å¯ç”¨é…ç½®ç¼“å­˜ï¼Œå°†é—®é¢˜å˜æˆè­¦å‘Šï¼Œè¯·æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

    
    
    -Dorg.gradle.unsafe.configuration-cache = true -Dorg.gradle.unsafe.configuration-cache-problems =warn

æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä»…é’ˆå¯¹ç»™å®šçš„è¿è¡Œé…ç½®å¯ç”¨å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ä¿æŒ`Templates > Gradle`é…ç½®ä¸å˜ï¼Œå¹¶æ ¹æ®éœ€è¦ç¼–è¾‘æ¯ä¸ªè¿è¡Œé…ç½®ã€‚

ç»“åˆè¿™ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥å…¨å±€å¯ç”¨å’Œç¦ç”¨æŸäº›è¿è¡Œé…ç½®ï¼Œæˆ–è€…ç›¸åã€‚

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ‚¨å¯ä»¥ä½¿ç”¨[gradle-idea-ext-plugin](https://github.com/JetBrains/gradle-idea-ext-
plugin)ä»æ„å»ºä¸­é…ç½®IntelliJè¿è¡Œé…ç½®ã€‚è¿™æ˜¯ä»…ä¸ºIDEå¯ç”¨é…ç½®ç¼“å­˜çš„å¥½æ–¹æ³•ã€‚  
  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
### [](#config_cache:ide:eclipse)[Eclipse
IDE](#config_cache:ide:eclipse)

åœ¨Eclipse IDEä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡Buildshipä»¥ä¸¤ç§æ–¹å¼å¯ç”¨å’Œé…ç½®é…ç½®ç¼“å­˜ï¼Œå³å…¨å±€é…ç½®æˆ–æ¯æ¬¡è¿è¡Œé…ç½®ã€‚

è¦å…¨å±€å¯ç”¨å®ƒï¼Œè¯·è½¬åˆ°`Preferences >
Gradle`ã€‚æ‚¨å¯ä»¥å°†ä¸Šè¿°å±æ€§ç”¨ä½œç³»ç»Ÿå±æ€§ã€‚ä¾‹å¦‚ï¼Œè¦å¯ç”¨é…ç½®ç¼“å­˜ï¼Œå°†é—®é¢˜è½¬å˜ä¸ºè­¦å‘Šï¼Œè¯·æ·»åŠ ä»¥ä¸‹JVMå‚æ•°ï¼š

  * `-Dorg.gradle.unsafe.configuration-cache=true`

  * `-Dorg.gradle.unsafe.configuration-cache-problems=warn`

è¦ä¸ºç»™å®šçš„è¿è¡Œé…ç½®å¯ç”¨å®ƒï¼Œè¯·è½¬åˆ°`Run configurationsâ€¦â€‹`ï¼Œæ‰¾åˆ°è¦æ›´æ”¹çš„é…ç½®ï¼Œè½¬åˆ°`Project
Settings`ï¼Œå‹¾é€‰`Override project settings`å¤é€‰æ¡†å¹¶æ·»åŠ ä¸ç›¸åŒçš„ç³»ç»Ÿå±æ€§`JVM argument`ã€‚

ç»“åˆè¿™ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥å…¨å±€å¯ç”¨å’Œç¦ç”¨æŸäº›è¿è¡Œé…ç½®ï¼Œæˆ–è€…ç›¸åã€‚

## [](#config_cache:plugins)[æ”¯æŒçš„æ’ä»¶](#config_cache:plugins)

é…ç½®ç¼“å­˜æ˜¯å…¨æ–°çš„ï¼Œå¹¶å¼•å…¥äº†æ’ä»¶å®ç°çš„æ–°è¦æ±‚ã€‚ç»“æœï¼Œæ ¸å¿ƒGradleæ’ä»¶å’Œç¤¾åŒºæ’ä»¶éƒ½éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚æœ¬èŠ‚æä¾›æœ‰å…³[Gradleæ ¸å¿ƒæ’ä»¶](#config_cache:plugins:core)å’Œ[ç¤¾åŒºæ’ä»¶](#config_cache:plugins:community)å½“å‰æ”¯æŒçš„ä¿¡æ¯ã€‚

### [](#config_cache:plugins:core)[Core
Gradleæ’ä»¶](#config_cache:plugins:core)
å¹¶éæ‰€æœ‰çš„[Gradleæ ¸å¿ƒæ’ä»¶éƒ½](https://docs.gradle.org/6.7.1/userguide/plugin_reference.html#plugin_reference)æ”¯æŒé…ç½®ç¼“å­˜ã€‚

JVM languages and frameworks

|

Native languages

|

Packaging and distribution   
  
---|---|---  
  
|  [âœ“](https://github.com/gradle/gradle/issues/13455) |

[Java](https://docs.gradle.org/6.7.1/userguide/java_plugin.html#java_plugin)  
  
---|---  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[Java
Library](https://docs.gradle.org/6.7.1/userguide/java_library_plugin.html#java_library_plugin)  
  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[Java
Platform](https://docs.gradle.org/6.7.1/userguide/java_platform_plugin.html#java_platform_plugin)  
  
[âš ](https://github.com/gradle/gradle/issues/13460) |

[Groovy](https://docs.gradle.org/6.7.1/userguide/groovy_plugin.html#groovy_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13461) |

[Scala](https://docs.gradle.org/6.7.1/userguide/scala_plugin.html#scala_plugin)  
  
[âš ](https://github.com/gradle/gradle/issues/13462) |

[ANTLR](https://docs.gradle.org/6.7.1/userguide/antlr_plugin.html#antlr_plugin)  
  
|  [âœ–](https://github.com/gradle/gradle/issues/13484) |

[C++
Application](https://docs.gradle.org/6.7.1/userguide/cpp_application_plugin.html#cpp_application_plugin)  
  
---|---  
[âœ–](https://github.com/gradle/gradle/issues/13485) |

[C++
Library](https://docs.gradle.org/6.7.1/userguide/cpp_library_plugin.html#cpp_library_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13514) |

[C++ Unit
Test](https://docs.gradle.org/6.7.1/userguide/cpp_unit_test_plugin.html#cpp_unit_test_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13515) |

[Swift
Application](https://docs.gradle.org/6.7.1/userguide/swift_application_plugin.html#swift_application_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13487) |

[Swift
Library](https://docs.gradle.org/6.7.1/userguide/swift_library_plugin.html#swift_library_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13488) |

[XCTest](https://docs.gradle.org/6.7.1/userguide/xctest_plugin.html#xctest_plugin)  
  
|  [âœ“](https://github.com/gradle/gradle/issues/13455) |

[Application](https://docs.gradle.org/6.7.1/userguide/application_plugin.html#application_plugin)  
  
---|---  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[WAR](https://docs.gradle.org/6.7.1/userguide/war_plugin.html#war_plugin)  
  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[EAR](https://docs.gradle.org/6.7.1/userguide/ear_plugin.html#ear_plugin)  
  
[âš ](https://github.com/gradle/gradle/issues/13468) |

[Maven
Publish](https://docs.gradle.org/6.7.1/userguide/publishing_maven.html#publishing_maven)  
  
[âœ–](https://github.com/gradle/gradle/issues/13469) |

[Ivy
Publish](https://docs.gradle.org/6.7.1/userguide/publishing_ivy.html#publishing_ivy)  
  
ğŸš« |

[Legacy Maven
Plugin](https://docs.gradle.org/6.7.1/userguide/maven_plugin.html#maven_plugin)  
  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[Distribution](https://docs.gradle.org/6.7.1/userguide/distribution_plugin.html#distribution_plugin)  
  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[Java Library
Distribution](https://docs.gradle.org/6.7.1/userguide/java_library_distribution_plugin.html#java_library_distribution_plugin)  
  
 Code analysis

|

 IDE integration

|

Utility  
  
|  [âœ–](https://github.com/gradle/gradle/issues/13475) |

[Checkstyle](https://docs.gradle.org/6.7.1/userguide/checkstyle_plugin.html#checkstyle_plugin)  
  
---|---  
[âœ–](https://github.com/gradle/gradle/issues/13476) |

[PMD](https://docs.gradle.org/6.7.1/userguide/pmd_plugin.html#pmd_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13477) |

[JaCoCo](https://docs.gradle.org/6.7.1/userguide/jacoco_plugin.html#jacoco_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13478) |

[CodeNarc](https://docs.gradle.org/6.7.1/userguide/codenarc_plugin.html#codenarc_plugin)  
  
|  [âœ–](https://github.com/gradle/gradle/issues/13479) |

[Eclipse](https://docs.gradle.org/6.7.1/userguide/eclipse_plugin.html#eclipse_plugin)  
  
---|---  
[âœ–](https://github.com/gradle/gradle/issues/13480) |

[IntelliJ
IDEA](https://docs.gradle.org/6.7.1/userguide/idea_plugin.html#idea_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13482) |

[Visual
Studio](https://docs.gradle.org/6.7.1/userguide/visual_studio_plugin.html#visual_studio_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13483) |

[Xcode](https://docs.gradle.org/6.7.1/userguide/xcode_plugin.html#xcode_plugin)  
  
|  [âœ“](https://github.com/gradle/gradle/issues/13455) |

[Base](https://docs.gradle.org/6.7.1/userguide/base_plugin.html#base_plugin)  
  
---|---  
[âš ](https://github.com/gradle/gradle/issues/13466) |

[Build
Init](https://docs.gradle.org/6.7.1/userguide/build_init_plugin.html#build_init_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13470) |

[Signing](https://docs.gradle.org/6.7.1/userguide/signing_plugin.html#signing_plugin)  
  
[âœ“](https://github.com/gradle/gradle/issues/13455) |

[Java Plugin
Development](https://docs.gradle.org/6.7.1/userguide/java_gradle_plugin.html#java_gradle_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13472) |

[Groovy DSL Plugin
Development](https://docs.gradle.org/6.7.1/userguide/custom_plugins.html#sec:precompiled_plugins)  
  
[âœ–](https://github.com/gradle/gradle/issues/13472) |

[Kotlin DSL Plugin
Development](https://docs.gradle.org/6.7.1/userguide/kotlin_dsl.html#sec:kotlin-
dsl_plugin)  
  
[âœ–](https://github.com/gradle/gradle/issues/13473) |

[Project Report
Plugin](https://docs.gradle.org/6.7.1/userguide/project_report_plugin.html#project_report_plugin)  
  
  
âœ“ |

æ”¯æŒçš„æ’ä»¶  
  
---|---
âš  |

éƒ¨åˆ†å—æ”¯æŒçš„æ’ä»¶  
  
âœ– |

ä¸æ”¯æŒçš„æ’ä»¶  
  
ğŸš« |

ä¸ä¼šå¤„ç†  
  
### [](#config_cache:plugins:community)[ç¤¾åŒºæ’ä»¶](#config_cache:plugins:community)

è¯·å‚é˜…é—®é¢˜[gradle /
gradleï¼ƒ13490](https://github.com/gradle/gradle/issues/13490)äº†è§£ç¤¾åŒºæ’ä»¶çš„çŠ¶æ€ã€‚

## [](#config_cache:troubleshooting)[æ•…éšœæ’é™¤](#config_cache:troubleshooting)

ä»¥ä¸‹å„èŠ‚å°†ä»‹ç»ä¸€äº›æœ‰å…³å¤„ç†é…ç½®ç¼“å­˜é—®é¢˜çš„ä¸€èˆ¬å‡†åˆ™ã€‚è¿™é€‚ç”¨äºæ‚¨çš„æ„å»ºé€»è¾‘å’ŒGradleæ’ä»¶ã€‚

å¦‚æœæ— æ³•åºåˆ—â€‹â€‹åŒ–è¿è¡Œä»»åŠ¡æ‰€éœ€çš„çŠ¶æ€ï¼Œåˆ™ä¼šç”Ÿæˆæ£€æµ‹åˆ°é—®é¢˜çš„HTMLæŠ¥å‘Šã€‚Gradleæ•…éšœè¾“å‡ºåŒ…æ‹¬æŒ‡å‘è¯¥æŠ¥å‘Šçš„å¯å•å‡»é“¾æ¥ã€‚æ­¤æŠ¥å‘Šéå¸¸æœ‰ç”¨ï¼Œå¯è®©æ‚¨æ·±å…¥åˆ†æé—®é¢˜ï¼Œäº†è§£å¯¼è‡´é—®é¢˜çš„åŸå› ã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ„å»ºè„šæœ¬ï¼Œå…¶ä¸­åŒ…å«å‡ ä¸ªé—®é¢˜ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    tasks.register('someTask') {
        def destination = System.getProperty('someDestination') __**( 1)**
        inputs.dir('source')
        outputs.dir(destination)
        doLast {
            project.copy { __**( 2)**
                from 'source'
                into destination
            }
        }
    }

build.gradle.kts

    
    
    tasks.register("someTask") {
        val destination = System.getProperty("someDestination") __**( 1)**
        inputs.dir("source")
        outputs.dir(destination)
        doLast {
            project.copy { __**( 2)**
                from("source")
                into(destination)
            }
        }
    }

â‘  [åœ¨é…ç½®æ—¶è¯»å–æœªå£°æ˜çš„ç³»ç»Ÿå±æ€§](#config_cache:requirements:undeclared_sys_prop_read)  

â‘¡ [`Project`åœ¨æ‰§è¡Œæ—¶ä½¿ç”¨å¯¹è±¡](#config_cache:requirements:use_project_during_execution)  
  
è¿è¡Œè¯¥ä»»åŠ¡å¤±è´¥ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­æ‰“å°ä»¥ä¸‹å†…å®¹ï¼š

    
    
      â¯ gradle --configuration-cache someTask -DsomeDestination=dest
      ...
      * What went wrong:
      Configuration cache problems found in this build.
      
      2 problems were found storing the configuration cache.
      - Build file 'build.gradle': read system property 'someDestination'
        See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read
      - Build file 'build.gradle': invocation of 'Task.project' at execution time is unsupported.
        See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution
      
      See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/<hash>/configuration-cache-report.html
      > Read system property 'someDestination'
      > Invocation of 'Task.project' by task ':someTask' at execution time is unsupported.
      
      * Try:
      Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
      
      * Get more help at https://help.gradle.org
      
      BUILD FAILED in 0s
      1 actionable task: 1 executed
      Configuration cache entry discarded with 2 problems.

ç”±äºå‘ç°é—®é¢˜æ„å»ºå¤±è´¥ï¼Œé…ç½®ç¼“å­˜æ¡ç›®è¢«ä¸¢å¼ƒã€‚

å¯ä»¥åœ¨é“¾æ¥çš„HTMLæŠ¥å‘Šä¸­æ‰¾åˆ°è¯¦ç»†ä¿¡æ¯ï¼š

![é—®é¢˜æŠ¥å‘Š](img/problems-report.png)

è¯¥æŠ¥å‘Šä¸¤æ¬¡æ˜¾ç¤ºé—®é¢˜é›†ã€‚é¦–å…ˆæŒ‰é—®é¢˜æ¶ˆæ¯åˆ†ç»„ï¼Œç„¶åæŒ‰ä»»åŠ¡åˆ†ç»„ã€‚å‰è€…ä½¿æ‚¨å¯ä»¥å¿«é€ŸæŸ¥çœ‹æ„å»ºæ‰€é¢ä¸´çš„é—®é¢˜ç±»åˆ«ã€‚åè€…ä½¿æ‚¨å¯ä»¥å¿«é€ŸæŸ¥çœ‹å“ªäº›ä»»åŠ¡æœ‰é—®é¢˜ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å¯ä»¥å±•å¼€æ ‘ä»¥å‘ç°ç½ªé­ç¥¸é¦–åœ¨å¯¹è±¡å›¾ä¸­çš„ä½ç½®ã€‚

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æŠ¥å‘Šä¸­æ˜¾ç¤ºçš„é—®é¢˜å…·æœ‰æŒ‡å‘ç›¸åº”[è¦æ±‚çš„](#config_cache:requirements)é“¾æ¥ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°æœ‰å…³è§£å†³é—®é¢˜çš„æŒ‡å—æˆ–[å°šæœªå®ç°](#config_cache:not_yet_implemented)çš„ç›¸åº”åŠŸèƒ½ã€‚

åœ¨æ›´æ”¹æ„å»ºæˆ–æ’ä»¶ä»¥è§£å†³é—®é¢˜æ—¶ï¼Œåº”è€ƒè™‘[ä½¿ç”¨TestKitæµ‹è¯•æ„å»ºé€»è¾‘](#config_cache:testing)ã€‚  
  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
åœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯ä»¥å†³å®š[å°†é—®é¢˜å˜æˆè­¦å‘Šï¼Œ](#config_cache:usage:ignore_problems)ç„¶åç»§ç»­æ¢ç´¢æ„å»ºå¯¹é…ç½®ç¼“å­˜çš„ååº”ï¼Œæˆ–è€…è§£å†³å½“å‰çš„é—®é¢˜ã€‚

è®©æˆ‘ä»¬å¿½ç•¥æŠ¥å‘Šçš„é—®é¢˜ï¼Œç„¶åå†æ¬¡è¿è¡Œç›¸åŒçš„æ„å»ºä¸¤æ¬¡ï¼Œä»¥æŸ¥çœ‹é‡ç”¨ç¼“å­˜çš„æœ‰é—®é¢˜çš„é…ç½®æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

    
    â¯ gradle --configuration-cache --configuration-cache-problems=warn someTask -DsomeDestination=dest
    Calculating task graph as no configuration cache is available for tasks: someTask
    > Task :someTask
    
    2 problems were found storing the configuration cache.
    - Build file 'build.gradle': read system property 'someDestination'
      See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:undeclared_sys_prop_read
    - Build file 'build.gradle': invocation of 'Task.project' at execution time is unsupported.
      See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution
    
    See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/<hash>/configuration-cache-report.html
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry stored with 2 problems.
    â¯ gradle --configuration-cache --configuration-cache-problems=warn someTask -DsomeDestination=dest
    Reusing configuration cache.
    > Task :someTask
    
    1 problem was found reusing the configuration cache.
    - Build file 'build.gradle': invocation of 'Task.project' at execution time is unsupported.
      See https://docs.gradle.org/0.0.0/userguide/configuration_cache.html#config_cache:requirements:use_project_during_execution
    
    See the complete report at file:///home/user/gradle/samples/build/reports/configuration-cache/<hash>/configuration-cache-report.html
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry reused with 1 problem.
è¿™ä¸¤ä¸ªç‰ˆæœ¬æˆåŠŸæŠ¥å‘Šäº†è§‚å¯Ÿåˆ°çš„é—®é¢˜ï¼Œè¿›è¡Œäº†å­˜å‚¨ï¼Œç„¶åé‡æ–°ä½¿ç”¨äº†é…ç½®ç¼“å­˜ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜åœ¨å­˜å‚¨æ—¶åœ¨é…ç½®æ—¶å‘ç”Ÿï¼Œåœ¨ç¬¬äºŒæ¬¡è¿è¡Œæ—¶æœªæŠ¥å‘Šï¼Œé‡æ–°ä½¿ç”¨äº†é…ç½®ç¼“å­˜ã€‚é…ç½®é˜¶æ®µè¢«è·³è¿‡ã€‚`Project`åœ¨å­˜å‚¨å’Œé‡ç”¨æ—¶éƒ½æŠ¥å‘Šäº†åœ¨æ‰§è¡Œæ—¶ä½¿ç”¨çš„ç¬¬äºŒä¸ªé—®é¢˜ã€‚ä¸¤ä¸ªç‰ˆæœ¬éƒ½æ‰§è¡Œäº†ä»»åŠ¡ã€‚

å€ŸåŠ©æ§åˆ¶å°é—®é¢˜æ‘˜è¦å’ŒHTMLæŠ¥å‘Šä¸­æä¾›çš„é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³é—®é¢˜ã€‚è¿™æ˜¯æ„å»ºè„šæœ¬çš„ä¸€äº›å›ºå®šç‰ˆæœ¬ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    import javax.inject.Inject
    
    abstract class MyCopyTask extends DefaultTask { __**( 1)**
    
        @InputDirectory abstract DirectoryProperty getSource() __**( 2)**
    
        @OutputDirectory abstract DirectoryProperty getDestination() __**( 2)**
    
        @Inject abstract FileSystemOperations getFs() __**( 3)**
    
        @TaskAction
        void action() {
            fs.copy { __**( 3)**
                from source
                into destination
            }
        }
    }
    
    tasks.register('someTask', MyCopyTask) {
        def projectDir = layout.projectDirectory
        source = projectDir.dir('source')
        destination = projectDir.dir(
            providers.systemProperty('someDestination').forUseAtConfigurationTime().get() __**( 4)**
        )
    }

build.gradle.kts

    
    
    import javax.inject.Inject
    
    abstract class MyCopyTask : DefaultTask() { __**( 1)**
    
        @get:InputDirectory abstract val source: DirectoryProperty __**( 2)**
    
        @get:OutputDirectory abstract val destination: DirectoryProperty __**( 2)**
    
        @get:Inject abstract val fs: FileSystemOperations __**( 3)**
    
        @TaskAction
        fun action() {
            fs.copy { __**( 3)**
                from(source)
                into(destination)
            }
        }
    }
    
    tasks.register<MyCopyTask>("someTask") {
        val projectDir = layout.projectDirectory
        source.set(projectDir.dir("source"))
        destination.set(projectDir.dir(
            providers.systemProperty("someDestination").forUseAtConfigurationTime().get() __**( 4)**
        ))
    }

â‘   æˆ‘ä»¬å°†ä¸´æ—¶ä»»åŠ¡å˜æˆäº†é€‚å½“çš„ä»»åŠ¡ç±»ï¼Œ  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
â‘¡  å¸¦æœ‰è¾“å…¥å’Œè¾“å‡ºå£°æ˜ï¼Œ  
â‘¢  å¹¶åœ¨`FileSystemOperations`æœåŠ¡ä¸­æ³¨å…¥äº†çš„å—æ”¯æŒæ›¿ä»£[`project.copy
{}`](#config_cache:requirements:use_project_during_execution)ã€‚  
â‘£ 
æœ€åï¼Œæˆ‘ä»¬å°†[åœ¨é…ç½®æ—¶ä½¿ç”¨](#config_cache:requirements:undeclared_sys_prop_read)çš„[ç³»ç»Ÿå±æ€§](#config_cache:requirements:undeclared_sys_prop_read)å£°æ˜ä¸ºæ„å»ºé…ç½®è¾“å…¥ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°æˆ‘ä»¬çš„ä»»åŠ¡è¾“å…¥ã€‚  
  
ç°åœ¨ï¼Œä¸¤æ¬¡è¿è¡Œä»»åŠ¡æˆåŠŸäº†ï¼Œæ²¡æœ‰æŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œå¹¶ä¸”åœ¨ç¬¬äºŒæ¬¡è¿è¡Œæ—¶é‡æ–°ä½¿ç”¨äº†é…ç½®ç¼“å­˜ï¼š

    
    â¯ gradle --configuration-cache someTask -DsomeDestination=dest
    Calculating task graph as no configuration cache is available for tasks: someTask
    > Task :someTask
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry stored.
    â¯ gradle --configuration-cache someTask -DsomeDestination=dest
    Reusing configuration cache.
    > Task :someTask
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry reused.
ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ›´æ”¹ç³»ç»Ÿå±æ€§çš„å€¼æ€ä¹ˆåŠï¼Ÿ

    
    â¯ gradle --configuration-cache someTask -DsomeDestination=another
    Calculating task graph as configuration cache cannot be reused because system property 'someDestination' has changed.
    > Task :someTask
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry stored.

å…ˆå‰çš„é…ç½®ç¼“å­˜æ¡ç›®æ— æ³•é‡å¤ä½¿ç”¨ï¼Œå¿…é¡»é‡æ–°è®¡ç®—å¹¶å­˜å‚¨ä»»åŠ¡å›¾ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨é…ç½®æ—¶è¯»å–äº†ç³»ç»Ÿå±æ€§ï¼Œå› æ­¤è¦æ±‚Gradleåœ¨è¯¥å±æ€§çš„å€¼æ›´æ”¹æ—¶å†æ¬¡è¿è¡Œé…ç½®é˜¶æ®µã€‚ä¿®å¤å°±åƒç›´æ¥è¿æ¥ç³»ç»Ÿå±æ€§ä¸€æ ·ç®€å•ï¼Œè€Œæ— éœ€åœ¨é…ç½®æ—¶è¯»å–å®ƒã€‚

`Groovy``Kotlin`

build.gradle

    
    
    tasks.register('someTask', MyCopyTask) {
        def projectDir = layout.projectDirectory
        source = projectDir.dir('source')
        destination = projectDir.dir(providers.systemProperty('someDestination')) __**( 1)**
    }

build.gradle.kts

    
    
    tasks.register<MyCopyTask>("someTask") {
        val projectDir = layout.projectDirectory
        source.set(projectDir.dir("source"))
        destination.set(projectDir.dir(providers.systemProperty("someDestination"))) __**( 1)**
    }

â‘   æˆ‘ä»¬ç›´æ¥è¿æ¥å·²å£°æ˜çš„ç³»ç»Ÿå±æ€§ï¼Œè€Œæ— éœ€åœ¨é…ç½®æ—¶è¯»å–å®ƒã€‚  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
æœ‰äº†è¿™ä¸ªç®€å•çš„æ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„æ—¶é—´è¿è¡Œä»»åŠ¡ï¼Œæ›´æ”¹ç³»ç»Ÿå±æ€§å€¼å¹¶é‡æ–°ä½¿ç”¨é…ç½®ç¼“å­˜ï¼š

    
    
    â¯ gradle --configuration-cache someTask -DsomeDestination=dest
    Calculating task graph as no configuration cache is available for tasks: someTask
    > Task :someTask
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry stored.
    â¯ gradle --configuration-cache someTask -DsomeDestination=another
    Reusing configuration cache.
    > Task :someTask
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed
    Configuration cache entry reused.
ç°åœ¨ï¼Œæˆ‘ä»¬å·²é€šè¿‡æ­¤ç®€å•ä»»åŠ¡è§£å†³äº†é—®é¢˜ã€‚

ç»§ç»­é˜…è¯»ä»¥äº†è§£å¦‚ä½•ä¸ºæ‚¨çš„æ„å»ºæˆ–æ’ä»¶é‡‡ç”¨é…ç½®ç¼“å­˜ã€‚

## [](#config_cache:adoption)[Adoption steps ï¼ˆé‡‡çº³æ­¥éª¤)](#config_cache:adoption)

ä¸€ä¸ªé‡è¦çš„å‰ææ¡ä»¶æ˜¯ä½¿Gradleå’Œæ’ä»¶ç‰ˆæœ¬ä¿æŒæœ€æ–°ã€‚ä»¥ä¸‹å†…å®¹æ¢è®¨äº†æˆåŠŸé‡‡ç”¨çš„æ¨èæ­¥éª¤ã€‚å®ƒé€‚ç”¨äºæ„å»ºå’Œæ’ä»¶ã€‚åœ¨æ‰§è¡Œè¿™äº›æ­¥éª¤æ—¶ï¼Œè¯·è®°ä½ä¸‹é¢çš„[éœ€æ±‚](#config_cache:requirements)ä¸€ç« ä¸­è§£é‡Šçš„HTMLæŠ¥å‘Šå’Œè§£å†³æ–¹æ¡ˆã€‚

Start with :help

å§‹ç»ˆä»å°è¯•ä½¿ç”¨æœ€ç®€å•çš„ä»»åŠ¡è¿›è¡Œæ„å»ºæˆ–æ’ä»¶å¼€å§‹`:help`ã€‚è¿™å°†æ‰§è¡Œæ„å»ºæˆ–æ’ä»¶çš„æœ€å°é…ç½®é˜¶æ®µã€‚

é€æ­¥ç¡®å®šæœ‰ç”¨çš„ä»»åŠ¡

    

ä¸è¦`build`é©¬ä¸Šè·‘æ­¥ã€‚æ‚¨è¿˜å¯ä»¥ç”¨æ¥`--dry-run`é¦–å…ˆå‘ç°æ›´å¤šçš„é…ç½®æ—¶é—´é—®é¢˜ã€‚

åœ¨è¿›è¡Œæ„å»ºæ—¶ï¼Œé€æ­¥é’ˆå¯¹æ‚¨çš„å¼€å‘åé¦ˆå¾ªç¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å¯¹æºä»£ç è¿›è¡Œä¸€äº›æ›´æ”¹ä¹‹åè¿è¡Œæµ‹è¯•ã€‚

ä½¿ç”¨æ’ä»¶æ—¶ï¼Œè¯·é€æ­¥ç¡®å®šå·²è´¡çŒ®æˆ–å·²é…ç½®çš„ä»»åŠ¡ã€‚

é€šè¿‡å°†é—®é¢˜å˜æˆè­¦å‘Šæ¥è¿›è¡Œæ¢ç´¢

    

ä¸è¦åœ¨ç¬¬ä¸€æ¬¡æ„å»ºå¤±è´¥æ—¶åœæ­¢ï¼Œè€Œæ˜¯[å°†é—®é¢˜å˜æˆè­¦å‘Šï¼Œ](#config_cache:usage:ignore_problems)ä»¥å‘ç°æ‚¨çš„æ„å»ºå’Œæ’ä»¶çš„è¡Œä¸ºã€‚å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·ä½¿ç”¨HTMLæŠ¥å‘Šæ¥æ¨æ–­ä¸å¤±è´¥æœ‰å…³çš„æŠ¥å‘Šé—®é¢˜ã€‚ç»§ç»­è¿è¡Œæ›´å¤šæœ‰ç”¨çš„ä»»åŠ¡ã€‚

è¿™å°†ä½¿æ‚¨å¯¹æ„å»ºå’Œæ’ä»¶é¢ä¸´çš„é—®é¢˜çš„æ€§è´¨æœ‰ä¸€ä¸ªå¾ˆå¥½çš„äº†è§£ã€‚è¯·è®°ä½ï¼Œå°†é—®é¢˜è½¬å˜ä¸ºè­¦å‘Šæ—¶ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦[æ‰‹åŠ¨ä½¿ç¼“å­˜æ— æ•ˆ](#config_cache:usage:invalidate)ã€‚

åé€€ä¸€æ­¥ä¸€æ­¥åœ°è§£å†³é—®é¢˜

    

å½“æ‚¨å¯¹æ‰€è¦è§£å†³çš„é—®é¢˜äº†è§£å¾—è¶³å¤Ÿå¤šæ—¶ï¼Œè¯·é€€åä¸€æ­¥ï¼Œå¼€å§‹è¿­ä»£åœ°è§£å†³æœ€é‡è¦çš„é—®é¢˜ã€‚ä½¿ç”¨HTMLæŠ¥å‘Šå’Œæ­¤æ–‡æ¡£å¯åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚

ä» _å­˜å‚¨_ é…ç½®ç¼“å­˜æ—¶æŠ¥å‘Šçš„é—®é¢˜å¼€å§‹ã€‚ä¿®å¤åï¼Œæ‚¨å¯ä»¥ä¾é æœ‰æ•ˆçš„ç¼“å­˜é…ç½®é˜¶æ®µï¼Œå¹¶ç»§ç»­è§£å†³åœ¨ _åŠ è½½_ é…ç½®ç¼“å­˜æ—¶æŠ¥å‘Šçš„é—®é¢˜ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

æŠ¥å‘Šé‡åˆ°çš„é—®é¢˜

    

å¦‚æœæ‚¨é‡åˆ°[GradleåŠŸèƒ½](#config_cache:not_yet_implemented)æˆ–æœ¬æ–‡æ¡£æœªæ¶µç›–çš„[Gradleæ ¸å¿ƒæ’ä»¶](#config_cache:plugins:core)çš„é—®é¢˜ï¼Œè¯·åœ¨ä¸ŠæŠ¥å‘Šé—®é¢˜[`gradle/gradle`](https://github.com/gradle/gradle/issues/new/choose)ã€‚

å¦‚æœæ‚¨é‡åˆ°ç¤¾åŒºGradleæ’ä»¶çš„é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®ƒæ˜¯å¦å·²åœ¨[gradle /
gradleï¼ƒ13490ä¸­](https://github.com/gradle/gradle/issues/13490)åˆ—å‡ºï¼Œå¹¶è€ƒè™‘å°†é—®é¢˜æŠ¥å‘Šç»™æ’ä»¶çš„é—®é¢˜è·Ÿè¸ªå™¨ã€‚

æŠ¥å‘Šæ­¤ç±»é—®é¢˜çš„ä¸€ç§å¥½æ–¹æ³•æ˜¯æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

  * æ­¤æ–‡æ¡£çš„é“¾æ¥ï¼Œ

  * æ‚¨å°è¯•çš„æ’ä»¶ç‰ˆæœ¬ï¼Œ

  * æ’ä»¶çš„è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œæˆ–è€…æœ€å¥½æ˜¯å¤åˆ¶è€…çš„ç‰ˆæœ¬ï¼Œ

  * å¯¹å¤±è´¥çš„æè¿°ï¼Œä¾‹å¦‚ç»™å®šä»»åŠ¡çš„é—®é¢˜

  * å¤åˆ¶å¤±è´¥çš„å‰¯æœ¬ï¼Œ

  * è‡ªåŒ…å«`configuration-cache-report.html`æ–‡ä»¶ã€‚

æµ‹è¯•ï¼Œæµ‹è¯•ï¼Œæµ‹è¯•

    

è€ƒè™‘ä¸ºæ„å»ºé€»è¾‘æ·»åŠ æµ‹è¯•ã€‚è¯·å‚é˜…ä»¥ä¸‹æœ‰å…³[æµ‹è¯•](#config_cache:testing)é…ç½®ç¼“å­˜çš„[æ„å»ºé€»è¾‘çš„](#config_cache:testing)éƒ¨åˆ†ã€‚è¿™å°†åœ¨è¿­ä»£æ‰€éœ€çš„æ›´æ”¹æ—¶ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼Œå¹¶é˜²æ­¢å°†æ¥å‘ç”Ÿé€€åŒ–ã€‚

å‘æ‚¨çš„å›¢é˜Ÿæ¨å¹¿

    

ä¸€æ—¦å¼€å‘äººå‘˜å·¥ä½œæµç¨‹æ­£å¸¸è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œä»IDEè¿è¡Œæµ‹è¯•ï¼‰ï¼Œå°±å¯ä»¥è€ƒè™‘ä¸ºå›¢é˜Ÿå¯ç”¨å®ƒã€‚æ›´æ”¹ä»£ç å’Œè¿è¡Œæµ‹è¯•æ—¶æ›´å¿«çš„å‘¨è½¬æ—¶é—´æ˜¯å€¼å¾—çš„ã€‚æ‚¨å¯èƒ½é¦–å…ˆè¦é€‰æ‹©åŠ å…¥ã€‚

å¦‚æœéœ€è¦ï¼Œå°†é—®é¢˜è½¬æ¢ä¸ºè­¦å‘Šï¼Œå¹¶åœ¨æ„å»º`gradle.properties`æ–‡ä»¶ä¸­è®¾ç½®å…è®¸çš„æœ€å¤§é—®é¢˜æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¦ç”¨é…ç½®ç¼“å­˜ã€‚è®©æ‚¨çš„å›¢é˜ŸçŸ¥é“ä»–ä»¬å¯ä»¥é€‰æ‹©åŠ å…¥ï¼Œä¾‹å¦‚ï¼Œåœ¨æ”¯æŒçš„å·¥ä½œæµç¨‹çš„IDEè¿è¡Œé…ç½®ä¸­å¯ç”¨é…ç½®ç¼“å­˜ã€‚

ç¨åï¼Œå½“æ›´å¤šå·¥ä½œæµåœ¨å·¥ä½œæ—¶ï¼Œæ‚¨å¯ä»¥è¿›è¡Œç¿»è½¬ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨é…ç½®ç¼“å­˜ï¼Œå°†CIé…ç½®ä¸ºç¦ç”¨å®ƒï¼Œå¹¶åœ¨éœ€è¦æ—¶ä¼ è¾¾éœ€è¦ç¦ç”¨é…ç½®ç¼“å­˜çš„ä¸å—æ”¯æŒçš„å·¥ä½œæµã€‚

## [](#config_cache:testing)[æµ‹è¯•æ‚¨çš„æ„å»ºé€»è¾‘](#config_cache:testing)

Gradle
TestKitï¼ˆä¹Ÿç§°ä¸ºTestKitï¼‰æ˜¯ä¸€ä¸ªæœ‰åŠ©äºæµ‹è¯•Gradleæ’ä»¶å’Œä¸€èˆ¬æ„å»ºé€»è¾‘çš„åº“ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨TestKitçš„ä¸€èˆ¬æŒ‡å¯¼ï¼Œè¯·å‚è§[ä¸“ç”¨ç« èŠ‚](https://docs.gradle.org/6.7.1/userguide/test_kit.html#test_kit)ã€‚

è¦åœ¨æµ‹è¯•ä¸­å¯ç”¨é…ç½®ç¼“å­˜ï¼Œå¯ä»¥å°†`--configuration-
cache`å‚æ•°ä¼ é€’ç»™[GradleRunner](https://docs.gradle.org/6.7.1/javadoc/org/gradle/testkit/runner/GradleRunner.html)æˆ–ä½¿ç”¨[å¯ç”¨é…ç½®ç¼“å­˜ä¸­](#config_cache:usage:enable)æè¿°çš„å…¶ä»–æ–¹æ³•ä¹‹ä¸€ã€‚

æ‚¨éœ€è¦è¿è¡Œä¸¤æ¬¡ä»»åŠ¡ã€‚ä¸€æ¬¡å¯åŠ¨é…ç½®ç¼“å­˜ã€‚ä¸€æ¬¡é‡ç”¨é…ç½®ç¼“å­˜ã€‚

ä¾‹å­1.æµ‹è¯•é…ç½®ç¼“å­˜

`Groovy``Kotlin`

src / test / groovy / org / example / BuildLogicFunctionalTest.groovy

    
    
        def "my task can be loaded from the configuration cache"() {
            given:
            buildFile << """
                plugins {
                    id 'org.example.my-plugin'
                }
            """
    
            when:
            runner()
                .withArguments('--configuration-cache', 'myTask')    __**( 1)**
                .build()
    
            and:
            def result = runner()
                .withArguments('--configuration-cache', 'myTask')    __**( 2)**
                .build()
    
            then:
            result.output.contains('Reusing configuration cache.')      __**( 3)**
            // ... more assertions on your task behavior
        }

src/test/kotlin/org/example/BuildLogicFunctionalTest.kt

    
    
        @Test
        fun `my task can be loaded from the configuration cache`() {
    
            buildFile.writeText("""
                plugins {
                    id 'org.example.my-plugin'
                }
            """)
    
            runner()
                .withArguments("--configuration-cache", "myTask")        __**( 1)**
                .build()
    
            val result = runner()
                .withArguments("--configuration-cache", "myTask")        __**( 2)**
                .build()
    
            require(result.output.contains("Reusing configuration cache.")) __**( 3)**
            // ... more assertions on your task behavior
        }

â‘   é¦–æ¬¡è¿è¡Œä¼šâ€‹â€‹å¯åŠ¨é…ç½®ç¼“å­˜ã€‚  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
â‘¡  ç¬¬äºŒæ¬¡è¿è¡Œå°†é‡ç”¨é…ç½®ç¼“å­˜ã€‚  
â‘¢  æ–­è¨€é…ç½®ç¼“å­˜å·²è¢«é‡ç”¨ã€‚  
  
å¦‚æœå‘ç°é…ç½®ç¼“å­˜æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆGradleå°†ä½¿ç”Ÿæˆå¤±è´¥å¹¶æŠ¥å‘Šé—®é¢˜ï¼Œå¹¶ä¸”æµ‹è¯•å°†å¤±è´¥ã€‚

## [](#config_cache:requirements)[è¦æ±‚](#config_cache:requirements)

ä¸ºäº†å°†ä»»åŠ¡å›¾çš„çŠ¶æ€æ•è·åˆ°é…ç½®ç¼“å­˜ä¸­å¹¶åœ¨ä»¥åçš„æ„å»ºä¸­å†æ¬¡é‡æ–°åŠ è½½ï¼ŒGradleå°†æŸäº›è¦æ±‚åº”ç”¨äºä»»åŠ¡å’Œå…¶ä»–æ„å»ºé€»è¾‘ã€‚è¿™äº›è¦æ±‚ä¸­çš„æ¯ä¸€ä¸ªéƒ½è¢«è§†ä¸ºé…ç½®ç¼“å­˜â€œé—®é¢˜â€ï¼Œå¦‚æœå­˜åœ¨è¿è§„ï¼Œåˆ™æ„å»ºå¤±è´¥ã€‚

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›è¦æ±‚å®é™…ä¸Šæ©ç›–äº†ä¸€äº›æœªå£°æ˜çš„è¾“å…¥ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæ‰€æœ‰æ„å»ºï¼Œä½¿ç”¨é…ç½®é«˜é€Ÿç¼“å­˜éƒ½å¯ä»¥é€‰æ‹©æ›´ä¸¥æ ¼ï¼Œæ›´æ­£ç¡®å’Œæ›´å¯é ã€‚

ä»¥ä¸‹å„èŠ‚æè¿°äº†æ¯ä¸ªè¦æ±‚ä»¥åŠå¦‚ä½•æ›´æ”¹æ„å»ºä»¥è§£å†³é—®é¢˜ã€‚

### [](#config_cache:requirements:disallowed_types)[æŸäº›ç±»å‹ä¸èƒ½è¢«ä»»åŠ¡å¼•ç”¨](#config_cache:requirements:disallowed_types)

ä»»åŠ¡å®ä¾‹ä¸èƒ½ä»å…¶å­—æ®µä¸­å¼•ç”¨è®¸å¤šç±»å‹ã€‚å¯¹äºä»»åŠ¡æ“ä½œï¼Œä¾‹å¦‚`doFirst {}`æˆ–ï¼Œä¹Ÿæ˜¯å¦‚æ­¤`doLast {}`ã€‚

è¿™äº›ç±»å‹åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

  * å®æ—¶JVMçŠ¶æ€ç±»å‹

  * æ‘‡ç¯®æ¨¡å‹ç±»å‹

  * ä¾èµ–ç®¡ç†ç±»å‹

åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå‡ä¸å…è®¸ä½¿ç”¨è¿™äº›ç±»å‹çš„åŸå› æ˜¯å®ƒä»¬çš„çŠ¶æ€æ— æ³•é€šè¿‡é…ç½®ç¼“å­˜è½»æ¾å­˜å‚¨æˆ–é‡æ–°åˆ›å»ºã€‚

ç›´æ’­JVMçŠ¶æ€ç±»å‹ï¼ˆä¾‹å¦‚`ClassLoader`ï¼Œ`Thread`ï¼Œ`OutputStream`ï¼Œ`Socket`ç­‰...ï¼‰ï¼Œåªæ˜¯ä¸å…è®¸ã€‚è¿™äº›ç±»å‹å‡ ä¹ä»ä¸ä»£è¡¨ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºã€‚

æ‘‡ç¯®æ¨¡å‹ç±»å‹ï¼ˆä¾‹å¦‚`Gradle`ï¼Œ`Settings`ï¼Œ`Project`ï¼Œ`SourceSet`ï¼Œ`Configuration`ç­‰...ï¼‰é€šå¸¸ç”¨æ¥è¿›è¡Œä¸€äº›ä»»åŠ¡çš„è¾“å…¥ï¼Œåº”è¯¥æ˜¯æ˜ç¡®å’Œç²¾ç¡®å£°æ˜æ¥ä»£æ›¿ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœå¼•ç”¨a`Project`ä»¥ä¾¿`project.version`åœ¨æ‰§è¡Œæ—¶è·å–ï¼Œåˆ™åº”æ”¹ä¸ºä½¿ç”¨æ¥ç›´æ¥å°† _é¡¹ç›®ç‰ˆæœ¬_
å£°æ˜ä¸ºä»»åŠ¡çš„è¾“å…¥`Property<String>`ã€‚å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯å¼•ç”¨a`SourceSet`ä»¥ä¾¿ä»¥åè·å–æºæ–‡ä»¶ï¼Œç¼–è¯‘ç±»è·¯å¾„æˆ–æºé›†çš„è¾“å‡ºã€‚ç›¸åï¼Œæ‚¨åº”è¯¥å°†å®ƒä»¬å£°æ˜ä¸º`FileCollection`è¾“å…¥ï¼Œå¹¶ä»…å¼•ç”¨å®ƒã€‚

ç›¸åŒè¦æ±‚é€‚ç”¨äºå…·æœ‰æŸäº›ç»†å¾®å·®åˆ«çš„ä¾èµ–é¡¹ç®¡ç†ç±»å‹ã€‚

æŸäº›ç±»å‹ï¼ˆä¾‹å¦‚ï¼‰`Configuration`ä¸èƒ½ä½œä¸ºè‰¯å¥½çš„ä»»åŠ¡è¾“å…¥å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰è®¸å¤šä¸ç›¸å…³çš„çŠ¶æ€ï¼Œå› æ­¤æœ€å¥½å°†è¿™äº›è¾“å…¥å»ºæ¨¡ä¸ºæ›´ç²¾ç¡®çš„å‚æ•°ã€‚æˆ‘ä»¬å®Œå…¨ä¸æ‰“ç®—ä½¿è¿™äº›ç±»å‹å¯åºåˆ—åŒ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¼•ç”¨a`Configuration`ä»¥åå†è·å–å·²è§£æçš„æ–‡ä»¶ï¼Œåˆ™åº”æ”¹ä¸ºå°†aå£°æ˜`FileCollection`ä¸ºä»»åŠ¡çš„è¾“å…¥ã€‚

å¼•ç”¨ä¾èµ–æ€§è§£æç»“æœä¹Ÿä¸å…è®¸ï¼ˆä¾‹å¦‚`ArtifactResolutionQuery`ï¼Œ`ResolvedArtifact`ï¼Œ`ArtifactResult`ç­‰...ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¼•ç”¨æŸäº›`ResolvedArtifactResult`å®ä¾‹ï¼Œåˆ™åº”å£°æ˜ä¸€äº›å®ä¾‹`ArtifactCollection`ä½œä¸ºä»»åŠ¡çš„è¾“å…¥ã€‚ç»éªŒæ³•åˆ™æ˜¯ä»»åŠ¡å¿…é¡»ä¸å¼•ç”¨å·²
_è§£æçš„_
ç»“æœï¼Œè€Œåº”å¼•ç”¨æƒ°æ€§è§„èŒƒï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œæ—¶è¿›è¡Œä¾èµ–å…³ç³»è§£æã€‚æŸäº›APIå·²ä¸¢å¤±ï¼Œå°šä¸èƒ½ç”¨ä½œä»»åŠ¡è¾“å…¥ï¼Œä¾‹å¦‚ï¼Œå½“å‰ä»»åŠ¡åŠ¨ä½œæ— æ³•[æ¨æ–­](https://github.com/gradle/gradle/issues/12871)ä¾èµ–å…³ç³»
_å›¾_ ï¼Œè¯·å‚é˜…[gradle /
gradleï¼ƒ12871](https://github.com/gradle/gradle/issues/12871)ã€‚

æŸäº›ç±»å‹ï¼Œä¾‹å¦‚`Publication`æˆ–`Dependency`ä¸å¯åºåˆ—åŒ–ï¼Œä½†æ˜¯å¯ä»¥ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬å¯ä»¥å…è®¸å°†å®ƒä»¬ç›´æ¥ç”¨ä½œä»»åŠ¡è¾“å…¥ã€‚

è¿™æ˜¯ä¸€ä¸ªæœ‰é—®é¢˜çš„ä»»åŠ¡ç±»å‹å¼•ç”¨çš„ç¤ºä¾‹`SourceSet`ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    abstract class SomeTask extends DefaultTask {
    
        @Input SourceSet sourceSet __**( 1)**
    
        @TaskAction
        void action() {
            def classpathFiles = sourceSet.compileClasspath.files
            // ...
        }
    }

build.gradle.kts

    
    
    abstract class SomeTask : DefaultTask() {
    
        @get:Input lateinit var sourceSet: SourceSet __**( 1)**
    
        @TaskAction
        fun action() {
            val classpathFiles = sourceSet.compileClasspath.files
            // ...
        }
    }

â‘   è¿™å°†è¢«æŠ¥å‘Šä¸ºé—®é¢˜ï¼Œå› ä¸º`SourceSet`ä¸å…è®¸å¼•ç”¨  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
ä¸‹é¢æ˜¯åº”å¦‚ä½•åšï¼š

`Groovy``Kotlin`

build.gradle

    
    
    abstract class SomeTask extends DefaultTask {
    
        @InputFiles @Classpath
        abstract ConfigurableFileCollection getClasspath() __**( 1)**
    
        @TaskAction
        void action() {
            def classpathFiles = classpath.files
            // ...
        }
    }

build.gradle.kts

    
    
    abstract class SomeTask : DefaultTask() {
    
        @get:InputFiles @get:Classpath
        abstract val classpath: ConfigurableFileCollection __**( 1)**
    
        @TaskAction
        fun action() {
            val classpathFiles = classpath.files
            // ...
        }
    }

â‘   ä¸å†æŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨å‚è€ƒæ”¯æŒçš„ç±»å‹ `FileCollection`  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
åŒæ ·ï¼Œå¦‚æœåœ¨è„šæœ¬ä¸­å£°æ˜çš„ä¸´æ—¶ä»»åŠ¡é‡åˆ°ç›¸åŒçš„é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

`Groovy``Kotlin`

build.gradle

    
    
    tasks.register('someTask') {
        doLast {
            def classpathFiles = sourceSets.main.compileClasspath.files __**( 1)**
        }
    }

build.gradle.kts

    
    
    tasks.register("someTask") {
        doLast {
            val classpathFiles = sourceSets.main.get().compileClasspath.files __**( 1)**
        }
    }

â‘   è¿™å°†è¢«æŠ¥å‘Šä¸ºé—®é¢˜ï¼Œå› ä¸º`doLast {}`é—­åŒ…æ­£åœ¨æ•è·å¯¹`SourceSet`  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
æ‚¨ä»ç„¶éœ€è¦æ»¡è¶³ç›¸åŒçš„è¦æ±‚ï¼Œå³ä¸å¼•ç”¨ä¸å…è®¸çš„ç±»å‹ã€‚ä¸Šé¢çš„ä»»åŠ¡å£°æ˜çš„å›ºå®šæ–¹æ³•å¦‚ä¸‹ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    tasks.register('someTask') {
        def classpath = sourceSets.main.compileClasspath __**( 1)**
        doLast {
            def classpathFiles = classpath.files
        }
    }

build.gradle.kts

    
    
    tasks.register("someTask") {
        val classpath = sourceSets.main.get().compileClasspath __**( 1)**
        doLast {
            val classpathFiles = classpath.files
        }
    }

â‘   ä¸å†æŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œ`doLast {}`é—­åŒ…ç°åœ¨ä»…æ•è·`classpath`å—æ”¯æŒ`FileCollection`ç±»å‹çš„é—­åŒ…  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
è¯·æ³¨æ„ï¼Œæœ‰æ—¶ä¼šé—´æ¥å¼•ç”¨ä¸å…è®¸çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è®©ä»»åŠ¡ä»å…è®¸çš„æ’ä»¶ä¸­å¼•ç”¨æŸç§ç±»å‹çš„ä»»åŠ¡ã€‚è¯¥ç±»å‹å¯ä»¥å¼•ç”¨å¦ä¸€ä¸ªå…è®¸çš„ç±»å‹ï¼Œè€Œåè€…åˆå¼•ç”¨ä¸€ä¸ªä¸å…è®¸çš„ç±»å‹ã€‚HTMLæŠ¥å‘Šä¸­æä¾›çš„å¯¹è±¡å›¾å±‚æ¬¡ç»“æ„è§†å›¾ä¸­çš„é—®é¢˜åº”å¯å¸®åŠ©æ‚¨æŸ¥æ˜è¿è§„è€…ã€‚

### [](#config_cache:requirements:use_project_during_execution)[ä½¿ç”¨`Project`å¯¹è±¡](#config_cache:requirements:use_project_during_execution)

ä»»åŠ¡`Project`åœ¨æ‰§è¡Œæ—¶ä¸å¾—ä½¿ç”¨ä»»ä½•å¯¹è±¡ã€‚è¿™åŒ…æ‹¬`Task.getProject()`åœ¨ä»»åŠ¡è¿è¡Œæ—¶è°ƒç”¨ã€‚

æŸäº›æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨ä¸[ä¸å…è®¸ç±»å‹](#config_cache:requirements:disallowed_types)ç›¸åŒçš„æ–¹å¼è¿›è¡Œä¿®å¤ã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œç±»ä¼¼çš„äº‹æƒ…ä¸Šéƒ½å¯ç”¨`Project`å’Œ`Task`ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦`Logger`åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™åº”ä½¿ç”¨`Task.logger`è€Œä¸æ˜¯`Project.logger`ã€‚

å¦åˆ™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[æ³¨å…¥æœåŠ¡](https://docs.gradle.org/6.7.1/userguide/custom_gradle_types.html#service_injection)ä»£æ›¿çš„æ–¹æ³•`Project`ã€‚

è¿™æ˜¯`Project`åœ¨æ‰§è¡Œæ—¶ä½¿ç”¨å¯¹è±¡çš„æœ‰é—®é¢˜çš„ä»»åŠ¡ç±»å‹çš„ç¤ºä¾‹ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    abstract class SomeTask extends DefaultTask {
        @TaskAction
        void action() {
            project.copy { __**( 1)**
                from 'source'
                into 'destination'
            }
        }
    }

build.gradle.kts

    
    
    abstract class SomeTask : DefaultTask() {
        @TaskAction
        fun action() {
            project.copy { __**( 1)**
                from("source")
                into("destination")
            }
        }
    }

â‘   è¿™å°†è¢«æŠ¥å‘Šä¸ºé—®é¢˜ï¼Œå› ä¸ºä»»åŠ¡æ“ä½œæ­£åœ¨`Project`æ‰§è¡Œæ—¶ä½¿ç”¨å¯¹è±¡  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
ä¸‹é¢æ˜¯åº”å¦‚ä½•åšï¼š

`Groovy``Kotlin`

build.gradle

    
    
    import javax.inject.Inject
    
    abstract class SomeTask extends DefaultTask {
    
        @Inject abstract FileSystemOperations getFs() __**( 1)**
    
        @TaskAction
        void action() {
            fs.copy {
                from 'source'
                into 'destination'
            }
        }
    }

build.gradle.kts

    
    
    import javax.inject.Inject
    
    abstract class SomeTask : DefaultTask() {
    
        @get:Inject abstract val fs: FileSystemOperations __**( 1)**
    
        @TaskAction
        fun action() {
            fs.copy {
                from("source")
                into("destination")
            }
        }
    }

â‘   ä¸å†æŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œ`FileSystemOperations`æ”¯æŒæ³¨å…¥æœåŠ¡æ›¿ä»£`project.copy {}`  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
åŒæ ·ï¼Œå¦‚æœåœ¨è„šæœ¬ä¸­å£°æ˜çš„ä¸´æ—¶ä»»åŠ¡é‡åˆ°ç›¸åŒçš„é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

`Groovy``Kotlin`

build.gradle

    
    
    tasks.register('someTask') {
        doLast {
            project.copy { __**( 1)**
                from 'source'
                into 'destination'
            }
        }
    }

build.gradle.kts

    
    
    tasks.register("someTask") {
        doLast {
            project.copy { __**( 1)**
                from("source")
                into("destination")
            }
        }
    }

â‘   è¿™å°†è¢«æŠ¥å‘Šä¸ºé—®é¢˜ï¼Œå› ä¸ºä»»åŠ¡æ“ä½œæ­£åœ¨`Project`æ‰§è¡Œæ—¶ä½¿ç”¨å¯¹è±¡  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
ä¸Šé¢çš„ä»»åŠ¡å£°æ˜çš„å›ºå®šæ–¹æ³•å¦‚ä¸‹ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    import javax.inject.Inject
    
    interface Injected {
        @Inject FileSystemOperations getFs() __**( 1)**
    }
    tasks.register('someTask') {
        def injected = project.objects.newInstance(Injected) __**( 2)**
        doLast {
            injected.fs.copy { __**( 3)**
                from 'source'
                into 'destination'
            }
        }
    }

build.gradle.kts

    
    
    import javax.inject.Inject
    
    interface Injected {
        @get:Inject val fs: FileSystemOperations __**( 1)**
    }
    tasks.register("someTask") {
        val injected = project.objects.newInstance<Injected>() __**( 2)**
        doLast {
            injected.fs.copy { __**( 3)**
                from("source")
                into("destination")
            }
        }
    }

â‘   æœåŠ¡ä¸èƒ½ç›´æ¥åœ¨è„šæœ¬ä¸­æ³¨å…¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç±»å‹æ¥ä¼ è¾¾æ³¨å…¥ç‚¹  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
â‘¡  `project.object`åœ¨ä»»åŠ¡åŠ¨ä½œä¹‹å¤–åˆ›å»ºé¢å¤–ç±»å‹çš„å®ä¾‹  
â‘¢ 
ä¸å†æŠ¥å‘Šä»»ä½•é—®é¢˜`injected`ï¼Œæä¾›è¯¥`FileSystemOperations`æœåŠ¡çš„ä»»åŠ¡æ“ä½œå‚è€ƒä½œä¸ºæ›¿ä»£çš„æ”¯æŒ`project.copy {}`  
  
æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œä¿®å¤è„šæœ¬ä¸­å£°æ˜çš„ä¸´æ—¶ä»»åŠ¡éœ€è¦ç›¸å½“å¤šçš„ä»ªå¼ã€‚ç°åœ¨æ˜¯è€ƒè™‘å°†ä»»åŠ¡å£°æ˜æå–ä¸ºé€‚å½“çš„ä»»åŠ¡ç±»çš„å¥½æ—¶æœºï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚

ä¸‹è¡¨æ˜¾ç¤ºäº†åº”ä½¿ç”¨å“ªäº›APIæˆ–æ³¨å…¥çš„æœåŠ¡æ›¿ä»£æ¯ç§`Project`æ–¹æ³•ã€‚

ä»£æ›¿ï¼š | ä½¿ç”¨ï¼š  
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
  
`project.rootDir`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.rootDir`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.projectDir`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.projectDir`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.buildDir`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.buildDir`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.name`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.name`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.description`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.description`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.group`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.group`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.version`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.version`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.properties`ï¼Œ`project.property(name)`ï¼Œ`project.hasProperty(name)`ï¼Œ`project.getProperty(name)`æˆ–è€…`project.findProperty(name)`

|

[Gradleå±æ€§çš„ä»·å€¼æä¾›è€…](#config_cache:requirements:undeclared_gradle_prop_read)  
  
`project.logger`

|

[Task.logger](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/Task.html#getLogger--)  
  
`project.provider {}`

|

[ProviderFactory.provider
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-
java.util.concurrent.Callable-)  
  
`project.file(path)`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.file(file)`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.uri(path)`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.uri(path)`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚å¦åˆ™ï¼Œ`File.toURI()`æˆ–å¯ä»¥ä½¿ç”¨å…¶ä»–ä¸€äº›JVM
APIã€‚  
  
`project.relativePath(path)`

|

[ProjectLayout.projectDirectory](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--)ã€‚[æ–‡ä»¶è·¯å¾„ï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/Directory.html#file-
java.lang.String-)  
  
`project.files(paths)`

|

[ObjectFactory.fileCollectionï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--)ã€‚[æ¥è‡ªï¼ˆè·¯å¾„ï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/ConfigurableFileCollection.html#from-
java.lang.Object%E2%80%A6%E2%80%8B-)  
  
`project.fileTree(paths)`

|

[ObjectFactory.fileTreeï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--)ã€‚[ä»ï¼ˆç›®å½•ï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/ConfigurableFileTree.html#from-
java.lang.Object-)  
  
`project.zipTree(path)`

|

[ArchiveOperations.zipTreeï¼ˆè·¯å¾„ï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/ArchiveOperations.html#zipTree-
java.lang.Object-)  
  
`project.tarTree(path)`

|

[ArchiveOperations.tarTreeï¼ˆè·¯å¾„ï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/ArchiveOperations.html#tarTree-
java.lang.Object-)  
  
`project.resources`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.resource`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.copySpec {}`

|

ä»»åŠ¡è¾“å…¥æˆ–è¾“å‡ºå±æ€§æˆ–è„šæœ¬å˜é‡ï¼Œä»¥æ•è·`project.copySpec {}`ç”¨äºè®¡ç®—å®é™…å‚æ•°çš„ç»“æœã€‚  
  
`project.copy {}`

|

[FileSystemOperations.copy
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/FileSystemOperations.html#copy-
org.gradle.api.Action-)  
  
`project.sync {}`

|

[FileSystemOperations.sync
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/FileSystemOperations.html#sync-
org.gradle.api.Action-)  
  
`project.delete {}`

|

[FileSystemOperations.delete
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/file/FileSystemOperations.html#delete-
org.gradle.api.Action-)  
  
`project.mkdir(path)`

|

Kotlinï¼ŒGroovyæˆ–Java APIå¯ç”¨äºæ‚¨çš„æ„å»ºé€»è¾‘ã€‚  
  
`project.exec {}`

|

[ExecOperations.exec
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/process/ExecOperations.html#exec-
org.gradle.api.Action-)  
  
`project.javaexec {}`

|

[ExecOperations.javaexec
{}](https://docs.gradle.org/6.7.1/javadoc/org/gradle/process/ExecOperations.html#javaexec-
org.gradle.api.Action-)  
  
`project.ant {}`

|

[ä»»åŠ¡ä»£ç†](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/Task.html#getAnt--)  
  
`project.createAntBuilder()`

|

[ä»»åŠ¡ä»£ç†](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/Task.html#getAnt--)  
  
### [](#config_cache:requirements:task_access)[ä»å¦ä¸€ä¸ªå®ä¾‹è®¿é—®ä»»åŠ¡å®ä¾‹](#config_cache:requirements:task_access)

ä»»åŠ¡ä¸åº”ç›´æ¥è®¿é—®å¦ä¸€ä¸ªä»»åŠ¡å®ä¾‹çš„çŠ¶æ€ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨[è¾“å…¥å’Œè¾“å‡ºå…³ç³»](https://docs.gradle.org/6.7.1/userguide/lazy_configuration.html#working_with_task_dependencies_in_lazy_properties)æ¥è¿æ¥ä»»åŠ¡ã€‚

è¯·æ³¨æ„ï¼Œæ­¤è¦æ±‚ä½¿å…¶ä¸æ”¯æŒç¼–å†™åœ¨æ‰§è¡Œæ—¶é…ç½®å…¶ä»–ä»»åŠ¡çš„ä»»åŠ¡ã€‚

### [](#config_cache:requirements:build_listeners)[ä½¿ç”¨æ„å»ºç›‘å¬å™¨](#config_cache:requirements:build_listeners)

æ’ä»¶å’Œæ„å»ºè„šæœ¬ä¸å¾—æ³¨å†Œä»»ä½•æ„å»ºä¾¦å¬å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é…ç½®æ—¶æ³¨å†Œçš„ä¾¦å¬å™¨ä¼šåœ¨æ‰§è¡Œæ—¶å¾—åˆ°é€šçŸ¥ã€‚ä¾‹å¦‚a`BuildListener`æˆ–a
`TaskExecutionListener`ã€‚

è¿™äº›åº”è¯¥ç”±[æ„å»ºæœåŠ¡](https://docs.gradle.org/6.7.1/userguide/build_services.html#build_services)ä»£æ›¿ï¼Œå¦‚æœéœ€è¦ï¼Œæ³¨å†Œ[æœåŠ¡å¯ä»¥](https://docs.gradle.org/6.7.1/userguide/build_services.html#build_services)æ³¨å†Œä»¥æ¥æ”¶æœ‰å…³[ä»»åŠ¡æ‰§è¡Œçš„](https://docs.gradle.org/6.7.1/userguide/build_services.html#operation_listener)ä¿¡æ¯ã€‚

### [](#config_cache:requirements:undeclared_gradle_prop_read)[æœªå£°æ˜é˜…è¯»Gradleå±æ€§](#config_cache:requirements:undeclared_gradle_prop_read)

æ’ä»¶å’Œæ„å»ºè„šæœ¬ä¸åº”åœ¨é…ç½®æ—¶ç›´æ¥è¯»å–Gradleå±æ€§ã€‚ç›¸åï¼Œå¿…é¡»ä½¿ç”¨å€¼æä¾›è€…APIå°†è¿™äº›Gradleå±æ€§å£°æ˜ä¸ºæ½œåœ¨çš„æ„å»ºé…ç½®è¾“å…¥ã€‚

æ­¤é—®é¢˜æ˜¯ç”±ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç”Ÿæˆé€»è¾‘å¼•èµ·çš„ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = project.findProperty('some-property') != null

build.gradle.kts

    
    
    val enabled = project.findProperty("some-property") != null

è‹¥è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·æ”¹ä¸ºä½¿ç”¨[provider.gradlePropertyï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-
java.lang.String-)é˜…è¯»Gradleå±æ€§ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = providers.gradleProperty('some-property').forUseAtConfigurationTime().present

build.gradle.kts

    
    
    val enabled = providers.gradleProperty("some-property").forUseAtConfigurationTime().isPresent

é€šå¸¸ï¼Œåº”é¿å…åœ¨é…ç½®æ—¶è¯»å–Gradleå±æ€§çš„å€¼ï¼Œä»¥é¿å…åœ¨Gradleå±æ€§å€¼æ›´æ”¹æ—¶ä½¿é…ç½®ç¼“å­˜æ¡ç›®æ— æ•ˆã€‚è€Œæ˜¯å¯ä»¥å°†[provider.gradlePropertyï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-
java.lang.String-)`Provider`è¿”å›çš„å€¼è¿æ¥åˆ°ä»»åŠ¡å±æ€§ã€‚[](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#gradleProperty-
java.lang.String-)

### [](#config_cache:requirements:undeclared_sys_prop_read)[æœªç»å£°æ˜çš„è¯»å–ç³»ç»Ÿå±æ€§](#config_cache:requirements:undeclared_sys_prop_read)

åœ¨é…ç½®æ—¶ï¼Œæ’ä»¶å’Œæ„å»ºè„šæœ¬ä¸åº”ç›´æ¥ä½¿ç”¨Java APIè¯»å–ç³»ç»Ÿå±æ€§ã€‚ç›¸åï¼Œå¿…é¡»ä½¿ç”¨å€¼æä¾›è€…APIå°†è¿™äº›ç³»ç»Ÿå±æ€§å£°æ˜ä¸ºæ½œåœ¨çš„æ„å»ºé…ç½®è¾“å…¥ã€‚

æ­¤é—®é¢˜æ˜¯ç”±ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç”Ÿæˆé€»è¾‘å¼•èµ·çš„ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = System.getProperty('some-property') != null

build.gradle.kts

    
    
    val enabled = System.getProperty("some-property") != null

è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·æ”¹ä¸ºä½¿ç”¨[provider.systemPropertyï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-
java.lang.String-)è¯»å–ç³»ç»Ÿå±æ€§ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = providers.systemProperty('some-property').forUseAtConfigurationTime().present

build.gradle.kts

    
    
    val enabled = providers.systemProperty("some-property").forUseAtConfigurationTime().isPresent

é€šå¸¸ï¼Œåº”é¿å…åœ¨é…ç½®æ—¶è¯»å–ç³»ç»Ÿå±æ€§çš„å€¼ï¼Œä»¥é¿å…åœ¨ç³»ç»Ÿå±æ€§å€¼æ›´æ”¹æ—¶ä½¿é…ç½®ç¼“å­˜æ¡ç›®æ— æ•ˆã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†[provider.systemPropertyï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-
java.lang.String-)`Provider`è¿”å›çš„å€¼è¿æ¥åˆ°ä»»åŠ¡å±æ€§ã€‚[](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#systemProperty-
java.lang.String-)

### [](#config_cache:requirements:undeclared_env_var_read)[æœªç»å£°æ˜çš„è¯»å–ç¯å¢ƒå˜é‡](#config_cache:requirements:undeclared_env_var_read)

åœ¨é…ç½®æ—¶ï¼Œæ’ä»¶å’Œæ„å»ºè„šæœ¬ä¸åº”ç›´æ¥ä½¿ç”¨Java APIè¯»å–ç¯å¢ƒå˜é‡ã€‚è€Œæ˜¯ä½¿ç”¨å€¼æä¾›è€…APIå°†ç¯å¢ƒå˜é‡å£°æ˜ä¸ºæ½œåœ¨çš„æ„å»ºé…ç½®è¾“å…¥ã€‚

æ­¤é—®é¢˜æ˜¯ç”±ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç”Ÿæˆé€»è¾‘å¼•èµ·çš„ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = System.getenv('SOME_ENV_VAR') != null

build.gradle.kts

    
    
    val enabled = System.getenv("SOME_ENV_VAR") != null

è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·æ”¹ç”¨[providers.environmentVariableï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-
java.lang.String-)è¯»å–ç¯å¢ƒå˜é‡ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def enabled = providers.environmentVariable('SOME_ENV_VAR').forUseAtConfigurationTime().present

build.gradle.kts

    
    
    val enabled = providers.environmentVariable("SOME_ENV_VAR").forUseAtConfigurationTime().isPresent

é€šå¸¸ï¼Œåº”é¿å…åœ¨é…ç½®æ—¶è¯»å–ç¯å¢ƒå˜é‡çš„å€¼ï¼Œä»¥é¿å…åœ¨ç¯å¢ƒå˜é‡å€¼æ›´æ”¹æ—¶ä½¿é…ç½®ç¼“å­˜æ¡ç›®æ— æ•ˆã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†[provider.environmentVariableï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-
java.lang.String-)`Provider`è¿”å›çš„å€¼è¿æ¥åˆ°ä»»åŠ¡å±æ€§ã€‚[](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#environmentVariable-
java.lang.String-)

### [](#config_cache:requirements:undeclared_file_read)[æœªå£°æ˜è¯»å–æ–‡ä»¶](#config_cache:requirements:undeclared_file_read)

åœ¨é…ç½®æ—¶ï¼Œæ’ä»¶å’Œæ„å»ºè„šæœ¬ä¸åº”ä½¿ç”¨Javaï¼ŒGroovyæˆ–Kotlin APIç›´æ¥è¯»å–æ–‡ä»¶ã€‚è€Œæ˜¯ä½¿ç”¨ä»·å€¼æä¾›è€…APIå°†æ–‡ä»¶å£°æ˜ä¸ºæ½œåœ¨çš„æ„å»ºé…ç½®è¾“å…¥ã€‚

æ­¤é—®é¢˜æ˜¯ç”±ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç”Ÿæˆé€»è¾‘å¼•èµ·çš„ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def config = file('some.conf').text

build.gradle.kts

    
    
    val config = file("some.conf").readText()

è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·æ”¹ç”¨[provider.fileContentsï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-
org.gradle.api.file.RegularFile-)è¯»å–æ–‡ä»¶ï¼š

`Groovy``Kotlin`

build.gradle

    
    
    def config = providers.fileContents(layout.projectDirectory.file('some.conf'))
        .asText.forUseAtConfigurationTime()

build.gradle.kts

    
    
    val config = providers.fileContents(layout.projectDirectory.file("some.conf"))
        .asText.forUseAtConfigurationTime()

é€šå¸¸ï¼Œåº”é¿å…åœ¨é…ç½®æ—¶è¯»å–æ–‡ä»¶ï¼Œä»¥é¿å…åœ¨æ–‡ä»¶å†…å®¹æ›´æ”¹æ—¶ä½¿é…ç½®ç¼“å­˜æ¡ç›®æ— æ•ˆã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†[provider.fileContentsï¼ˆï¼‰](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-
org.gradle.api.file.RegularFile-)`Provider`è¿”å›çš„å€¼è¿æ¥åˆ°ä»»åŠ¡å±æ€§ã€‚[](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/provider/ProviderFactory.html#fileContents-
org.gradle.api.file.RegularFile-)

## [](#config_cache:not_yet_implemented)[å°šæœªå®ç°](#config_cache:not_yet_implemented)

ä½¿ç”¨æŸäº›GradleåŠŸèƒ½ä½¿ç”¨é…ç½®ç¼“å­˜çš„æ”¯æŒå°šæœªå®ç°ã€‚è¿™äº›åŠŸèƒ½çš„æ”¯æŒå°†åœ¨ä»¥åçš„Gradleç‰ˆæœ¬ä¸­æ·»åŠ ã€‚

### [](#config_cache:not_yet_implemented:build_scan)[æ„å»ºæ‰«ææ”¯æŒ](#config_cache:not_yet_implemented:build_scan)

å¯ç”¨é…ç½®ç¼“å­˜çš„æ„å»ºæ‰«æåŠŸèƒ½éœ€è¦Gradle Enterpriseæ’ä»¶ç‰ˆæœ¬3.4æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ä½¿ç”¨æ—©æœŸç‰ˆæœ¬æ—¶ï¼Œä½¿ç”¨é…ç½®ç¼“å­˜æ—¶å°†è‡ªåŠ¨ç¦ç”¨å†…éƒ¨ç‰ˆæœ¬æ‰«æå‘å¸ƒã€‚

### [](#config_cache:not_yet_implemented:sharing)[å…±äº«é…ç½®ç¼“å­˜](#config_cache:not_yet_implemented:sharing)

é…ç½®ç¼“å­˜å½“å‰ä»…å­˜å‚¨åœ¨æœ¬åœ°ã€‚çƒ­çš„æˆ–å†·çš„æœ¬åœ°Gradleå®ˆæŠ¤ç¨‹åºéƒ½å¯ä»¥é‡ç”¨å®ƒã€‚ä½†æ˜¯å®ƒä¸èƒ½åœ¨å¼€å‘äººå‘˜æˆ–CIè®¡ç®—æœºä¹‹é—´å…±äº«ã€‚

å‚è§[gradle / gradleï¼ƒ13510](https://github.com/gradle/gradle/issues/13510)ã€‚

### [](#config_cache:not_yet_implemented:normalization)[è‡ªå®šä¹‰è¾“å…¥æ ‡å‡†åŒ–](#config_cache:not_yet_implemented:normalization)

ä½¿ç”¨é…ç½®ç¼“å­˜æ—¶ï¼Œä¸ä¼šæ•è·è‡ªå®šä¹‰[è¾“å…¥å½’ä¸€åŒ–](https://docs.gradle.org/6.7.1/userguide/more_about_tasks.html#sec:configure_input_normalization)ã€‚å¦‚æœæ‚¨çš„æ„å»ºå…·æœ‰ç”¨äºè¾“å…¥å½’ä¸€åŒ–çš„é…ç½®ï¼Œå³`normalization
{ }`ï¼Œå®ƒå°†è¢«å¿½ç•¥ï¼Œåˆ™ä¸ä¼šæŠ¥å‘Šä»»ä½•é—®é¢˜ã€‚é‡å¤ä½¿ç”¨é…ç½®ç¼“å­˜çš„æ„å»ºå¯èƒ½ä¼šçœ‹åˆ°æ„å»ºç¼“å­˜æœªå‘½ä¸­ï¼Œä½†å°†ä¿æŒå¯é ã€‚

å‚è§[gradle / gradleï¼ƒ13706](https://github.com/gradle/gradle/issues/13706)ã€‚

### [](#config_cache:not_yet_implemented:composite_builds)[å¤åˆä½“](#config_cache:not_yet_implemented:composite_builds)

åœ¨[å¤åˆæ„å»º](https://docs.gradle.org/6.7.1/userguide/composite_builds.html#composite_builds)ä¸Šä½¿ç”¨é…ç½®ç¼“å­˜æ—¶ï¼Œå°†æŠ¥å‘Šé—®é¢˜ã€‚å¦‚æœæ‚¨[å¿½ç•¥é—®é¢˜ï¼Œ](#config_cache:usage:ignore_problems)åˆ™åœ¨é‡æ–°ä½¿ç”¨é…ç½®ç¼“å­˜æ—¶ï¼Œå°†è·³è¿‡åŒ…å«çš„å†…éƒ¨ç‰ˆæœ¬ã€‚

å‚è§[gradle / gradleï¼ƒ13503](https://github.com/gradle/gradle/issues/13503)ã€‚

### [](#config_cache:not_yet_implemented:source_dependencies)[æºä¾èµ–](#config_cache:not_yet_implemented:source_dependencies)

å°šæœªå®ç°å¯¹[æºä¾èµ–æ€§çš„](https://blog.gradle.org/introducing-source-
dependencies)æ”¯æŒã€‚å¯ç”¨é…ç½®ç¼“å­˜åï¼Œå°†ä¸ä¼šæŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œå¹¶ä¸”æ„å»ºå°†å¤±è´¥ã€‚

å‚è§[gradle / gradleï¼ƒ13506](https://github.com/gradle/gradle/issues/13506)ã€‚

### [](#config_cache:not_yet_implemented:testkit_build_with_java_agent)[å°†Javaä»£ç†ä¸ä½¿ç”¨TestKitè¿è¡Œçš„æ„å»ºä¸€èµ·ä½¿ç”¨](#config_cache:not_yet_implemented:testkit_build_with_java_agent)

ä½¿ç”¨[TestKit](https://docs.gradle.org/6.7.1/userguide/test_kit.html#test_kit)è¿è¡Œå†…éƒ¨ç‰ˆæœ¬æ—¶ï¼Œé…ç½®ç¼“å­˜å¯èƒ½ä¼šå¹²æ‰°åº”ç”¨äºè¿™äº›å†…éƒ¨ç‰ˆæœ¬çš„Javaä»£ç†ï¼ˆä¾‹å¦‚Jacocoä»£ç†ï¼‰ã€‚

### [](#config_cache:not_yet_implemented:java_serialization)[Javaå¯¹è±¡åºåˆ—åŒ–](#config_cache:not_yet_implemented:java_serialization)

Gradleå…è®¸å°†æ”¯æŒ[Javaå¯¹è±¡åºåˆ—åŒ–](https://docs.oracle.com/javase/8/docs/platform/serialization/spec/serialTOC.html)åè®®çš„[å¯¹è±¡](https://docs.oracle.com/javase/8/docs/platform/serialization/spec/serialTOC.html)å­˜å‚¨åœ¨é…ç½®ç¼“å­˜ä¸­ã€‚

å½“å‰ï¼Œè¯¥å®ç°ä»…é™äºå¯åºåˆ—åŒ–çš„ç±»ï¼Œè¿™äº›ç±»å¯å®ç°`java.io.Serializable`æ¥å£å¹¶å®šä¹‰ä»¥ä¸‹æ–¹æ³•ç»„åˆä¹‹ä¸€ï¼š

  * `writeObject`ä¸`readObject`ç²¾ç¡®æ§åˆ¶è¦å­˜å‚¨çš„ä¿¡æ¯çš„æ–¹æ³•ç›¸ç»“åˆçš„æ–¹æ³•ï¼›

  * ä¸€ä¸ª`writeObject`æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•`readObject`; `writeObject`æœ€ç»ˆå¿…é¡»è‡´ç”µ`ObjectOutputStream.defaultWriteObject`;

  * ä¸€ä¸ª`readObject`æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•`writeObject`; `readObject`æœ€ç»ˆå¿…é¡»è‡´ç”µ`ObjectInputStream.defaultReadObject`;

  * ä¸€ç§`writeReplace`å…è®¸ç±»æŒ‡å®šè¦ç¼–å†™çš„æ›¿æ¢çš„æ–¹æ³•ï¼›

  * ä¸€ç§`readResolve`å…è®¸ç±»æŒ‡å®šåˆšè¯»å–çš„å¯¹è±¡çš„æ›¿æ¢çš„æ–¹æ³•ï¼›

**ä¸** æ”¯æŒä»¥ä¸‹ _Javaå¯¹è±¡åºåˆ—åŒ–_ åŠŸèƒ½ï¼š ****

  * å®ç°`java.io.Externalizable`æ¥å£çš„å¯åºåˆ—åŒ–ç±»ï¼›æ­¤ç±»çš„å¯¹è±¡åœ¨åºåˆ—åŒ–æœŸé—´è¢«é…ç½®é«˜é€Ÿç¼“å­˜ä¸¢å¼ƒï¼Œå¹¶æŠ¥å‘Šä¸ºé—®é¢˜ï¼›

  * è¯¥`serialPersistentFields`æ„ä»¶ä»¥æ˜¾å¼å£°æ˜å“ªäº›å­—æ®µæ˜¯å¯åºåˆ—åŒ–; è¯¥æˆå‘˜ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å°†è¢«å¿½ç•¥ï¼›é…ç½®ç¼“å­˜ä¼šè€ƒè™‘é™¤`transient`å­—æ®µä¹‹å¤–çš„æ‰€æœ‰å¯åºåˆ—åŒ–å†…å®¹ï¼›

  * `ObjectOutputStream`ä¸æ”¯æŒä»¥ä¸‹æ–¹æ³•ï¼Œå¹¶ä¸”å°†æŠ›å‡º`UnsupportedOperationException`ï¼š

    * `reset()`ï¼Œ`writeFields()`ï¼Œ`putFields()`ï¼Œ`writeChars(String)`ï¼Œ`writeBytes(String)`å’Œ`writeUnshared(Any?)`ã€‚

  * `ObjectInputStream`ä¸æ”¯æŒä»¥ä¸‹æ–¹æ³•ï¼Œå¹¶ä¸”å°†æŠ›å‡º`UnsupportedOperationException`ï¼š

    * `readLine()`ï¼Œ`readFully(ByteArray)`ï¼Œ`readFully(ByteArray, Int, Int)`ï¼Œ`readUnshared()`ï¼Œ`readFields()`ï¼Œ`transferTo(OutputStream)`å’Œ`readAllBytes()`ã€‚

  * é€šè¿‡æ³¨å†Œçš„éªŒè¯å°†`ObjectInputStream.registerValidation`è¢«å¿½ç•¥ï¼›

  * è¯¥`readObjectNoData`æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ï¼›

å‚è§[gradle / gradleï¼ƒ13588](https://github.com/gradle/gradle/issues/13588)ã€‚

