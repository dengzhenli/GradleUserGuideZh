

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [来自蚂蚁](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#customizing-execution)
    * [配置构建环境](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [配置Gradle守护程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#optimizing-build-performance)
    * [构建绩效指南](https://guides.gradle.org/performance/)
    * [启用和配置构建缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [使用配置缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#learning-the-basics)
    * [介绍构建脚本的基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [处理任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [了解有关构建脚本的更多信息](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [使用Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [了解构建生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [Working with Logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [Avoiding Traps](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#authoring-multi-project-builds)
    * [Creating a Basic Multi-Project Build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#advanced-techniques)
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [Using Ant from Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [构建C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [测试C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [建立Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [测试Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### 使用依赖项

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [声明版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [控制翻译](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#controlling-transitive-dependencies)
    * [Upgrading Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [Downgrading and Excluding](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [Aligning Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [Customizing Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [Preventing accidental upgrades](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [图书馆的生产和消费形式](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [在多仓库环境中工作](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [出版图书馆](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [术语](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### 扩展摇篮

  * [插件开发教程](https://gradle.org/guides/?q=Plugin%20Development)
  * [编写Gradle任务类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [编写Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [编写自定义Gradle类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [延迟配置任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [使用避免任务配置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### 参考

  * [核心插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [命令行界面](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle和第三方工具](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [摇篮包装](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle管理的目录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# 延迟配置

version 6.7.1

内容

  * [懒惰的属性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_properties)
  * [创建属性或提供程序实例](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#creating_property_provider)
  * [将属性连接在一起](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#connecting_properties_together)
  * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_files_in_lazy_properties)
  * [使用任务输入和输出](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_task_dependencies_in_lazy_properties)
  * [使用收藏](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_collections)
  * [使用地图](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_maps)
  * [将约定应用于属性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#applying_conventions)
  * [使财产不可修改](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#unmodifiable_property)
  * [指导方针](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_faqs)
  * [未来发展](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_roadmap)
  * [提供程序文件API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_reference)
  * [属性文件API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#property_files_api_reference)
  * [惰性集合API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_collections_api_reference)
  * [惰性对象API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_objects_api_reference)

随着构建复杂性的增加，知道何时何地配置特定值可能变得难以推理。Gradle提供了几种使用 _惰性配置_ 来管理这种复杂性的方法。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_properties)[懒惰的属性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_properties)

Gradle提供了惰性属性，这延迟了对属性值的计算，直到真正需要它为止。这些为构建脚本和插件作者提供了三个主要好处：

  1. 构建作者可以将Gradle模型连接在一起，而不必担心何时知道特定属性的值。例如，您可能想基于扩展的源目录属性设置任务的输入源文件，但是直到构建脚本或某些其他插件对其进行配置之前，扩展属性的值才是未知的。

  2. Build authors can wire an output property of a task into an input property of some other task and Gradle automatically determines the task dependencies based on this connection. Property instances carry information about which task, if any, produces their value. Build authors do not need to worry about keeping task dependencies in sync with configuration changes.

  3. Build authors can avoid resource intensive work during the configuration phase, which can have a large impact on build performance. For example, when a configuration value comes from parsing a file but is only used when functional tests are run, using a property instance to capture this means that the file is parsed only when the functional tests are run, but not when, for example, `clean` is run.

Gradle represents lazy properties with two interfaces:

  * [Provider](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html) represents a value that can only be queried and cannot be changed.

    * Properties with these types are read-only.

    * The method [Provider.get()](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#get--) returns the current value of the property.

    * A `Provider` can be created from another `Provider` using [Provider.map(Transformer)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-).

    * Many other types extend `Provider` and can be used where-ever a `Provider` is required.

  * [Property](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html) represents a value that can be queried and also changed.

    * Properties with these types are configurable.

    * `Property` extends the `Provider` interface.

    * The method [Property.set(T)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html#set-T-) specifies a value for the property, overwriting whatever value may have been present.

    * [Property.set（Provider）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-)方法为[属性](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html#set-org.gradle.api.provider.Provider-)`Provider`的值指定一个，覆盖可能存在的任何值。这使您可以在配置值之前将实例`Provider`和`Property`实例连接在一起。

    * 阿`Property`可通过工厂方法创建[ObjectFactory.property（类）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-)。

惰性属性旨在传递，并且仅在需要时才查询。通常，这将在执行阶段发生。有关Gradle构建阶段的更多信息，请参见[构建生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:build_phases)。

以下内容演示了一个任务，该任务具有可配置的`greeting`属性和`message`从中派生的只读属性：

示例1.使用只读和可配置属性

`Groovy``Kotlin`

build.gradle

    
    
    // A task that displays a greeting
    class Greeting extends DefaultTask {
        // A configurable greeting
        @Input
        final Property<String> greeting = project.objects.property(String)
    
        // Read-only property calculated from the greeting
        @Internal
        final Provider<String> message = greeting.map { it + ' from Gradle' }
    
        @TaskAction
        void printMessage() {
            logger.quiet(message.get())
        }
    }
    
    task greeting(type: Greeting) {
        // Configure the greeting
        greeting.set('Hi')
    
        // Note that an assignment statement can be used instead of calling Property.set()
        greeting = 'Hi'
    }

build.gradle.kts

    
    
    // A task that displays a greeting
    open class Greeting : DefaultTask() {
        // Configurable by the user
        @Input
        val greeting: Property<String> = project.objects.property()
    
        // Read-only property calculated from the greeting
        @Internal
        val message: Provider<String> = greeting.map { it + " from Gradle" }
    
        @TaskAction
        fun printMessage() {
            logger.quiet(message.get())
        }
    }
    
    tasks.register<Greeting>("greeting") {
        // Configure the greeting
        greeting.set("Hi")
    }

输出 **`gradle greeting`**

    
    
    $ gradle问候
    
    >任务：问候
    来自Gradle的大家好
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

该`Greeting`任务的类型属性`Property<String>`代表可配置的问候语，并且类型属性`Provider<String>`代表计算的只读消息。该消息`Provider`是`Property`使用该`map()`方法从问候语创建的，因此，随着greeting属性值的更改，其值将保持最新。

__ |

请注意，Gradle Groovy
DSL为`Property`任务实现中的每个类型的属性生成设置方法。这些设置方法使您可以`=`方便地使用Assignment（）运算符配置属性。

Kotlin DSL便利性将在将来的版本中添加。  
  
---|---  
  
##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#creating_property_provider)[创建属性或提供程序实例](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#creating_property_provider)

Neither `Provider` nor its subtypes such as `Property` are intended to be
implemented by a build script or plugin author. Gradle provides factory
methods to create instances of these types instead. See the [Quick
Reference](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_reference)
for all of the types and factories available. In the previous example, we have
seen 2 factory methods:

  * [ObjectFactory.property(Class)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-) create a new `Property` instance. An instance of the [ObjectFactory](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html) can be referenced from [Project.getObjects()](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Project.html#getObjects--) or by injecting `ObjectFactory` through a constructor or method.

  * [Provider.map(Transformer)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-) creates a new `Provider` from an existing `Provider` or `Property` instance.

A `Provider` can also be created by the factory method
[ProviderFactory.provider(Callable)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-
java.util.concurrent.Callable-). You should prefer using `map()` instead, as
this has some useful benefits, which we will see later.

__ |

There are no specific methods create a provider using a `groovy.lang.Closure`.
When writing a plugin or build script with Groovy, you can use the
`map(Transformer)` method with a closure and Groovy will take care of
converting the closure to a `Transformer`. You can see this in action in the
previous example.

Similarly, when writing a plugin or build script with Kotlin, the Kotlin
compiler will take care of converting a Kotlin function into a `Transformer`.  
  
---|---  
  
##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#connecting_properties_together)[Connecting
properties
together](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#connecting_properties_together)

惰性属性的一个重要特征是它们可以连接在一起，从而对一个属性的更改会自动反映在其他属性中。这是一个将任务的属性连接到项目扩展的属性的示例：

示例2.将属性连接在一起

`Groovy``Kotlin`

build.gradle

    
    
    // A project extension
    class MessageExtension {
        // A configurable greeting
        final Property<String> greeting
    
        @javax.inject.Inject
        MessageExtension(ObjectFactory objects) {
            greeting = objects.property(String)
        }
    }
    
    // A task that displays a greeting
    class Greeting extends DefaultTask {
        // A configurable greeting
        @Input
        final Property<String> greeting = project.objects.property(String)
    
        // Read-only property calculated from the greeting
        @Internal
        final Provider<String> message = greeting.map { it + ' from Gradle' }
    
        @TaskAction
        void printMessage() {
            logger.quiet(message.get())
        }
    }
    
    // Create the project extension
    project.extensions.create('messages', MessageExtension)
    
    // Create the greeting task
    task greeting(type: Greeting) {
        // Attach the greeting from the project extension
        // Note that the values of the project extension have not been configured yet
        greeting.set(project.messages.greeting)
    
        // Note that an assignment statement can be used instead of calling Property.set()
        greeting = project.messages.greeting
    }
    
    messages {
        // Configure the greeting on the extension
        // Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes
        greeting = 'Hi'
    }

build.gradle.kts

    
    
    // A project extension
    open class MessageExtension(objects: ObjectFactory) {
        // A configurable greeting
        val greeting: Property<String> = objects.property()
    }
    
    // A task that displays a greeting
    open class Greeting : DefaultTask() {
        // Configurable by the user
        @Input
        val greeting: Property<String> = project.objects.property()
    
        // Read-only property calculated from the greeting
        @Internal
        val message: Provider<String> = greeting.map { it + " from Gradle" }
    
        @TaskAction
        fun printMessage() {
            logger.quiet(message.get())
        }
    }
    
    // Create the project extension
    val messages = project.extensions.create("messages", MessageExtension::class)
    
    // Create the greeting task
    tasks.register<Greeting>("greeting") {
        // Attach the greeting from the project extension
        // Note that the values of the project extension have not been configured yet
        greeting.set(messages.greeting)
    }
    
    configure<MessageExtension> {
        // Configure the greeting on the extension
        // Note that there is no need to reconfigure the task's `greeting` property. This is automatically updated as the extension property changes
        greeting.set("Hi")
    }

输出 **`gradle greeting`**

    
    
    $ gradle问候
    
    >任务：问候
    来自Gradle的大家好
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

本示例调用[Property.set（Provider）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html#set-
org.gradle.api.provider.Provider-)方法将a附加`Provider`到a，`Property`以提供属性的值。在这种情况下，`Provider`碰巧也是一种情况`Property`，但是您可以连接任何`Provider`实现，例如使用`Provider.map()`

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_files_in_lazy_properties)[处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_files_in_lazy_properties)

在[“使用文件”中](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html#working_with_files)，我们为`File`类对象引入了四种收集类型：

表1.文件概要回顾 只读类型 | 可配置类型  
---|---  
  
[文件集](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/FileCollection.html)

|

[ConfigurableFileCollection](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ConfigurableFileCollection.html)  
  
[文件树](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/FileTree.html)

|

[可配置文件树](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ConfigurableFileTree.html)  
  
所有这些类型也被认为是惰性类型。

在本节中，我们将介绍更强类型的模型类型来表示文件系统的元素：[Directory](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/Directory.html)和[RegularFile](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/RegularFile.html)。这些类型不应与标准Java
[File](https://docs.oracle.com/javase/8/docs/api/java/io/File.html)类型混淆，因为它们用于告诉Gradle和其他人您期望更具体的值，例如目录或非目录常规文件。

Gradle提供了两个专门的`Property`子类型来处理这些类型的值：[RegularFileProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/RegularFileProperty.html)和[DirectoryProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html)。[ObjectFactory](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html)具有创建这些方法的方法：[ObjectFactory.fileProperty（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--)和[ObjectFactory.directoryProperty（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--)。

A`DirectoryProperty`也可以分别通过[DirectoryProperty.dir（String）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-
java.lang.String-)和[DirectoryProperty.file（String）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#file-
java.lang.String-)来创建`Provider`对`Directory`和的延迟评估。这些方法创建提供程序，其值是根据创建它们的位置计算的。从这些提供程序返回的值将反映对的更改。`RegularFile`[](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-
java.lang.String-)[](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#file-
java.lang.String-)`DirectoryProperty``DirectoryProperty`

例子3.使用文件和目录属性

`Groovy``Kotlin`

build.gradle

    
    
    // A task that generates a source file and writes the result to an output directory
    class GenerateSource extends DefaultTask {
        // The configuration file to use to generate the source file
        @InputFile
        final RegularFileProperty configFile = project.objects.fileProperty()
    
        // The directory to write source files to
        @OutputDirectory
        final DirectoryProperty outputDir = project.objects.directoryProperty()
    
        @TaskAction
        def compile() {
            def inFile = configFile.get().asFile
            logger.quiet("configuration file = $inFile")
            def dir = outputDir.get().asFile
            logger.quiet("output dir = $dir")
            def className = inFile.text.trim()
            def srcFile = new File(dir, "${className}.java")
            srcFile.text = "public class ${className} { ... }"
        }
    }
    
    // Create the source generation task
    task generate(type: GenerateSource) {
        // Configure the locations, relative to the project and build directories
        configFile = project.layout.projectDirectory.file('src/main/config.txt')
        outputDir = project.layout.buildDirectory.dir('generated-source')
    
        // Note that a `File` instance can be used as a convenience to set a location
        configFile = file('src/config.txt')
    }
    
    // Change the build directory
    // Don't need to reconfigure the task properties. These are automatically updated as the build directory changes
    buildDir = 'output'

build.gradle.kts

    
    
    // A task that generates a source file and writes the result to an output directory
    open class GenerateSource @javax.inject.Inject constructor(objects: ObjectFactory): DefaultTask() {
        @InputFile
        val configFile: RegularFileProperty = objects.fileProperty()
    
        @OutputDirectory
        val outputDir: DirectoryProperty = objects.directoryProperty()
    
        @TaskAction
        fun compile() {
            val inFile = configFile.get().asFile
            logger.quiet("configuration file = $inFile")
            val dir = outputDir.get().asFile
            logger.quiet("output dir = $dir")
            val className = inFile.readText().trim()
            val srcFile = File(dir, "${className}.java")
            srcFile.writeText("public class ${className} { }")
        }
    }
    
    // Create the source generation task
    tasks.register<GenerateSource>("generate") {
        // Configure the locations, relative to the project and build directories
        configFile.set(project.layout.projectDirectory.file("src/config.txt"))
        outputDir.set(project.layout.buildDirectory.dir("generated-source"))
    }
    
    // Change the build directory
    // Don't need to reconfigure the task properties. These are automatically updated as the build directory changes
    buildDir = file("output")

输出 **`gradle print`**

    
    
    $ gradle打印
    
    >任务：生成
    配置文件= /home/user/gradle/samples/src/config.txt
    输出目录= / home / user / gradle / samples / output / generated-source
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

Output of **`gradle print`**

    
    
    $ gradle print
    
    > Task :generate
    configuration file = /home/user/gradle/samples/kotlin/src/config.txt
    output dir = /home/user/gradle/samples/kotlin/output/generated-source
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

本示例创建表示项目位置的提供程序，并通过[Project.getLayout（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Project.html#getLayout--)和[ProjectLayout.getBuildDirectory（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ProjectLayout.html#getBuildDirectory--)和[ProjectLayout.getProjectDirectory（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ProjectLayout.html#getProjectDirectory--)构建目录。

要关闭循环，请注意，可以将a`DirectoryProperty`或简单的`Directory`转换为a
`FileTree`，以允许使用[DirectoryProperty.getAsFileTree（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--)或[Directory.getAsFileTree（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/Directory.html#getAsFileTree--)查询目录中包含的文件和目录。此外，还可以通过[DirectoryProperty.files（Object
...）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#files-
java.lang.Object...-)或[Directory.files（Object
...）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/Directory.html#files-
java.lang.Object...-)从`DirectoryProperty`或中`Directory`创建`FileCollection`实例，该实例包含目录中包含的一组文件。[](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#files-
java.lang.Object...-)[](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/Directory.html#files-
java.lang.Object...-)

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_task_dependencies_in_lazy_properties)[使用任务输入和输出](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_task_dependencies_in_lazy_properties)

许多内部版本将多个任务连接在一起，其中一个任务将另一任务的输出作为输入。为了使这项工作有效，我们将需要配置每个任务以知道在哪里寻找其输入并放置其输出，确保将生产和使用任务配置在相同的位置，并在任务之间附加任务依赖性。如果这些值中的任何一个可由用户配置或由多个插件配置，那么这将很麻烦且脆弱，因为需要按正确的顺序配置任务属性，并且随着值的更改，位置和任务相关性必须保持同步。

该`Property`API使这种通过跟踪不只是价值的财产，这是我们已经看到的更容易，但也产生了价值，让您不必将其指定为好任务。例如，考虑以下带有生产者和消费者任务的插件，它们相互连接在一起：

例子4.隐式任务输入文件的依赖性

`Groovy``Kotlin`

build.gradle

    
    
    class Producer extends DefaultTask {
        @OutputFile
        final RegularFileProperty outputFile = project.objects.fileProperty()
    
        @TaskAction
        void produce() {
            String message = 'Hello, World!'
            def output = outputFile.get().asFile
            output.text = message
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    class Consumer extends DefaultTask {
        @InputFile
        final RegularFileProperty inputFile = project.objects.fileProperty()
    
        @TaskAction
        void consume() {
            def input = inputFile.get().asFile
            def message = input.text
            logger.quiet("Read '${message}' from ${input}")
        }
    }
    
    def producer = tasks.register("producer", Producer)
    def consumer = tasks.register("consumer", Consumer)
    
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    consumer.configure {
        inputFile = producer.flatMap { it.outputFile }
    }
    
    // Set values for the producer lazily
    // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
    producer.configure {
        outputFile = layout.buildDirectory.file('file.txt')
    }
    
    // Change the build directory.
    // Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes
    buildDir = 'output'

build.gradle.kts

    
    
    open class Producer : DefaultTask() {
        @OutputFile
        val outputFile: RegularFileProperty = project.objects.fileProperty()
    
        @TaskAction
        fun produce() {
            val message = "Hello, World!"
            val output = outputFile.get().asFile
            output.writeText( message)
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    open class Consumer : DefaultTask() {
        @InputFile
        val inputFile: RegularFileProperty = project.objects.fileProperty()
    
        @TaskAction
        fun consume() {
            val input = inputFile.get().asFile
            val message = input.readText()
            logger.quiet("Read '${message}' from ${input}")
        }
    }
    
    val producer by tasks.registering(Producer::class)
    val consumer by tasks.registering(Consumer::class)
    
    consumer.configure {
        // Connect the producer task output to the consumer task input
        // Don't need to add a task dependency to the consumer task. This is automatically added
        inputFile.set(producer.flatMap { it.outputFile })
    }
    
    producer.configure {
        // Set values for the producer lazily
        // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
        outputFile.set(layout.buildDirectory.file("file.txt"))
    }
    
    // Change the build directory.
    // Don't need to update producer.outputFile and consumer.inputFile. These are automatically updated as the build directory changes
    buildDir = file("output")

输出 **`gradle consumer`**

    
    
    $ gradle消费者
    
    >任务：生产者
    写了“你好，世界！” 到/home/user/gradle/samples/output/file.txt
    
    >任务：消费者
    阅读“你好，世界！” 来自/home/user/gradle/samples/output/file.txt
    
    在0秒内成功建立
    2个可执行任务：2个已执行

Output of **`gradle consumer`**

    
    
    $ gradle consumer
    
    > Task :producer
    Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/file.txt
    
    > Task :consumer
    Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/file.txt
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed

在上面的示例中，在定义任何位置之前已连接任务输出和输入。可以在执行任务之前的任何时间调用设置器，更改将自动影响所有相关的输入和输出属性。

在此示例中要注意的另一件重要事情是，没有任何明确的任务依赖性。通过`Providers`跟踪哪个任务产生其值来表示的任务输出，并将它们用作任务输入将隐式添加正确的任务依赖性。

隐式任务依赖项也适用于不是文件的输入属性。

例子5.隐式任务输入依赖

`Groovy``Kotlin`

build.gradle

    
    
    class Producer extends DefaultTask {
        @OutputFile
        final RegularFileProperty outputFile = project.objects.fileProperty()
    
        @TaskAction
        void produce() {
            String message = 'Hello, World!'
            def output = outputFile.get().asFile
            output.text = message
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    class Consumer extends DefaultTask {
        @Input
        final Property<String> message = project.objects.property(String)
    
        @TaskAction
        void consume() {
            logger.quiet(message.get())
        }
    }
    
    task producer(type: Producer)
    task consumer(type: Consumer)
    
    // Connect the producer task output to the consumer task input
    // Don't need to add a task dependency to the consumer task. This is automatically added
    consumer.message = producer.outputFile.map { it.asFile.text }
    
    // Set values for the producer lazily
    producer.outputFile = layout.buildDirectory.file('file.txt')

build.gradle.kts

    
    
    open class Producer : DefaultTask() {
        @OutputFile
        val outputFile: RegularFileProperty = project.objects.fileProperty()
    
        @TaskAction
        fun produce() {
            val message = "Hello, World!"
            val output = outputFile.get().asFile
            output.writeText( message)
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    open class Consumer : DefaultTask() {
        @Input
        val message: Property<String> = project.objects.property(String::class)
    
        @TaskAction
        fun consume() {
            logger.quiet(message.get())
        }
    }
    
    val producer by tasks.registering(Producer::class) {
        // Set values for the producer lazily
        // Don't need to update the consumer.inputFile property. This is automatically updated as producer.outputFile changes
        outputFile.set(layout.buildDirectory.file("file.txt"))
    }
    val consumer by tasks.registering(Consumer::class) {
        // Connect the producer task output to the consumer task input
        // Don't need to add a task dependency to the consumer task. This is automatically added
        message.set(producer.map { it.outputFile.get().asFile.readText() })
    }

输出 **`gradle consumer`**

    
    
    $ gradle消费者
    
    >任务：生产者
    写了“你好，世界！” 到/home/user/gradle/samples/build/file.txt
    
    >任务：消费者
    你好，世界！
    
    在0秒内成功建立
    2个可执行任务：2个已执行

Output of **`gradle consumer`**

    
    
    $ gradle consumer
    
    > Task :producer
    Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/build/file.txt
    
    > Task :consumer
    Hello, World!
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_collections)[使用收藏](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_collections)

Gradle提供了两种惰性属性来帮助配置`Collection`属性。这些文件的工作原理与其他任何`Provider`文件一样，并且与文件提供程序一样，它们具有其他建模功能：

  * 对于`List`值，该接口称为[ListProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/ListProperty.html)。您可以`ListProperty`使用[ObjectFactory.listProperty（Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-)并指定元素类型来创建新的。

  * 对于`Set`值，该接口称为[SetProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/SetProperty.html)。您可以`SetProperty`使用[ObjectFactory.setProperty（Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-)并指定元素类型来创建新的。

这种类型的属性使您可以使用[HasMultipleValues.set（Iterable）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-
java.lang.Iterable-)和[HasMultipleValues.set（Provider）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasMultipleValues.html#set-
org.gradle.api.provider.Provider-)覆盖整个集合值，或通过各种`add`方法添加新元素：

  * [HasMultipleValues.add（T）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-T-)：将单个元素添加到集合中

  * [HasMultipleValues.add（Provider）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasMultipleValues.html#add-org.gradle.api.provider.Provider-)：将延迟计算的元素添加到集合中

  * [HasMultipleValues.addAll（Provider）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasMultipleValues.html#addAll-org.gradle.api.provider.Provider-)：将延迟计算的元素集合添加到列表中

就像every一样`Provider`，在调用[Provider.get（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#get--)时计算集合。以下示例显示了运行中的[ListProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/ListProperty.html)：

例子6.列表属性

`Groovy``Kotlin`

build.gradle

    
    
    class Producer extends DefaultTask {
        @OutputFile
        final RegularFileProperty outputFile = project.objects.fileProperty()
    
        @TaskAction
        void produce() {
            String message = 'Hello, World!'
            def output = outputFile.get().asFile
            output.text = message
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    class Consumer extends DefaultTask {
        @InputFiles
        final ListProperty<RegularFile> inputFiles = project.objects.listProperty(RegularFile)
    
        @TaskAction
        void consume() {
            inputFiles.get().each { inputFile ->
                def input = inputFile.asFile
                def message = input.text
                logger.quiet("Read '${message}' from ${input}")
            }
        }
    }
    
    task producerOne(type: Producer)
    task producerTwo(type: Producer)
    task consumer(type: Consumer)
    
    // Connect the producer task outputs to the consumer task input
    // Don't need to add task dependencies to the consumer task. These are automatically added
    consumer.inputFiles.add(producerOne.outputFile)
    consumer.inputFiles.add(producerTwo.outputFile)
    
    // Set values for the producer tasks lazily
    // Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes
    producerOne.outputFile = layout.buildDirectory.file('one.txt')
    producerTwo.outputFile = layout.buildDirectory.file('two.txt')
    
    // Change the build directory.
    // Don't need to update the task properties. These are automatically updated as the build directory changes
    buildDir = 'output'

build.gradle.kts

    
    
    open class Producer : DefaultTask() {
        @OutputFile
        val outputFile: RegularFileProperty = project.objects.fileProperty()
    
        @TaskAction
        fun produce() {
            val message = "Hello, World!"
            val output = outputFile.get().asFile
            output.writeText( message)
            logger.quiet("Wrote '${message}' to ${output}")
        }
    }
    
    open class Consumer : DefaultTask() {
        @InputFiles
        val inputFiles: ListProperty<RegularFile> = project.objects.listProperty(RegularFile::class)
    
        @TaskAction
        fun consume() {
            inputFiles.get().forEach { inputFile ->
                val input = inputFile.asFile
                val message = input.readText()
                logger.quiet("Read '${message}' from ${input}")
            }
        }
    }
    
    val producerOne by tasks.registering(Producer::class)
    val producerTwo by tasks.registering(Producer::class)
    val consumer by tasks.registering(Consumer::class) {
        // Connect the producer task outputs to the consumer task input
        // Don't need to add task dependencies to the consumer task. These are automatically added
        inputFiles.add(producerOne.get().outputFile)
        inputFiles.add(producerTwo.get().outputFile)
    }
    
    // Set values for the producer tasks lazily
    // Don't need to update the consumer.inputFiles property. This is automatically updated as producer.outputFile changes
    producerOne { outputFile.set(layout.buildDirectory.file("one.txt")) }
    producerTwo { outputFile.set(layout.buildDirectory.file("two.txt")) }
    
    // Change the build directory.
    // Don't need to update the task properties. These are automatically updated as the build directory changes
    buildDir = file("output")

输出 **`gradle consumer`**

    
    
    $ gradle消费者
    
    >任务：生产者一个
    写了“你好，世界！” 到/home/user/gradle/samples/output/one.txt
    
    >任务：生产者2
    写了“你好，世界！” 到/home/user/gradle/samples/output/two.txt
    
    >任务：消费者
    阅读“你好，世界！” 来自/home/user/gradle/samples/output/one.txt
    阅读“你好，世界！” 来自/home/user/gradle/samples/output/two.txt
    
    在0秒内成功建立
    3个可执行的任务：3个已执行

Output of **`gradle consumer`**

    
    
    $ gradle consumer
    
    > Task :producerOne
    Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/one.txt
    
    > Task :producerTwo
    Wrote 'Hello, World!' to /home/user/gradle/samples/kotlin/output/two.txt
    
    > Task :consumer
    Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/one.txt
    Read 'Hello, World!' from /home/user/gradle/samples/kotlin/output/two.txt
    
    BUILD SUCCESSFUL in 0s
    3 actionable tasks: 3 executed

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_maps)[使用地图](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#working_with_maps)

Gradle提供了一个惰性[MapProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/MapProperty.html)类型，以允许`Map`配置值。您可以`MapProperty`使用[ObjectFactory.mapProperty（Class，Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#mapProperty-
java.lang.Class-java.lang.Class-)创建一个实例。

与其他属性类型相似，一个`MapProperty`具有[set（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/MapProperty.html#set-
java.util.Map-)方法，可用于指定该属性的值。还有一些其他方法可以将具有惰性值的条目添加到映射中。

例子7.地图属性

`Groovy``Kotlin`

build.gradle

    
    
    class Generator extends DefaultTask {
        @Input
        final MapProperty<String, Integer> properties = project.objects.mapProperty(String, Integer)
    
        @TaskAction
        void generate() {
            properties.get().each { key, value ->
                logger.quiet("${key} = ${value}")
            }
        }
    }
    
    // Some values to be configured later
    def b = 0
    def c = 0
    
    task generate(type: Generator) {
        properties.put("a", 1)
        // Values have not been configured yet
        properties.put("b", providers.provider { b })
        properties.putAll(providers.provider { [c: c, d: c + 1] })
    }
    
    // Configure the values. There is no need to reconfigure the task
    b = 2
    c = 3

build.gradle.kts

    
    
    open class Generator: DefaultTask() {
        @Input
        val properties: MapProperty<String, Int> = project.objects.mapProperty(String::class, Int::class)
    
        @TaskAction
        fun generate() {
            properties.get().forEach { entry ->
                logger.quiet("${entry.key} = ${entry.value}")
            }
        }
    }
    
    // Some values to be configured later
    var b = 0
    var c = 0
    
    tasks.register<Generator>("generate") {
        properties.put("a", 1)
        // Values have not been configured yet
        properties.put("b", providers.provider { b })
        properties.putAll(providers.provider { mapOf("c" to c, "d" to c + 1) })
    }
    
    // Configure the values. There is no need to reconfigure the task
    b = 2
    c = 3

输出 **`gradle consumer`**

    
    
    $ gradle生成
    
    >任务：生成
    a = 1
    b = 2
    c = 3
    d = 4
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#applying_conventions)[将约定应用于属性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#applying_conventions)

如果尚未为该属性配置任何值，通常您希望将某些 _约定_ 或默认值应用于该属性。您可以`convention()`为此使用方法。此方法接受一个值或a
`Provider`，它将被用作该值，直到配置了其他值。

例子8.属性约定

`Groovy``Kotlin`

build.gradle

    
    
    task show {
        doLast {
            def property = objects.property(String)
    
            // Set a convention
            property.convention("convention 1")
            println("value = " + property.get())
    
            // Can replace the convention
            property.convention("convention 2")
            println("value = " + property.get())
    
            property.set("value")
    
            // Once a value is set, the convention is ignored
            property.convention("ignored convention")
            println("value = " + property.get())
        }
    }

build.gradle.kts

    
    
    tasks.register("show") {
        doLast {
            val property = objects.property(String::class)
    
            property.convention("convention 1")
            println("value = " + property.get())
    
            // Can replace the convention
            property.convention("convention 2")
            println("value = " + property.get())
    
            property.set("value")
            // Once a value is set, the convention is ignored
    
            property.convention("ignored convention")
            println("value = " + property.get())
        }
    }

输出 **`gradle show`**

    
    
    $ gradle显示
    
    >任务：显示
    值=约定1
    值=约定2
    值=值
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#unmodifiable_property)[使财产不可修改](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#unmodifiable_property)

任务或项目的大多数属性旨在由插件或构建脚本配置，然后将所得的值用于做一些有用的事情。例如，为编译任务指定输出目录的属性可以从插件指定的值开始，然后构建脚本可能将其更改为某个自定义位置，然后任务在运行时使用该值。但是，一旦任务开始运行，我们希望防止对该属性进行任何进一步的更改。这样，我们可以避免使用不同属性的值来避免由不同使用者产生的错误，例如任务操作或Gradle的最新检查或构建缓存或其他任务。

惰性属性提供了几种方法，您可以在配置值后禁止更改其值。所述[finalizeValue（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html#finalizeValue--)方法计算
_最终_
的属性值，并且防止到属性进一步的修改。当属性的值来自时`Provider`，将查询提供程序的当前值，结果将成为属性的最终值。此最终值将替换提供程序，并且该属性不再跟踪提供程序的值。调用此方法还会使属性实例不可修改，并且任何进一步尝试更改属性值的尝试都会失败。当任务开始执行时，Gradle会自动使任务的属性最终化。

所述[finalizeValueOnRead（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/HasConfigurableValue.html#finalizeValueOnRead--)方法是类似的，不同之处在于，不计算该属性的最终值，直到属性的值被查询。换句话说，该方法根据需要延迟计算最终值，而`finalizeValue()`急切地计算最终值。当值的计算成本可能很高或尚未进行配置时，可以使用此方法，但是您还想确保该属性的所有使用者在查询该值时都看到相同的值。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_faqs)[指导方针](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_faqs)

本节将介绍成功使用Provider API的准则。要查看这些指导原则，请查看[gradle-site-
plugin](https://github.com/gradle/gradle-site-
plugin)，这是一个Gradle插件，演示了已建立的插件开发技术和实践。

  * 该[物业](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)和[供应商](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)类型有所有你需要查询或配置的值重载。因此，您应该遵循以下准则：

    * 对于可配置的属性，直接通过单个getter公开该[Property](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)。

    * 对于不可配置的属性，请直接通过单个getter公开[提供程序](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)。

  * 避免简化，例如来电`obj.getProperty().get()`，并`obj.getProperty().set(T)`在你的代码通过引入额外的getter和setter。

  * 在将插件迁移为使用提供程序时，请遵循以下准则：

    * 如果是新属性，请使用单个getter将其公开为[Property](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)或[Provider](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)。

    * 如果正在孵化，请将其更改为使用单个吸气剂使用[属性](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)或[提供程序](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)。

    * 如果它是稳定的属性，请添加新的[属性](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)或[提供者，](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)并弃用旧的[属性](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)或[提供者](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)。您应将旧的吸气剂/装料器适当地连接到新的属性中。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_roadmap)[未来发展](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_roadmap)

展望未来，新属性将使用提供者API。Groovy Gradle
DSL添加了便捷的方法，以使提供程序的使用在构建脚本中几乎是透明的。现有任务将根据需要并以向后兼容的方式将其现有的“原始”属性替换为提供程序。新任务将使用提供程序API设计。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_reference)[提供程序文件API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_configuration_reference)

将这些类型用于 _只读_ 值：

[提供者](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)<
[RegularFile](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/RegularFile.html)
>

    

磁盘上的文件

工厂工厂

    

  * [Provider.map（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-)。

  * [Provider.flatMap（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-)。

  * [DirectoryProperty.file（String）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#file-java.lang.String-)

[提供者](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)<[目录](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/Directory.html)>

    

磁盘上的目录

工厂工厂

    

  * [Provider.map（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-)。

  * [Provider.flatMap（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-)。

  * [DirectoryProperty.dir（字符串）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#dir-java.lang.String-)

[文件集](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/FileCollection.html)

    

非结构化文件集合

工厂工厂

    

  * [Project.files（Object []）](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Project.html#org.gradle.api.Project:files\(java.lang.Object\[\]\))

  * [ProjectLayout.files（Object ...）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ProjectLayout.html#files-java.lang.Object...-)

  * [DirectoryProperty.files（Object ...）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#files-java.lang.Object...-)

[文件树](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/FileTree.html)

    

文件层次结构

工厂工厂

    

  * [Project.fileTree（Object）](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Project.html#org.gradle.api.Project:fileTree\(java.lang.Object\))将产生[ConfigurableFileTree](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ConfigurableFileTree.html)，或者您可以使用[Project.zipTree（Object）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Project.html#zipTree-java.lang.Object-)和[Project.tarTree（Object）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Project.html#tarTree-java.lang.Object-)

  * [DirectoryProperty.getAsFileTree（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html#getAsFileTree--)

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#property_files_api_reference)[属性文件API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#property_files_api_reference)

将这些类型用于 _可变_ 值：

[RegularFileProperty](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/RegularFileProperty.html)

    

磁盘上的文件

工厂工厂

    

  * [ObjectFactory.fileProperty（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#fileProperty--)

[目录属性](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/DirectoryProperty.html)

    

磁盘上的目录

工厂工厂

    

  * [ObjectFactory.directoryProperty（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#directoryProperty--)

[ConfigurableFileCollection](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ConfigurableFileCollection.html)

    

非结构化文件集合

工厂工厂

    

  * [ObjectFactory.fileCollection（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#fileCollection--)

[可配置文件树](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/ConfigurableFileTree.html)

    

文件层次结构

工厂工厂

    

  * [ObjectFactory.fileTree（）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#fileTree--)

[SourceDirectorySet](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/file/SourceDirectorySet.html)

    

源目录的层次结构

工厂工厂

    

  * [ObjectFactory.sourceDirectorySet（String，String）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#sourceDirectorySet-java.lang.String-java.lang.String-)

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_collections_api_reference)[惰性集合API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_collections_api_reference)

将这些类型用于 _可变_ 值：

[ListProperty
<T>](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/ListProperty.html)

    

属性值为 `List<T>`

工厂工厂

    

  * [ObjectFactory.listProperty（Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#listProperty-java.lang.Class-)

[SetProperty
<T>](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/SetProperty.html)

    

属性值为 `Set<T>`

工厂工厂

    

  * [ObjectFactory.setProperty（Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#setProperty-java.lang.Class-)

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_objects_api_reference)[惰性对象API参考](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html#lazy_objects_api_reference)

将这些类型用于 _只读_ 值：

[提供者<T>](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html)

    

属性的值是的一个实例 `T`

工厂工厂

    

  * [Provider.map（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#map-org.gradle.api.Transformer-)。

  * [Provider.flatMap（Transformer）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Provider.html#flatMap-org.gradle.api.Transformer-)。

  * [ProviderFactory.provider（Callable）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/ProviderFactory.html#provider-java.util.concurrent.Callable-)。总是比其他方法更喜欢其他工厂方法之一。

将这些类型用于 _可变_ 值：

[属性<T>](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/provider/Property.html)

    

属性的值是的一个实例 `T`

工厂工厂

    

  * [ObjectFactory.property（Class）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/model/ObjectFactory.html#property-java.lang.Class-)

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./延迟配置_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

