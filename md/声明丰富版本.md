# 声明丰富版本

Gradle支持用于声明版本的丰富模型，该模型允许组合不同级别的版本信息。术语及其含义如下（从最强到最弱）：

---
`strictly`


与该版本符号不匹配的任何版本将被排除。这是最强的版本声明。
在声明的依赖项上，`strictly`可以降级版本。
在传递依赖项上，如果无法选择此子句可接受的版本，将导致依赖项解析失败。
有关详细信息，请参见[覆盖依赖项版本](/md/降级版本并排除依赖项.md#覆盖传递依赖项版本)。
该术语支持动态版本。

定义后，将覆盖先前的`require`声明并清除之前的 `reject`。

---
`require`

    

表示所选版本不能低于`require`可接受的版本，但可以通过冲突解决方案提高，即使更高版本具有排他性更高的界限。
这就是依赖项上的直接版本所转换的内容。该术语支持动态版本。

定义后，将覆盖先前的`strictly`声明并清除之前的 `reject`。

---
`prefer`

这是一个非常软的版本声明。仅当对该模块的版本没有更强的非动态观点时，才适用。
该术语不支持动态版本。

定义可以补充`strictly`或`require`。

在级别层次结构之外还有一个附加术语：

---
`reject`

    
声明模块不接受特定版本。如果唯一的可选版本也被拒绝，这将导致依赖项解析失败。该术语支持动态版本。

---
下表说明了许多用例以及如何组合不同的术语以进行丰富版本声明：

表1.丰富版本的用例
 
可以使用哪个版本的依存关系？| `strictly` | `require` | `prefer` | `rejects` |选择结果  
---|---  |---|---  |---|---    
经过测试的`1.5`，相信所有将来的版本都可以使用。|  |1.5|  |  |任何版本的开始`1.5`，相当于`org:foo:1.5`。接受升级到`2.4`。  
经过测试的`1.5`，约束根据语义版本升级。|  |`[1.0,2.0 [`|1.5|  |`1.0`和`2.0`之间的任何版本（如果没有其他人关心`1.5`）。接受升级到`2.4`。  🔒  
经过测试`1.5`，但遵循语义版本控制。|`[1.0,2.0[`|  |1.5|  |如果没有其他人在乎`1.5`，则介于`1.0`和`2.0`之间的任何版本。 从传递依赖项覆盖版本。 🔒 
与上述相同，但`1.4`已知已损坏。|`[1.0,2.0[`|  |1.5|1.4|任何`1.0`与`2.0`版本之间并排除`1.4`，如果没有人关心`1.5`。  从传递依赖项覆盖版本。  🔒    
没意见，使用`1.5`工作。|  |  |1.5|  | 如果没有其他意见，则`1.5`。  
没意见，偏向最新版本。|  |  |`latest.release`|  |构建时的最新版本。  🔒  
在边缘，最新版本，没有降级。|  |`latest.release`|  |  |构建时的最新版本。  🔒   
没有其他版本，只有1.5。|1.5|  |  |  |1.5，如果另一个`strict`或更高的`require`约束不同意，则失败。  从传递依赖项覆盖版本。  
`1.5` 或专门的补丁版本。|`[1.5,1.6[`|  |  |  |最新的`1.5.x`修补程序版本，如果另一个`strict`或更高的`require`约束不同意，则失败。  从传递依赖项覆盖版本。  🔒  
  
带锁（🔒）的行表示在这种情况下，利用[依赖项锁](/md/锁定依赖版本.md)是有意义的。与丰富版本声明有关的另一个概念是发布已[解析版本](/md/Maven发布插件.md#自定义依赖版本)而不是已声明[版本](/md/Maven发布插件.md#自定义依赖版本)的能力。

使用`strictly`，尤其是对于Library，必须经过深思熟虑，因为它会对下游用户产生影响。
同时，如果使用得当，它将有助于消费者了解哪些库组合在其上下文中无法协同工作。
有关更多信息，请参见[覆盖依赖项版本](/md/降级版本并排除依赖项.md#覆盖传递依赖项版本)。

╔═════════════════════════════  

丰富的版本信息将以Gradle
Module元数据格式保存。但是，转换为Ivy或Maven元数据格式将是有损的。
最高级别将被发布，即`strictly`或`require`而不是`prefer`。此外，任何内容`reject`都将被忽略。  
  
╚═════════════════════════════    
  
丰富版本声明通过`version`DSL方法在依赖项或约束声明上访问，
该声明提供对[MutableVersionConstraint的](https://docs.gradle.org/6.7.1/javadoc/org/gradle/api/artifacts/MutableVersionConstraint.html) 访问。

例子1.丰富的版本声明

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        implementation('org.slf4j:slf4j-api') {
            version {
                strictly '[1.7, 1.8['
                prefer '1.7.25'
            }
        }
    
        constraints {
            implementation('org.springframework:spring-core') {
                version {
                    require '4.2.9.RELEASE'
                    reject '4.3.16.RELEASE'
                }
            }
        }
    }

build.gradle.kts

    
    
    dependencies {
        implementation("org.slf4j:slf4j-api") {
            version {
                strictly("[1.7, 1.8[")
                prefer("1.7.25")
            }
        }
    
        constraints {
            add("implementation", "org.springframework:spring-core") {
                version {
                    require("4.2.9.RELEASE")
                    reject("4.3.16.RELEASE")
                }
            }
        }
    }

