

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [来自蚂蚁](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#customizing-execution)
    * [配置构建环境](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [配置Gradle守护程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#optimizing-build-performance)
    * [构建绩效指南](https://guides.gradle.org/performance/)
    * [启用和配置构建缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [使用配置缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#learning-the-basics)
    * [介绍构建脚本的基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [处理任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [了解有关构建脚本的更多信息](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [使用Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [Understanding the Build Lifecycle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [Working with Logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [Avoiding Traps](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#authoring-multi-project-builds)
    * [Creating a Basic Multi-Project Build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#advanced-techniques)
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [Using Ant from Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [构建C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [测试C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [建立Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [测试Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### 使用依赖项

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [声明版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [控制翻译](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#controlling-transitive-dependencies)
    * [升级版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [降级和排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [共享版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [对齐依赖](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [处理互斥依赖性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [修复元数据](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [自定义分辨率](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [防止意外升级](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [图书馆的生产和消费形式](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [在多仓库环境中工作](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [出版图书馆](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [术语](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### 扩展摇篮

  * [插件开发教程](https://gradle.org/guides/?q=Plugin%20Development)
  * [编写Gradle任务类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [编写Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [编写自定义Gradle类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [延迟配置任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [使用避免任务配置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### 参考

  * [核心插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [命令行界面](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle和第三方工具](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [摇篮包装](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle管理的目录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# 对齐依赖版本

version 6.7.1

内容

  * [处理不一致的模块版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#handling_inconsistent_module_versions)
  * [将本机版本与Gradle对齐](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#aligning_versions_natively_with_gradle)
  * [对齐未随Gradle发布的模块版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:align-versions-unpublished)

Dependency version alignment allows different modules belonging to the same
logical group (a _platform_ ) to have identical versions in a dependency
graph.

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#handling_inconsistent_module_versions)[Handling
inconsistent module
versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#handling_inconsistent_module_versions)

Gradle supports aligning versions of modules which belong to the same
"platform". It is often preferable, for example, that the API and
implementation modules of a component are using the same version. However,
because of the game of transitive dependency resolution, it is possible that
different modules belonging to the same platform end up using different
versions. For example, your project may depend on the `jackson-databind` and
`vert.x` libraries, as illustrated below:

Example 1. Declaring dependencies

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        // a dependency on Jackson Databind
        implementation 'com.fasterxml.jackson.core:jackson-databind:2.8.9'
    
        // and a dependency on vert.x
        implementation 'io.vertx:vertx-core:3.5.3'
    }

build.gradle.kts

    
    
    dependencies {
        // a dependency on Jackson Databind
        implementation("com.fasterxml.jackson.core:jackson-databind:2.8.9")
    
        // and a dependency on vert.x
        implementation("io.vertx:vertx-core:3.5.3")
    }

Because `vert.x` depends on `jackson-core`, we would actually resolve the
following dependency versions:

  * `jackson-core` version `2.9.5` (brought by `vertx-core`)

  * `jackson-databind` version `2.9.5` (by conflict resolution)

  * `jackson-annotation` version `2.9.0` (dependency of `jackson-databind:2.9.5`)

It’s easy to end up with a set of versions which do not work well together. To
fix this, Gradle supports dependency version alignment, which is supported by
the concept of platforms. A platform represents a set of modules which "work
well together". Either because they are actually published as a whole (when
one of the members of the platform is published, all other modules are also
published with the same version), or because someone tested the modules and
indicates that they work well together (typically, the Spring Platform).

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#aligning_versions_natively_with_gradle)[将本机版本与Gradle对齐](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#aligning_versions_natively_with_gradle)

Gradle本机支持Gradle生产的模块的对齐。这是[依赖性约束](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html#sec:adding-
constraints-transitive-
deps)的可传递[性](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html#sec:adding-
constraints-transitive-
deps)的直接结果。因此，如果您具有多项目构建，并且希望使用者获得所有模块的相同版本，那么Gradle提供了一种使用[Java Platform
Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)进行此操作的简单方法。

例如，如果您的项目包含3个模块：

  * `lib`

  * `utils`

  * `core`，取决于`lib`和`utils`

并声明以下依赖项的使用者：

  * `core` 版本1.0

  * `lib` 版本1.1

然后默认情况下，解析将选择`core:1.0`和`lib:1.1`，因为`lib`与无关`core`。我们可以通过在项目中添加一个新的模块
_platform_ 来解决此问题，该模块将对项目的所有模块添加约束：

例子2.平台模块

`Groovy``Kotlin`

build.gradle

    
    
    plugins {
        id 'java-platform'
    }
    
    dependencies {
        // The platform declares constraints on all components that
        // require alignment
        constraints {
            api(project(":core"))
            api(project(":lib"))
            api(project(":utils"))
        }
    }

build.gradle.kts

    
    
    plugins {
        `java-platform`
    }
    
    dependencies {
        // The platform declares constraints on all components that
        // require alignment
        constraints {
            api(project(":core"))
            api(project(":lib"))
            api(project(":utils"))
        }
    }

完成此操作后，我们需要确保所有模块现在都 _依赖于该平台_ ，如下所示：

例子3.声明对平台的依赖

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        // Each project has a dependency on the platform
        api(platform(project(":platform")))
    
        // And any additional dependency required
        implementation(project(":lib"))
        implementation(project(":utils"))
    }

build.gradle.kts

    
    
    dependencies {
        // Each project has a dependency on the platform
        api(platform(project(":platform")))
    
        // And any additional dependency required
        implementation(project(":lib"))
        implementation(project(":utils"))
    }

平台对所有组件都包含约束很重要，而且每个组件都对平台具有依赖关系很重要。这样，每当摇篮将增加一个依赖关系图上的平台的模块，它会 _还_
包括对平台的其他模块的约束。这意味着，如果我们看到属于同一平台的另一个模块，我们将自动升级到相同版本。

在我们的示例中，这意味着我们首先看到`core:1.0`，它带来了一个`1.0`对`lib:1.0`and约束的平台`lib:1.0`。然后，我们添加`lib:1.1`对的依赖`platform:1.1`。通过冲突解决，我们选择对`1.1`施加约束的平台`core:1.1`。然后我们在`core:1.0`和之间解决冲突`core:1.1`，这意味着`core`和`lib`现在正确对齐。

__ |  仅当您使用Gradle Module元数据时，才对发布的组件强制执行此行为。  
---|---  
  
##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:align-
versions-
unpublished)[对齐未随Gradle发布的模块版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:align-
versions-unpublished)

Whenever the publisher doesn’t use Gradle, like in our Jackson example, we can
explain to Gradle that all Jackson modules "belong to" the same platform and
benefit from the same behavior as with native alignment. There are two options
to express that a set of modules belong to a platform:

  1. A platform is **published** as a [BOM](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html#sub:bom_import) and can be used: For example, `com.fasterxml.jackson:jackson-bom` can be used as platform. The information missing to Gradle in that case is that the platform should be added to the dependencies if one of its members is used.

  2. No existing platform can be used. Instead, a **virtual platform** should be created by Gradle: In this case, Gradle builds up the platform itself based on all the members that are used.

To provide the missing information to Gradle, you can define [component
metadata
rules](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
as explained in the following.

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:align_bom_platform)[Align
versions of modules using a published
BOM](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:align_bom_platform)

Example 4. A dependency version alignment rule

`Groovy``Kotlin`

build.gradle

    
    
    class JacksonBomAlignmentRule implements ComponentMetadataRule {
        void execute(ComponentMetadataContext ctx) {
            ctx.details.with {
                if (id.group.startsWith("com.fasterxml.jackson")) {
                    // declare that Jackson modules belong to the platform defined by the Jackson BOM
                    belongsTo("com.fasterxml.jackson:jackson-bom:${id.version}", false)
                }
            }
        }
    }

build.gradle.kts

    
    
    open class JacksonBomAlignmentRule: ComponentMetadataRule {
        override fun execute(ctx: ComponentMetadataContext) {
            ctx.details.run {
                if (id.group.startsWith("com.fasterxml.jackson")) {
                    // declare that Jackson modules belong to the platform defined by the Jackson BOM
                    belongsTo("com.fasterxml.jackson:jackson-bom:${id.version}", false)
                }
            }
        }
    }

By using the `belongsTo` with `false` ( **not** virtual), we declare that all
modules belong to the same _published platform_. In this case, the platform is
`com.fasterxml.jackson:jackson-bom` and Gradle will look for it, as for any
other module, in the declared repositories.

Example 5. Making use of a dependency version alignment rule

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        components.all(JacksonBomAlignmentRule)
    }

build.gradle.kts

    
    
    dependencies {
        components.all<JacksonBomAlignmentRule>()
    }

使用该规则，以上示例中的版本将与选定的`com.fasterxml.jackson:jackson-
bom`定义版本保持一致。在这种情况下，`com.fasterxml.jackson:jackson-
bom:2.9.5`将被选为所选`2.9.5`模块的最高版本。在BOM，下面的版本中定义和将被使用： `jackson-core:2.9.5`，
`jackson-databind:2.9.5`和 `jackson-annotation:2.9.0`。`jackson-
annotation`此处的较低版本可能是所需的结果，因为它是BOM的建议。

__ |  从Gradle
6.1开始，此行为工作可靠。实际上，它类似于[组件元数据规则](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)，该[规则](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)使用来向平台的所有成员添加平台依赖性`withDependencies`。  
---|---  
  
###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:virtual_platform)[在没有发布平台的情况下对齐模块版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html#sec:virtual_platform)

例子6.依赖版本对齐规则

`Groovy``Kotlin`

build.gradle

    
    
    class JacksonAlignmentRule implements ComponentMetadataRule {
        void execute(ComponentMetadataContext ctx) {
            ctx.details.with {
                if (id.group.startsWith("com.fasterxml.jackson")) {
                    // declare that Jackson modules all belong to the Jackson virtual platform
                    belongsTo("com.fasterxml.jackson:jackson-virtual-platform:${id.version}")
                }
            }
        }
    }

build.gradle.kts

    
    
    open class JacksonAlignmentRule: ComponentMetadataRule {
        override fun execute(ctx: ComponentMetadataContext) {
            ctx.details.run {
                if (id.group.startsWith("com.fasterxml.jackson")) {
                    // declare that Jackson modules all belong to the Jackson virtual platform
                    belongsTo("com.fasterxml.jackson:jackson-virtual-platform:${id.version}")
                }
            }
        }
    }

通过使用`belongsTo`不带进一步参数的关键字（平台 **是** 虚拟的），我们声明所有模块都属于同一个 _虚拟平台_
，该引擎专门对其进行处理。不会从存储库中检索虚拟平台。在这种情况下`com.fasterxml.jackson:jackson-virtual-
platform`，标识符是构建作者自己定义的东西。然后，Gradle通过收集`belongsTo`指向同一虚拟平台的所有语句来动态创建平台的“内容” 。

例子7.利用依赖版本对齐规则

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        components.all(JacksonAlignmentRule)
    }

build.gradle.kts

    
    
    dependencies {
        components.all<JacksonAlignmentRule>()
    }

使用该规则，以上示例中的所有版本都将与对齐`2.9.5`。在这种情况下，也`jackson-
annotation:2.9.5`将采用，因为这就是我们定义本地虚拟平台的方式。

对于已发布平台和虚拟平台，Gradle允许您通过在平台上指定 _强制_ 依赖项来覆盖平台本身的版本选择：

例子8.强制平台降级

`Groovy``Kotlin`

build.gradle

    
    
    dependencies {
        // Forcefully downgrade the virtual Jackson platform to 2.8.9
        implementation enforcedPlatform('com.fasterxml.jackson:jackson-virtual-platform:2.8.9')
    }

build.gradle.kts

    
    
    dependencies {
        // Forcefully downgrade the virtual Jackson platform to 2.8.9
        implementation(enforcedPlatform("com.fasterxml.jackson:jackson-virtual-platform:2.8.9"))
    }

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./对齐依赖版本_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

