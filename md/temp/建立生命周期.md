

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [来自蚂蚁](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#customizing-execution)
    * [Configuring the Build Environment](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [Configuring the Gradle Daemon](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [Using Initialization Scripts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#optimizing-build-performance)
    * [Build Performance Guide](https://guides.gradle.org/performance/)
    * [Enabling and Configuring the Build Cache](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [Using the Configuration Cache](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#learning-the-basics)
    * [介绍构建脚本的基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [处理任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [了解有关构建脚本的更多信息](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [使用Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [了解构建生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [使用记录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [避免陷阱](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#authoring-multi-project-builds)
    * [Creating a Basic Multi-Project Build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#advanced-techniques)
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [Using Ant from Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [构建C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [测试C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [建立Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [测试Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### 使用依赖项

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [声明版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [控制翻译](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#controlling-transitive-dependencies)
    * [Upgrading Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [Downgrading and Excluding](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [Aligning Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [Customizing Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [Preventing accidental upgrades](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [图书馆的生产和消费形式](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [在多仓库环境中工作](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [出版图书馆](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [术语](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### 扩展摇篮

  * [插件开发教程](https://gradle.org/guides/?q=Plugin%20Development)
  * [编写Gradle任务类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [编写Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [编写自定义Gradle类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [延迟配置任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [使用避免任务配置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### 参考

  * [核心插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [命令行界面](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle和第三方工具](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [摇篮包装](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle管理的目录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# 建立生命周期

version 6.7.1

内容

  * [建立阶段](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:build_phases)
  * [设定档](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:settings_file)
  * [初始化](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:initialization)
  * [单个项目构建的配置和执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:configuration_and_execution_of_a_single_project_build)
  * [响应构建脚本中的生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#build_lifecycle_events)

我们之前说过，Gradle的核心是一种用于基于依赖项编程的语言。用Gradle术语，这意味着您可以定义任务以及任务之间的依赖关系。Gradle保证这些任务按照其依赖关系的顺序执行，并且每个任务仅执行一次。这些任务形成有向无[环图](http://en.wikipedia.org/wiki/Directed_acyclic_graph)。有一些构建工具可以在执行任务时构建此类依赖关系图。
_在_ 执行任何任务 _之前，_ Gradle会构建完整的依赖关系图。这是Gradle的核心，它使许多事情成为可能，而这是其他不可能做到的。

您的构建脚本将配置此依赖关系图。因此，严格来说，它们是 _构建配置脚本_ 。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:build_phases)[建立阶段](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:build_phases)

Gradle构建具有三个不同的阶段。

初始化

    

Gradle支持单项目和多项目构建。在初始化阶段，Gradle决定要参与构建的[项目](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Project.html)，并为每个[项目](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Project.html)创建一个[Project](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Project.html)实例。

组态

    

在此阶段，将配置项目对象。执行作为构建一部分的 _所有_ 项目的构建脚本。

执行

    

Gradle确定要在配置阶段创建和配置的任务子集。子集由传递给`gradle`命令的任务名称参数和当前目录确定。然后Gradle执行每个选定的任务。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:settings_file)[设定档](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:settings_file)

除了构建脚本文件外，Gradle还定义了一个设置文件。设置文件由Gradle通过命名约定确定。该文件的默认名称是`settings.gradle`。在本章的后面，我们将解释Gradle如何查找设置文件。

设置文件在初始化阶段执行。多项目构建必须`settings.gradle`在多项目层次结构的根项目中具有一个文件。这是必需的，因为设置文件定义了哪些项目正在参与多项目构建（请参见[创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html#multi_project_builds)）。对于单项目构建，设置文件是可选的。除了定义包含的项目之外，您可能还需要将库添加到构建脚本类路径中（请参阅[组织Gradle项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html#organizing_gradle_projects)）。让我们首先用单个项目构建进行一些自省：

例子1.单个项目的建立

`Groovy``Kotlin`

settings.gradle

    
    
    rootProject.name = 'basic'
    println 'This is executed during the initialization phase.'

build.gradle

    
    
    println 'This is executed during the configuration phase.'
    
    task configured {
        println 'This is also executed during the configuration phase.'
    }
    
    task test {
        doLast {
            println 'This is executed during the execution phase.'
        }
    }
    
    task testBoth {
    	doFirst {
    	  println 'This is executed first during the execution phase.'
    	}
    	doLast {
    	  println 'This is executed last during the execution phase.'
    	}
    	println 'This is executed during the configuration phase as well.'
    }

settings.gradle.kts

    
    
    rootProject.name = "basic"
    println("This is executed during the initialization phase.")

build.gradle.kts

    
    
    println("This is executed during the configuration phase.")
    
    tasks.register("configured") {
        println("This is also executed during the configuration phase.")
    }
    
    tasks.register("test") {
        doLast {
            println("This is executed during the execution phase.")
        }
    }
    
    tasks.register("testBoth") {
        doFirst {
            println("This is executed first during the execution phase.")
        }
        doLast {
            println("This is executed last during the execution phase.")
        }
        println("This is executed during the configuration phase as well.")
    }

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_test_testboth)[输出
**`gradle test
testBoth`**](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_test_testboth)

`Groovy``Kotlin`

    
    
    > gradle test testBoth
    This is executed during the initialization phase.
    
    > Configure project :
    This is executed during the configuration phase.
    This is also executed during the configuration phase.
    This is executed during the configuration phase as well.
    
    > Task :test
    This is executed during the execution phase.
    
    > Task :testBoth
    This is executed first during the execution phase.
    This is executed last during the execution phase.
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed
    
    
    > gradle test testBoth
    This is executed during the initialization phase.
    
    > Configure project :
    This is executed during the configuration phase.
    This is executed during the configuration phase as well.
    
    > Task :test
    This is executed during the execution phase.
    
    > Task :testBoth
    This is executed first during the execution phase.
    This is executed last during the execution phase.
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed

对于构建脚本，将属性访问和方法调用委派给项目对象。同样，设置文件中的属性访问和方法调用也委托给设置对象。请参阅API文档中的[Settings](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.initialization.Settings.html)类以获取更多信息。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:initialization)[初始化](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:initialization)

Gradle如何知道执行单个项目还是多个项目？如果您从带有`settings.gradle`文件的目录中触发多项目构建，则Gradle会使用它来配置构建。Gradle还允许您从参与构建的任何子项目中执行构建。[
[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#_footnotedef_1
"查看脚注。") ] 如果您在没有`settings.gradle`文件的项目中执行Gradle
，则Gradle会`settings.gradle`通过以下方式查找文件：

  * 它`settings.gradle`在父目录中查找。

  * 如果未找到，则该构建将作为单个项目构建执行。

  * 如果`settings.gradle`找到文件，Gradle将检查当前项目是否属于找到的`settings.gradle`文件中定义的多项目层次结构。如果不是，则将构建作为单个项目构建执行。否则，将执行多项目构建。

这种行为的目的是什么？Gradle需要确定您所在的项目是否是多项目构建的子项目。当然，如果它是一个子项目，则仅构建子项目及其从属项目，但是Gradle需要为整个多项目构建创建构建配置（请参见[Configuration
and
Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html#configuration_and_execution)）。如果当前项目包含一个`settings.gradle`文件，则该构建始终按以下方式执行：

  * 如果`settings.gradle`文件未定义多项目层次结构，则为单个项目构建

  * 如果`settings.gradle`文件确实定义了多项目层次结构，则为多项目构建。

自动搜索`settings.gradle`文件仅适用于具有默认项目布局的多项目构建，其中项目路径与磁盘上的物理子项目布局相匹配。Gradle支持多项目构建的任意物理布局，但是对于这样的任意布局，您需要从设置文件所在的目录中执行构建。有关如何从根目录运行部分构建的信息，请参阅[通过标准名称执行任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html#sec:executing_tasks_by_fully_qualified_name)。

Gradle为参与构建的每个项目创建一个Project对象。对于多项目构建，这些是Settings对象中指定的项目（加上根项目）。默认情况下，每个项目对象的名称都等于其顶级目录的名称，除根项目外的每个项目都有一个父项目。任何项目都可以有子项目。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:configuration_and_execution_of_a_single_project_build)[单个项目构建的配置和执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:configuration_and_execution_of_a_single_project_build)

对于单个项目构建， _初始化后_
阶段的工作流程非常简单。将针对初始化阶段创建的项目对象执行构建脚本。然后Gradle查找名称与作为命令行参数传递的名称相同的任务。如果存在这些任务名称，则会按照传递它们的顺序将它们作为单独的版本执行。配置和执行中讨论了多项目构建的[配置和执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html#configuration_and_execution)。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#build_lifecycle_events)[响应构建脚本中的生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#build_lifecycle_events)

随着构建在生命周期中的进展，您的构建脚本可以接收通知。这些通知通常采用两种形式：您可以实现特定的侦听器接口，也可以提供一个闭包以在触发通知时执行。下面的示例使用闭包。有关如何使用侦听器接口的详细信息，请参阅API文档。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:project_evaluation)[项目评估](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:project_evaluation)

您可以在评估项目之前和之后立即收到通知。一旦构建脚本中的所有定义均已应用，这可用于执行其他配置，或用于某些自定义日志记录或性能分析。

下面的示例`test`向`hasTests`属性为true的每个项目添加一个任务。

例子2.将测试任务添加到每个具有特定属性集的项目

`Groovy``Kotlin`

build.gradle

    
    
    allprojects {
        afterEvaluate { project ->
            if (project.hasTests) {
                println "Adding test task to $project"
                project.task('test') {
                    doLast {
                        println "Running tests for $project"
                    }
                }
            }
        }
    }

项目等级

    
    
    hasTests = true

build.gradle.kts

    
    
    allprojects {
        afterEvaluate {
            if (extra["hasTests"] as Boolean) {
                println("Adding test task to $project")
                tasks.register("test") {
                    doLast {
                        println("Running tests for $project")
                    }
                }
            }
        }
    }

project-a.gradle.kts

    
    
    extra["hasTests"] = true

输出 `gradle -q test`

    
    
    > gradle -q测试
    将测试任务添加到项目'：project-a'
    运行项目'：project-a'的测试

本示例使用方法`Project.afterEvaluate()`添加一个闭包，该闭包在评估项目后执行。

评估任何项目时，也可能会收到通知。本示例对项目评估执行一些自定义日志记录。请注意，`afterProject`无论项目评估成功还是失败，都将收到通知。

例子3.通知

`Groovy``Kotlin`

build.gradle

    
    
    gradle.afterProject { project ->
        if (project.state.failure) {
            println "Evaluation of $project FAILED"
        } else {
            println "Evaluation of $project succeeded"
        }
    }

build.gradle.kts

    
    
    gradle.afterProject {
        if (state.failure != null) {
            println("Evaluation of $project FAILED")
        } else {
            println("Evaluation of $project succeeded")
        }
    }

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_q_test)[输出
**`gradle -q
test`**](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_q_test)

`Groovy``Kotlin`

    
    
    > gradle -q test
    Evaluation of root project 'build-project-evaluate-events' succeeded
    Evaluation of project ':project-a' succeeded
    Evaluation of project ':project-b' FAILED
    
    FAILURE: Build failed with an exception.
    
    * Where:
    Build file '/home/user/gradle/samples/project-b.gradle' line: 1
    
    * What went wrong:
    A problem occurred evaluating project ':project-b'.
    > broken
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 0s
    
    
    > gradle -q test
    Evaluation of root project 'build-project-evaluate-events' succeeded
    Evaluation of project ':project-a' succeeded
    Evaluation of project ':project-b' FAILED
    
    FAILURE: Build failed with an exception.
    
    * Where:
    Build file '/home/user/gradle/samples/project-b.gradle.kts' line: 1
    
    * What went wrong:
    broken
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 0s

您还可以向[Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.invocation.Gradle.html)添加[ProjectEvaluationListener](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/ProjectEvaluationListener.html)来接收这些事件。[](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.invocation.Gradle.html)

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_creation)[任务创建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_creation)

将任务添加到项目后，您会立即收到通知。在构建文件中使任务可用之前，可以使用它来设置一些默认值或添加行为。

下面的示例设置`srcDir`每个任务在创建时的属性。

例子4.为所有任务设置某些属性

`Groovy``Kotlin`

build.gradle

    
    
    tasks.whenTaskAdded { task ->
        task.ext.srcDir = 'src/main/java'
    }
    
    task a
    
    println "source dir is $a.srcDir"

build.gradle.kts

    
    
    tasks.whenTaskAdded {
        extra["srcDir"] = "src/main/java"
    }
    
    val a by tasks.registering
    
    println("source dir is ${a.get().extra["srcDir"]}")

输出 **`gradle -q a`**

    
    
    > gradle -qa
    源目录是src / main / java

您还可以将[Action](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Action.html)添加到[TaskContainer](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/tasks/TaskContainer.html)以接收这些事件。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_execution_graph_ready)[任务执行图准备就绪](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_execution_graph_ready)

填充了任务执行图后，您可以立即收到通知（请参阅“[通过DAG配置”](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html#configure-
by-dag)）。

您还可以将[TaskExecutionGraphListener](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/execution/TaskExecutionGraphListener.html)添加到[TaskExecutionGraph](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/execution/TaskExecutionGraph.html)来接收这些事件。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_execution)[任务执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#sec:task_execution)

您可以在执行任何任务之前和之后立即收到通知。

下面的示例记录每个任务执行的开始和结束。请注意，`afterTask`无论任务是成功完成还是失败（例外），都将收到通知。

例子5.记录每个任务执行的开始和结束

`Groovy``Kotlin`

build.gradle

    
    
    task ok
    
    task broken(dependsOn: ok) {
        doLast {
            throw new RuntimeException('broken')
        }
    }
    
    gradle.taskGraph.beforeTask { Task task ->
        println "executing $task ..."
    }
    
    gradle.taskGraph.afterTask { Task task, TaskState state ->
        if (state.failure) {
            println "FAILED"
        }
        else {
            println "done"
        }
    }

build.gradle.kts

    
    
    tasks.register("ok")
    
    tasks.register("broken") {
        dependsOn("ok")
        doLast {
            throw RuntimeException("broken")
        }
    }
    
    gradle.taskGraph.beforeTask {
        println("executing $this ...")
    }
    
    gradle.taskGraph.afterTask {
        if (state.failure != null) {
            println("FAILED")
        } else {
            println("done")
        }
    }

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_q_broken)[输出
**`gradle -q
broken`**](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#output_of_gradle_q_broken)

`Groovy``Kotlin`

    
    
    > gradle -q broken
    executing task ':ok' ...
    done
    executing task ':broken' ...
    FAILED
    
    FAILURE: Build failed with an exception.
    
    * Where:
    Build file '/home/user/gradle/samples/build.gradle' line: 5
    
    * What went wrong:
    Execution failed for task ':broken'.
    > broken
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 0s
    
    
    > gradle -q broken
    executing task ':ok' ...
    done
    executing task ':broken' ...
    FAILED
    
    FAILURE: Build failed with an exception.
    
    * What went wrong:
    Execution failed for task ':broken'.
    > broken
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 0s

你也可以使用一个[TaskExecutionListener](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/execution/TaskExecutionListener.html)到[TaskExecutionGraph](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/execution/TaskExecutionGraph.html)接收这些事件。

* * *

[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html#_footnoteref_1)。Gradle支持部分多项目构建（请参阅[执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)）。

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./建立生命周期_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

