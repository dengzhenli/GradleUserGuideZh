

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [来自蚂蚁](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#customizing-execution)
    * [配置构建环境](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [配置Gradle守护程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#optimizing-build-performance)
    * [构建绩效指南](https://guides.gradle.org/performance/)
    * [启用和配置构建缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [使用配置缓存](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#learning-the-basics)
    * [介绍构建脚本的基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [处理任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [了解有关构建脚本的更多信息](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [处理文件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [使用Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [了解构建生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [使用记录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [避免陷阱](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#authoring-multi-project-builds)
    * [创建基本的多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [声明子项目之间的依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [在子项目之间共享构建逻辑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#advanced-techniques)
    * [开发并行任务](https://guides.gradle.org/using-the-worker-api/)
    * [使用TestKit测试构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [从Gradle使用Ant](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [Building C++ projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [Testing C++ projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [Building Swift projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [Testing Swift projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### Working with Dependencies

  * [Learning the Basics](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [Declaring Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [Controlling Transitives](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#controlling-transitive-dependencies)
    * [Upgrading Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [Downgrading and Excluding](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [Aligning Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [Customizing Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [Preventing accidental upgrades](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [Producing and Consuming Variants of Libraries](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [Working in a Multi-repo Environment](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [Publishing Libraries](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [Terminology](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### Extending Gradle

  * [Plugin Development Tutorials](https://gradle.org/guides/?q=Plugin%20Development)
  * [Writing Gradle Task Types](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [Writing Gradle Plugins](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [Writing Custom Gradle Types](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [Configuring Tasks Lazily](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [Using Task Configuration Avoidance](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### Reference

  * [Core Plugins](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [Command-Line Interface](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle & Third-party Tools](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [The Gradle Wrapper](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle-managed Directories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# Using Ant from Gradle

version 6.7.1

Contents

  * [Using Ant tasks and types in your build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:using_ant_tasks)
  * [Importing an Ant build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:import_ant_build)
  * [Ant properties and references](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_properties)
  * [Ant logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_logging)
  * [API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_api)

Gradle provides excellent integration with Ant. You can use individual Ant
tasks or entire Ant builds in your Gradle builds. In fact, you will find that
it’s far easier and more powerful using Ant tasks in a Gradle build script,
than it is to use Ant’s XML format. You could even use Gradle simply as a
powerful Ant task scripting tool.

Ant can be divided into two layers. The first layer is the Ant language. It
provides the syntax for the `build.xml` file, the handling of the targets,
special constructs like macrodefs, and so on. In other words, everything
except the Ant tasks and types. Gradle understands this language, and allows
you to import your Ant `build.xml` directly into a Gradle project. You can
then use the targets of your Ant build as if they were Gradle tasks.

The second layer of Ant is its wealth of Ant tasks and types, like `javac`,
`copy` or `jar`. For this layer Gradle provides integration simply by relying
on Groovy, and the fantastic `AntBuilder`.

Finally, since build scripts are Groovy scripts, you can always execute an Ant
build as an external process. Your build script may contain statements like:
`"ant clean
compile".execute()`.[[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#_footnotedef_1
"查看脚注。")]

You can use Gradle’s Ant integration as a path for migrating your build from
Ant to Gradle. For example, you could start by importing your existing Ant
build. Then you could move your dependency declarations from the Ant script to
your build file. Finally, you could move your tasks across to your build file,
or replace them with some of Gradle’s plugins. This process can be done in
parts over time, and you can have a working Gradle build during the entire
process.

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:using_ant_tasks)[Using
Ant tasks and types in your
build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:using_ant_tasks)

In your build script, a property called `ant` is provided by Gradle. This is a
reference to an
[AntBuilder](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/AntBuilder.html)
instance. This `AntBuilder` is used to access Ant tasks, types and properties
from your build script. There is a very simple mapping from Ant’s `build.xml`
format to Groovy, which is explained below.

You execute an Ant task by calling a method on the `AntBuilder` instance. You
use the task name as the method name. For example, you execute the Ant `echo`
task by calling the `ant.echo()` method. The attributes of the Ant task are
passed as Map parameters to the method. Below is an example of the `echo`
task. Notice that we can also mix Groovy code and the Ant task markup. This
can be extremely powerful.

Example 1. Using an Ant task

`Groovy``Kotlin`

build.gradle

    
    
    task hello {
        doLast {
            String greeting = 'hello from Ant'
            ant.echo(message: greeting)
        }
    }

build.gradle.kts

    
    
    tasks.register("hello") {
        doLast {
            val greeting = "hello from Ant"
            ant.withGroovyBuilder {
                "echo"("message" to greeting)
            }
        }
    }

Output of `gradle hello`

    
    
    > gradle hello
    
    > Task :hello
    [ant:echo] hello from Ant
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

You pass nested text to an Ant task by passing it as a parameter of the task
method call. In this example, we pass the message for the `echo` task as
nested text:

Example 2. Passing nested text to an Ant task

`Groovy``Kotlin`

build.gradle

    
    
    task hello {
        doLast {
            ant.echo('hello from Ant')
        }
    }

build.gradle.kts

    
    
    tasks.register("hello") {
        doLast {
            ant.withGroovyBuilder {
                "echo"("message" to "hello from Ant")
            }
        }
    }

Output of `gradle hello`

    
    
    > gradle hello
    
    > Task :hello
    [ant:echo] hello from Ant
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

You pass nested elements to an Ant task inside a closure. Nested elements are
defined in the same way as tasks, by calling a method with the same name as
the element we want to define.

Example 3. Passing nested elements to an Ant task

`Groovy``Kotlin`

build.gradle

    
    
    task zip {
        doLast {
            ant.zip(destfile: 'archive.zip') {
                fileset(dir: 'src') {
                    include(name: '**.xml')
                    exclude(name: '**.java')
                }
            }
        }
    }

build.gradle.kts

    
    
    tasks.register("zip") {
        doLast {
            ant.withGroovyBuilder {
                "zip"("destfile" to "archive.zip") {
                    "fileset"("dir" to "src") {
                        "include"("name" to "**.xml")
                        "exclude"("name" to "**.java")
                    }
                }
            }
        }
    }

You can access Ant types in the same way that you access tasks, using the name
of the type as the method name. The method call returns the Ant data type,
which you can then use directly in your build script. In the following
example, we create an Ant `path` object, then iterate over the contents of it.

Example 4. Using an Ant type

`Groovy``Kotlin`

build.gradle

    
    
    task list {
        doLast {
            def path = ant.path {
                fileset(dir: 'libs', includes: '*.jar')
            }
            path.list().each {
                println it
            }
        }
    }

build.gradle.kts

    
    
    import org.apache.tools.ant.types.Path
    
    tasks.register("list") {
        doLast {
            val path = ant.withGroovyBuilder {
                "path" {
                    "fileset"("dir" to "libs", "includes" to "*.jar")
                }
            } as Path
            path.list().forEach {
                println(it)
            }
        }
    }

More information about `AntBuilder` can be found in 'Groovy in Action' 8.4 or
at the [Groovy Wiki](https://groovy-lang.org/scripting-ant.html).

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:using_custom_ant_tasks)[Using
custom Ant tasks in your
build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:using_custom_ant_tasks)

To make custom tasks available in your build, you can use the `taskdef`
(usually easier) or `typedef` Ant task, just as you would in a `build.xml`
file. You can then refer to the custom Ant task as you would a built-in Ant
task.

Example 5. Using a custom Ant task

`Groovy``Kotlin`

build.gradle

    
    
    task check {
        doLast {
            ant.taskdef(resource: 'checkstyletask.properties') {
                classpath {
                    fileset(dir: 'libs', includes: '*.jar')
                }
            }
            ant.checkstyle(config: 'checkstyle.xml') {
                fileset(dir: 'src')
            }
        }
    }

build.gradle.kts

    
    
    tasks.register("check") {
        doLast {
            ant.withGroovyBuilder {
                "taskdef"("resource" to "checkstyletask.properties") {
                    "classpath" {
                        "fileset"("dir" to "libs", "includes" to "*.jar")
                    }
                }
                "checkstyle"("config" to "checkstyle.xml") {
                    "fileset"("dir" to "src")
                }
            }
        }
    }

You can use Gradle’s dependency management to assemble the classpath to use
for the custom tasks. To do this, you need to define a custom configuration
for the classpath, then add some dependencies to the configuration. This is
described in more detail in [Declaring
Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html).

Example 6. Declaring the classpath for a custom Ant task

`Groovy``Kotlin`

build.gradle

    
    
    configurations {
        pmd
    }
    
    dependencies {
        pmd group: 'pmd', name: 'pmd', version: '4.2.5'
    }

build.gradle.kts

    
    
    val pmd = configurations.create("pmd")
    
    dependencies {
        pmd(group = "pmd", name = "pmd", version = "4.2.5")
    }

To use the classpath configuration, use the `asPath` property of the custom
configuration.

Example 7. Using a custom Ant task and dependency management together

`Groovy``Kotlin`

build.gradle

    
    
    task check {
        doLast {
            ant.taskdef(name: 'pmd',
                        classname: 'net.sourceforge.pmd.ant.PMDTask',
                        classpath: configurations.pmd.asPath)
            ant.pmd(shortFilenames: 'true',
                    failonruleviolation: 'true',
                    rulesetfiles: file('pmd-rules.xml').toURI().toString()) {
                formatter(type: 'text', toConsole: 'true')
                fileset(dir: 'src')
            }
        }
    }

build.gradle.kts

    
    
    tasks.register("check") {
        doLast {
            ant.withGroovyBuilder {
                "taskdef"("name" to "pmd",
                          "classname" to "net.sourceforge.pmd.ant.PMDTask",
                          "classpath" to pmd.asPath)
                "pmd"("shortFilenames" to true,
                      "failonruleviolation" to true,
                      "rulesetfiles" to file("pmd-rules.xml").toURI().toString()) {
                    "formatter"("type" to "text", "toConsole" to "true")
                    "fileset"("dir" to "src")
                }
            }
        }
    }

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:import_ant_build)[Importing
an Ant
build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:import_ant_build)

You can use the `ant.importBuild()` method to import an Ant build into your
Gradle project. When you import an Ant build, each Ant target is treated as a
Gradle task. This means you can manipulate and execute the Ant targets in
exactly the same way as Gradle tasks.

Example 8. Importing an Ant build

`Groovy``Kotlin`

build.gradle

    
    
    ant.importBuild 'build.xml'

build.gradle.kts

    
    
    ant.importBuild("build.xml")

build.xml

    
    
    <project>
        <target name="hello">
            <echo>Hello, from Ant</echo>
        </target>
    </project>

Output of `gradle hello`

    
    
    > gradle hello
    
    > Task :hello
    [ant:echo] Hello, from Ant
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

You can add a task which depends on an Ant target:

Example 9. Task that depends on Ant target

`Groovy``Kotlin`

build.gradle

    
    
    ant.importBuild 'build.xml'
    
    task intro(dependsOn: hello) {
        doLast {
            println 'Hello, from Gradle'
        }
    }

build.gradle.kts

    
    
    ant.importBuild("build.xml")
    
    tasks.register("intro") {
        dependsOn("hello")
        doLast {
            println("Hello, from Gradle")
        }
    }

Output of `gradle intro`

    
    
    > gradle intro
    
    > Task :hello
    [ant:echo] Hello, from Ant
    
    > Task :intro
    Hello, from Gradle
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed

Or, you can add behaviour to an Ant target:

Example 10. Adding behaviour to an Ant target

`Groovy``Kotlin`

build.gradle

    
    
    ant.importBuild 'build.xml'
    
    hello {
        doLast {
            println 'Hello, from Gradle'
        }
    }

build.gradle.kts

    
    
    ant.importBuild("build.xml")
    
    tasks.named("hello") {
        doLast {
            println("Hello, from Gradle")
        }
    }

Output of `gradle hello`

    
    
    > gradle hello
    
    > Task :hello
    [ant:echo] Hello, from Ant
    Hello, from Gradle
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

It is also possible for an Ant target to depend on a Gradle task:

Example 11. Ant target that depends on Gradle task

`Groovy``Kotlin`

build.gradle

    
    
    ant.importBuild 'build.xml'
    
    task intro {
        doLast {
            println 'Hello, from Gradle'
        }
    }

build.gradle.kts

    
    
    ant.importBuild("build.xml")
    
    tasks.register("intro") {
        doLast {
            println("Hello, from Gradle")
        }
    }

build.xml

    
    
    <project>
        <target name="hello" depends="intro">
            <echo>Hello, from Ant</echo>
        </target>
    </project>

Output of `gradle hello`

    
    
    > gradle hello
    
    > Task :intro
    Hello, from Gradle
    
    > Task :hello
    [ant:echo] Hello, from Ant
    
    BUILD SUCCESSFUL in 0s
    2 actionable tasks: 2 executed

Sometimes it may be necessary to “rename” the task generated for an Ant target
to avoid a naming collision with existing Gradle tasks. To do this, use the
[AntBuilder.importBuild(java.lang.Object,
org.gradle.api.Transformer)](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/AntBuilder.html#importBuild-
java.lang.Object-org.gradle.api.Transformer-) method.

Example 12. Renaming imported Ant targets

`Groovy``Kotlin`

build.gradle

    
    
    ant.importBuild('build.xml') { antTargetName ->
        'a-' + antTargetName
    }

build.gradle.kts

    
    
    ant.importBuild("build.xml") { antTargetName ->
        "a-" + antTargetName
    }

build.xml

    
    
    <project>
        <target name="hello">
            <echo>Hello, from Ant</echo>
        </target>
    </project>

Output of `gradle a-hello`

    
    
    > gradle a-hello
    
    > Task :a-hello
    [ant:echo] Hello, from Ant
    
    BUILD SUCCESSFUL in 0s
    1 actionable task: 1 executed

Note that while the second argument to this method should be a
[Transformer](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Transformer.html),
when programming in Groovy we can simply use a closure instead of an anonymous
inner class (or similar) due to [Groovy’s support for automatically coercing
closures to single-abstract-method
types](http://mrhaki.blogspot.ie/2013/11/groovy-goodness-implicit-
closure.html).

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_properties)[Ant
properties and
references](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_properties)

There are several ways to set an Ant property, so that the property can be
used by Ant tasks. You can set the property directly on the `AntBuilder`
instance. The Ant properties are also available as a Map which you can change.
You can also use the Ant `property` task. Below are some examples of how to do
this.

Example 13. Setting an Ant property

`Groovy``Kotlin`

build.gradle

    
    
    ant.buildDir = buildDir
    ant.properties.buildDir = buildDir
    ant.properties['buildDir'] = buildDir
    ant.property(name: 'buildDir', location: buildDir)

build.gradle.kts

    
    
    ant.setProperty("buildDir", buildDir)
    ant.properties.set("buildDir", buildDir)
    ant.properties["buildDir"] = buildDir
    ant.withGroovyBuilder {
        "property"("name" to "buildDir", "location" to "buildDir")
    }

Many Ant tasks set properties when they execute. There are several ways to get
the value of these properties. You can get the property directly from the
`AntBuilder` instance. The Ant properties are also available as a Map. Below
are some examples.

Example 14. Getting an Ant property

build.xml

    
    
    <property name="antProp" value="a property defined in an Ant build"/>

`Groovy``Kotlin`

build.gradle

    
    
    println ant.antProp
    println ant.properties.antProp
    println ant.properties['antProp']

build.gradle.kts

    
    
    println(ant.getProperty("antProp"))
    println(ant.properties.get("antProp"))
    println(ant.properties["antProp"])

There are several ways to set an Ant reference:

Example 15. Setting an Ant reference

`Groovy``Kotlin`

build.gradle

    
    
    ant.path(id: 'classpath', location: 'libs')
    ant.references.classpath = ant.path(location: 'libs')
    ant.references['classpath'] = ant.path(location: 'libs')

build.gradle.kts

    
    
    ant.withGroovyBuilder { "path"("id" to "classpath", "location" to "libs") }
    ant.references.set("classpath", ant.withGroovyBuilder { "path"("location" to "libs") })
    ant.references["classpath"] = ant.withGroovyBuilder { "path"("location" to "libs") }

build.xml

    
    
    <path refid="classpath"/>

There are several ways to get an Ant reference:

Example 16. Getting an Ant reference

build.xml

    
    
    <path id="antPath" location="libs"/>

`Groovy``Kotlin`

build.gradle

    
    
    println ant.references.antPath
    println ant.references['antPath']

build.gradle.kts

    
    
    println(ant.references.get("antPath"))
    println(ant.references["antPath"])

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_logging)[Ant
logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_logging)

Gradle maps Ant message priorities to Gradle log levels so that messages
logged from Ant appear in the Gradle output. By default, these are mapped as
follows:

Table 1. Ant message priority mapping Ant Message Priority | Gradle Log Level  
---|---  
  
_VERBOSE_

|

`DEBUG`  
  
_DEBUG_

|

`DEBUG`  
  
_INFO_

|

`INFO`  
  
_WARN_

|

`WARN`  
  
_ERROR_

|

`ERROR`  
  
###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:fine_tuning_ant_logging)[Fine
tuning Ant
logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:fine_tuning_ant_logging)

The default mapping of Ant message priority to Gradle log level can sometimes
be problematic. For example, there is no message priority that maps directly
to the `LIFECYCLE` log level, which is the default for Gradle. Many Ant tasks
log messages at the _INFO_ priority, which means to expose those messages from
Gradle, a build would have to be run with the log level set to `INFO`,
potentially logging much more output than is desired.

相反，如果Ant任务记录消息的级别过高，则要抑制这些消息，将需要以更高的日志级别运行构建，例如`QUIET`。但是，这可能导致其他期望的输出被抑制。

为了解决这个问题，Gradle允许用户微调Ant日志并控制消息优先级到Gradle日志级别的映射。这是通过`LIFECYCLE`使用[AntBuilder.setLifecycleLogLevel（java.lang.String）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/AntBuilder.html#setLifecycleLogLevel-
java.lang.String-)方法设置应映射到默认Gradle日志级别的优先级来完成的。设置此值后，以配置的优先级或更高优先级记录的任何Ant消息将至少记录在`LIFECYCLE`。低于此优先级记录的任何Ant消息最多将记录为`INFO`。

例如，以下内容更改了映射，以便在日志级别公开Ant _INFO_ 优先级消息`LIFECYCLE`。

例子17.调整Ant日志

`Groovy``Kotlin`

build.gradle

    
    
    ant.lifecycleLogLevel = "INFO"
    
    task hello {
        doLast {
            ant.echo(level: "info", message: "hello from info priority!")
        }
    }

build.gradle.kts

    
    
    ant.lifecycleLogLevel = AntBuilder.AntMessagePriority.INFO
    
    tasks.register("hello") {
        doLast {
            ant.withGroovyBuilder {
                "echo"("level" to "info", "message" to "hello from info priority!")
            }
        }
    }

输出 `gradle hello`

    
    
    > gradle你好
    
    >任务：你好
    [ant：echo]信息优先！
    
    在0秒内成功建立
    1个可执行的任务：1个已执行

另一方面，如果将`lifecycleLogLevel`设置为 _ERROR_ ，则将不再以日志级别记录以 _WARN_
优先级记录的Ant消息`WARN`。现在将以该`INFO`级别记录它们，并且默认情况下将其禁止显示。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_api)[API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#sec:ant_api)

Ant集成由[AntBuilder](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/AntBuilder.html)提供。

* * *

[1](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html#_footnoteref_1)。在Groovy中，您可以执行字符串。要了解有关使用Groovy执行外部流程的更多信息，请参阅“
Groovy in Action” 9.3.2或Groovy Wiki。

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./从Gradle使用Ant_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

