

[ Gradle ](https://docs.gradle.org "Gradle Docs")

User Manual

  * Community Open Community Menu

[ Community Home ](https://gradle.org/)

[ Community Forums ](https://discuss.gradle.org/)

[ Community Plugins ](https://plugins.gradle.org)

  * [Training](https://gradle.com/training/)
  * News Open Community Menu

[ Newsletter ](https://newsletter.gradle.com)

[ Blog ](https://blog.gradle.org)

[ Twitter ](https://twitter.com/gradle)

  * [Enterprise](https://gradle.com)
  * [github](https://github.com/gradle/gradle "Gradle on GitHub")

  * [Docs Home](../userguide/userguide.html)
  * [Samples](../samples/index.html)
  * [Release Notes](../release-notes.html)
  * Gradle API
    * [Javadoc](../javadoc/index.html?overview-summary.html)
    * [Groovy DSL Reference](../dsl/index.html)
    * [Groovy DSL Primer](../userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL Primer](../userguide/kotlin_dsl.html)

### User Manual

[ PDF ](../userguide/userguide.pdf)

  * [What is Gradle?](../userguide/what_is_gradle.html)
  * [Getting Started](../userguide/getting_started.html)
  * [Installing Gradle](../userguide/installation.html)
  * Upgrading Gradle...
    * [version 6.X to latest](../userguide/upgrading_version_6.html)
    * [version 5.X to 6.0](../userguide/upgrading_version_5.html)
    * [version 4.X to 5.0](../userguide/upgrading_version_4.html)
    * [Gradle's Feature Lifecycle](../userguide/feature_lifecycle.html)
  * Migrating to Gradle...
    * [from Maven](../userguide/migrating_from_maven.html)
    * [from Ant](../userguide/migrating_from_ant.html)
  * [Compatibility Notes](../userguide/compatibility.html)
  * [Troubleshooting Builds](../userguide/troubleshooting.html)

### Running Gradle Builds

  * Customizing Execution
    * [Configuring the Build Environment](../userguide/build_environment.html)
    * [Configuring the Gradle Daemon](../userguide/gradle_daemon.html)
    * [Using Initialization Scripts](../userguide/init_scripts.html)
  * [Executing Multi-Project Builds](../userguide/intro_multi_project_builds.html)
  * [Inspecting Gradle Builds](https://scans.gradle.com/)
  * Optimizing Build Times
    * [Build Performance Guide](https://guides.gradle.org/performance/)
    * [Enabling and Configuring the Build Cache](../userguide/build_cache.html)
    * [Using the Configuration Cache](../userguide/configuration_cache.html)

### Authoring Gradle Builds

  * Learning the Basics
    * [Introducing the Basics of Build Scripts](../userguide/tutorial_using_tasks.html)
    * [Working with Tasks](../userguide/more_about_tasks.html)
    * [Learning More About Build Scripts](../userguide/writing_build_scripts.html)
    * [Working with Files](../userguide/working_with_files.html)
    * [Using Gradle Plugins](../userguide/plugins.html)
    * [Understanding the Build Lifecycle](../userguide/build_lifecycle.html)
    * [Working with Logging](../userguide/logging.html)
    * [Avoiding Traps](../userguide/potential_traps.html)
  * Authoring Multi-Project Builds
    * [Creating a Basic Multi-Project Build](../userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](../userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](../userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](../userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](../userguide/multi_project_configuration_and_execution.html)
  * Authoring Sustainable Builds
    * [Organizing Build Logic](../userguide/organizing_gradle_projects.html)
    * [Following Best Practices](../userguide/authoring_maintainable_build_scripts.html)
  * Advanced Techniques
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](../userguide/test_kit.html)
    * [Using Ant from Gradle](../userguide/ant.html)

### Authoring JVM Builds

  * [Building Java & JVM projects](../userguide/building_java_projects.html)
  * [Testing Java & JVM projects](../userguide/java_testing.html)
  * [Toolchains for Java projects](../userguide/toolchains.html)
  * [Managing Dependencies](../userguide/dependency_management_for_java_projects.html)
  * JVM Plugins
    * [Java Library Plugin](../userguide/java_library_plugin.html)
    * [Java Application Plugin](../userguide/application_plugin.html)
    * [Java Platform Plugin](../userguide/java_platform_plugin.html)
    * [Groovy Plugin](../userguide/groovy_plugin.html)
    * [Scala Plugin](../userguide/scala_plugin.html)

### Authoring C++/Swift Builds

  * [Building C++ projects](../userguide/building_cpp_projects.html)
  * [Testing C++ projects](../userguide/cpp_testing.html)
  * [Building Swift projects](../userguide/building_swift_projects.html)
  * [Testing Swift projects](../userguide/swift_testing.html)

### Working with Dependencies

  * Learning the Basics
    * [What is Dependency Management?](../userguide/core_dependency_management.html)
    * [Declaring Repositories](../userguide/declaring_repositories.html)
    * [Declaring Dependencies](../userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](../userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](../userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](../userguide/dependency_resolution.html)
    * [Verifying dependencies](../userguide/dependency_verification.html)
  * Declaring Versions
    * [Declaring Versions and Ranges](../userguide/single_versions.html)
    * [Declaring Rich Versions](../userguide/rich_versions.html)
    * [Handling Changing Versions](../userguide/dynamic_versions.html)
    * [Locking Versions](../userguide/dependency_locking.html)
  * Controlling Transitives
    * [Upgrading Versions](../userguide/dependency_constraints.html)
    * [Downgrading and Excluding](../userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](../userguide/platforms.html)
    * [Aligning Dependencies](../userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](../userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](../userguide/component_metadata_rules.html)
    * [Customizing Resolution](../userguide/resolution_rules.html)
    * [Preventing accidental upgrades](../userguide/resolution_strategy_tuning.html)
  * Producing and Consuming Variants of Libraries
    * [Declaring Capabilities of a Library](../userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](../userguide/feature_variants.html)
    * [Understanding Variant Selection](../userguide/variant_model.html)
    * [Declaring Variant Attributes](../userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](../userguide/cross_project_publications.html)
    * [Transforming Artifacts](../userguide/artifact_transforms.html)
  * Working in a Multi-repo Environment
    * [Composing Builds](../userguide/composite_builds.html)
  * Publishing Libraries
    * [Setting up Publishing](../userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](../userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](../userguide/publishing_signing.html)
    * [Customizing Publishing](../userguide/publishing_customization.html)
    * [Maven Publish Plugin](../userguide/publishing_maven.html)
    * [Ivy Publish Plugin](../userguide/publishing_ivy.html)
  * [Terminology](../userguide/dependency_management_terminology.html)

### Extending Gradle

  * [Plugin Development Tutorials](https://gradle.org/guides/?q=Plugin%20Development)
  * [Writing Gradle Task Types](../userguide/custom_tasks.html)
  * [Writing Gradle Plugins](../userguide/custom_plugins.html)
  * [Writing Custom Gradle Types](../userguide/custom_gradle_types.html)
  * [Configuring Tasks Lazily](../userguide/lazy_configuration.html)
  * [Using Task Configuration Avoidance](../userguide/task_configuration_avoidance.html)

### Reference

  * [Core Plugins](../userguide/plugin_reference.html)
  * [Command-Line Interface](../userguide/command_line_interface.html)
  * [Gradle & Third-party Tools](../userguide/third_party_integration.html)
  * [The Gradle Wrapper](../userguide/gradle_wrapper.html)
  * [Gradle-managed Directories](../userguide/directory_layout.html)

# Initialization Scripts

version 6.7.1

Contents

  * Basic usage
  * Using an init script
  * Writing an init script
  * External dependencies for the init script
  * Init script plugins

Gradle provides a powerful mechanism to allow customizing the build based on
the current environment. This mechanism also supports tools that wish to
integrate with Gradle.

Note that this is completely different from the “`init`” task provided by the
“`build-init`” plugin (see [Build Init
Plugin](build_init_plugin.html#build_init_plugin)).

## Basic usage

Initialization scripts (a.k.a. _init scripts_ ) are similar to other scripts
in Gradle. These scripts, however, are run before the build starts. Here are
several possible uses:

  * Set up enterprise-wide configuration, such as where to find custom plugins.

  * Set up properties based on the current environment, such as a developer's machine vs. a continuous integration server.

  * Supply personal information about the user that is required by the build, such as repository or database authentication credentials.

  * Define machine specific details, such as where JDKs are installed.

  * Register build listeners. External tools that wish to listen to Gradle events might find this useful.

  * Register build loggers. You might wish to customize how Gradle logs the events that it generates.

One main limitation of init scripts is that they cannot access classes in the
`buildSrc` project (see [Using buildSrc to extract imperative
logic](organizing_gradle_projects.html#sec:build_sources) for details of this
feature).

## Using an init script

There are several ways to use an init script:

  * Specify a file on the command line. The command line option is `-I` or `--init-script` followed by the path to the script. The command line option can appear more than once, each time adding another init script. The build will fail if any of the files specified on the command line does not exist.

  * Put a file called `init.gradle` (or `init.gradle.kts` for Kotlin) in the `_USER_HOME_ /.gradle/` directory.

  * Put a file that ends with `.gradle` (or `.init.gradle.kts` for Kotlin) in the `_USER_HOME_ /.gradle/init.d/` directory.

  * Put a file that ends with `.gradle` (or `.init.gradle.kts` for Kotlin) in the `_GRADLE_HOME_ /init.d/` directory, in the Gradle distribution. This allows you to package up a custom Gradle distribution containing some custom build logic and plugins. You can combine this with the [Gradle wrapper](gradle_wrapper.html#gradle_wrapper) as a way to make custom logic available to all builds in your enterprise.

If more than one init script is found they will all be executed, in the order
specified above. Scripts in a given directory are executed in alphabetical
order. This allows, for example, a tool to specify an init script on the
command line and the user to put one in their home directory for defining the
environment and both scripts will run when Gradle is executed.

## Writing an init script

Similar to a Gradle build script, an init script is a Groovy or Kotlin script.
Each init script has a [Gradle](../dsl/org.gradle.api.invocation.Gradle.html)
instance associated with it. Any property reference and method call in the
init script will delegate to this `Gradle` instance.

Each init script also implements the
[Script](../dsl/org.gradle.api.Script.html) interface.

### Configuring projects from an init script

You can use an init script to configure the projects in the build. This works
in a similar way to configuring projects in a multi-project build. The
following sample shows how to perform extra configuration from an init script
_before_ the projects are evaluated. This sample uses this feature to
configure an extra repository to be used only for certain environments.

Example 1. Using init script to perform extra configuration before projects
are evaluated

build.gradle

    
    
    repositories {
        mavenCentral()
    }
    
    task showRepos {
        doLast {
            println "All repos:"
            println repositories.collect { it.name }
        }
    }

init.gradle

    
    
    allprojects {
        repositories {
            mavenLocal()
        }
    }

build.gradle.kts

    
    
    repositories {
        mavenCentral()
    }
    
    tasks.register("showRepos") {
        doLast {
            println("All repos:")
            //TODO:kotlin-dsl remove filter once we're no longer on a kotlin eap
            println(repositories.map { it.name }.filter { it != "maven" })
        }
    }

init.gradle.kts

    
    
    allprojects {
        repositories {
            mavenLocal()
        }
    }

#### Output when applying the init script

    
    
    > gradle --init-script init.gradle -q showRepos
    All repos:
    [MavenLocal, MavenRepo]
    
    
    > gradle --init-script init.gradle.kts -q showRepos
    All repos:
    [MavenLocal, MavenRepo]

## External dependencies for the init script

In [External dependencies for the build
script](tutorial_using_tasks.html#sec:build_script_external_dependencies) it
was explained how to add external dependencies to a build script. Init scripts
can also declare dependencies. You do this with the `initscript()` method,
passing in a closure which declares the init script classpath.

Example 2. Declaring external dependencies for an init script

init.gradle

    
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath 'org.apache.commons:commons-math:2.0'
        }
    }

init.gradle.kts

    
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath("org.apache.commons:commons-math:2.0")
        }
    }

The closure passed to the `initscript()` method configures a
[ScriptHandler](../javadoc/org/gradle/api/initialization/dsl/ScriptHandler.html)
instance. You declare the init script classpath by adding dependencies to the
`classpath` configuration. This is the same way you declare, for example, the
Java compilation classpath. You can use any of the dependency types described
in [Declaring Dependencies](declaring_dependencies.html), except project
dependencies.

Having declared the init script classpath, you can use the classes in your
init script as you would any other classes on the classpath. The following
example adds to the previous example, and uses classes from the init script
classpath.

Example 3. An init script with external dependencies

init.gradle

    
    
    import org.apache.commons.math.fraction.Fraction
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath 'org.apache.commons:commons-math:2.0'
        }
    }
    
    println Fraction.ONE_FIFTH.multiply(2)

init.gradle.kts

    
    
    import org.apache.commons.math.fraction.Fraction
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath("org.apache.commons:commons-math:2.0")
        }
    }
    
    println(Fraction.ONE_FIFTH.multiply(2))

Output when applying the init script

    
    
    > gradle --init-script init.gradle -q doNothing
    2 / 5
    
    
    > gradle --init-script init.gradle.kts -q doNothing
    2 / 5

## Init script plugins

Similar to a Gradle build script or a Gradle settings file, plugins can be
applied on init scripts.

Example 4. Using plugins in init scripts

init.gradle

    
    
    apply plugin: EnterpriseRepositoryPlugin
    
    class EnterpriseRepositoryPlugin implements Plugin<Gradle> {
    
        private static String ENTERPRISE_REPOSITORY_URL = "https://repo.gradle.org/gradle/repo"
    
        void apply(Gradle gradle) {
            // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
            gradle.allprojects { project ->
                project.repositories {
    
                    // Remove all repositories not pointing to the enterprise repository url
                    all { ArtifactRepository repo ->
                        if (!(repo instanceof MavenArtifactRepository) ||
                              repo.url.toString() != ENTERPRISE_REPOSITORY_URL) {
                            project.logger.lifecycle "Repository ${repo.url} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed"
                            remove repo
                        }
                    }
    
                    // add the enterprise repository
                    maven {
                        name "STANDARD_ENTERPRISE_REPO"
                        url ENTERPRISE_REPOSITORY_URL
                    }
                }
            }
        }
    }

build.gradle

    
    
    repositories{
        mavenCentral()
    }
    
     task showRepositories {
         doLast {
             repositories.each {
                 println "repository: ${it.name} ('${it.url}')"
             }
         }
    }

init.gradle.kts

    
    
    apply<EnterpriseRepositoryPlugin>()
    
    class EnterpriseRepositoryPlugin : Plugin<Gradle> {
        companion object {
            const val ENTERPRISE_REPOSITORY_URL = "https://repo.gradle.org/gradle/repo"
        }
    
        override fun apply(gradle: Gradle) {
            // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
            gradle.allprojects {
                repositories {
    
                    // Remove all repositories not pointing to the enterprise repository url
                    all {
                        if (this !is MavenArtifactRepository || url.toString() != ENTERPRISE_REPOSITORY_URL) {
                            project.logger.lifecycle("Repository ${(this as? MavenArtifactRepository)?.url ?: name} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed")
                            remove(this)
                        }
                    }
    
                    // add the enterprise repository
                    add(maven {
                        name = "STANDARD_ENTERPRISE_REPO"
                        url = uri(ENTERPRISE_REPOSITORY_URL)
                    })
                }
            }
        }
    }

build.gradle.kts

    
    
    repositories{
        mavenCentral()
    }
    
    tasks.register("showRepositories") {
        doLast {
            repositories.map { it as MavenArtifactRepository }.forEach {
                println("repository: ${it.name} ('${it.url}')")
            }
        }
    }

Output when applying the init script

    
    
    > gradle --init-script init.gradle -q showRepositories
    repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')
    
    
    > gradle --init-script init.gradle.kts -q showRepositories
    repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')

The plugin in the init script ensures that only a specified repository is used
when running the build.

When applying plugins within the init script, Gradle instantiates the plugin
and calls the plugin instance's
[Plugin.apply(T)](../javadoc/org/gradle/api/Plugin.html#apply-T-) method. The
`gradle` object is passed as a parameter, which can be used to configure all
aspects of a build. Of course, the applied plugin can be resolved as an
external dependency as described in External dependencies for the init script

**Docs**

  * [User Manual](/userguide/userguide.html)
  * [DSL Reference](/dsl/)
  * [Release Notes](/release-notes.html)
  * [Javadoc](/javadoc/)

**News**

  * [Blog](https://blog.gradle.org/)
  * [Newsletter](https://newsletter.gradle.com/)
  * [Twitter](https://twitter.com/gradle)
  * [Status Page](https://status.gradle.com/)

**Products**

  * [Build Scans](https://gradle.com/build-scans/)
  * [Build Cache](https://gradle.com/build-cache/)
  * [Enterprise Docs](https://gradle.com/enterprise/resources/)

**Get Help**

  * [Forums](https://discuss.gradle.org/c/help-discuss)
  * [GitHub](https://github.com/gradle/)
  * [Training](https://gradle.com/training/)
  * [Services](https://gradle.org/services/)

##### Stay `UP-TO-DATE` on new features and news

By entering your email, you agree to our
[Terms](https://gradle.com/legal/terms-of-service/) and [Privacy
Policy](https://gradle.com/legal/privacy/), including receipt of emails. You
can unsubscribe at any time.

Subscribe

© [Gradle Inc.](https://gradle.com) 2020 All rights reserved.

[ gradle ](/)

[Careers](https://gradle.com/careers/) |
[Privacy](https://gradle.com/legal/privacy/) | [Terms of
Service](https://gradle.com/legal/terms-of-service/) |
[Contact](https://gradle.org/contact/)

