

[ Gradle ](https://docs.gradle.org/ "Gradle Docs")

用户手册

  * 社区 Open Community Menu

[ 社区之家 ](https://gradle.org/)

[ 社区论坛 ](https://discuss.gradle.org/)

[ 社区插件 ](https://plugins.gradle.org/)

  * [训练](https://gradle.com/training/)
  * 新闻 Open Community Menu

[ 通讯 ](https://newsletter.gradle.com/)

[ 博客 ](https://blog.gradle.org/)

[ 推特 ](https://twitter.com/gradle)

  * [企业](https://gradle.com/)
  * [github](https://github.com/gradle/gradle "GitHub上的Gradle")

  * [文件首页](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.html)
  * [样品](file:///Users/dxs/temp/gradle-6.7.1/docs/samples/index.html)
  * [发行说明](file:///Users/dxs/temp/gradle-6.7.1/docs/release-notes.html)
  * [Gradle API](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#gradle-api)
    * [Java文档](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/index.html?overview-summary.html)
    * [Groovy DSL参考](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/index.html)
    * [Groovy DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_build_script_primer.html)
    * [Kotlin DSL API](https://gradle.github.io/kotlin-dsl-docs/api/)
    * [Kotlin DSL入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/kotlin_dsl.html)

### 用户手册

[ PDF格式 ](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/userguide.pdf)

  * [什么是Gradle？](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/what_is_gradle.html)
  * [入门](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/getting_started.html)
  * [安装Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/installation.html)
  * [升级Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#upgrading-gradle)
    * [版本6.X到最新](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_6.html)
    * [版本5.X到6.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_5.html)
    * [版本4.X到5.0](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/upgrading_version_4.html)
    * [Gradle的功能生命周期](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_lifecycle.html)
  * [迁移至Gradle ...](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#migrating-to-gradle)
    * [从Maven](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_maven.html)
    * [from Ant](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/migrating_from_ant.html)
  * [相容性说明](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/compatibility.html)
  * [对构建进行故障排除](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/troubleshooting.html)

### 运行Gradle构建

  * [自定义执行](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#customizing-execution)
    * [配置构建环境](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_environment.html)
    * [配置Gradle守护程序](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_daemon.html)
    * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html)
  * [执行多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/intro_multi_project_builds.html)
  * [检查Gradle构建](https://scans.gradle.com/)
  * [优化构建时间](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#optimizing-build-performance)
    * [Build Performance Guide](https://guides.gradle.org/performance/)
    * [Enabling and Configuring the Build Cache](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_cache.html)
    * [Using the Configuration Cache](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/configuration_cache.html)

### 编写Gradle构建

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#learning-the-basics)
    * [Introducing the Basics of Build Scripts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html)
    * [Working with Tasks](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/more_about_tasks.html)
    * [Learning More About Build Scripts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/writing_build_scripts.html)
    * [Working with Files](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/working_with_files.html)
    * [Using Gradle Plugins](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugins.html)
    * [Understanding the Build Lifecycle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_lifecycle.html)
    * [Working with Logging](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/logging.html)
    * [Avoiding Traps](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/potential_traps.html)
  * [创作多项目构建](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#authoring-multi-project-builds)
    * [Creating a Basic Multi-Project Build](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_builds.html)
    * [Declaring Dependencies between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies_between_subprojects.html)
    * [Sharing Build Logic between Subprojects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/sharing_build_logic_between_subprojects.html)
    * [Fine Tuning the Project Layout](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/fine_tuning_project_layout.html)
    * [Understanding Configuration and Execution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/multi_project_configuration_and_execution.html)
  * [创作可持续建筑](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#authoring-sustainable-builds)
    * [Organizing Build Logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html)
    * [Following Best Practices](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/authoring_maintainable_build_scripts.html)
  * [先进技术](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#advanced-techniques)
    * [Developing Parallel Tasks](https://guides.gradle.org/using-the-worker-api/)
    * [Testing a Build with TestKit](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/test_kit.html)
    * [Using Ant from Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/ant.html)

### 编写JVM构建

  * [构建Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_java_projects.html)
  * [测试Java和JVM项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_testing.html)
  * [Java项目的工具链](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/toolchains.html)
  * [管理依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_for_java_projects.html)
  * [JVM插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#jvm-plugins)
    * [Java Library Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_library_plugin.html)
    * [Java Application Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/application_plugin.html)
    * [Java Platform Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/java_platform_plugin.html)
    * [Groovy Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/groovy_plugin.html)
    * [Scala Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/scala_plugin.html)

### 编写C ++ / Swift构建

  * [构建C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_cpp_projects.html)
  * [测试C ++项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cpp_testing.html)
  * [建立Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/building_swift_projects.html)
  * [测试Swift项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/swift_testing.html)

### 使用依赖项

  * [学习基础](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#learning-the-basics-dependency-management)
    * [What is Dependency Management?](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/core_dependency_management.html)
    * [Declaring Repositories](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_repositories.html)
    * [Declaring Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)
    * [Understanding Library and Application Differences](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/library_vs_application.html)
    * [Viewing and Debugging Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/viewing_debugging_dependencies.html)
    * [Understanding Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_resolution.html)
    * [Verifying dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_verification.html)
  * [声明版本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#declaring-dependency-versions)
    * [Declaring Versions and Ranges](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/single_versions.html)
    * [Declaring Rich Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/rich_versions.html)
    * [Handling Changing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dynamic_versions.html)
    * [Locking Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_locking.html)
  * [控制翻译](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#controlling-transitive-dependencies)
    * [Upgrading Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_constraints.html)
    * [Downgrading and Excluding](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_downgrade_and_exclude.html)
    * [Sharing Versions](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/platforms.html)
    * [Aligning Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_version_alignment.html)
    * [Handling Mutually Exclusive Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_capability_conflict.html)
    * [Fixing Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_metadata_rules.html)
    * [Customizing Resolution](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_rules.html)
    * [Preventing accidental upgrades](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/resolution_strategy_tuning.html)
  * [图书馆的生产和消费形式](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#modeling-features)
    * [Declaring Capabilities of a Library](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/component_capabilities.html)
    * [Modeling Feature Variants and Optional Dependencies](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/feature_variants.html)
    * [Understanding Variant Selection](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_model.html)
    * [Declaring Variant Attributes](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/variant_attributes.html)
    * [Sharing Outputs of Projects](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/cross_project_publications.html)
    * [Transforming Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/artifact_transforms.html)
  * [在多仓库环境中工作](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#multi-repo)
    * [Composing Builds](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/composite_builds.html)
  * [出版图书馆](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#publishing)
    * [Setting up Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_setup.html)
    * [Understanding Gradle Module Metadata](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_gradle_module_metadata.html)
    * [Signing Artifacts](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_signing.html)
    * [Customizing Publishing](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_customization.html)
    * [Maven Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_maven.html)
    * [Ivy Publish Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/publishing_ivy.html)
  * [术语](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/dependency_management_terminology.html)

### 扩展摇篮

  * [插件开发教程](https://gradle.org/guides/?q=Plugin%20Development)
  * [编写Gradle任务类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_tasks.html)
  * [编写Gradle插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_plugins.html)
  * [编写自定义Gradle类型](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/custom_gradle_types.html)
  * [延迟配置任务](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/lazy_configuration.html)
  * [使用避免任务配置](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/task_configuration_avoidance.html)

### 参考

  * [核心插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/plugin_reference.html)
  * [命令行界面](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/command_line_interface.html)
  * [Gradle和第三方工具](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/third_party_integration.html)
  * [摇篮包装](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html)
  * [Gradle管理的目录](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/directory_layout.html)

# 初始化脚本

version 6.7.1

内容

  * [基本用法](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:basic_usage)
  * [使用初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:using_an_init_script)
  * [编写一个初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:writing_an_init_script)
  * [初始化脚本的外部依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:custom_classpath)
  * [初始化脚本插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:init_script_plugins)

Gradle provides a powerful mechanism to allow customizing the build based on
the current environment. This mechanism also supports tools that wish to
integrate with Gradle.

Note that this is completely different from the “`init`” task provided by the
“`build-init`” plugin (see [Build Init
Plugin](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/build_init_plugin.html#build_init_plugin)).

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:basic_usage)[Basic
usage](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:basic_usage)

Initialization scripts (a.k.a. _init scripts_ ) are similar to other scripts
in Gradle. These scripts, however, are run before the build starts. Here are
several possible uses:

  * Set up enterprise-wide configuration, such as where to find custom plugins.

  * Set up properties based on the current environment, such as a developer’s machine vs. a continuous integration server.

  * Supply personal information about the user that is required by the build, such as repository or database authentication credentials.

  * Define machine specific details, such as where JDKs are installed.

  * Register build listeners. External tools that wish to listen to Gradle events might find this useful.

  * Register build loggers. You might wish to customize how Gradle logs the events that it generates.

One main limitation of init scripts is that they cannot access classes in the
`buildSrc` project (see [Using buildSrc to extract imperative
logic](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/organizing_gradle_projects.html#sec:build_sources)
for details of this feature).

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:using_an_init_script)[Using
an init
script](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:using_an_init_script)

There are several ways to use an init script:

  * 在命令行上指定一个文件。命令行选项位于脚本路径之后，`-I`或`--init-script`位于脚本路径之后。命令行选项可以多次出现，每次添加另一个初始化脚本。如果命令行上指定的任何文件不存在，则构建将失败。

  * 在目录中放置一个名为`init.gradle`（或`init.gradle.kts`Kotlin的）` _USER_HOME_ /.gradle/`文件。

  * 在目录中放置一个以`.gradle`（或`.init.gradle.kts`Kotlin）结尾的文件` _USER_HOME_ /.gradle/init.d/`。

  * 在Gradle发行版的目录中放置一个以`.gradle`（或`.init.gradle.kts`Kotlin）结尾的文件` _GRADLE_HOME_ /init.d/`。这使您可以打包包含一些自定义构建逻辑和插件的自定义Gradle发行版。您可以将其与[Gradle包装器](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/gradle_wrapper.html#gradle_wrapper)结合使用，以使自定义逻辑可用于企业中的所有内部版本。

如果发现一个以上的初始化脚本，它们将全部按照上面指定的顺序执行。给定目录中的脚本按字母顺序执行。例如，这允许使用一种工具在命令行上指定一个初始化脚本，并且用户可以将一个脚本放入其主目录中以定义环境，并且在执行Gradle时，这两个脚本都将运行。

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:writing_an_init_script)[编写一个初始化脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:writing_an_init_script)

类似于Gradle构建脚本，初始化脚本是Groovy或Kotlin脚本。每个初始化脚本都有一个与之关联的[Gradle](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.invocation.Gradle.html)实例。初始化脚本中的任何属性引用和方法调用都将委派给该`Gradle`实例。

每个初始化脚本还实现[脚本](file:///Users/dxs/temp/gradle-6.7.1/docs/dsl/org.gradle.api.Script.html)接口。

###
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:configuring_projects_from_an_init_script)[通过初始化脚本配置项目](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:configuring_projects_from_an_init_script)

您可以使用初始化脚本来配置构建中的项目。这与在多项目构建中配置项目的方式类似。以下示例显示了 _在_ 评估项目 _之前_
如何通过初始化脚本执行额外的配置。本样本使用此功能来配置额外的存储库，以仅用于某些环境。

示例1.在评估项目之前，使用init脚本执行额外的配置

`Groovy``Kotlin`

build.gradle

    
    
    repositories {
        mavenCentral()
    }
    
    task showRepos {
        doLast {
            println "All repos:"
            println repositories.collect { it.name }
        }
    }

初始化等级

    
    
    allprojects {
        repositories {
            mavenLocal()
        }
    }

build.gradle.kts

    
    
    repositories {
        mavenCentral()
    }
    
    tasks.register("showRepos") {
        doLast {
            println("All repos:")
            //TODO:kotlin-dsl remove filter once we're no longer on a kotlin eap
            println(repositories.map { it.name }.filter { it != "maven" })
        }
    }

init.gradle.kts

    
    
    allprojects {
        repositories {
            mavenLocal()
        }
    }

####
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#output_when_applying_the_init_script)[应用初始化脚本时的输出](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#output_when_applying_the_init_script)

`Groovy``Kotlin`

    
    
    > gradle --init-script init.gradle -q showRepos
    All repos:
    [MavenLocal, MavenRepo]
    
    
    > gradle --init-script init.gradle.kts -q showRepos
    All repos:
    [MavenLocal, MavenRepo]

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:custom_classpath)[初始化脚本的外部依赖关系](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:custom_classpath)

在[构建脚本的外部依赖关系中，](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/tutorial_using_tasks.html#sec:build_script_external_dependencies)说明了如何向构建脚本添加外部依赖关系。初始化脚本也可以声明依赖关系。您可以使用`initscript()`方法执行此操作，并传入一个声明初始化脚本类路径的闭包。

例子2.声明一个初始化脚本的外部依赖

`Groovy``Kotlin`

初始化等级

    
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath 'org.apache.commons:commons-math:2.0'
        }
    }

init.gradle.kts

    
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath("org.apache.commons:commons-math:2.0")
        }
    }

传递给该`initscript()`方法的闭包将配置[ScriptHandler](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/initialization/dsl/ScriptHandler.html)实例。您可以通过向`classpath`配置添加依赖项来声明初始化脚本类路径。例如，这与声明Java编译类路径的方式相同。您可以使用“[声明依赖项”中](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/declaring_dependencies.html)描述的任何依赖项类型，项目依赖项除外。

声明了初始化脚本的类路径后，您可以像使用该类路径上的任何其他类一样，使用初始化脚本中的类。以下示例将添加到前面的示例中，并使用init脚本classpath中的类。

例子3.具有外部依赖关系的初始化脚本

`Groovy``Kotlin`

初始化等级

    
    
    import org.apache.commons.math.fraction.Fraction
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath 'org.apache.commons:commons-math:2.0'
        }
    }
    
    println Fraction.ONE_FIFTH.multiply(2)

init.gradle.kts

    
    
    import org.apache.commons.math.fraction.Fraction
    
    initscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath("org.apache.commons:commons-math:2.0")
        }
    }
    
    println(Fraction.ONE_FIFTH.multiply(2))

应用初始化脚本时的输出

`Groovy``Kotlin`

    
    
    > gradle --init-script init.gradle -q doNothing
    2 / 5
    
    
    > gradle --init-script init.gradle.kts -q doNothing
    2 / 5

##
[](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:init_script_plugins)[初始化脚本插件](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:init_script_plugins)

类似于Gradle构建脚本或Gradle设置文件，可以将插件应用于初始化脚本。

例子4.在初始化脚本中使用插件

`Groovy``Kotlin`

初始化等级

    
    
    apply plugin: EnterpriseRepositoryPlugin
    
    class EnterpriseRepositoryPlugin implements Plugin<Gradle> {
    
        private static String ENTERPRISE_REPOSITORY_URL = "https://repo.gradle.org/gradle/repo"
    
        void apply(Gradle gradle) {
            // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
            gradle.allprojects { project ->
                project.repositories {
    
                    // Remove all repositories not pointing to the enterprise repository url
                    all { ArtifactRepository repo ->
                        if (!(repo instanceof MavenArtifactRepository) ||
                              repo.url.toString() != ENTERPRISE_REPOSITORY_URL) {
                            project.logger.lifecycle "Repository ${repo.url} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed"
                            remove repo
                        }
                    }
    
                    // add the enterprise repository
                    maven {
                        name "STANDARD_ENTERPRISE_REPO"
                        url ENTERPRISE_REPOSITORY_URL
                    }
                }
            }
        }
    }

build.gradle

    
    
    repositories{
        mavenCentral()
    }
    
     task showRepositories {
         doLast {
             repositories.each {
                 println "repository: ${it.name} ('${it.url}')"
             }
         }
    }

init.gradle.kts

    
    
    apply<EnterpriseRepositoryPlugin>()
    
    class EnterpriseRepositoryPlugin : Plugin<Gradle> {
        companion object {
            const val ENTERPRISE_REPOSITORY_URL = "https://repo.gradle.org/gradle/repo"
        }
    
        override fun apply(gradle: Gradle) {
            // ONLY USE ENTERPRISE REPO FOR DEPENDENCIES
            gradle.allprojects {
                repositories {
    
                    // Remove all repositories not pointing to the enterprise repository url
                    all {
                        if (this !is MavenArtifactRepository || url.toString() != ENTERPRISE_REPOSITORY_URL) {
                            project.logger.lifecycle("Repository ${(this as? MavenArtifactRepository)?.url ?: name} removed. Only $ENTERPRISE_REPOSITORY_URL is allowed")
                            remove(this)
                        }
                    }
    
                    // add the enterprise repository
                    add(maven {
                        name = "STANDARD_ENTERPRISE_REPO"
                        url = uri(ENTERPRISE_REPOSITORY_URL)
                    })
                }
            }
        }
    }

build.gradle.kts

    
    
    repositories{
        mavenCentral()
    }
    
    tasks.register("showRepositories") {
        doLast {
            repositories.map { it as MavenArtifactRepository }.forEach {
                println("repository: ${it.name} ('${it.url}')")
            }
        }
    }

应用初始化脚本时的输出

`Groovy``Kotlin`

    
    
    > gradle --init-script init.gradle -q showRepositories
    repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')
    
    
    > gradle --init-script init.gradle.kts -q showRepositories
    repository: STANDARD_ENTERPRISE_REPO ('https://repo.gradle.org/gradle/repo')

初始化脚本中的插件可确保在运行构建时仅使用指定的存储库。

在初始化脚本中应用插件时，Gradle实例化插件并调用插件实例的[Plugin.apply（T）](file:///Users/dxs/temp/gradle-6.7.1/docs/javadoc/org/gradle/api/Plugin.html#apply-T-)方法。该`gradle`对象作为参数传递，可用于配置构建的各个方面。当然，可以将应用的插件解析为外部依赖项，如[init脚本的外部依赖项中所述](file:///Users/dxs/temp/gradle-6.7.1/docs/userguide/init_scripts.html#sec:custom_classpath)

**文件**

  * [用户手册](file:///userguide/userguide.html)
  * [DSL参考](file:///dsl/)
  * [发行说明](file:///release-notes.html)
  * [Java文档](file:///javadoc/)

**新闻**

  * [博客](https://blog.gradle.org/)
  * [通讯](https://newsletter.gradle.com/)
  * [推特](https://twitter.com/gradle)
  * [状态页](https://status.gradle.com/)

**产品展示**

  * [构建扫描](https://gradle.com/build-scans/)
  * [构建缓存](https://gradle.com/build-cache/)
  * [企业文件](https://gradle.com/enterprise/resources/)

**得到帮助**

  * [论坛](https://discuss.gradle.org/c/help-discuss)
  * [的GitHub](https://github.com/gradle/)
  * [训练](https://gradle.com/training/)
  * [服务](https://gradle.org/services/)

##### 随时`UP-TO-DATE`关注新功能和新闻

输入您的电子邮件，即表示您同意我们的[条款](https://gradle.com/legal/terms-of-
service/)和[隐私政策](https://gradle.com/legal/privacy/)，包括接收电子邮件。您可以随时取消订阅。

订阅

© [Gradle Inc.](https://gradle.com/) 2020年 版权所有。

[ gradle ](file:///)

[招贤纳士](https://gradle.com/careers/)| [隐私](https://gradle.com/legal/privacy/)|
[服务条款](https://gradle.com/legal/terms-of-service/)|
[联系](https://gradle.org/contact/)

![Google 翻译](./初始化脚本_files/translate_24dp.png)

# 原文

提供更好的翻译建议

* * *

